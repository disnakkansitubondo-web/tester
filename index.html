<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>APLIKASI BARJAS - SISTEM BANTUAN</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-datepicker/1.9.0/css/bootstrap-datepicker.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.28/jspdf.plugin.autotable.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <style>
        :root {
            --primary-color: #0d47a1;
            --secondary-color: #00695c;
            --accent-color: #ff8f00;
            --light-blue: #e3f2fd;
            --dark-blue: #082e5c;
            --gradient-primary: linear-gradient(135deg, var(--primary-color), var(--dark-blue));
            --gradient-secondary: linear-gradient(135deg, var(--secondary-color), #004d40);
            --gradient-accent: linear-gradient(135deg, var(--accent-color), #e65100);
            --shadow-sm: 0 2px 8px rgba(0,0,0,0.08);
            --shadow-md: 0 4px 16px rgba(0,0,0,0.12);
            --shadow-lg: 0 8px 28px rgba(0,0,0,0.15);
            --login-gradient: linear-gradient(135deg, #0d47a1, #00695c, #ff8f00);
        }
        
        body {
            background: linear-gradient(135deg, #f5f9ff 0%, #e8f5e9 100%);
            font-family: 'Poppins', 'Segoe UI', sans-serif;
            min-height: 100vh;
            padding: 10px 0;
            overflow-x: hidden;
        }
        
        .app-container {
            max-width: 1600px;
            margin: 0 auto;
            background: white;
            box-shadow: var(--shadow-lg);
            border-radius: 12px;
            overflow: hidden;
            position: relative;
            z-index: 10;
        }
        
        .app-header {
            background: var(--gradient-primary);
            color: white;
            padding: 20px 15px;
            text-align: center;
            position: relative;
            overflow: hidden;
        }
        
        .app-header::before {
            content: "";
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(255,255,255,0.15) 0%, transparent 70%);
            pointer-events: none;
        }
        
        .app-logo {
            font-size: 2.5rem;
            margin-bottom: 10px;
            position: relative;
            z-index: 1;
        }
        
        .app-title {
            font-size: 1.8rem;
            font-weight: 800;
            margin: 0;
            position: relative;
            z-index: 1;
            text-shadow: 1px 1px 4px rgba(0,0,0,0.3);
        }
        
        .app-subtitle {
            font-size: 1rem;
            opacity: 0.95;
            position: relative;
            z-index: 1;
            font-weight: 300;
            letter-spacing: 0.5px;
            margin-bottom: 5px;
        }
        
        .nav-pills .nav-link {
            border-radius: 8px;
            margin-bottom: 8px;
            padding: 12px 15px;
            font-weight: 500;
            color: #444;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            font-size: 0.9rem;
        }
        
        .nav-pills .nav-link:hover {
            background-color: #f0f7ff;
            transform: translateX(3px);
        }
        
        .nav-pills .nav-link.active {
            background: var(--gradient-primary);
            font-weight: 600;
            box-shadow: var(--shadow-md);
            transform: translateX(3px);
            color: white;
        }
        
        .section-title {
            border-left: 4px solid var(--primary-color);
            padding-left: 12px;
            margin: 20px 0;
            font-weight: 700;
            color: var(--dark-blue);
            font-size: 1.4rem;
            position: relative;
        }
        
        .section-title::after {
            content: "";
            position: absolute;
            bottom: -5px;
            left: 12px;
            width: 40px;
            height: 2px;
            background: var(--gradient-primary);
            border-radius: 2px;
        }
        
        .btn-primary {
            background: var(--gradient-primary);
            border: none;
            padding: 10px 20px;
            font-weight: 600;
            box-shadow: var(--shadow-md);
            border-radius: 8px;
            transition: all 0.3s;
            font-size: 0.9rem;
        }
        
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-lg);
        }
        
        .btn-success {
            background: var(--gradient-secondary);
            border: none;
            padding: 10px 20px;
            font-weight: 600;
            box-shadow: var(--shadow-md);
            border-radius: 8px;
            transition: all 0.3s;
            font-size: 0.9rem;
        }
        
        .btn-success:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-lg);
        }
        
        .btn-warning {
            background: var(--gradient-accent);
            border: none;
            padding: 10px 20px;
            font-weight: 600;
            box-shadow: var(--shadow-md);
            border-radius: 8px;
            transition: all 0.3s;
            font-size: 0.9rem;
        }
        
        .btn-warning:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-lg);
        }
        
        .form-label {
            font-weight: 600;
            color: #444;
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            font-size: 0.9rem;
        }
        
        .form-label i {
            margin-right: 6px;
            color: var(--primary-color);
        }
        
        .form-control, .form-select {
            border-radius: 8px;
            padding: 12px 15px;
            border: 1px solid #ddd;
            transition: all 0.3s;
            box-shadow: var(--shadow-sm);
            font-size: 0.9rem;
        }
        
        .form-control:focus, .form-select:focus {
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(13, 71, 161, 0.2);
            transform: translateY(-2px);
        }
        
        .copyright {
            text-align: center;
            padding: 20px;
            background-color: var(--light-blue);
            color: var(--dark-blue);
            font-size: 0.9rem;
            font-weight: 500;
        }
        
        .data-table {
            font-size: 0.85rem;
            border-collapse: separate;
            border-spacing: 0;
            box-shadow: var(--shadow-sm);
            border-radius: 8px;
            overflow: hidden;
        }
        
        .data-table th {
            background: var(--gradient-primary);
            color: white;
            font-weight: 600;
            padding: 12px 10px;
            text-align: center;
            position: relative;
            font-size: 0.85rem;
        }
        
        .data-table th::after {
            content: "";
            position: absolute;
            bottom: 0;
            left: 0;
            width: 100%;
            height: 1px;
            background: rgba(255,255,255,0.3);
        }
        
        .data-table td {
            padding: 10px 8px;
            vertical-align: middle;
            border-bottom: 1px solid #eee;
            font-size: 0.85rem;
        }
        
        .data-table tr:nth-child(even) {
            background-color: #f9fbff;
        }
        
        .data-table tr:hover {
            background-color: #edf5ff;
        }
        
        .feature-icon {
            font-size: 1.1rem;
            margin-right: 8px;
            width: 24px;
            text-align: center;
        }
        
        .card {
            border-radius: 10px;
            border: none;
            box-shadow: var(--shadow-md);
            transition: all 0.3s ease;
            overflow: hidden;
            margin-bottom: 15px;
        }
        
        .card:hover {
            transform: translateY(-5px);
            box-shadow: var(--shadow-lg);
        }
        
        .card-header {
            border-radius: 10px 10px 0 0 !important;
            font-weight: 600;
            padding: 15px 20px;
            background: var(--gradient-primary);
            color: white;
            font-size: 0.95rem;
        }
        
        .stats-box {
            text-align: center;
            padding: 20px 15px;
            border-radius: 10px;
            background: white;
            box-shadow: var(--shadow-md);
            transition: all 0.3s;
            position: relative;
            overflow: hidden;
            margin-bottom: 15px;
        }
        
        .stats-box::before {
            content: "";
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 4px;
            background: var(--gradient-primary);
            border-radius: 2px;
        }
        
        .stats-box:hover {
            transform: translateY(-3px);
            box-shadow: var(--shadow-lg);
        }
        
        .stats-number {
            font-size: 1.8rem;
            font-weight: 800;
            color: var(--primary-color);
            margin: 10px 0;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.1);
        }
        
        .stats-label {
            font-size: 0.9rem;
            color: #666;
            font-weight: 500;
        }
        
        .notification-toast {
            position: fixed;
            bottom: 20px;
            right: 20px;
            z-index: 1050;
            min-width: 280px;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: var(--shadow-lg);
            max-width: calc(100vw - 40px);
        }
        
        .input-error {
            border-color: #dc3545;
            box-shadow: 0 0 0 3px rgba(220, 53, 69, 0.2);
        }
        
        .error-message {
            color: #dc3545;
            font-size: 0.8rem;
            margin-top: 5px;
            display: none;
            font-weight: 500;
        }
        
        .watermark {
            position: absolute;
            bottom: 10px;
            right: 15px;
            opacity: 0.8;
            font-size: 0.8rem;
            color: white;
            font-weight: 300;
        }
        
        .control-panel {
            background: #f8f9fa;
            border-radius: 8px;
            padding: 15px;
            margin-top: 15px;
            box-shadow: var(--shadow-sm);
        }
        
        .control-title {
            font-size: 1rem;
            color: var(--primary-color);
            font-weight: 600;
            margin-bottom: 15px;
            padding-bottom: 8px;
            border-bottom: 1px solid var(--light-blue);
        }
        
        .floating-action-btn {
            position: fixed;
            bottom: 20px;
            right: 20px;
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background: var(--gradient-primary);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: var(--shadow-lg);
            z-index: 1000;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .floating-action-btn:hover {
            transform: scale(1.1) rotate(90deg);
        }
        
        .filter-section {
            background: white;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 20px;
            box-shadow: var(--shadow-sm);
        }
        
        .badge-custom {
            background: var(--gradient-primary);
            color: white;
            padding: 6px 12px;
            border-radius: 16px;
            font-weight: 600;
            font-size: 0.8rem;
        }
        
        .mobile-menu-btn {
            display: none;
            position: fixed;
            top: 15px;
            left: 15px;
            z-index: 1050;
            background: var(--gradient-primary);
            color: white;
            border: none;
            border-radius: 50%;
            width: 45px;
            height: 45px;
            box-shadow: var(--shadow-lg);
        }
        
        .sidebar-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 1040;
        }
        
        /* Animations */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .animate-fadeIn {
            animation: fadeIn 0.5s ease forwards;
        }
        
        /* Custom scrollbar */
        ::-webkit-scrollbar {
            width: 6px;
        }
        
        ::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 8px;
        }
        
        ::-webkit-scrollbar-thumb {
            background: var(--primary-color);
            border-radius: 8px;
        }
        
        ::-webkit-scrollbar-thumb:hover {
            background: var(--dark-blue);
        }
        
        /* Responsive styles */
        @media (max-width: 991.98px) {
            .col-md-3.col-lg-2 {
                position: fixed;
                left: -300px;
                top: 0;
                bottom: 0;
                z-index: 1050;
                width: 280px;
                transition: left 0.3s ease;
                overflow-y: auto;
                padding-top: 60px;
            }
            
            .col-md-3.col-lg-2.mobile-show {
                left: 0;
            }
            
            .col-md-9.col-lg-10 {
                width: 100%;
                flex: 0 0 100%;
                max-width: 100%;
            }
            
            .mobile-menu-btn {
                display: flex;
                align-items: center;
                justify-content: center;
            }
            
            .sidebar-overlay.mobile-show {
                display: block;
            }
        }
        
        /* Print Styles - IMPROVED FOR LANDSCAPE */
        @media print {
            @page {
                size: landscape;
                margin: 0.5cm;
            }
            
            body * {
                visibility: hidden;
            }
            
            .app-container, .app-container * {
                visibility: visible;
            }
            
            .app-container {
                position: absolute;
                left: 0;
                top: 0;
                width: 100%;
                box-shadow: none;
            }
            
            .nav-pills, .mobile-menu-btn, .sidebar-overlay, .floating-action-btn,
            .btn-group, .filter-section, .toast {
                display: none !important;
            }
            
            .col-md-3.col-lg-2.p-4.bg-light {
                display: none !important;
            }
            
            .col-md-9.col-lg-10.p-5 {
                width: 100%;
                flex: 0 0 100%;
                max-width: 100%;
                padding: 0 !important;
            }
            
            .copyright {
                display: none;
            }
            
            .data-table {
                font-size: 10px;
                width: 100% !important;
            }
            
            .data-table th, .data-table td {
                padding: 4px 2px;
            }
            
            /* Sembunyikan kolom aksi dan link Google Drive saat mencetak */
            .data-table th:last-child,
            .data-table td:last-child {
                display: none !important;
            }
            
            /* Judul untuk laporan cetak */
            .print-header {
                display: block !important;
                text-align: center;
                margin-bottom: 15px;
            }
            
            .print-title {
                font-size: 18px;
                font-weight: bold;
                margin-bottom: 5px;
            }
            
            .print-subtitle {
                font-size: 14px;
                margin-bottom: 10px;
            }
            
            .print-date {
                font-size: 12px;
                text-align: right;
                margin-bottom: 10px;
            }
        }

        /* WhatsApp link style */
        .whatsapp-link {
            color: #25D366;
            text-decoration: none;
        }
        
        .whatsapp-link:hover {
            text-decoration: underline;
        }
        
        /* View Link Button */
        .btn-view {
            background: linear-gradient(135deg, #17a2b8, #138496);
            color: white;
            border: none;
            padding: 5px 10px;
            border-radius: 4px;
            font-size: 0.8rem;
        }
        
        .btn-view:hover {
            background: linear-gradient(135deg, #138496, #117a8b);
            color: white;
        }
        
        /* Undo Button */
        .btn-undo {
            background: linear-gradient(135deg, #6c757d, #5a6268);
            color: white;
            border: none;
        }
        
        .btn-undo:hover {
            background: linear-gradient(135deg, #5a6268, #4e555b);
            color: white;
        }
        
        /* WhatsApp number link in table */
        .whatsapp-number {
            color: #25D366;
            cursor: pointer;
            text-decoration: underline;
        }
        
        /* Welcome Modal Styles */
        .welcome-modal .modal-content {
            border-radius: 15px;
            overflow: hidden;
            border: none;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }
        
        .welcome-header {
            background: var(--gradient-primary);
            color: white;
            text-align: center;
            padding: 25px;
        }
        
        .welcome-icon {
            font-size: 3rem;
            margin-bottom: 15px;
            color: white;
        }
        
        .welcome-body {
            padding: 25px;
            text-align: center;
        }
        
        .welcome-footer {
            background: #f8f9fa;
            padding: 15px;
            text-align: center;
            border-top: 1px solid #eee;
        }
        
        .countdown-timer {
            font-size: 0.9rem;
            color: #6c757d;
            margin-top: 10px;
        }
        
        /* Button untuk cetak per data */
        .btn-print-individual {
            background: linear-gradient(135deg, #6f42c1, #5a2d95);
            color: white;
            border: none;
            padding: 5px 10px;
            border-radius: 4px;
            font-size: 0.8rem;
        }
        
        .btn-print-individual:hover {
            background: linear-gradient(135deg, #5a2d95, #4a2479);
            color: white;
        }
        
        /* Developer Info Styles */
        .developer-info {
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            border-radius: 10px;
            padding: 15px;
            margin-top: 20px;
            box-shadow: var(--shadow-sm);
        }
        
        .developer-info h6 {
            color: var(--primary-color);
            font-weight: 600;
            margin-bottom: 15px;
            padding-bottom: 8px;
            border-bottom: 1px solid #ddd;
        }
        
        .developer-contact p {
            margin-bottom: 8px;
            font-size: 0.85rem;
        }
        
        .developer-contact a {
            color: var(--primary-color);
            text-decoration: none;
            transition: all 0.3s;
        }
        
        .developer-contact a:hover {
            color: var(--dark-blue);
            text-decoration: underline;
        }
        
        /* Loading spinner */
        .spinner-border-sm {
            width: 1rem;
            height: 1rem;
        }

        /* Login Modal Styles */
        .login-modal .modal-content {
            border-radius: 15px;
            overflow: hidden;
            border: none;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
        }

        .login-header {
            background: var(--login-gradient);
            color: white;
            text-align: center;
            padding: 25px 20px;
            position: relative;
        }

        .login-icon {
            font-size: 3rem;
            margin-bottom: 15px;
            color: white;
        }

        .login-title {
            font-size: 1.8rem;
            font-weight: 700;
            margin: 0;
        }

        .login-subtitle {
            font-size: 1rem;
            opacity: 0.9;
            margin: 5px 0 0;
        }

        .login-body {
            padding: 25px;
            position: relative;
            z-index: 1;
        }

        .login-form-group {
            margin-bottom: 20px;
        }

        .login-form-label {
            font-weight: 600;
            color: var(--dark-blue);
            margin-bottom: 8px;
            display: flex;
            align-items: center;
        }

        .login-form-label i {
            margin-right: 10px;
            color: var(--dark-blue);
        }

        .login-form-control {
            border-radius: 8px;
            padding: 12px 15px;
            border: 2px solid #ddd;
            transition: all 0.3s;
        }

        .login-form-control:focus {
            border-color: var(--dark-blue);
            box-shadow: 0 0 0 3px rgba(13, 71, 161, 0.2);
        }

        .login-input-group-text {
            background: var(--light-blue);
            border: 2px solid #ddd;
            border-left: none;
        }

        .btn-login {
            background: var(--gradient-secondary);
            color: white;
            border: none;
            padding: 12px;
            font-weight: 600;
            border-radius: 8px;
            width: 100%;
            transition: all 0.3s;
            margin-top: 10px;
        }

        .btn-login:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 105, 92, 0.4);
        }

        .btn-login:disabled {
            background: #ccc;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        .login-security-notice {
            text-align: center;
            margin-top: 20px;
            font-size: 0.85rem;
            color: #666;
        }

        .login-attempts-count {
            text-align: center;
            font-size: 0.9rem;
            color: #ff8f00;
            font-weight: 500;
            margin-top: 5px;
        }

        .login-blocked-message {
            text-align: center;
            background: rgba(220, 53, 69, 0.1);
            border-radius: 8px;
            padding: 15px;
            margin-top: 20px;
            color: #dc3545;
            font-weight: 500;
        }

        .login-countdown {
            font-size: 1.2rem;
            font-weight: 700;
            color: var(--dark-blue);
        }

        .login-developer-info {
            background: var(--light-blue);
            border-radius: 10px;
            padding: 20px;
            margin-top: 25px;
            text-align: center;
        }

        .login-developer-logo {
            max-width: 180px;
            margin-bottom: 15px;
            border-radius: 8px;
        }

        .login-developer-contact a {
            color: var(--dark-blue);
            text-decoration: none;
            transition: all 0.3s;
            display: inline-block;
            margin: 5px 0;
        }

        .login-developer-contact a:hover {
            color: var(--primary-color);
            text-decoration: underline;
            transform: translateY(-2px);
        }

        .login-copyright {
            text-align: center;
            margin-top: 20px;
            color: #666;
            font-size: 0.9rem;
            opacity: 0.9;
        }

        /* Animations */
        @keyframes login-shake {
            0%, 100% { transform: translateX(0); }
            10%, 30%, 50%, 70%, 90% { transform: translateX(-10px); }
            20%, 40%, 60%, 80% { transform: translateX(10px); }
        }

        .login-shake {
            animation: login-shake 0.6s cubic-bezier(.36,.07,.19,.97) both;
        }

        /* Login particle background */
        #login-particles {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 1040; /* Higher than modal backdrop */
            display: none;
        }

        /* Link Google Drive dalam tabel */
        .drive-link {
            color: #0d47a1;
            text-decoration: none;
            cursor: pointer;
        }

        .drive-link:hover {
            text-decoration: underline;
        }

        /* Modal untuk menambah link */
        .link-modal .modal-dialog {
            max-width: 600px;
        }
        
        /* App content when not authenticated */
        .app-content-unauthenticated {
            display: none;
        }

        /* Search box for desa dropdown */
        .dropdown-search-container {
            position: relative;
        }

        .dropdown-search {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            z-index: 1000;
            background: white;
            border: 1px solid #ddd;
            border-radius: 8px;
            padding: 8px;
            display: none;
        }

        .dropdown-search input {
            width: 100%;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
        }

        /* Kode Validasi Styles */
        .kode-validasi-container {
            display: flex;
            align-items: center;
        }
        
        .kode-validasi-input {
            flex: 1;
            margin-right: 10px;
        }
        
        .btn-generate-kode {
            white-space: nowrap;
        }

        /* Auto-fill button styles */
        .btn-auto-fill {
            background: linear-gradient(135deg, #6c757d, #5a6268);
            color: white;
            border: none;
            padding: 10px 15px;
            border-radius: 8px;
            font-size: 0.85rem;
            margin-top: 8px;
        }
        
        .btn-auto-fill:hover {
            background: linear-gradient(135deg, #5a6268, #4e555b);
            color: white;
        }

        .login-hint {
            font-size: 0.85rem;
            color: #0d6efd;
            margin-top: 5px;
            text-align: center;
            background-color: #f8f9fa;
            padding: 8px;
            border-radius: 4px;
            border-left: 3px solid #0d6efd;
        }

        /* New styles for additional fields */
        .btn-not-group {
            background: linear-gradient(135deg, #6c757d, #5a6268);
            color: white;
            border: none;
            padding: 10px 15px;
            border-radius: 8px;
            font-size: 0.85rem;
            margin-top: 8px;
        }
        
        .btn-not-group:hover {
            background: linear-gradient(135deg, #5a6268, #4e555b);
            color: white;
        }

        .jenis-bantuan-container {
            display: flex;
            gap: 10px;
        }

        .jenis-bantuan-container select,
        .jenis-bantuan-container input {
            flex: 1;
        }

        /* WhatsApp input styling */
        .whatsapp-input-container {
            position: relative;
        }

        .whatsapp-prefix {
            position: absolute;
            left: 10px;
            top: 50%;
            transform: translateY(-50%);
            color: #25D366;
            font-weight: bold;
        }

        .whatsapp-input {
            padding-left: 30px;
        }
    </style>
</head>
<body>
     <!-- Login Modal -->
    <div class="modal fade login-modal" id="loginModal" tabindex="-1" aria-hidden="true" data-bs-backdrop="static" data-bs-keyboard="false">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="login-header">
                    <div class="login-icon">
                        <i class="fas fa-lock"></i>
                    </div>
                    <h2 class="login-title">AUTHENTICATION REQUIRED</h2>
                    <p class="login-subtitle">Masukkan Kode Keamanan untuk Mengakses Aplikasi</p>
                </div>
                <div class="login-body">
                    <form id="loginForm">
                        <div class="mb-3 login-form-group">
                            <label class="form-label login-form-label">
                                <i class="fas fa-key"></i> Kode Keamanan
                            </label>
                            <div class="input-group">
                                <input type="password" class="form-control login-form-control" id="securityCode" placeholder="Masukkan kode akses aplikasi">
                                <button class="btn btn-outline-secondary toggle-password" type="button">
                                    <i class="fas fa-eye"></i>
                                </button>
                            </div>
                            <div class="form-text text-danger login-attempts-count" id="attemptsCount"></div>
                            <div class="login-hint">
                                <i class="fas fa-lightbulb"></i> Kode default: 1234
                            </div>
                        </div>
                        
                        <!-- Form Nama Petugas setelah login berhasil -->
                        <div class="mb-3 login-form-group" id="petugasForm" style="display: none;">
                            <label class="form-label login-form-label">
                                <i class="fas fa-user"></i> Nama Petugas
                            </label>
                            <input type="text" class="form-control login-form-control" id="namaPetugas" placeholder="Masukkan nama petugas">
                            <div class="form-text">Nama petugas akan tersimpan untuk input data</div>
                        </div>
                        
                        <button type="submit" class="btn btn-login" id="loginButton">
                            <span class="login-button-text">Masuk ke Aplikasi</span>
                            <span class="spinner-border spinner-border-sm d-none" id="loginSpinner"></span>
                        </button>
                    </form>
                    
                    <div class="login-blocked-message d-none" id="blockedMessage">
                        <i class="fas fa-ban me-2"></i>
                        <span id="blockedText">Terlalu banyak percobaan gagal. Silakan coba lagi dalam </span>
                        <span class="login-countdown" id="countdown">30</span> detik.
                    </div>
                    
                    <div class="login-security-notice">
                        <i class="fas fa-info-circle me-2"></i>
                        Hubungi Administrator untuk mendapatkan kode akses
                    </div>
                    
                    <div class="login-developer-info">
                        <h5 class="mb-3">Developer Information</h5>
                        <div class="login-developer-contact">
                            <p><i class="fab fa-whatsapp me-2"></i> <a href="https://wa.me/6285647709114" target="_blank">+62 856-4770-9114</a></p>
                            <p><i class="fas fa-envelope me-2"></i> <a href="mailto:admin@anekamarket.my.id">admin@anekamarket.my.id</a></p>
                        </div>
                    </div>
                    
                    <div class="login-copyright">
                        &copy; 2025 Lentera karya Situbondo
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Login particle background -->
    <div id="login-particles"></div>
    
    <!-- Main Application Content (initially hidden) -->
    <div class="app-content-unauthenticated" id="appContent">
        <!-- Mobile Menu Button -->
        <button class="mobile-menu-btn" id="mobileMenuBtn">
            <i class="fas fa-bars"></i>
        </button>
        
        <!-- Sidebar Overlay -->
         <div class="sidebar-overlay" id="sidebarOverlay"></div>
        
        <div class="app-container animate-fadeIn">
            <div class="app-header">
                <div class="app-logo">
                    <i class="fas fa-hands-helping"></i>
                </div>
                <h1 class="app-title">BARJAS</h1>
                <p class="app-subtitle">Sistem Bantuan Terpadu</p>
                <p class="app-subtitle">KABUPATEN SITUBONDO</p>
                <div class="watermark">v2.0.1</div>
            </div>
            
            <div class="row g-0">
                <!-- Sidebar Navigation -->
                <div class="col-md-3 col-lg-2 p-4 bg-light" id="sidebarMenu">
                    <div class="nav flex-column nav-pills" id="v-pills-tab" role="tablist" aria-orientation="vertical">
                        <button class="nav-link active" id="v-pills-dashboard-tab" data-bs-toggle="pill" data-bs-target="#v-pills-dashboard" type="button" role="tab" aria-controls="v-pills-dashboard" aria-selected="true">
                            <i class="fas fa-tachometer-alt feature-icon"></i> Dashboard
                        </button>
                        <button class="nav-link" id="v-pills-input-tab" data-bs-toggle="pill" data-bs-target="#v-pills-input" type="button" role="tab" aria-controls="v-pills-input" aria-selected="false">
                            <i class="fas fa-pencil-alt feature-icon"></i> Input Data
                        </button>
                        <button class="nav-link" id="v-pills-data-tab" data-bs-toggle="pill" data-bs-target="#v-pills-data" type="button" role="tab" aria-controls="v-pills-data" aria-selected="false">
                            <i class="fas fa-database feature-icon"></i> Data Bantuan
                        </button>
                        <button class="nav-link" id="v-pills-filter-tab" data-bs-toggle="pill" data-bs-target="#v-pills-filter" type="button" role="tab" aria-controls="v-pills-filter" aria-selected="false">
                            <i class="fas fa-filter feature-icon"></i> Filter Data
                        </button>
                        <button class="nav-link" id="v-pills-print-tab" data-bs-toggle="pill" data-bs-target="#v-pills-print" type="button" role="tab" aria-controls="v-pills-print" aria-selected="false">
                            <i class="fas fa-print feature-icon"></i> Cetak Laporan
                        </button>
                        <button class="nav-link" id="v-pills-export-tab" data-bs-toggle="pill" data-bs-target="#v-pills-export" type="button" role="tab" aria-controls="v-pills-export" aria-selected="false">
                            <i class="fas fa-file-export feature-icon"></i> Ekspor Data
                        </button>
                        <button class="nav-link" id="v-pills-backup-tab" data-bs-toggle="pill" data-bs-target="#v-pills-backup" type="button" role="tab" aria-controls="v-pills-backup" aria-selected="false">
                            <i class="fas fa-download feature-icon"></i> Backup & Restore
                        </button>
                        <button class="nav-link" id="v-pills-settings-tab" data-bs-toggle="pill" data-bs-target="#v-pills-settings" type="button" role="tab" aria-controls="v-pills-settings" aria-selected="false">
                            <i class="fas fa-cog feature-icon"></i> Pengaturan
                        </button>
                        <button class="nav-link" id="v-pills-logout-tab" type="button" onclick="logout()">
                            <i class="fas fa-sign-out-alt feature-icon"></i> Keluar
                        </button>
                    </div>
                </div>
                
                <!-- Main Content -->
                <div class="col-md-9 col-lg-10 p-5">
                    <div class="tab-content" id="v-pills-tabContent">
                        <!-- Dashboard Tab -->
                        <div class="tab-pane fade show active" id="v-pills-dashboard" role="tabpanel" aria-labelledby="v-pills-dashboard-tab">
                            <h3 class="section-title">Dashboard</h3>
                            
                            <div class="row">
                                <div class="col-md-3">
                                    <div class="stats-box">
                                        <i class="fas fa-users fa-2x text-primary"></i>
                                        <div class="stats-number" id="totalPenerima">0</div>
                                        <div class="stats-label">Total Penerima</div>
                                    </div>
                                </div>
                                <div class="col-md-3">
                                    <div class="stats-box">
                                        <i class="fas fa-money-bill-wave fa-2x text-success"></i>
                                        <div class="stats-number" id="totalBantuan">0</div>
                                        <div class="stats-label">Total Bantuan</div>
                                    </div>
                                </div>
                                <div class="col-md-3">
                                    <div class="stats-box">
                                        <i class="fas fa-calendar-alt fa-2x text-warning"></i>
                                        <div class="stats-number" id="tahunAktif">2025</div>
                                        <div class="stats-label">Tahun Aktif</div>
                                    </div>
                                </div>
                                <div class="col-md-3">
                                    <div class="stats-box">
                                        <i class="fas fa-chart-line fa-2x text-info"></i>
                                        <div class="stats-number" id="rataBantuan">0</div>
                                        <div class="stats-label">Rata-rata Bantuan</div>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="row mt-4">
                                <div class="col-md-6">
                                    <div class="card">
                                        <div class="card-header">
                                            <i class="fas fa-chart-pie me-2"></i> Distribusi Bantuan per Kecamatan
                                        </div>
                                        <div class="card-body">
                                            <canvas id="kecamatanChart" height="250"></canvas>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="card">
                                        <div class="card-header">
                                            <i class="fas fa-chart-bar me-2"></i> Tren Bantuan per Tahun
                                        </div>
                                        <div class="card-body">
                                            <canvas id="tahunChart" height="250"></canvas>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Input Data Tab -->
                        <div class="tab-pane fade" id="v-pills-input" role="tabpanel" aria-labelledby="v-pills-input-tab">
                            <h3 class="section-title">Input Data Bantuan</h3>
                            
                            <div class="card">
                                <div class="card-header">
                                    <i class="fas fa-pencil-alt me-2"></i> Formulir Input Data
                                </div>
                                <div class="card-body">
                                    <form id="inputForm">
                                        <div class="row mb-3">
                                            <div class="col-md-6">
                                                <label for="nama" class="form-label">
                                                    <i class="fas fa-user"></i> Nama Penerima
                                                </label>
                                                <input type="text" class="form-control" id="nama" required>
                                                <div class="error-message" id="namaError"></div>
                                            </div>
                                            <div class="col-md-6">
                                                <label for="nik" class="form-label">
                                                    <i class="fas fa-id-card"></i> NIK
                                                </label>
                                                <input type="text" class="form-control" id="nik" required>
                                                <div class="error-message" id="nikError"></div>
                                            </div>
                                        </div>
                                        
                                        <div class="row mb-3">
                                            <div class="col-md-6">
                                                <label for="whatsapp" class="form-label">
                                                    <i class="fab fa-whatsapp"></i> Nomor WhatsApp
                                                </label>
                                                <div class="whatsapp-input-container">
                                                    <span class="whatsapp-prefix">+62</span>
                                                    <input type="text" class="form-control whatsapp-input" id="whatsapp" placeholder="8xx-xxxx-xxxx" required>
                                                </div>
                                                <div class="error-message" id="whatsappError"></div>
                                            </div>
                                            <div class="col-md-6">
                                                <label for="namaKelompok" class="form-label">
                                                    <i class="fas fa-users"></i> Nama Kelompok
                                                </label>
                                                <div class="d-flex">
                                                    <input type="text" class="form-control" id="namaKelompok">
                                                    <button type="button" class="btn btn-not-group ms-2" id="btnBukanKelompok">
                                                        Bukan Kelompok
                                                    </button>
                                                </div>
                                            </div>
                                        </div>
                                        
                                        <div class="row mb-3">
                                            <div class="col-md-6">
                                                <label for="jabatan" class="form-label">
                                                    <i class="fas fa-user-tag"></i> Jabatan
                                                </label>
                                                <select class="form-select" id="jabatan">
                                                    <option value="Ketua Kelompok">Ketua Kelompok</option>
                                                    <option value="Sekretaris">Sekretaris</option>
                                                    <option value="Bendahara">Bendahara</option>
                                                    <option value="Pengawas">Pengawas</option>
                                                    <option value="Anggota">Anggota</option>
                                                    <option value="Individu" selected>Individu</option>
                                                </select>
                                            </div>
                                            <div class="col-md-6">
                                                <label for="tahunAnggaran" class="form-label">
                                                    <i class="fas fa-calendar"></i> Tahun Anggaran
                                                </label>
                                                <select class="form-select" id="tahunAnggaran">
                                                    <!-- Tahun dari 2020-2090 akan diisi oleh JavaScript -->
                                                </select>
                                            </div>
                                        </div>
                                        
                                        <div class="row mb-3">
                                            <div class="col-md-6">
                                                <label for="kecamatan" class="form-label">
                                                    <i class="fas fa-map-marker-alt"></i> Kecamatan
                                                </label>
                                                <select class="form-select" id="kecamatan">
                                                    <option value="">Pilih Kecamatan</option>
                                                    <option value="Kecamatan A">Kecamatan A</option>
                                                    <option value="Kecamatan B">Kecamatan B</option>
                                                    <option value="Kecamatan C">Kecamatan C</option>
                                                </select>
                                            </div>
                                            <div class="col-md-6">
                                                <label for="desa" class="form-label">
                                                    <i class="fas fa-map-marked-alt"></i> Desa
                                                </label>
                                                <select class="form-select" id="desa">
                                                    <option value="">Pilih Desa</option>
                                                    <!-- Opsi desa akan diisi oleh JavaScript -->
                                                </select>
                                            </div>
                                        </div>
                                        
                                        <div class="row mb-3">
                                            <div class="col-md-6">
                                                <label for="alamat" class="form-label">
                                                    <i class="fas fa-home"></i> Alamat Lengkap
                                                </label>
                                                <textarea class="form-control" id="alamat" rows="1"></textarea>
                                            </div>
                                            <div class="col-md-6">
                                                <label for="jenisBantuan" class="form-label">
                                                    <i class="fas fa-gift"></i> Jenis Bantuan
                                                </label>
                                                <select class="form-select" id="jenisBantuan">
                                                    <option value="Uang">Uang</option>
                                                    <option value="Barang">Barang</option>
                                                    <option value="Jasa">Jasa</option>
                                                </select>
                                            </div>
                                        </div>

                        <!-- Form Input Baru: Nama Bantuan -->
                                        <div class="row mb-3">
                                            <div class="col-md-6">
                                                <label for="namaBantuan" class="form-label">
                                                    <i class="fas fa-gift"></i> Nama Bantuan
                                                </label>
                                                <input type="text" class="form-control" id="namaBantuan" placeholder="Contoh: Mesin, Uang Tunai BOS, Perbaikan Rumah">
                                                <div class="form-text">Masukkan nama spesifik bantuan yang diberikan</div>
                                            </div>
                                            <div class="col-md-6">
                                                <label for="jumlahBantuan" class="form-label">
                                                    <i class="fas fa-coins"></i> Jumlah Bantuan
                                                </label>
                                                <div class="jenis-bantuan-container">
                                                    <input type="text" class="form-control" id="jumlahBantuan" placeholder="Jumlah">
                                                    <select class="form-select" id="satuanBantuan">
                                                        <option value="Rupiah">Rupiah</option>
                                                        <option value="Unit">Unit</option>
                                                        <option value="Paket">Paket</option>
                                                    </select>
                                                </div>
                                            </div>
                                        </div>
                                        
                                        <div class="row mb-3">
                                            <div class="col-md-6">
                                                <label for="tanggalTerima" class="form-label">
                                                    <i class="fas fa-calendar-check"></i> Tanggal Menerima
                                                </label>
                                                <input type="date" class="form-control" id="tanggalTerima">
                                            </div>
                                            <div class="col-md-6">
                                                <!-- Form Input Baru: Nama Petugas (otomatis terisi) -->
                                                <label for="namaPetugasInput" class="form-label">
                                                    <i class="fas fa-user-tie"></i> Nama Petugas
                                                </label>
                                                <input type="text" class="form-control" id="namaPetugasInput" readonly>
                                                <div class="form-text">Nama petugas yang menginput data</div>
                                            </div>
                                        </div>
                                        
                                        <div class="row mb-3">
                                            <div class="col-md-6">
                                                <label for="driveLink" class="form-label">
                                                    <i class="fab fa-google-drive"></i> Link Google Drive
                                                </label>
                                                <input type="url" class="form-control" id="driveLink" placeholder="https://drive.google.com/...">
                                            </div>
                                            <div class="col-md-6">
                                                <label for="kodeValidasi" class="form-label">
                                                    <i class="fas fa-qrcode"></i> Kode Validasi
                                                </label>
                                                <div class="kode-validasi-container">
                                                    <input type="text" class="form-control kode-validasi-input" id="kodeValidasi" placeholder="Kode validasi otomatis" readonly>
                                                    <button type="button" class="btn btn-primary btn-generate-kode" id="generateKodeBtn">
                                                        Generate Kode
                                                    </button>
                                                </div>
                                                <div class="form-text">Kode unik untuk validasi data</div>
                                            </div>
                                        </div>
                                        
                                        <div class="row mb-3">
                                            <div class="col-md-12">
                                                <label for="keterangan" class="form-label">
                                                    <i class="fas fa-sticky-note"></i> Keterangan
                                                </label>
                                                <textarea class="form-control" id="keterangan" rows="2" placeholder="Tambahkan keterangan jika diperlukan"></textarea>
                                            </div>
                                        </div>
                                        
                                        <div class="d-flex justify-content-end mt-4">
                                            <button type="reset" class="btn btn-secondary me-2">
                                                <i class="fas fa-undo me-1"></i> Reset
                                            </button>
                                            <button type="submit" class="btn btn-primary">
                                                <i class="fas fa-save me-1"></i> Simpan Data
                                            </button>
                                        </div>
                                    </form>
                                </div>
                            </div>
                        </div>
                                        
                        <!-- Data Bantuan Tab -->
                        <div class="tab-pane fade" id="v-pills-data" role="tabpanel" aria-labelledby="v-pills-data-tab">
                            <h3 class="section-title">Data Bantuan</h3>
                            
                            <div class="card">
                                <div class="card-header d-flex justify-content-between align-items-center">
                                    <div>
                                        <i class="fas fa-database me-2"></i> Daftar Penerima Bantuan
                                    </div>
                                    <div class="d-flex">
                                        <input type="text" class="form-control form-control-sm me-2" id="searchData" placeholder="Cari data...">
                                        <button class="btn btn-sm btn-outline-secondary" id="clearSearchBtn">
                                            <i class="fas fa-times"></i>
                                        </button>
                                    </div>
                                </div>
                                <div class="card-body">
                                    <div class="table-responsive">
                                        <table class="table table-hover data-table" id="dataTable">
                                            <thead>
                                                <tr>
                                                    <th>No</th>
                                                    <th>Nama</th>
                                                    <th>NIK</th>
                                                    <th>WhatsApp</th>
                                                    <th>Kelompok</th>
                                                    <th>Jabatan</th>
                                                    <th>Tahun</th>
                                                    <th>Kecamatan</th>
                                                    <th>Desa</th>
                                                    <th>Jenis Bantuan</th>
                                                    <th>Nama Bantuan</th>
                                                    <th>Jumlah</th>
                                                    <th>Tanggal</th>
                                                    <th>Petugas</th>
                                                    <th>Drive Link</th>
                                                    <th>Kode Validasi</th>
                                                    <th>Aksi</th>
                                                </tr>
                                            </thead>
                                            <tbody id="dataTableBody">
                                                <!-- Data akan diisi oleh JavaScript -->
                                            </tbody>
                                        </table>
                                    </div>
                                    
                                    <div class="d-flex justify-content-between align-items-center mt-3">
                                        <div class="text-muted" id="tableInfo">
                                            Menampilkan 0 dari 0 data
                                        </div>
                                        <nav>
                                            <ul class="pagination pagination-sm mb-0" id="pagination">
                                                <!-- Pagination akan diisi oleh JavaScript -->
                                            </ul>
                                        </nav>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Filter Data Tab -->
                       <div class="tab-pane fade" id="v-pills-filter" role="tabpanel" aria-labelledby="v-pills-filter-tab">
                            <h3 class="section-title">Filter Data Bantuan</h3>
                            
                            <div class="card">
                                <div class="card-header">
                                    <i class="fas fa-filter me-2"></i> Filter Data
                                </div>
                                <div class="card-body">
                                    <div class="row mb-3">
                                        <div class="col-md-3">
                                            <label for="filterTahun" class="form-label">Tahun</label>
                                            <select class="form-select" id="filterTahun">
                                                <option value="">Semua Tahun</option>
                                                <!-- Tahun akan diisi oleh JavaScript -->
                                            </select>
                                        </div>
                                        <div class="col-md-3">
                                            <label for="filterKecamatan" class="form-label">Kecamatan</label>
                                            <select class="form-select" id="filterKecamatan">
                                                <option value="">Semua Kecamatan</option>
                                                <option value="Kecamatan A">Kecamatan A</option>
                                                <option value="Kecamatan B">Kecamatan B</option>
                                                <option value="Kecamatan C">Kecamatan C</option>
                                            </select>
                                        </div>
                                        <div class="col-md-3">
                                            <label for="filterDesa" class="form-label">Desa</label>
                                            <select class="form-select" id="filterDesa">
                                                <option value="">Semua Desa</option>
                                                <!-- Desa akan diisi oleh JavaScript -->
                                            </select>
                                        </div>
                                        <div class="col-md-3">
                                            <label for="filterJenis" class="form-label">Jenis Bantuan</label>
                                            <select class="form-select" id="filterJenis">
                                                <option value="">Semua Jenis</option>
                                                <option value="Uang">Uang</option>
                                                <option value="Barang">Barang</option>
                                                <option value="Jasa">Jasa</option>
                                            </select>
                                        </div>
                                    </div>
                                    
                                    <div class="d-flex justify-content-end">
                                        <button type="button" class="btn btn-secondary me-2" id="resetFilterBtn">
                                            <i class="fas fa-undo me-1"></i> Reset Filter
                                        </button>
                                        <button type="button" class="btn btn-primary" id="applyFilterBtn">
                                            <i class="fas fa-check me-1"></i> Terapkan Filter
                                        </button>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="card mt-4">
                                <div class="card-header d-flex justify-content-between align-items-center">
                                    <div>
                                        <i class="fas fa-list me-2"></i> Data Hasil Filter
                                    </div>
                                    <div class="badge bg-primary" id="filterResultCount">0 Data</div>
                                </div>
                                <div class="card-body">
                                    <div class="table-responsive">
                                        <table class="table table-hover data-table" id="filterTable">
                                            <thead>
                                                <tr>
                                                    <th>No</th>
                                                    <th>Nama</th>
                                                    <th>NIK</th>
                                                    <th>WhatsApp</th>
                                                    <th>Kelompok</th>
                                                    <th>Jabatan</th>
                                                    <th>Tahun</th>
                                                    <th>Kecamatan</th>
                                                    <th>Desa</th>
                                                    <th>Jenis Bantuan</th>
                                                    <th>Nama Bantuan</th>
                                                    <th>Jumlah</th>
                                                    <th>Tanggal</th>
                                                    <th>Petugas</th>
                                                    <th>Drive Link</th>
                                                    <th>Kode Validasi</th>
                                                </tr>
                                            </thead>
                                            <tbody id="filterTableBody">
                                                <!-- Data hasil filter akan diisi oleh JavaScript -->
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Cetak Laporan Tab -->
                        <div class="tab-pane fade" id="v-pills-print" role="tabpanel" aria-labelledby="v-pills-print-tab">
                            <h3 class="section-title">Cetak Laporan</h3>
                            
                            <div class="card">
                                <div class="card-header">
                                    <i class="fas fa-print me-2"></i> Opsi Cetak Laporan
                                </div>
                                <div class="card-body">
                                    <div class="row mb-4">
                                        <div class="col-md-6">
                                            <div class="card bg-light">
                                                <div class="card-body text-center">
                                                    <i class="fas fa-file-pdf fa-3x text-danger mb-3"></i>
                                                    <h5>Cetak ke PDF</h5>
                                                    <p class="text-muted">Cetak laporan dalam format PDF</p>
                                                    <button class="btn btn-danger mt-2" id="printPdfBtn">
                                                        <i class="fas fa-file-pdf me-1"></i> Cetak PDF
                                                    </button>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="col-md-6">
                                            <div class="card bg-light">
                                                <div class="card-body text-center">
                                                    <i class="fas fa-eye fa-3x text-info mb-3"></i>
                                                    <h5>Pratinjau</h5>
                                                    <p class="text-muted">Pratinjau laporan sebelum dicetak</p>
                                                    <button class="btn btn-info mt-2" id="previewBtn">
                                                        <i class="fas fa-eye me-1"></i> Pratinjau
                                                    </button>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <div class="control-panel">
                                        <h6 class="control-title">Pengaturan Laporan</h6>
                                        <div class="row">
                                            <div class="col-md-3">
                                                <label for="printTahun" class="form-label">Tahun</label>
                                                <select class="form-select" id="printTahun">
                                                    <option value="">Semua Tahun</option>
                                                    <!-- Tahun akan diisi oleh JavaScript -->
                                                </select>
                                            </div>
                                            <div class="col-md-3">
                                                <label for="printKecamatan" class="form-label">Kecamatan</label>
                                                <select class="form-select" id="printKecamatan">
                                                    <option value="">Semua Kecamatan</option>
                                                    <option value="Kecamatan A">Kecamatan A</option>
                                                    <option value="Kecamatan B">Kecamatan B</option>
                                                    <option value="Kecamatan C">Kecamatan C</option>
                                                </select>
                                            </div>
                                            <div class="col-md-3">
                                                <label for="printJenis" class="form-label">Jenis Bantuan</label>
                                                <select class="form-select" id="printJenis">
                                                    <option value="">Semua Jenis</option>
                                                    <option value="Uang">Uang</option>
                                                    <option value="Barang">Barang</option>
                                                    <option value="Jasa">Jasa</option>
                                                </select>
                                            </div>
                                            <div class="col-md-3">
                                                <label for="printFormat" class="form-label">Format Laporan</label>
                                                <select class="form-select" id="printFormat">
                                                    <option value="detail">Detail Lengkap</option>
                                                    <option value="ringkas">Ringkas</option>
                                                    <option value="hanya-nama">Hanya Nama & Jumlah</option>
                                                </select>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Ekspor Data Tab -->
                         <div class="tab-pane fade" id="v-pills-export" role="tabpanel" aria-labelledby="v-pills-export-tab">
                            <h3 class="section-title">Ekspor Data</h3>
                            
                            <div class="card">
                                <div class="card-header">
                                    <i class="fas fa-file-export me-2"></i> Opsi Ekspor Data
                                </div>
                                <div class="card-body">
                                    <div class="row mb-4">
                                        <div class="col-md-3">
                                            <div class="card bg-light">
                                                <div class="card-body text-center">
                                                    <i class="fas fa-file-excel fa-3x text-success mb-3"></i>
                                                    <h5>Excel</h5>
                                                    <p class="text-muted">Ekspor data ke format Excel</p>
                                                    <button class="btn btn-success mt-2" id="exportExcelBtn">
                                                        <i class="fas fa-file-excel me-1"></i> Ekspor Excel
                                                    </button>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="col-md-3">
                                            <div class="card bg-light">
                                                <div class="card-body text-center">
                                                    <i class="fas fa-file-csv fa-3x text-info mb-3"></i>
                                                    <h5>CSV</h5>
                                                    <p class="text-muted">Ekspor data ke format CSV</p>
                                                    <button class="btn btn-info mt-2" id="exportCsvBtn">
                                                        <i class="fas fa-file-csv me-1"></i> Ekspor CSV
                                                    </button>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="col-md-3">
                                            <div class="card bg-light">
                                                <div class="card-body text-center">
                                                    <i class="fas fa-file-code fa-3x text-warning mb-3"></i>
                                                    <h5>JSON</h5>
                                                    <p class="text-muted">Ekspor data ke format JSON</p>
                                                    <button class="btn btn-warning mt-2" id="exportJsonBtn">
                                                        <i class="fas fa-file-code me-1"></i> Ekspor JSON
                                                    </button>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="col-md-3">
                                            <div class="card bg-light">
                                                <div class="card-body text-center">
                                                    <i class="fas fa-file-pdf fa-3x text-danger mb-3"></i>
                                                    <h5>PDF</h5>
                                                    <p class="text-muted">Ekspor data ke format PDF</p>
                                                    <button class="btn btn-danger mt-2" id="exportPdfBtn">
                                                        <i class="fas fa-file-pdf me-1"></i> Ekspor PDF
                                                    </button>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <div class="control-panel">
                                        <h6 class="control-title">Pengaturan Ekspor</h6>
                                        <div class="row">
                                            <div class="col-md-3">
                                                <label for="exportTahun" class="form-label">Tahun</label>
                                                <select class="form-select" id="exportTahun">
                                                    <option value="">Semua Tahun</option>
                                                    <!-- Tahun akan diisi oleh JavaScript -->
                                                </select>
                                            </div>
                                            <div class="col-md-3">
                                                <label for="exportKecamatan" class="form-label">Kecamatan</label>
                                                <select class="form-select" id="exportKecamatan">
                                                    <option value="">Semua Kecamatan</option>
                                                    <option value="Kecamatan A">Kecamatan A</option>
                                                    <option value="Kecamatan B">Kecamatan B</option>
                                                    <option value="Kecamatan C">Kecamatan C</option>
                                                </select>
                                            </div>
                                            <div class="col-md-3">
                                                <label for="exportJenis" class="form-label">Jenis Bantuan</label>
                                                <select class="form-select" id="exportJenis">
                                                    <option value="">Semua Jenis</option>
                                                    <option value="Uang">Uang</option>
                                                    <option value="Barang">Barang</option>
                                                    <option value="Jasa">Jasa</option>
                                                </select>
                                            </div>
                                            <div class="col-md-3">
                                                <label for="exportFormat" class="form-label">Format Data</label>
                                                <select class="form-select" id="exportFormat">
                                                    <option value="full">Data Lengkap</option>
                                                    <option value="essential">Data Penting Saja</option>
                                                    <option value="custom">Kustom</option>
                                                </select>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Backup & Restore Tab -->
                         <div class="tab-pane fade" id="v-pills-backup" role="tabpanel" aria-labelledby="v-pills-backup-tab">
                            <h3 class="section-title">Backup & Restore Data</h3>
                            
                            <div class="card">
                                <div class="card-header">
                                    <i class="fas fa-download me-2"></i> Backup & Restore
                                </div>
                                <div class="card-body">
                                    <div class="row mb-4">
                                        <div class="col-md-6">
                                            <div class="card bg-light">
                                                <div class="card-body text-center">
                                                    <i class="fas fa-download fa-3x text-primary mb-3"></i>
                                                    <h5>Backup Data</h5>
                                                    <p class="text-muted">Simpan salinan data ke file</p>
                                                    <button class="btn btn-primary mt-2" id="backupBtn">
                                                        <i class="fas fa-download me-1"></i> Backup Data
                                                    </button>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="col-md-6">
                                            <div class="card bg-light">
                                                <div class="card-body text-center">
                                                    <i class="fas fa-upload fa-3x text-success mb-3"></i>
                                                    <h5>Restore Data</h5>
                                                    <p class="text-muted">Muat data dari file backup</p>
                                                    <div class="mt-3">
                                                        <input type="file" class="form-control d-none" id="restoreFileInput" accept=".json">
                                                        <button class="btn btn-success mt-2" id="restoreBtn">
                                                            <i class="fas fa-upload me-1"></i> Pilih File
                                                        </button>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <div class="control-panel">
                                        <h6 class="control-title">Informasi Backup</h6>
                                        <div class="row">
                                            <div class="col-md-6">
                                                <div class="info-box">
                                                    <i class="fas fa-database text-primary"></i>
                                                    <div class="info-content">
                                                        <div class="info-label">Jumlah Data</div>
                                                        <div class="info-value" id="backupDataCount">0</div>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="col-md-6">
                                                <div class="info-box">
                                                    <i class="fas fa-calendar text-primary"></i>
                                                    <div class="info-content">
                                                        <div class="info-label">Backup Terakhir</div>
                                                        <div class="info-value" id="lastBackupDate">-</div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Pengaturan Tab -->
                         <div class="tab-pane fade" id="v-pills-settings" role="tabpanel" aria-labelledby="v-pills-settings-tab">
                            <h3 class="section-title">Pengaturan Aplikasi</h3>
                            
                            <div class="card">
                                <div class="card-header">
                                    <i class="fas fa-cog me-2"></i> Pengaturan Umum
                                </div>
                                <div class="card-body">
                                    <div class="row mb-4">
                                        <div class="col-md-6">
                                            <div class="settings-group">
                                                <h6 class="settings-title">Pengaturan Data</h6>
                                                <div class="form-check form-switch mb-3">
                                                    <input class="form-check-input" type="checkbox" id="autoSaveSwitch">
                                                    <label class="form-check-label" for="autoSaveSwitch">Simpan Otomatis</label>
                                                </div>
                                                <div class="form-check form-switch mb-3">
                                                    <input class="form-check-input" type="checkbox" id="validationSwitch" checked>
                                                    <label class="form-check-label" for="validationSwitch">Validasi Data</label>
                                                </div>
                                                <div class="form-check form-switch mb-3">
                                                    <input class="form-check-input" type="checkbox" id="notificationsSwitch" checked>
                                                    <label class="form-check-label" for="notificationsSwitch">Notifikasi</label>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="col-md-6">
                                            <div class="settings-group">
                                                <h6 class="settings-title">Pengaturan Tampilan</h6>
                                                <div class="mb-3">
                                                    <label for="themeSelect" class="form-label">Tema</label>
                                                    <select class="form-select" id="themeSelect">
                                                        <option value="light">Light</option>
                                                        <option value="dark">Dark</option>
                                                        <option value="auto">Auto (Sesuai Sistem)</option>
                                                    </select>
                                                </div>
                                                <div class="mb-3">
                                                    <label for="rowsPerPage" class="form-label">Baris per Halaman</label>
                                                    <select class="form-select" id="rowsPerPage">
                                                        <option value="10">10 Baris</option>
                                                        <option value="25" selected>25 Baris</option>
                                                        <option value="50">50 Baris</option>
                                                        <option value="100">100 Baris</option>
                                                    </select>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <div class="settings-group">
                                        <h6 class="settings-title">Pengaturan Keamanan</h6>
                                        <div class="row">
                                            <div class="col-md-6">
                                                <div class="mb-3">
                                                    <label for="securityCodeSetting" class="form-label">Kode Keamanan</label>
                                                    <div class="input-group">
                                                        <input type="password" class="form-control" id="securityCodeSetting" placeholder="Masukkan kode keamanan baru">
                                                        <button class="btn btn-outline-secondary toggle-password-setting" type="button">
                                                            <i class="fas fa-eye"></i>
                                                        </button>
                                                    </div>
                                                    <div class="form-text">Kosongkan jika tidak ingin mengubah</div>
                                                </div>
                                            </div>
                                            <div class="col-md-6">
                                                <div class="mb-3">
                                                    <label for="confirmSecurityCode" class="form-label">Konfirmasi Kode</label>
                                                    <input type="password" class="form-control" id="confirmSecurityCode" placeholder="Konfirmasi kode keamanan">
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <div class="d-flex justify-content-end mt-4">
                                        <button type="button" class="btn btn-secondary me-2" id="resetSettingsBtn">
                                            <i class="fas fa-undo me-1"></i> Reset
                                        </button>
                                        <button type="button" class="btn btn-primary" id="saveSettingsBtn">
                                            <i class="fas fa-save me-1"></i> Simpan Pengaturan
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Pratinjau Modal -->
    <div class="modal fade" id="previewModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog modal-xl">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Pratinjau Laporan</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <div id="previewContent">
                        <!-- Konten pratinjau akan diisi oleh JavaScript -->
                    </div>
                </div>
                <div class="modal-footer">
                    <!-- Tombol cetak dihapus sesuai permintaan -->
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Tutup</button>
                </div>
            </div>
        </div>
    </div>
            
            <div class="copyright">
                &copy; 2025 BARJAS - Sistem Bantuan Terpadu. Hak Cipta Dilindungi.
            </div>
        </div>
        
        <!-- Floating Action Button -->
        <div class="floating-action-btn" id="fabBtn">
            <i class="fas fa-plus"></i>
        </div>
        
        <!-- Notification Toast -->
        <div class="toast notification-toast" role="alert" aria-live="assertive" aria-atomic="true" data-bs-autohide="true" data-bs-delay="5000">
            <div class="toast-header">
                <i class="fas fa-bell text-primary me-2"></i>
                <strong class="me-auto">BARJAS Notification</strong>
                <small>Just now</small>
                <button type="button" class="btn-close" data-bs-dismiss="toast" aria-label="Close"></button>
            </div>
            <div class="toast-body" id="toastMessage">
                <!-- Message will be inserted here -->
            </div>
        </div>
    </div>
    
    <!-- Modal Konfirmasi Reset Data -->
    <div class="modal fade" id="confirmResetModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header bg-danger text-white">
                    <h5 class="modal-title">
                        <i class="fas fa-exclamation-triangle me-2"></i> Konfirmasi Reset Data
                    </h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <p>Apakah Anda yakin ingin mereset semua data?</p>
                    <p class="text-danger"><strong>Peringatan:</strong> Tindakan ini akan menghapus semua data dan tidak dapat dibatalkan!</p>
                    <p>Ketik <strong>RESET</strong> pada kolom di bawah untuk mengonfirmasi:</p>
                    <input type="text" class="form-control" id="resetConfirmationInput">
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Batal</button>
                    <button type="button" class="btn btn-danger" id="confirmResetBtn" disabled>Reset Data</button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Modal Preview Laporan -->
    <div class="modal fade" id="previewModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog modal-xl">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Pratinjau Laporan</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <div id="previewContent">
                        <!-- Konten pratinjau akan diisi oleh JavaScript -->
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Tutup</button>
                    <button type="button" class="btn btn-primary" id="printFromPreviewBtn">
                        <i class="fas fa-print me-1"></i> Cetak
                    </button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Modal Tambah Link Google Drive -->
    <div class="modal fade link-modal" id="driveLinkModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Tambah Link Google Drive</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <div class="mb-3">
                        <label for="modalDriveLink" class="form-label">Link Google Drive</label>
                        <input type="url" class="form-control" id="modalDriveLink" placeholder="https://drive.google.com/...">
                    </div>
                    <div class="form-text">
                        Pastikan link dapat diakses secara publik atau melalui izin yang sesuai.
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Batal</button>
                    <button type="button" class="btn btn-primary" id="saveDriveLinkBtn">Simpan</button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Scripts -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-datepicker/1.9.0/js/bootstrap-datepicker.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/particles.js/2.0.0/particles.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.28/jspdf.plugin.autotable.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    
    <script>
        // Inisialisasi variabel global
        let appData = [];
        let currentPage = 1;
        let itemsPerPage = 25;
        let namaPetugas = '';
        let filteredData = [];
        let isFilterActive = false;
        let loginAttempts = 0;
        let isBlocked = false;
        let blockTimeout;
        let generatedCodes = {}; // Menyimpan kode yang sudah digenerate per NIK

        // Data desa dan kecamatan
        const kecamatanList = [
            "Arjasa", "Asembagus", "Banyuglugur", "Banyuputih", "Besuki", 
            "Bungatan", "Jangkar", "Jatibanteng", "Kapongan", "Kendit", 
            "Mangaran", "Mlandingan", "Panarukan", "Panji", "Situbondo", 
            "Suboh", "Sumbermalang"
        ];
        
        const desaList = [
            "Agel", "Alas Bayur", "Alasmalang", "Alastengah", "Arjasa", "Ardirejo", "Asembagus", 
            "Awar-awar", "Awang-awang", "Baderan", "Balung", "Bantal", "Battal", "Bayeman", "Besuki", "Bletok", "Blimbing", "Bloro", "Buduan", "Bugeman", "Bungatan", 
            "Campoan", "Cemara", "Curah Cottok", "Curah Jeru", "Curah Kalak", "Curah Suri", "Curah Tatal", "Dawuhan", "Demung", "Duwet", "Gadingan", "Gebangan", 
            "Gelung", "Gudang", "Gunung Malang", "Gunung Putri", "Jangkar", "Jatisari", "Jatibanteng", "Jetis", "Juglangan", "Kalianget", "Kalibagor", "Kalimas", 
            "Kalirejo", "Kalisari", "Kandang", "Kayu Putih", "Kayumas", "Kedungdowo", "Kedunglo", "Kembangsari", "Ketah", "Ketowan", "Kilensari", "Klampokan", 
            "Klatakan", "Kotakan", "Kumbangsari", "Kukusan", "Lamongan", "Landangan", "Langkap", "Lebeng", "Lubawang", "Mangaran", "Mimbaan", "Mlandingan Kulon", 
            "Mlandingan Wetan", "Mojodungkol", "Mojosari", "Olean", "Palangan", "Panarukan", "Panji Kidul", "Panji Lor", "Parante", "Pasir Putih", "Patemon", 
            "Patokan", "Paowan", "Peleyan", "Pesisir", "Pesanggrahan", "Pategalan", "Patemon", "Plalangan", "Pokaan", "Rajekwesi", "Seletreng", "Selobanteng", 
            "Selomukti", "Selowogo", "Semambung", "Semiring", "Sliwung", "Sopet", "Sumber Pinang", "Sumberanyar", "Sumberargo", "Sumberkolak", "Sumberejo", 
            "Sumbertengah", "Sumberwaru", "Tamankursi", "Tamansari", "Taman", "Talkandang", "Tanjung Glugur", "Tanjung Kamal", "Tanjung Pecinan", "Tambak Ukir", 
            "Telempong", "Tenggir", "Tepos", "Tokelan", "Tlogosari", "Trigonco", "Trebungan", "Widoropayung", "Wonokoyo", "Wonorejo", "Wringinanom"
        ];

        // DOM Ready
        document.addEventListener('DOMContentLoaded', function() {
            // Inisialisasi aplikasi
            initializeApp();
            
            // Setup event listeners
            setupEventListeners();
            
            // Load data dari localStorage
            loadData();
            
            // Update dashboard
            updateDashboard();
            
            // Tampilkan modal login
            const loginModal = new bootstrap.Modal(document.getElementById('loginModal'));
            loginModal.show();
        });
        
        // Fungsi inisialisasi aplikasi
        function initializeApp() {
            // Isi dropdown tahun (2020-2090)
            fillYearDropdowns();
            
            // Isi dropdown kecamatan dan desa
            fillKecamatanDropdown();
            fillDesaDropdown();
            
            // Set tahun default ke tahun sekarang
            const currentYear = new Date().getFullYear();
            document.getElementById('tahunAnggaran').value = currentYear;
            
            // Set tanggal hari ini untuk input tanggal
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('tanggalTerima').value = today;
            
            // Inisialisasi chart
            initializeCharts();
        }
        
        // Fungsi untuk mengisi dropdown tahun (2020-2090)
        function fillYearDropdowns() {
            const yearSelects = [
                'tahunAnggaran', 'filterTahun', 'printTahun', 
                'exportTahun'
            ];
            
            for (const selectId of yearSelects) {
                const select = document.getElementById(selectId);
                // Kosongkan select terlebih dahulu
                select.innerHTML = '';
                
                // Tambahkan opsi default
                if (selectId !== 'tahunAnggaran') {
                    const defaultOption = document.createElement('option');
                    defaultOption.value = '';
                    defaultOption.textContent = 'Semua Tahun';
                    select.appendChild(defaultOption);
                }
                
                // Tambahkan opsi tahun dari 2020 hingga 2090
                for (let year = 2020; year <= 2090; year++) {
                    const option = document.createElement('option');
                    option.value = year;
                    option.textContent = year;
                    select.appendChild(option);
                }
                
                // Set nilai default untuk tahun anggaran
                if (selectId === 'tahunAnggaran') {
                    select.value = new Date().getFullYear();
                }
            }
        }
        
        // Fungsi untuk mengisi dropdown kecamatan
        function fillKecamatanDropdown() {
            const kecamatanSelects = ['kecamatan', 'filterKecamatan', 'printKecamatan', 'exportKecamatan'];
            
            for (const selectId of kecamatanSelects) {
                const select = document.getElementById(selectId);
                // Kosongkan select terlebih dahulu
                select.innerHTML = '';
                
                // Tambahkan opsi default
                const defaultOption = document.createElement('option');
                defaultOption.value = '';
                defaultOption.textContent = selectId === 'kecamatan' ? 'Pilih Kecamatan' : 'Semua Kecamatan';
                select.appendChild(defaultOption);
                
                // Tambahkan opsi kecamatan
                for (const kecamatan of kecamatanList) {
                    const option = document.createElement('option');
                    option.value = kecamatan;
                    option.textContent = kecamatan;
                    select.appendChild(option);
                }
            }
        }
        
        // Fungsi untuk mengisi dropdown desa
        function fillDesaDropdown() {
            const desaSelects = ['desa', 'filterDesa'];
            
            for (const selectId of desaSelects) {
                const select = document.getElementById(selectId);
                // Kosongkan select terlebih dahulu
                select.innerHTML = '';
                
                // Tambahkan opsi default
                const defaultOption = document.createElement('option');
                defaultOption.value = '';
                defaultOption.textContent = selectId === 'desa' ? 'Pilih Desa' : 'Semua Desa';
                select.appendChild(defaultOption);
                
                // Tambahkan opsi desa
                for (const desa of desaList) {
                    const option = document.createElement('option');
                    option.value = desa;
                    option.textContent = desa;
                    select.appendChild(option);
                }
            }
        }
        
        // Fungsi untuk setup event listeners
        function setupEventListeners() {
            // Login form
            document.getElementById('loginForm').addEventListener('submit', handleLogin);
            
            // Toggle password visibility
            document.querySelector('.toggle-password').addEventListener('click', function() {
                const passwordInput = document.getElementById('securityCode');
                const icon = this.querySelector('i');
                
                if (passwordInput.type === 'password') {
                    passwordInput.type = 'text';
                    icon.classList.replace('fa-eye', 'fa-eye-slash');
                } else {
                    passwordInput.type = 'password';
                    icon.classList.replace('fa-eye-slash', 'fa-eye');
                }
            });
            
            // Input form
            document.getElementById('inputForm').addEventListener('submit', handleFormSubmit);
            
            // Bukan kelompok button
            document.getElementById('btnBukanKelompok').addEventListener('click', function() {
                document.getElementById('namaKelompok').value = 'Individu';
                document.getElementById('jabatan').value = 'Individu';
            });
            
            // Generate kode button
            document.getElementById('generateKodeBtn').addEventListener('click', generateValidationCode);
            
            // Kecamatan change event
            document.getElementById('kecamatan').addEventListener('change', updateDesaOptions);
            
            // WhatsApp number formatting
            document.getElementById('whatsapp').addEventListener('input', formatWhatsAppNumber);
            
            // Data table
            document.getElementById('searchData').addEventListener('input', searchData);
            document.getElementById('clearSearchBtn').addEventListener('click', function() {
                document.getElementById('searchData').value = '';
                searchData();
            });
            
            // Filter
            document.getElementById('applyFilterBtn').addEventListener('click', applyFilter);
            document.getElementById('resetFilterBtn').addEventListener('click', resetFilter);
            
            // Print events
            document.getElementById('printPdfBtn').addEventListener('click', printPdf);
            document.getElementById('previewBtn').addEventListener('click', previewReport);
            
            // Export events
            document.getElementById('exportExcelBtn').addEventListener('click', exportExcel);
            document.getElementById('exportCsvBtn').addEventListener('click', exportCsv);
            document.getElementById('exportJsonBtn').addEventListener('click', exportJson);
            document.getElementById('exportPdfBtn').addEventListener('click', exportPdf);
            
            // Backup & Restore events
            document.getElementById('backupBtn').addEventListener('click', backupData);
            document.getElementById('restoreBtn').addEventListener('click', function() {
                document.getElementById('restoreFileInput').click();
            });
            document.getElementById('restoreFileInput').addEventListener('change', restoreData);
            
            // Settings events
            document.getElementById('saveSettingsBtn').addEventListener('click', saveSettings);
            document.getElementById('resetSettingsBtn').addEventListener('click', resetSettings);
            document.querySelector('.toggle-password-setting').addEventListener('click', function() {
                const passwordInput = document.getElementById('securityCodeSetting');
                const confirmInput = document.getElementById('confirmSecurityCode');
                const icon = this.querySelector('i');
                
                if (passwordInput.type === 'password') {
                    passwordInput.type = 'text';
                    confirmInput.type = 'text';
                    icon.classList.replace('fa-eye', 'fa-eye-slash');
                } else {
                    passwordInput.type = 'password';
                    confirmInput.type = 'password';
                    icon.classList.replace('fa-eye-slash', 'fa-eye');
                }
            });
            
            // Mobile menu
            document.getElementById('mobileMenuBtn').addEventListener('click', toggleMobileMenu);
            document.getElementById('sidebarOverlay').addEventListener('click', toggleMobileMenu);
            
            // FAB button
            document.getElementById('fabBtn').addEventListener('click', scrollToTop);
            
            // Kecamatan change event untuk update desa
            document.getElementById('kecamatan').addEventListener('change', updateDesaDropdown);
            document.getElementById('filterKecamatan').addEventListener('change', updateFilterDesaDropdown);
            
            // Jenis bantuan change event
            document.getElementById('jenisBantuan').addEventListener('change', updateSatuanBantuan);
        }
        
        // Fungsi untuk handle login
        function handleLogin(e) {
            e.preventDefault();
            
            if (isBlocked) {
                showNotification('Anda masih dalam masa pemblokiran. Silakan coba lagi nanti.', 'error');
                return;
            }
            
            const securityCode = document.getElementById('securityCode').value;
            const loginButton = document.getElementById('loginButton');
            const loginSpinner = document.getElementById('loginSpinner');
            const loginText = document.querySelector('.login-button-text');
            
            // Tampilkan spinner
            loginButton.disabled = true;
            loginSpinner.classList.remove('d-none');
            loginText.textContent = 'Memverifikasi...';
            
            // Simulasi proses login
            setTimeout(() => {
                if (securityCode === '1234') { // Kode default
                    // Login berhasil
                    loginSpinner.classList.add('d-none');
                    loginText.textContent = 'Masuk ke Aplikasi';
                    loginButton.disabled = false;
                    
                    // Tampilkan form nama petugas setelah login berhasil
                    document.getElementById('petugasForm').style.display = 'block';
                    
                    // Sembunyikan form input kode keamanan
                    document.querySelector('.login-form-group').style.display = 'none';
                    
                    // Ubah tombol login menjadi tombol simpan nama petugas
                    loginText.textContent = 'Simpan Nama Petugas';
                    loginSpinner.classList.add('d-none');
                    loginButton.disabled = false;
                    
                    // Ubah event listener untuk menangani penyimpanan nama petugas
                    document.getElementById('loginForm').removeEventListener('submit', handleLogin);
                    document.getElementById('loginForm').addEventListener('submit', handleSavePetugas);
                    
                } else {
                    // Login gagal
                    loginSpinner.classList.add('d-none');
                    loginText.textContent = 'Masuk ke Aplikasi';
                    loginButton.disabled = false;
                    
                    // Sembunyikan aplikasi
                    document.getElementById('appContent').classList.add('app-content-unauthenticated');
                    
                    loginAttempts++;
                    updateAttemptsCount();
                    
                    // Goyangkan form
                    document.getElementById('loginForm').classList.add('login-shake');
                    setTimeout(() => {
                        document.getElementById('loginForm').classList.remove('login-shake');
                    }, 600);
                    
                    if (loginAttempts >= 3) {
                        // Blokir akses sementara
                        blockAccess();
                    }
                    
                    showNotification('Kode keamanan salah. Silakan coba lagi.', 'error');
                }
            }, 1000);
        }
        
        // Fungsi untuk menangani penyimpanan nama petugas
        function handleSavePetugas(e) {
            e.preventDefault();
            
            namaPetugas = document.getElementById('namaPetugas').value.trim();
            
            if (!namaPetugas) {
                alert('Nama petugas harus diisi.');
                return;
            }
            
            // Set nilai nama petugas di form input data
            document.getElementById('namaPetugasInput').value = namaPetugas;
            
            // Simpan nama petugas ke localStorage
            localStorage.setItem('namaPetugas', namaPetugas);
            
            // Tampilkan konten aplikasi
            document.getElementById('appContent').style.display = 'block';
            document.getElementById('appContent').classList.remove('app-content-unauthenticated');
            
            // Reset percobaan login
            loginAttempts = 0;
            updateAttemptsCount();
            
            // Sembunyikan modal login
            const loginModal = bootstrap.Modal.getInstance(document.getElementById('loginModal'));
            loginModal.hide();
            
            showNotification('Login berhasil! Selamat datang di aplikasi BARJAS.', 'success');
        }
        
        // Fungsi untuk update attempts count
        function updateAttemptsCount() {
            const attemptsElement = document.getElementById('attemptsCount');
            const blockedMessage = document.getElementById('blockedMessage');
            
            if (loginAttempts > 0) {
                attemptsElement.textContent = `Percobaan login gagal: ${loginAttempts}/3`;
                attemptsElement.style.display = 'block';
            } else {
                attemptsElement.style.display = 'none';
            }
            
            if (isBlocked) {
                blockedMessage.classList.remove('d-none');
            } else {
                blockedMessage.classList.add('d-none');
            }
        }
        
        // Fungsi untuk memblokir akses sementara
        function blockAccess() {
            isBlocked = true;
            updateAttemptsCount();
            
            let countdown = 30;
            document.getElementById('countdown').textContent = countdown;
            
            blockTimeout = setInterval(() => {
                countdown--;
                document.getElementById('countdown').textContent = countdown;
                
                if (countdown <= 0) {
                    clearInterval(blockTimeout);
                    isBlocked = false;
                    updateAttemptsCount();
                }
            }, 1000);
        }
        
        // Fungsi untuk logout
        function logout() {
            if (confirm('Apakah Anda yakin ingin keluar dari aplikasi?')) {
                // Sembunyikan konten aplikasi
                document.getElementById('appContent').style.display = 'none';
                
                // Tampilkan modal login
                const loginModal = new bootstrap.Modal(document.getElementById('loginModal'));
                loginModal.show();
                
                // Reset form login
                document.getElementById('loginForm').reset();
                document.getElementById('petugasForm').style.display = 'none';
                document.querySelector('.login-form-group').style.display = 'block';
                
                // Kembalikan event listener untuk login
                document.getElementById('loginForm').removeEventListener('submit', handleSavePetugas);
                document.getElementById('loginForm').addEventListener('submit', handleLogin);
                
                showNotification('Anda telah logout dari aplikasi.', 'info');
            }
        }
        
        // Fungsi untuk handle form submit
        function handleFormSubmit(e) {
            e.preventDefault();
            
            // Validasi form
            if (!validateForm()) {
                return;
            }
            
            // Ambil nilai dari form
            const formData = {
                id: Date.now(), // ID unik berdasarkan timestamp
                nama: document.getElementById('nama').value,
                nik: document.getElementById('nik').value,
                whatsapp: document.getElementById('whatsapp').getAttribute('data-raw-value') || document.getElementById('whatsapp').value.replace(/\D/g, ''),
                namaKelompok: document.getElementById('namaKelompok').value,
                jabatan: document.getElementById('jabatan').value,
                tahunAnggaran: document.getElementById('tahunAnggaran').value,
                kecamatan: document.getElementById('kecamatan').value,
                desa: document.getElementById('desa').value,
                alamat: document.getElementById('alamat').value,
                jenisBantuan: document.getElementById('jenisBantuan').value,
                namaBantuan: document.getElementById('namaBantuan').value,
                jumlahBantuan: document.getElementById('jumlahBantuan').value,
                satuanBantuan: document.getElementById('satuanBantuan').value,
                tanggalTerima: document.getElementById('tanggalTerima').value,
                namaPetugas: document.getElementById('namaPetugasInput').value,
                driveLink: document.getElementById('driveLink').value,
                kodeValidasi: document.getElementById('kodeValidasi').value,
                keterangan: document.getElementById('keterangan').value,
                tanggalInput: new Date().toISOString()
            };
            
            // Tambahkan data ke array
            appData.push(formData);
            saveData();
            
            // Reset form
            document.getElementById('inputForm').reset();
            
            // Set kembali nama petugas (karena form direset)
            document.getElementById('namaPetugasInput').value = namaPetugas;
            
            // Reset jabatan ke default
            document.getElementById('jabatan').value = 'Individu';
            
            // Set tahun ke default
            document.getElementById('tahunAnggaran').value = new Date().getFullYear();
            
            // Set tanggal hari ini
            document.getElementById('tanggalTerima').value = new Date().toISOString().split('T')[0];
            
            // Reset kode validasi
            document.getElementById('kodeValidasi').value = '';
            
            // Update UI
            updateDashboard();
            renderDataTable();
            
            showNotification('Data berhasil disimpan!', 'success');
        }
        
        // Fungsi untuk validasi form
        function validateForm() {
            let isValid = true;
            
            // Validasi Nama
            const nama = document.getElementById('nama').value;
            if (!nama) {
                document.getElementById('namaError').textContent = 'Nama harus diisi';
                document.getElementById('namaError').style.display = 'block';
                document.getElementById('nama').classList.add('input-error');
                isValid = false;
            } else {
                document.getElementById('namaError').style.display = 'none';
                document.getElementById('nama').classList.remove('input-error');
            }
            
            // Validasi NIK
            const nik = document.getElementById('nik').value;
            if (!nik) {
                document.getElementById('nikError').textContent = 'NIK harus diisi';
                document.getElementById('nikError').style.display = 'block';
                document.getElementById('nik').classList.add('input-error');
                isValid = false;
            } else if (isNikExists(nik)) {
                document.getElementById('nikError').textContent = 'NIK sudah terdaftar dalam sistem';
                document.getElementById('nikError').style.display = 'block';
                document.getElementById('nik').classList.add('input-error');
                isValid = false;
            } else {
                document.getElementById('nikError').style.display = 'none';
                document.getElementById('nik').classList.remove('input-error');
            }
            
            // Validasi WhatsApp
            const whatsapp = document.getElementById('whatsapp').value;
            if (!whatsapp) {
                document.getElementById('whatsappError').textContent = 'Nomor WhatsApp harus diisi';
                document.getElementById('whatsappError').style.display = 'block';
                document.getElementById('whatsapp').classList.add('input-error');
                isValid = false;
            } else {
                document.getElementById('whatsappError').style.display = 'none';
                document.getElementById('whatsapp').classList.remove('input-error');
            }
            
            // Validasi Kode Validasi
            const kodeValidasi = document.getElementById('kodeValidasi').value;
            if (!kodeValidasi) {
                showNotification('Harap generate kode validasi terlebih dahulu', 'error');
                isValid = false;
            }
            
            return isValid;
        }
        
        // Fungsi untuk format nomor WhatsApp
        function formatWhatsAppNumber(e) {
            let value = e.target.value.replace(/\D/g, '');
            
            // Jika dimulai dengan 0, ganti dengan 62
            if (value.startsWith('0')) {
                value = '62' + value.substring(1);
            }
            
            // Simpan nilai asli (tanpa tanda hubung) di data attribute
            e.target.setAttribute('data-raw-value', value);
            
            // Format tampilan: 62-xxx-xxxx-xxxx hanya untuk tampilan
            let displayValue = value;
            if (value.length > 2) {
                displayValue = value.substring(0, 2) + '-' + value.substring(2);
            }
            if (value.length > 6) {
                displayValue = value.substring(0, 6) + '-' + value.substring(6);
            }
            if (value.length > 11) {
                displayValue = value.substring(0, 11) + '-' + value.substring(11);
            }
            
            e.target.value = displayValue;
        }
        
        // Fungsi untuk mengecek apakah NIK sudah ada
        function isNikExists(nik) {
            return appData.some(data => data.nik === nik);
        }
        
        // Fungsi untuk generate kode validasi
        function generateValidationCode() {
            const nik = document.getElementById('nik').value;
            const nama = document.getElementById('nama').value;
            
            if (!nik || !nama) {
                showNotification('Harap isi NIK dan Nama terlebih dahulu', 'error');
                return;
            }
            
            // Cek apakah sudah ada kode untuk NIK ini
            if (generatedCodes[nik]) {
                document.getElementById('kodeValidasi').value = generatedCodes[nik];
                showNotification('Kode validasi sudah digenerate untuk NIK ini', 'info');
                return;
            }
            
            // Generate kode unik 5 karakter (huruf kapital dan angka)
            const characters = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789';
            let result = '';
            
            for (let i = 0; i < 5; i++) {
                result += characters.charAt(Math.floor(Math.random() * characters.length));
            }
            
            // Simpan kode untuk NIK ini
            generatedCodes[nik] = result;
            
            // Set nilai kode validasi
            document.getElementById('kodeValidasi').value = result;
            
            showNotification('Kode validasi berhasil digenerate', 'success');
        }
        
        // Fungsi untuk update dropdown desa berdasarkan kecamatan
        function updateDesaDropdown() {
            const kecamatan = document.getElementById('kecamatan').value;
            const desaSelect = document.getElementById('desa');
            
            // Reset dropdown desa
            desaSelect.innerHTML = '<option value="">Pilih Desa</option>';
            
            // Jika tidak ada kecamatan yang dipilih, tampilkan semua desa
            if (!kecamatan) {
                for (const desa of desaList) {
                    const option = document.createElement('option');
                    option.value = desa;
                    option.textContent = desa;
                    desaSelect.appendChild(option);
                }
                return;
            }
            
            // Daftar desa berdasarkan kecamatan (dalam aplikasi nyata, ini akan disesuaikan)
            // Untuk sementara, tampilkan semua desa tanpa filter
            for (const desa of desaList) {
                const option = document.createElement('option');
                option.value = desa;
                option.textContent = desa;
                desaSelect.appendChild(option);
            }
        }
        
        // Fungsi untuk update dropdown desa filter berdasarkan kecamatan
        function updateFilterDesaDropdown() {
            const kecamatan = document.getElementById('filterKecamatan').value;
            const desaSelect = document.getElementById('filterDesa');
            
            // Reset dropdown desa
            desaSelect.innerHTML = '<option value="">Semua Desa</option>';
            
            // Jika tidak ada kecamatan yang dipilih, tampilkan semua desa
            if (!kecamatan) {
                for (const desa of desaList) {
                    const option = document.createElement('option');
                    option.value = desa;
                    option.textContent = desa;
                    desaSelect.appendChild(option);
                }
                return;
            }
            
            // Daftar desa berdasarkan kecamatan (dalam aplikasi nyata, ini akan disesuaikan)
            // Untuk sementara, tampilkan semua desa tanpa filter
            for (const desa of desaList) {
                const option = document.createElement('option');
                option.value = desa;
                option.textContent = desa;
                desaSelect.appendChild(option);
            }
        }
        
        // Fungsi untuk update satuan bantuan berdasarkan jenis bantuan
        function updateSatuanBantuan() {
            const jenisBantuan = document.getElementById('jenisBantuan').value;
            const satuanBantuan = document.getElementById('satuanBantuan');
            
            // Reset dropdown satuan
            satuanBantuan.innerHTML = '';
            
            // Set opsi satuan berdasarkan jenis bantuan
            if (jenisBantuan === 'Uang') {
                satuanBantuan.innerHTML = '<option value="Rupiah">Rupiah</option>';
            } else if (jenisBantuan === 'Barang') {
                satuanBantuan.innerHTML = `
                    <option value="Unit">Unit</option>
                    <option value="Paket">Paket</option>
                    <option value="Set">Set</option>
                `;
            } else if (jenisBantuan === 'Jasa') {
                satuanBantuan.innerHTML = `
                    <option value="Jam">Jam</option>
                    <option value="Hari">Hari</option>
                    <option value="Paket">Paket</option>
                `;
            }
        }
        
        // Fungsi untuk load data dari localStorage
        function loadData() {
            const savedData = localStorage.getItem('barjasData');
            const savedNamaPetugas = localStorage.getItem('namaPetugas');
            if (savedData) {
                appData = JSON.parse(savedData);
            }

            if (savedNamaPetugas) {
                namaPetugas = savedNamaPetugas;
                document.getElementById('namaPetugasInput').value = namaPetugas;
            }
            
            const savedCodes = localStorage.getItem('barjasGeneratedCodes');
            if (savedCodes) {
                generatedCodes = JSON.parse(savedCodes);
            }
            
            renderDataTable();
        }
        
        // Fungsi untuk save data ke localStorage
        function saveData() {
            localStorage.setItem('barjasData', JSON.stringify(appData));
            localStorage.setItem('barjasGeneratedCodes', JSON.stringify(generatedCodes));
            localStorage.setItem('appData', JSON.stringify(appData));
        }
        
        // Fungsi untuk render data table
        function renderDataTable() {
            const tableBody = document.getElementById('dataTableBody');
            const tableInfo = document.getElementById('tableInfo');
            const pagination = document.getElementById('pagination');
            
            tableBody.innerHTML = '';
            
            const dataToRender = isFilterActive ? filteredData : appData;
            const totalItems = dataToRender.length;
            const totalPages = Math.ceil(totalItems / itemsPerPage);
            
            // Batasi currentPage agar tidak melebihi totalPages
            if (currentPage > totalPages && totalPages > 0) {
                currentPage = totalPages;
            }
            
            const startIndex = (currentPage - 1) * itemsPerPage;
            const endIndex = Math.min(startIndex + itemsPerPage, totalItems);
            
            for (let i = startIndex; i < endIndex; i++) {
                const data = dataToRender[i];
                const row = document.createElement('tr');
                
                // Format nomor WhatsApp untuk tampilan
                const whatsappDisplay = data.whatsapp ? data.whatsapp.replace('62', '0') : '-';
                
                row.innerHTML = `
                    <td>${i + 1}</td>
                    <td>${data.nama}</td>
                    <td>${data.nik}</td>
                    <td>
                        <span class="whatsapp-number" data-phone="${data.whatsapp}">
                            ${whatsappDisplay}
                        </span>
                    </td>
                    <td>${data.namaKelompok || '-'}</td>
                    <td>${data.jabatan || '-'}</td>
                    <td>${data.tahunAnggaran}</td>
                    <td>${data.kecamatan}</td>
                    <td>${data.desa}</td>
                    <td>${data.jenisBantuan}</td>
                    <td>${data.namaBantuan || '-'}</td>
                    <td>${data.jumlahBantuan} ${data.satuanBantuan}</td>
                    <td>${formatDate(data.tanggalTerima)}</td>
                    <td>${data.namaPetugas || '-'}</td>
                    <td>
                        ${data.driveLink ? 
                            `<a href="${data.driveLink}" class="drive-link" target="_blank">
                                <i class="fas fa-external-link-alt"></i> Buka
                            </a>` : 
                            '-'}
                    </td>
                    <td>${data.kodeValidasi}</td>
                    <td>
                        <div class="btn-group btn-group-sm">
                            <button class="btn btn-primary" onclick="editData(${data.id})">
                                <i class="fas fa-edit"></i>
                            </button>
                            <button class="btn btn-danger" onclick="deleteData(${data.id})">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>
                    </td>
                `;
                
                tableBody.appendChild(row);
            }
            
            // Tampilkan informasi tabel
            tableInfo.textContent = `Menampilkan ${startIndex + 1} sampai ${endIndex} dari ${totalItems} data`;
            
            // Buat pagination
            renderPagination(pagination, currentPage, totalPages);
            
            // Tambahkan event listener untuk nomor WhatsApp
            document.querySelectorAll('.whatsapp-number').forEach(element => {
                element.addEventListener('click', function() {
                    const phoneNumber = this.getAttribute('data-phone');
                    if (phoneNumber) {
                        window.open(`https://wa.me/${phoneNumber}`, '_blank');
                    }
                });
            });
        }
        
        // Fungsi untuk render pagination
        function renderPagination(pagination, currentPage, totalPages) {
            pagination.innerHTML = '';
            
            if (totalPages <= 1) {
                return;
            }
            
            // Tombol Previous
            const prevLi = document.createElement('li');
            prevLi.className = `page-item ${currentPage === 1 ? 'disabled' : ''}`;
            prevLi.innerHTML = `<a class="page-link" href="#" data-page="${currentPage - 1}">Sebelumnya</a>`;
            pagination.appendChild(prevLi);
            
            // Tampilkan halaman
            const startPage = Math.max(1, currentPage - 2);
            const endPage = Math.min(totalPages, startPage + 4);
            
            for (let i = startPage; i <= endPage; i++) {
                const pageLi = document.createElement('li');
                pageLi.className = `page-item ${i === currentPage ? 'active' : ''}`;
                pageLi.innerHTML = `<a class="page-link" href="#" data-page="${i}">${i}</a>`;
                pagination.appendChild(pageLi);
            }
            
            // Tombol Next
            const nextLi = document.createElement('li');
            nextLi.className = `page-item ${currentPage === totalPages ? 'disabled' : ''}`;
            nextLi.innerHTML = `<a class="page-link" href="#" data-page="${currentPage + 1}">Selanjutnya</a>`;
            pagination.appendChild(nextLi);
            
            // Tambahkan event listener untuk pagination
            pagination.querySelectorAll('.page-link').forEach(link => {
                link.addEventListener('click', function(e) {
                    e.preventDefault();
                    const page = parseInt(this.getAttribute('data-page'));
                    if (!isNaN(page) && page >= 1 && page <= totalPages) {
                        currentPage = page;
                        renderDataTable();
                    }
                });
            });
        }
        
        // Fungsi untuk search data
        function searchData() {
            const searchTerm = document.getElementById('searchData').value.toLowerCase();
            
            if (isFilterActive) {
                // Jika filter aktif, cari dalam data yang sudah difilter
                filteredData = filteredData.filter(data => 
                    data.nama.toLowerCase().includes(searchTerm) ||
                    data.nik.toLowerCase().includes(searchTerm) ||
                    (data.namaKelompok && data.namaKelompok.toLowerCase().includes(searchTerm)) ||
                    data.kecamatan.toLowerCase().includes(searchTerm) ||
                    data.desa.toLowerCase().includes(searchTerm) ||
                    data.jenisBantuan.toLowerCase().includes(searchTerm) ||
                    (data.namaBantuan && data.namaBantuan.toLowerCase().includes(searchTerm)) ||
                    data.namaPetugas.toLowerCase().includes(searchTerm)
                );
            } else {
                // Jika tidak ada filter aktif, cari dalam semua data
                filteredData = appData.filter(data => 
                    data.nama.toLowerCase().includes(searchTerm) ||
                    data.nik.toLowerCase().includes(searchTerm) ||
                    (data.namaKelompok && data.namaKelompok.toLowerCase().includes(searchTerm)) ||
                    data.kecamatan.toLowerCase().includes(searchTerm) ||
                    data.desa.toLowerCase().includes(searchTerm) ||
                    data.jenisBantuan.toLowerCase().includes(searchTerm) ||
                    (data.namaBantuan && data.namaBantuan.toLowerCase().includes(searchTerm)) ||
                    data.namaPetugas.toLowerCase().includes(searchTerm)
                );
                
                isFilterActive = searchTerm !== '';
            }
            
            currentPage = 1;
            renderDataTable();
        }
        
        // Fungsi untuk apply filter
        function applyFilter() {
            const tahun = document.getElementById('filterTahun').value;
            const kecamatan = document.getElementById('filterKecamatan').value;
            const desa = document.getElementById('filterDesa').value;
            const jenisBantuan = document.getElementById('filterJenisBantuan').value;
            
            filteredData = appData.filter(data => {
                return (!tahun || data.tahunAnggaran == tahun) &&
                       (!kecamatan || data.kecamatan === kecamatan) &&
                       (!desa || data.desa === desa) &&
                       (!jenisBantuan || data.jenisBantuan === jenisBantuan);
            });
            
            isFilterActive = true;
            currentPage = 1;
            renderDataTable();
            
            showNotification('Filter berhasil diterapkan', 'success');
        }
        
        // Fungsi untuk reset filter
        function resetFilter() {
            document.getElementById('filterTahun').value = '';
            document.getElementById('filterKecamatan').value = '';
            document.getElementById('filterDesa').value = '';
            document.getElementById('filterJenisBantuan').value = '';
            
            isFilterActive = false;
            currentPage = 1;
            renderDataTable();
            
            showNotification('Filter direset', 'info');
        }
        
        // Fungsi untuk edit data
        function editData(id) {
            const data = appData.find(item => item.id === id);
            if (!data) return;
            
            // Isi form dengan data yang dipilih
            document.getElementById('nama').value = data.nama;
            document.getElementById('nik').value = data.nik;
            document.getElementById('whatsapp').value = data.whatsapp;
            document.getElementById('namaKelompok').value = data.namaKelompok || '';
            document.getElementById('jabatan').value = data.jabatan || 'Individu';
            document.getElementById('tahunAnggaran').value = data.tahunAnggaran;
            document.getElementById('kecamatan').value = data.kecamatan;
            document.getElementById('desa').value = data.desa;
            document.getElementById('alamat').value = data.alamat || '';
            document.getElementById('jenisBantuan').value = data.jenisBantuan;
            document.getElementById('namaBantuan').value = data.namaBantuan || '';
            document.getElementById('jumlahBantuan').value = data.jumlahBantuan;
            document.getElementById('satuanBantuan').value = data.satuanBantuan;
            document.getElementById('tanggalTerima').value = data.tanggalTerima;
            document.getElementById('driveLink').value = data.driveLink || '';
            document.getElementById('kodeValidasi').value = data.kodeValidasi;
            document.getElementById('keterangan').value = data.keterangan || '';
            
            // Update satuan bantuan berdasarkan jenis bantuan
            updateSatuanBantuan();
            
            // Scroll ke form input
            document.getElementById('inputForm').scrollIntoView({ behavior: 'smooth' });
            
            // Tampilkan pesan
            showNotification('Data siap untuk diedit. Jangan lupa untuk menyimpan perubahan.', 'info');
            
            // Hapus data lama dari array
            deleteData(id, false);
        }
        
        // Fungsi untuk delete data
        function deleteData(id, confirm = true) {
            if (confirm && !window.confirm('Apakah Anda yakin ingin menghapus data ini?')) {
                return;
            }
            
            const index = appData.findIndex(item => item.id === id);
            if (index !== -1) {
                appData.splice(index, 1);
                saveData();
                renderDataTable();
                updateDashboard();
                
                if (confirm) {
                    showNotification('Data berhasil dihapus', 'success');
                }
            }
        }
        
        // Fungsi untuk update dashboard
        function updateDashboard() {
            const totalDataElement = document.getElementById('totalData');
            const latestDataElement = document.getElementById('latestData');
            const chartSection = document.getElementById('chartSection');
            
            totalDataElement.textContent = appData.length;
            
            if (appData.length > 0) {
                const latestData = appData[appData.length - 1];
                latestDataElement.innerHTML = `
                    <strong>${latestData.nama}</strong> (${latestData.nik}) - 
                    ${latestData.jenisBantuan} di ${latestData.desa}, ${latestData.kecamatan}
                `;
            } else {
                latestDataElement.textContent = 'Belum ada data';
            }
            
            // Update chart jika ada data
            if (appData.length > 0) {
                updateCharts();
                chartSection.style.display = 'block';
            } else {
                chartSection.style.display = 'none';
            }
        }
        
        // Fungsi untuk inisialisasi chart
        function initializeCharts() {
            // Inisialisasi chart di sini
            // Chart akan diupdate dengan data nyata saat updateCharts() dipanggil
        }
        
        // Fungsi untuk update chart
        function updateCharts() {
            // Update chart berdasarkan data yang ada
            // Implementasi chart akan ditambahkan di sini
        }
        
        // Fungsi untuk format tanggal
        function formatDate(dateString) {
            const options = { year: 'numeric', month: 'long', day: 'numeric' };
            return new Date(dateString).toLocaleDateString('id-ID', options);
        }
        
        // Fungsi untuk print PDF
        function printPdf() {
            window.print();
        }
        
        // Fungsi untuk preview report
        function previewReport() {
            const tahun = document.getElementById('printTahun').value;
            const kecamatan = document.getElementById('printKecamatan').value;
            
            // Filter data untuk preview
            let dataToPrint = appData;
            if (tahun) {
                dataToPrint = dataToPrint.filter(data => data.tahunAnggaran == tahun);
            }
            if (kecamatan) {
                dataToPrint = dataToPrint.filter(data => data.kecamatan === kecamatan);
            }
            
            if (dataToPrint.length === 0) {
                showNotification('Tidak ada data untuk ditampilkan', 'warning');
                return;
            }
            
            // Buka jendela baru untuk preview
            const printWindow = window.open('', '_blank');
            printWindow.document.write(`
                <html>
                <head>
                    <title>Laporan BARJAS</title>
                    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
                    <style>
                        body { font-family: Arial, sans-serif; padding: 20px; }
                        h1 { color: #0d47a1; }
                        .header { text-align: center; margin-bottom: 30px; }
                        .footer { text-align: center; margin-top: 30px; font-size: 0.9em; color: #666; }
                        table { width: 100%; border-collapse: collapse; }
                        th, td { border: 1px solid #ddd; padding: 8px; text-align: left; }
                        th { background-color: #f2f2f2; }
                    </style>
                </head>
                <body>
                    <div class="header">
                        <h1>LAPORAN BARJAS</h1>
                        <p>Sistem Bantuan Masyarakat</p>
                        <p>${tahun ? 'Tahun: ' + tahun : 'Semua Tahun'} ${kecamatan ? 'Kecamatan: ' + kecamatan : ''}</p>
                    </div>
                    
                    <table class="table table-bordered">
                        <thead>
                            <tr>
                                <th>No</th>
                                <th>Nama</th>
                                <th>NIK</th>
                                <th>WhatsApp</th>
                                <th>Kelompok</th>
                                <th>Tahun</th>
                                <th>Kecamatan</th>
                                <th>Desa</th>
                                <th>Jenis Bantuan</th>
                                <th>Nama Bantuan</th>
                                <th>Jumlah</th>
                                <th>Tanggal Terima</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${dataToPrint.map((data, index) => `
                                <tr>
                                    <td>${index + 1}</td>
                                    <td>${data.nama}</td>
                                    <td>${data.nik}</td>
                                    <td>${data.whatsapp}</td>
                                    <td>${data.namaKelompok || '-'}</td>
                                    <td>${data.tahunAnggaran}</td>
                                    <td>${data.kecamatan}</td>
                                    <td>${data.desa}</td>
                                    <td>${data.jenisBantuan}</td>
                                    <td>${data.namaBantuan || '-'}</td>
                                    <td>${data.jumlahBantuan} ${data.satuanBantuan}</td>
                                    <td>${formatDate(data.tanggalTerima)}</td>
                                </tr>
                            `).join('')}
                        </tbody>
                    </table>
                    
                    <div class="footer">
                        <p>Dicetak pada: ${new Date().toLocaleDateString('id-ID', { 
                            year: 'numeric', month: 'long', day: 'numeric',
                            hour: '2-digit', minute: '2-digit'
                        })}</p>
                        <p>Oleh: ${namaPetugas || 'Petugas'}</p>
                    </div>
                </body>
                </html>
            `);
            
            printWindow.document.close();
        }
        
        // Fungsi untuk export Excel
        function exportExcel() {
            const tahun = document.getElementById('exportTahun').value;
            const kecamatan = document.getElementById('exportKecamatan').value;
            
            // Filter data untuk export
            let dataToExport = appData;
            if (tahun) {
                dataToExport = dataToExport.filter(data => data.tahunAnggaran == tahun);
            }
            if (kecamatan) {
                dataToExport = dataToExport.filter(data => data.kecamatan === kecamatan);
            }
            
            if (dataToExport.length === 0) {
                showNotification('Tidak ada data untuk diexport', 'warning');
                return;
            }
            
            // Siapkan data untuk Excel
            const excelData = dataToExport.map(data => ({
                'Nama': data.nama,
                'NIK': data.nik,
                'WhatsApp': data.whatsapp,
                'Nama Kelompok': data.namaKelompok || '',
                'Jabatan': data.jabatan || '',
                'Tahun Anggaran': data.tahunAnggaran,
                'Kecamatan': data.kecamatan,
                'Desa': data.desa,
                'Alamat': data.alamat || '',
                'Jenis Bantuan': data.jenisBantuan,
                'Nama Bantuan': data.namaBantuan || '',
                'Jumlah Bantuan': data.jumlahBantuan,
                'Satuan Bantuan': data.satuanBantuan,
                'Tanggal Terima': formatDate(data.tanggalTerima),
                'Nama Petugas': data.namaPetugas,
                'Drive Link': data.driveLink || '',
                'Kode Validasi': data.kodeValidasi,
                'Keterangan': data.keterangan || ''
            }));
            
            // Buat worksheet
            const ws = XLSX.utils.json_to_sheet(excelData);
            
            // Buat workbook
            const wb = XLSX.utils.book_new();
            XLSX.utils.book_append_sheet(wb, ws, 'Data BARJAS');
            
            // Export ke file
            const fileName = `BARJAS_Export_${tahun || 'SemuaTahun'}_${kecamatan || 'SemuaKecamatan'}_${new Date().getTime()}.xlsx`;
            XLSX.writeFile(wb, fileName);
            
            showNotification('Data berhasil diexport ke Excel', 'success');
        }
        
        // Fungsi untuk export CSV
        function exportCsv() {
            const tahun = document.getElementById('exportTahun').value;
            const kecamatan = document.getElementById('exportKecamatan').value;
            
            // Filter data untuk export
            let dataToExport = appData;
            if (tahun) {
                dataToExport = dataToExport.filter(data => data.tahunAnggaran == tahun);
            }
            if (kecamatan) {
                dataToExport = dataToExport.filter(data => data.kecamatan === kecamatan);
            }
            
            if (dataToExport.length === 0) {
                showNotification('Tidak ada data untuk diexport', 'warning');
                return;
            }
            
            // Siapkan header CSV
            let csvContent = 'Nama,NIK,WhatsApp,Nama Kelompok,Jabatan,Tahun Anggaran,Kecamatan,Desa,Alamat,Jenis Bantuan,Nama Bantuan,Jumlah Bantuan,Satuan Bantuan,Tanggal Terima,Nama Petugas,Drive Link,Kode Validasi,Keterangan\n';
            
            // Tambahkan data
            dataToExport.forEach(data => {
                csvContent += `"${data.nama}","${data.nik}","${data.whatsapp}","${data.namaKelompok || ''}","${data.jabatan || ''}",${data.tahunAnggaran},"${data.kecamatan}","${data.desa}","${data.alamat || ''}","${data.jenisBantuan}","${data.namaBantuan || ''}",${data.jumlahBantuan},"${data.satuanBantuan}","${formatDate(data.tanggalTerima)}","${data.namaPetugas}","${data.driveLink || ''}","${data.kodeValidasi}","${data.keterangan || ''}"\n`;
            });
            
            // Buat blob dan download
            const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement('a');
            const url = URL.createObjectURL(blob);
            
            link.setAttribute('href', url);
            link.setAttribute('download', `BARJAS_Export_${tahun || 'SemuaTahun'}_${kecamatan || 'SemuaKecamatan'}_${new Date().getTime()}.csv`);
            link.style.visibility = 'hidden';
            
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            
            showNotification('Data berhasil diexport ke CSV', 'success');
        }
        
        // Fungsi untuk export JSON
        function exportJson() {
            const tahun = document.getElementById('exportTahun').value;
            const kecamatan = document.getElementById('exportKecamatan').value;
            
            // Filter data untuk export
            let dataToExport = appData;
            if (tahun) {
                dataToExport = dataToExport.filter(data => data.tahunAnggaran == tahun);
            }
            if (kecamatan) {
                dataToExport = dataToExport.filter(data => data.kecamatan === kecamatan);
            }
            
            if (dataToExport.length === 0) {
                showNotification('Tidak ada data untuk diexport', 'warning');
                return;
            }
            
            // Buat blob dan download
            const jsonString = JSON.stringify(dataToExport, null, 2);
            const blob = new Blob([jsonString], { type: 'application/json' });
            const link = document.createElement('a');
            const url = URL.createObjectURL(blob);
            
            link.setAttribute('href', url);
            link.setAttribute('download', `BARJAS_Export_${tahun || 'SemuaTahun'}_${kecamatan || 'SemuaKecamatan'}_${new Date().getTime()}.json`);
            link.style.visibility = 'hidden';
            
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            
            showNotification('Data berhasil diexport ke JSON', 'success');
        }
        
        // Fungsi untuk export PDF
        function exportPdf() {
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF();
            
            const tahun = document.getElementById('exportTahun').value;
            const kecamatan = document.getElementById('exportKecamatan').value;
            
            // Filter data untuk export
            let dataToExport = appData;
            if (tahun) {
                dataToExport = dataToExport.filter(data => data.tahunAnggaran == tahun);
            }
            if (kecamatan) {
                dataToExport = dataToExport.filter(data => data.kecamatan === kecamatan);
            }
            
            if (dataToExport.length === 0) {
                showNotification('Tidak ada data untuk diexport', 'warning');
                return;
            }
            
            // Siapkan data untuk tabel PDF
            const tableData = dataToExport.map(data => [
                data.nama,
                data.nik,
                data.whatsapp,
                data.namaKelompok || '-',
                data.tahunAnggaran,
                data.kecamatan,
                data.desa,
                data.jenisBantuan,
                data.namaBantuan || '-',
                `${data.jumlahBantuan} ${data.satuanBantuan}`,
                formatDate(data.tanggalTerima)
            ]);
            
            // Tambahkan header
            doc.setFontSize(16);
            doc.text('LAPORAN BARJAS', 105, 15, { align: 'center' });
            doc.setFontSize(12);
            doc.text('Sistem Bantuan Masyarakat', 105, 22, { align: 'center' });
            
            let filterInfo = '';
            if (tahun) filterInfo += `Tahun: ${tahun} `;
            if (kecamatan) filterInfo += `Kecamatan: ${kecamatan}`;
            
            if (filterInfo) {
                doc.setFontSize(10);
                doc.text(filterInfo, 105, 29, { align: 'center' });
            }
            
            // Buat tabel
            doc.autoTable({
                head: [['Nama', 'NIK', 'WhatsApp', 'Kelompok', 'Tahun', 'Kecamatan', 'Desa', 'Jenis', 'Bantuan', 'Jumlah', 'Tanggal']],
                body: tableData,
                startY: 35,
                theme: 'grid',
                headStyles: {
                    fillColor: [13, 71, 161],
                    textColor: 255
                },
                styles: {
                    fontSize: 8,
                    cellPadding: 1
                },
                margin: { top: 35 }
            });
            
            // Tambahkan footer
            const pageCount = doc.internal.getNumberOfPages();
            for (let i = 1; i <= pageCount; i++) {
                doc.setPage(i);
                doc.setFontSize(10);
                doc.text(`Halaman ${i} dari ${pageCount}`, 105, doc.internal.pageSize.height - 10, { align: 'center' });
                doc.text(`Dicetak oleh: ${namaPetugas || 'Petugas'} pada: ${new Date().toLocaleDateString('id-ID')}`, 105, doc.internal.pageSize.height - 5, { align: 'center' });
            }
            
            // Simpan PDF
            doc.save(`BARJAS_Export_${tahun || 'SemuaTahun'}_${kecamatan || 'SemuaKecamatan'}_${new Date().getTime()}.pdf`);
            
            showNotification('Data berhasil diexport ke PDF', 'success');
        }
        
        // Fungsi untuk backup data
        function backupData() {
            const dataToBackup = {
                appData: appData,
                generatedCodes: generatedCodes,
                namaPetugas: namaPetugas,
                backupDate: new Date().toISOString()
            };
            
            const jsonString = JSON.stringify(dataToBackup);
            const blob = new Blob([jsonString], { type: 'application/json' });
            const link = document.createElement('a');
            const url = URL.createObjectURL(blob);
            
            link.setAttribute('href', url);
            link.setAttribute('download', `BARJAS_Backup_${new Date().getTime()}.json`);
            link.style.visibility = 'hidden';
            
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            
            showNotification('Backup data berhasil', 'success');
        }
        
        // Fungsi untuk restore data
        function restoreData(e) {
            const file = e.target.files[0];
            if (!file) return;
            
            if (!confirm('Restore data akan menggantikan semua data yang ada. Lanjutkan?')) {
                e.target.value = '';
                return;
            }
            
            const reader = new FileReader();
            reader.onload = function(event) {
                try {
                    const backupData = JSON.parse(event.target.result);
                    
                    if (backupData.appData) {
                        appData = backupData.appData;
                    }
                    
                    if (backupData.generatedCodes) {
                        generatedCodes = backupData.generatedCodes;
                    }
                    
                    if (backupData.namaPetugas) {
                        namaPetugas = backupData.namaPetugas;
                        document.getElementById('namaPetugasInput').value = namaPetugas;
                        localStorage.setItem('namaPetugas', namaPetugas);
                    }
                    
                    saveData();
                    renderDataTable();
                    updateDashboard();
                    
                    showNotification('Data berhasil direstore', 'success');
                } catch (error) {
                    console.error('Error restoring data:', error);
                    showNotification('Gagal memulihkan data. File mungkin rusak.', 'error');
                }
            };
            
            reader.readAsText(file);
            e.target.value = '';
        }
        
        // Fungsi untuk save settings
        function saveSettings() {
            const newSecurityCode = document.getElementById('securityCodeSetting').value;
            const confirmSecurityCode = document.getElementById('confirmSecurityCode').value;
            
            if (newSecurityCode !== confirmSecurityCode) {
                showNotification('Kode keamanan dan konfirmasi tidak cocok', 'error');
                return;
            }
            
            // Di aplikasi nyata, kode keamanan akan disimpan dengan aman
            // Di sini kita hanya menyimpan di localStorage untuk simulasi
            if (newSecurityCode) {
                localStorage.setItem('securityCode', newSecurityCode);
                showNotification('Pengaturan berhasil disimpan', 'success');
            } else {
                showNotification('Kode keamanan tidak boleh kosong', 'error');
            }
        }
        
        // Fungsi untuk reset settings
        function resetSettings() {
            document.getElementById('securityCodeSetting').value = '';
            document.getElementById('confirmSecurityCode').value = '';
            showNotification('Pengaturan direset', 'info');
        }
        
        // Fungsi untuk toggle mobile menu
        function toggleMobileMenu() {
            const sidebar = document.getElementById('sidebar');
            const overlay = document.getElementById('sidebarOverlay');
            
            sidebar.classList.toggle('show');
            overlay.classList.toggle('show');
            
            document.body.classList.toggle('no-scroll');
        }
        
        // Fungsi untuk scroll to top
        function scrollToTop() {
            window.scrollTo({
                top: 0,
                behavior: 'smooth'
            });
        }
        
        // Fungsi untuk show notification
        function showNotification(message, type = 'info') {
            // Buat elemen notifikasi
            const notification = document.createElement('div');
            notification.className = `notification notification-${type}`;
            notification.innerHTML = `
                <div class="notification-content">
                    <span class="notification-message">${message}</span>
                    <button class="notification-close">&times;</button>
                </div>
            `;
            
            // Tambahkan ke container notifikasi
            const container = document.getElementById('notificationContainer');
            container.appendChild(notification);
            
            // Tampilkan notifikasi
            setTimeout(() => {
                notification.classList.add('show');
            }, 10);
            
            // Sembunyikan notifikasi setelah 5 detik
            const timeout = setTimeout(() => {
                closeNotification(notification);
            }, 5000);
            
            // Tambahkan event listener untuk tombol close
            const closeButton = notification.querySelector('.notification-close');
            closeButton.addEventListener('click', () => {
                clearTimeout(timeout);
                closeNotification(notification);
            });
        }
        
        // Fungsi untuk close notification
        function closeNotification(notification) {
            notification.classList.remove('show');
            setTimeout(() => {
                if (notification.parentNode) {
                    notification.parentNode.removeChild(notification);
                }
            }, 300);
        }
        
        // Inisialisasi datepicker
        function initDatePicker() {
            $('#tanggalTerima').datepicker({
                format: 'yyyy-mm-dd',
                autoclose: true,
                todayHighlight: true,
                language: 'id'
            });
        }
        
        // Panggil initDatePicker setelah DOM siap
        document.addEventListener('DOMContentLoaded', function() {
            initDatePicker();
        });
        
        // Update desa options berdasarkan kecamatan
        function updateDesaOptions() {
            const kecamatanSelect = document.getElementById('kecamatan');
            const desaSelect = document.getElementById('desa');
            const selectedKecamatan = kecamatanSelect.value;
            
            // Reset desa options
            desaSelect.innerHTML = '<option value="">Pilih Desa</option>';
            
            if (!selectedKecamatan) {
                // Jika tidak ada kecamatan yang dipilih, tampilkan semua desa
                desaList.forEach(desa => {
                    const option = document.createElement('option');
                    option.value = desa;
                    option.textContent = desa;
                    desaSelect.appendChild(option);
                });
                return;
            }
            
            // Filter desa berdasarkan kecamatan (dalam aplikasi nyata, ini akan menggunakan data yang sesuai)
            // Untuk demo, kita akan menampilkan semua desa
            desaList.forEach(desa => {
                const option = document.createElement('option');
                option.value = desa;
                option.textContent = desa;
                desaSelect.appendChild(option);
            });
        }
    </script>
</body>
</html>
