<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>APLIKASI BARJAS - SISTEM BANTUAN</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-datepicker/1.9.0/css/bootstrap-datepicker.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.28/jspdf.plugin.autotable.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <style>
        :root {
            --primary-color: #0d47a1;
            --secondary-color: #00695c;
            --accent-color: #ff8f00;
            --light-blue: #e3f2fd;
            --dark-blue: #082e5c;
            --gradient-primary: linear-gradient(135deg, var(--primary-color), var(--dark-blue));
            --gradient-secondary: linear-gradient(135deg, var(--secondary-color), #004d40);
            --gradient-accent: linear-gradient(135deg, var(--accent-color), #e65100);
            --shadow-sm: 0 2px 8px rgba(0,0,0,0.08);
            --shadow-md: 0 4px 16px rgba(0,0,0,0.12);
            --shadow-lg: 0 8px 28px rgba(0,0,0,0.15);
            --login-gradient: linear-gradient(135deg, #0d47a1, #00695c, #ff8f00);
        }
        
        body {
            background: linear-gradient(135deg, #f5f9ff 0%, #e8f5e9 100%);
            font-family: 'Poppins', 'Segoe UI', sans-serif;
            min-height: 100vh;
            padding: 10px 0;
            overflow-x: hidden;
        }
        
        .app-container {
            max-width: 1600px;
            margin: 0 auto;
            background: white;
            box-shadow: var(--shadow-lg);
            border-radius: 12px;
            overflow: hidden;
            position: relative;
            z-index: 10;
        }
        
        .app-header {
            background: var(--gradient-primary);
            color: white;
            padding: 20px 15px;
            text-align: center;
            position: relative;
            overflow: hidden;
        }
        
        .app-header::before {
            content: "";
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(255,255,255,0.15) 0%, transparent 70%);
            pointer-events: none;
        }
        
        .app-logo {
            font-size: 2.5rem;
            margin-bottom: 10px;
            position: relative;
            z-index: 1;
        }
        
        .app-title {
            font-size: 1.8rem;
            font-weight: 800;
            margin: 0;
            position: relative;
            z-index: 1;
            text-shadow: 1px 1px 4px rgba(0,0,0,0.3);
        }
        
        .app-subtitle {
            font-size: 1rem;
            opacity: 0.95;
            position: relative;
            z-index: 1;
            font-weight: 300;
            letter-spacing: 0.5px;
            margin-bottom: 5px;
        }
        
        .nav-pills .nav-link {
            border-radius: 8px;
            margin-bottom: 8px;
            padding: 12px 15px;
            font-weight: 500;
            color: #444;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            font-size: 0.9rem;
        }
        
        .nav-pills .nav-link:hover {
            background-color: #f0f7ff;
            transform: translateX(3px);
        }
        
        .nav-pills .nav-link.active {
            background: var(--gradient-primary);
            font-weight: 600;
            box-shadow: var(--shadow-md);
            transform: translateX(3px);
            color: white;
        }
        
        .section-title {
            border-left: 4px solid var(--primary-color);
            padding-left: 12px;
            margin: 20px 0;
            font-weight: 700;
            color: var(--dark-blue);
            font-size: 1.4rem;
            position: relative;
        }
        
        .section-title::after {
            content: "";
            position: absolute;
            bottom: -5px;
            left: 12px;
            width: 40px;
            height: 2px;
            background: var(--gradient-primary);
            border-radius: 2px;
        }
        
        .btn-primary {
            background: var(--gradient-primary);
            border: none;
            padding: 10px 20px;
            font-weight: 600;
            box-shadow: var(--shadow-md);
            border-radius: 8px;
            transition: all 0.3s;
            font-size: 0.9rem;
        }
        
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-lg);
        }
        
        .btn-success {
            background: var(--gradient-secondary);
            border: none;
            padding: 10px 20px;
            font-weight: 600;
            box-shadow: var(--shadow-md);
            border-radius: 8px;
            transition: all 0.3s;
            font-size: 0.9rem;
        }
        
        .btn-success:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-lg);
        }
        
        .btn-warning {
            background: var(--gradient-accent);
            border: none;
            padding: 10px 20px;
            font-weight: 600;
            box-shadow: var(--shadow-md);
            border-radius: 8px;
            transition: all 0.3s;
            font-size: 0.9rem;
        }
        
        .btn-warning:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-lg);
        }
        
        .form-label {
            font-weight: 600;
            color: #444;
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            font-size: 0.9rem;
        }
        
        .form-label i {
            margin-right: 6px;
            color: var(--primary-color);
        }
        
        .form-control, .form-select {
            border-radius: 8px;
            padding: 12px 15px;
            border: 1px solid #ddd;
            transition: all 0.3s;
            box-shadow: var(--shadow-sm);
            font-size: 0.9rem;
        }
        
        .form-control:focus, .form-select:focus {
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(13, 71, 161, 0.2);
            transform: translateY(-2px);
        }
        
        .copyright {
            text-align: center;
            padding: 20px;
            background-color: var(--light-blue);
            color: var(--dark-blue);
            font-size: 0.9rem;
            font-weight: 500;
        }
        
        .data-table {
            font-size: 0.85rem;
            border-collapse: separate;
            border-spacing: 0;
            box-shadow: var(--shadow-sm);
            border-radius: 8px;
            overflow: hidden;
        }
        
        .data-table th {
            background: var(--gradient-primary);
            color: white;
            font-weight: 600;
            padding: 12px 10px;
            text-align: center;
            position: relative;
            font-size: 0.85rem;
        }
        
        .data-table th::after {
            content: "";
            position: absolute;
            bottom: 0;
            left: 0;
            width: 100%;
            height: 1px;
            background: rgba(255,255,255,0.3);
        }
        
        .data-table td {
            padding: 10px 8px;
            vertical-align: middle;
            border-bottom: 1px solid #eee;
            font-size: 0.85rem;
        }
        
        .data-table tr:nth-child(even) {
            background-color: #f9fbff;
        }
        
        .data-table tr:hover {
            background-color: #edf5ff;
        }
        
        .feature-icon {
            font-size: 1.1rem;
            margin-right: 8px;
            width: 24px;
            text-align: center;
        }
        
        .card {
            border-radius: 10px;
            border: none;
            box-shadow: var(--shadow-md);
            transition: all 0.3s ease;
            overflow: hidden;
            margin-bottom: 15px;
        }
        
        .card:hover {
            transform: translateY(-5px);
            box-shadow: var(--shadow-lg);
        }
        
        .card-header {
            border-radius: 10px 10px 0 0 !important;
            font-weight: 600;
            padding: 15px 20px;
            background: var(--gradient-primary);
            color: white;
            font-size: 0.95rem;
        }
        
        .stats-box {
            text-align: center;
            padding: 20px 15px;
            border-radius: 10px;
            background: white;
            box-shadow: var(--shadow-md);
            transition: all 0.3s;
            position: relative;
            overflow: hidden;
            margin-bottom: 15px;
        }
        
        .stats-box::before {
            content: "";
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 4px;
            background: var(--gradient-primary);
            border-radius: 2px;
        }
        
        .stats-box:hover {
            transform: translateY(-3px);
            box-shadow: var(--shadow-lg);
        }
        
        .stats-number {
            font-size: 1.8rem;
            font-weight: 800;
            color: var(--primary-color);
            margin: 10px 0;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.1);
        }
        
        .stats-label {
            font-size: 0.9rem;
            color: #666;
            font-weight: 500;
        }
        
        .notification-toast {
            position: fixed;
            bottom: 20px;
            right: 20px;
            z-index: 1050;
            min-width: 280px;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: var(--shadow-lg);
            max-width: calc(100vw - 40px);
        }
        
        .input-error {
            border-color: #dc3545;
            box-shadow: 0 0 0 3px rgba(220, 53, 69, 0.2);
        }
        
        .error-message {
            color: #dc3545;
            font-size: 0.8rem;
            margin-top: 5px;
            display: none;
            font-weight: 500;
        }
        
        .watermark {
            position: absolute;
            bottom: 10px;
            right: 15px;
            opacity: 0.8;
            font-size: 0.8rem;
            color: white;
            font-weight: 300;
        }
        
        .control-panel {
            background: #f8f9fa;
            border-radius: 8px;
            padding: 15px;
            margin-top: 15px;
            box-shadow: var(--shadow-sm);
        }
        
        .control-title {
            font-size: 1rem;
            color: var(--primary-color);
            font-weight: 600;
            margin-bottom: 15px;
            padding-bottom: 8px;
            border-bottom: 1px solid var(--light-blue);
        }
        
        .floating-action-btn {
            position: fixed;
            bottom: 20px;
            right: 20px;
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background: var(--gradient-primary);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: var(--shadow-lg);
            z-index: 1000;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .floating-action-btn:hover {
            transform: scale(1.1) rotate(90deg);
        }
        
        .filter-section {
            background: white;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 20px;
            box-shadow: var(--shadow-sm);
        }
        
        .badge-custom {
            background: var(--gradient-primary);
            color: white;
            padding: 6px 12px;
            border-radius: 16px;
            font-weight: 600;
            font-size: 0.8rem;
        }
        
        .mobile-menu-btn {
            display: none;
            position: fixed;
            top: 15px;
            left: 15px;
            z-index: 1050;
            background: var(--gradient-primary);
            color: white;
            border: none;
            border-radius: 50%;
            width: 45px;
            height: 45px;
            box-shadow: var(--shadow-lg);
        }
        
        .sidebar-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 1040;
        }
        
        /* Animations */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .animate-fadeIn {
            animation: fadeIn 0.5s ease forwards;
        }
        
        /* Custom scrollbar */
        ::-webkit-scrollbar {
            width: 6px;
        }
        
        ::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 8px;
        }
        
        ::-webkit-scrollbar-thumb {
            background: var(--primary-color);
            border-radius: 8px;
        }
        
        ::-webkit-scrollbar-thumb:hover {
            background: var(--dark-blue);
        }
        
        /* Responsive styles */
        @media (max-width: 991.98px) {
            .col-md-3.col-lg-2 {
                position: fixed;
                left: -300px;
                top: 0;
                bottom: 0;
                z-index: 1050;
                width: 280px;
                transition: left 0.3s ease;
                overflow-y: auto;
                padding-top: 60px;
            }
            
            .col-md-3.col-lg-2.mobile-show {
                left: 0;
            }
            
            .col-md-9.col-lg-10 {
                width: 100%;
                flex: 0 0 100%;
                max-width: 100%;
            }
            
            .mobile-menu-btn {
                display: flex;
                align-items: center;
                justify-content: center;
            }
            
            .sidebar-overlay.mobile-show {
                display: block;
            }
        }
        
        /* Print Styles - IMPROVED FOR LANDSCAPE */
        @media print {
            @page {
                size: landscape;
                margin: 0.5cm;
            }
            
            body * {
                visibility: hidden;
            }
            
            .app-container, .app-container * {
                visibility: visible;
            }
            
            .app-container {
                position: absolute;
                left: 0;
                top: 0;
                width: 100%;
                box-shadow: none;
            }
            
            .nav-pills, .mobile-menu-btn, .sidebar-overlay, .floating-action-btn,
            .btn-group, .filter-section, .toast {
                display: none !important;
            }
            
            .col-md-3.col-lg-2.p-4.bg-light {
                display: none !important;
            }
            
            .col-md-9.col-lg-10.p-5 {
                width: 100%;
                flex: 0 0 100%;
                max-width: 100%;
                padding: 0 !important;
            }
            
            .copyright {
                display: none;
            }
            
            .data-table {
                font-size: 10px;
                width: 100% !important;
            }
            
            .data-table th, .data-table td {
                padding: 4px 2px;
            }
            
            /* Sembunyikan kolom aksi dan link Google Drive saat mencetak */
            .data-table th:last-child,
            .data-table td:last-child {
                display: none !important;
            }
            
            /* Judul untuk laporan cetak */
            .print-header {
                display: block !important;
                text-align: center;
                margin-bottom: 15px;
            }
            
            .print-title {
                font-size: 18px;
                font-weight: bold;
                margin-bottom: 5px;
            }
            
            .print-subtitle {
                font-size: 14px;
                margin-bottom: 10px;
            }
            
            .print-date {
                font-size: 12px;
                text-align: right;
                margin-bottom: 10px;
            }
        }

        /* WhatsApp link style */
        .whatsapp-link {
            color: #25D366;
            text-decoration: none;
        }
        
        .whatsapp-link:hover {
            text-decoration: underline;
        }
        
        /* View Link Button */
        .btn-view {
            background: linear-gradient(135deg, #17a2b8, #138496);
            color: white;
            border: none;
            padding: 5px 10px;
            border-radius: 4px;
            font-size: 0.8rem;
        }
        
        .btn-view:hover {
            background: linear-gradient(135deg, #138496, #117a8b);
            color: white;
        }
        
        /* Undo Button */
        .btn-undo {
            background: linear-gradient(135deg, #6c757d, #5a6268);
            color: white;
            border: none;
        }
        
        .btn-undo:hover {
            background: linear-gradient(135deg, #5a6268, #4e555b);
            color: white;
        }
        
        /* WhatsApp number link in table */
        .whatsapp-number {
            color: #25D366;
            cursor: pointer;
            text-decoration: underline;
        }
        
        /* Welcome Modal Styles */
        .welcome-modal .modal-content {
            border-radius: 15px;
            overflow: hidden;
            border: none;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }
        
        .welcome-header {
            background: var(--gradient-primary);
            color: white;
            text-align: center;
            padding: 25px;
        }
        
        .welcome-icon {
            font-size: 3rem;
            margin-bottom: 15px;
        }
        
        .welcome-body {
            padding: 25px;
            text-align: center;
        }
        
        .welcome-footer {
            background: #f8f9fa;
            padding: 15px;
            text-align: center;
            border-top: 1px solid #eee;
        }
        
        .countdown-timer {
            font-size: 0.9rem;
            color: #6c757d;
            margin-top: 10px;
        }
        
        /* Button untuk cetak per data */
        .btn-print-individual {
            background: linear-gradient(135deg, #6f42c1, #5a2d95);
            color: white;
            border: none;
            padding: 5px 10px;
            border-radius: 4px;
            font-size: 0.8rem;
        }
        
        .btn-print-individual:hover {
            background: linear-gradient(135deg, #5a2d95, #4a2479);
            color: white;
        }
        
        /* Developer Info Styles */
        .developer-info {
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            border-radius: 10px;
            padding: 20px;
            margin-top: 20px;
            box-shadow: var(--shadow-sm);
        }
        
        .developer-logo {
            max-width: 120px;
            margin-bottom: 15px;
            border-radius: 8px;
        }
        
        .developer-contact a {
            color: var(--primary-color);
            text-decoration: none;
            transition: all 0.3s;
        }
        
        .developer-contact a:hover {
            color: var(--dark-blue);
            text-decoration: underline;
        }
        
        /* Welcome Splash Screen */
        .welcome-splash {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: var(--gradient-primary);
            color: white;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 9999;
            transition: opacity 0.5s ease;
        }
        
        .welcome-splash-content {
            text-align: center;
            max-width: 600px;
            padding: 30px;
        }
        
        .welcome-splash-logo {
            font-size: 4rem;
            margin-bottom: 20px;
        }
        
        .welcome-splash-title {
            font-size: 2.2rem;
            font-weight: 800;
            margin-bottom: 15px;
        }
        
        .welcome-splash-message {
            font-size: 1.1rem;
            line-height: 1.6;
            margin-bottom: 25px;
        }
        
        .welcome-splash-countdown {
            font-size: 1rem;
            margin-top: 20px;
        }
        
        .welcome-splash-close {
            position: absolute;
            top: 20px;
            right: 20px;
            background: rgba(255,255,255,0.2);
            border: none;
            color: white;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .welcome-splash-close:hover {
            background: rgba(255,255,255,0.3);
            transform: rotate(90deg);
        }
        
        /* Loading spinner */
        .spinner-border-sm {
            width: 1rem;
            height: 1rem;
        }

        /* Login Modal Styles */
        .login-modal .modal-content {
            border-radius: 15px;
            overflow: hidden;
            border: none;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
        }

        .login-header {
            background: var(--login-gradient);
            color: white;
            text-align: center;
            padding: 25px 20px;
            position: relative;
        }

        .login-icon {
            font-size: 3rem;
            margin-bottom: 15px;
            color: white;
        }

        .login-title {
            font-size: 1.8rem;
            font-weight: 700;
            margin: 0;
        }

        .login-subtitle {
            font-size: 1rem;
            opacity: 0.9;
            margin: 5px 0 0;
        }

        .login-body {
            padding: 25px;
            position: relative;
            z-index: 1;
        }

        .login-form-group {
            margin-bottom: 20px;
        }

        .login-form-label {
            font-weight: 600;
            color: var(--dark-blue);
            margin-bottom: 8px;
            display: flex;
            align-items: center;
        }

        .login-form-label i {
            margin-right: 10px;
            color: var(--dark-blue);
        }

        .login-form-control {
            border-radius: 8px;
            padding: 12px 15px;
            border: 2px solid #ddd;
            transition: all 0.3s;
        }

        .login-form-control:focus {
            border-color: var(--dark-blue);
            box-shadow: 0 0 0 3px rgba(13, 71, 161, 0.2);
        }

        .login-input-group-text {
            background: var(--light-blue);
            border: 2px solid #ddd;
            border-left: none;
        }

        .btn-login {
            background: var(--gradient-secondary);
            color: white;
            border: none;
            padding: 12px;
            font-weight: 600;
            border-radius: 8px;
            width: 100%;
            transition: all 0.3s;
            margin-top: 10px;
        }

        .btn-login:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 105, 92, 0.4);
        }

        .btn-login:disabled {
            background: #ccc;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        .login-security-notice {
            text-align: center;
            margin-top: 20px;
            font-size: 0.85rem;
            color: #666;
        }

        .login-attempts-count {
            text-align: center;
            font-size: 0.9rem;
            color: #ff8f00;
            font-weight: 500;
            margin-top: 5px;
        }

        .login-blocked-message {
            text-align: center;
            background: rgba(220, 53, 69, 0.1);
            border-radius: 8px;
            padding: 15px;
            margin-top: 20px;
            color: #dc3545;
            font-weight: 500;
        }

        .login-countdown {
            font-size: 1.2rem;
            font-weight: 700;
            color: var(--dark-blue);
        }

        .login-developer-info {
            background: var(--light-blue);
            border-radius: 10px;
            padding: 20px;
            margin-top: 25px;
            text-align: center;
        }

        .login-developer-logo {
            max-width: 180px;
            margin-bottom: 15px;
            border-radius: 8px;
        }

        .login-developer-contact a {
            color: var(--dark-blue);
            text-decoration: none;
            transition: all 0.3s;
            display: inline-block;
            margin: 5px 0;
        }

        .login-developer-contact a:hover {
            color: var(--primary-color);
            text-decoration: underline;
            transform: translateY(-2px);
        }

        .login-copyright {
            text-align: center;
            margin-top: 20px;
            color: #666;
            font-size: 0.9rem;
            opacity: 0.9;
        }

        /* Animations */
        @keyframes login-shake {
            0%, 100% { transform: translateX(0); }
            10%, 30%, 50%, 70%, 90% { transform: translateX(-10px); }
            20%, 40%, 60%, 80% { transform: translateX(10px); }
        }

        .login-shake {
            animation: login-shake 0.6s cubic-bezier(.36,.07,.19,.97) both;
        }

        /* Login particle background */
        #login-particles {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 1040; /* Higher than modal backdrop */
            display: none;
        }

        /* Link Google Drive dalam tabel */
        .drive-link {
            color: #0d47a1;
            text-decoration: none;
            cursor: pointer;
        }

        .drive-link:hover {
            text-decoration: underline;
        }

        /* Modal untuk menambah link */
        .link-modal .modal-dialog {
            max-width: 600px;
        }
        
        /* App content when not authenticated */
        .app-content-unauthenticated {
            display: none;
        }
    </style>
</head>
<body>
    <!-- Login Modal -->
    <div class="modal fade login-modal" id="loginModal" tabindex="-1" aria-hidden="true" data-bs-backdrop="static" data-bs-keyboard="false">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="login-header">
                    <div class="login-icon">
                        <i class="fas fa-lock"></i>
                    </div>
                    <h2 class="login-title">AUTHENTICATION REQUIRED</h2>
                    <p class="login-subtitle">Masukkan Kode Keamanan untuk Mengakses Aplikasi</p>
                </div>
                <div class="login-body">
                    <form id="loginForm">
                        <div class="mb-3 login-form-group">
                            <label class="form-label login-form-label">
                                <i class="fas fa-key"></i> Kode Keamanan
                            </label>
                            <div class="input-group">
                                <input type="password" class="form-control login-form-control" id="securityCode" placeholder="Masukkan kode akses aplikasi">
                                <button class="btn btn-outline-secondary toggle-password" type="button">
                                    <i class="fas fa-eye"></i>
                                </button>
                            </div>
                            <div class="form-text text-danger login-attempts-count" id="attemptsCount"></div>
                        </div>
                        <button type="submit" class="btn btn-login" id="loginButton">
                            <span class="login-button-text">Masuk ke Aplikasi</span>
                            <span class="spinner-border spinner-border-sm d-none" id="loginSpinner"></span>
                        </button>
                    </form>
                    
                    <div class="login-blocked-message d-none" id="blockedMessage">
                        <i class="fas fa-ban me-2"></i>
                        <span id="blockedText">Terlalu banyak percobaan gagal. Silakan coba lagi dalam </span>
                        <span class="login-countdown" id="countdown">30</span> detik.
                    </div>
                    
                    <div class="login-security-notice">
                        <i class="fas fa-info-circle me-2"></i>
                        Hubungi Administrator untuk mendapatkan kode akses
                    </div>
                    
                    <div class="login-developer-info">
                        <h5 class="mb-3">Developer Information</h5>
                        <div class="login-developer-contact">
                            <p><i class="fab fa-whatsapp me-2"></i> <a href="https://wa.me/6285647709114" target="_blank">+62 856-4770-9114</a></p>
                            <p><i class="fas fa-envelope me-2"></i> <a href="mailto:admin@anekamarket.my.id">admin@anekamarket.my.id</a></p>
                        </div>
                    </div>
                    
                    <div class="login-copyright">
                        &copy; 2025 Lentera karya Situbondo
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Login particle background -->
    <div id="login-particles"></div>
    
    <!-- Welcome Splash Screen -->
    <div class="welcome-splash" id="welcomeSplash">
        <button class="welcome-splash-close" id="closeSplash">
            <i class="fas fa-times"></i>
        </button>
        <div class="welcome-splash-content">
            <div class="welcome-splash-logo">
                <i class="fas fa-hands-helping"></i>
            </div>
            <h1 class="welcome-splash-title">SISTEM BANTUAN BARJAS</h1>
            <p class="welcome-splash-message">
                Aplikasi Sistem Bantuan BARJAS merupakan platform terpadu yang dirancang untuk mentransformasi pendataan, penyaluran, 
                dan monitoring program bantuan pemerintah. Aplikasi ini kami ciptakan untuk mendorong efisiensi, akurasi, 
                dan transparansi dalam pengelolaan bantuan, guna mempercepat penyerapan dan meningkatkan akuntabilitas.
            </p>
            <div class="welcome-splash-countdown" id="splashCountdown">
                Membuka aplikasi dalam <span id="countdownTimer">5</span> detik...
            </div>
        </div>
    </div>
    
    <!-- Main Application Content (initially hidden) -->
    <div class="app-content-unauthenticated" id="appContent">
        <!-- Mobile Menu Button -->
        <button class="mobile-menu-btn" id="mobileMenuBtn">
            <i class="fas fa-bars"></i>
        </button>
        
        <!-- Sidebar Overlay -->
        <div class="sidebar-overlay" id="sidebarOverlay"></div>
        
        <div class="app-container animate-fadeIn">
            <div class="app-header">
                <div class="app-logo">
                    <i class="fas fa-hands-helping"></i>
                </div>
                <h1 class="app-title">BARJAS</h1>
                <p class="app-subtitle">Sistem Bantuan Terpadu</p>
                <p class="app-subtitle" id="institutionName">Dinas Peternakan dan Perikanan Kabupaten Situbondo</p>
                <div class="watermark">v2.1.0</div>
            </div>
            
            <div class="row g-0">
                <!-- Sidebar Navigation -->
                <div class="col-md-3 col-lg-2 p-4 bg-light" id="sidebar">
                    <ul class="nav nav-pills flex-column mb-auto">
                        <li class="nav-item">
                            <a href="#" class="nav-link active" data-bs-target="dashboard">
                                <span class="feature-icon"><i class="fas fa-home"></i></span>
                                Dashboard
                            </a>
                        </li>
                        <li class="nav-item">
                            <a href="#" class="nav-link" data-bs-target="inputData">
                                <span class="feature-icon"><i class="fas fa-pen-to-square"></i></span>
                                Input Data Bantuan
                            </a>
                        </li>
                        <li class="nav-item">
                            <a href="#" class="nav-link" data-bs-target="dataTable">
                                <span class="feature-icon"><i class="fas fa-table"></i></span>
                                Tabel Data
                            </a>
                        </li>
                        <li class="nav-item">
                            <a href="#" class="nav-link" data-bs-target="settings">
                                <span class="feature-icon"><i class="fas fa-gear"></i></span>
                                Pengaturan
                            </a>
                        </li>
                        <li class="nav-item mt-4">
                            <a href="#" class="nav-link text-danger" id="logoutButton">
                                <span class="feature-icon"><i class="fas fa-right-from-bracket"></i></span>
                                Keluar
                            </a>
                        </li>
                    </ul>
                </div>
                
                <!-- Main Content Area -->
                <div class="col-md-9 col-lg-10 p-5">
                    <!-- Dashboard Section -->
                    <div class="content-section" id="dashboard">
                        <h3 class="section-title">Dashboard</h3>
                        
                        <div class="row">
                            <div class="col-md-4">
                                <div class="stats-box">
                                    <div class="stats-icon">
                                        <i class="fas fa-users fa-2x text-primary"></i>
                                    </div>
                                    <div class="stats-number" id="totalRecipients">0</div>
                                    <div class="stats-label">Total Penerima Bantuan</div>
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="stats-box">
                                    <div class="stats-icon">
                                        <i class="fas fa-box-open fa-2x text-success"></i>
                                    </div>
                                    <div class="stats-number" id="totalAssistance">0</div>
                                    <div class="stats-label">Total Bantuan Disalurkan</div>
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="stats-box">
                                    <div class="stats-icon">
                                        <i class="fas fa-check-circle fa-2x text-warning"></i>
                                    </div>
                                    <div class="stats-number" id="completedDistributions">0</div>
                                    <div class="stats-label">Distribusi Terselesaikan</div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="row mt-4">
                            <div class="col-md-8">
                                <div class="card">
                                    <div class="card-header">
                                        <i class="fas fa-chart-line me-2"></i>Statistik Bantuan Per Jenis
                                    </div>
                                    <div class="card-body">
                                        <canvas id="assistanceChart" height="250"></canvas>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="card">
                                    <div class="card-header">
                                        <i class="fas fa-chart-pie me-2"></i>Distribusi Per Kecamatan
                                    </div>
                                    <div class="card-body">
                                        <canvas id="distributionChart" height="250"></canvas>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="row mt-4">
                            <div class="col-12">
                                <div class="card">
                                    <div class="card-header">
                                        <i class="fas fa-history me-2"></i>Aktivitas Terbaru
                                    </div>
                                    <div class="card-body p-0">
                                        <div class="table-responsive">
                                            <table class="table table-hover table-striped mb-0 data-table">
                                                <thead>
                                                    <tr>
                                                        <th>Tanggal</th>
                                                        <th>Jenis Bantuan</th>
                                                        <th>Penerima</th>
                                                        <th>Lokasi</th>
                                                        <th>Status</th>
                                                    </tr>
                                                </thead>
                                                <tbody id="recentActivities">
                                                    <tr>
                                                        <td colspan="5" class="text-center">Memuat data...</td>
                                                    </tr>
                                                </tbody>
                                            </table>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Input Data Section -->
                    <div class="content-section d-none" id="inputData">
                        <h3 class="section-title">Input Data Bantuan</h3>
                        
                        <div class="card">
                            <div class="card-header">
                                <i class="fas fa-pen-to-square me-2"></i>Formulir Input Data
                            </div>
                            <div class="card-body">
                                <form id="assistanceForm">
                                    <div class="row mb-3">
                                        <div class="col-md-6">
                                            <label class="form-label">
                                                <i class="fas fa-tag"></i> Jenis Bantuan
                                            </label>
                                            <select class="form-select" id="assistanceType" required>
                                                <option value="">Pilih Jenis Bantuan</option>
                                                <option value="Pakan Ternak">Pakan Ternak</option>
                                                <option value="Bibit Ikan">Bibit Ikan</option>
                                                <option value="Pupuk">Pupuk</option>
                                                <option value="Alat Pertanian">Alat Pertanian</option>
                                                <option value="Lainnya">Lainnya</option>
                                            </select>
                                        </div>
                                        <div class="col-md-6">
                                            <label class="form-label">
                                                <i class="fas fa-calendar"></i> Tanggal Distribusi
                                            </label>
                                            <input type="date" class="form-control" id="distributionDate" required>
                                        </div>
                                    </div>
                                    
                                    <div class="row mb-3">
                                        <div class="col-md-6">
                                            <label class="form-label">
                                                <i class="fas fa-user"></i> Nama Penerima
                                            </label>
                                            <input type="text" class="form-control" id="recipientName" placeholder="Nama lengkap penerima" required>
                                        </div>
                                        <div class="col-md-6">
                                            <label class="form-label">
                                                <i class="fas fa-phone"></i> Nomor Telepon/WhatsApp
                                            </label>
                                            <input type="tel" class="form-control" id="recipientPhone" placeholder="Contoh: 081234567890">
                                        </div>
                                    </div>
                                    
                                    <div class="row mb-3">
                                        <div class="col-md-6">
                                            <label class="form-label">
                                                <i class="fas fa-map-marker-alt"></i> Kecamatan
                                            </label>
                                            <select class="form-select" id="district" required>
                                                <option value="">Pilih Kecamatan</option>
                                                <option value="Banyuglugur">Banyuglugur</option>
                                                <option value="Besuki">Besuki</option>
                                                <option value="Jatibanteng">Jatibanteng</option>
                                                <option value="Kapongan">Kapongan</option>
                                                <option value="Kendit">Kendit</option>
                                                <option value="Mangaran">Mangaran</option>
                                                <option value="Panarukan">Panarukan</option>
                                                <option value="Panji">Panji</option>
                                                <option value="Situbondo">Situbondo</option>
                                                <option value="Suboh">Suboh</option>
                                            </select>
                                        </div>
                                        <div class="col-md-6">
                                            <label class="form-label">
                                                <i class="fas fa-location-dot"></i> Desa/Kelurahan
                                            </label>
                                            <input type="text" class="form-control" id="village" placeholder="Nama desa/kelurahan" required>
                                        </div>
                                    </div>
                                    
                                    <div class="row mb-3">
                                        <div class="col-md-6">
                                            <label class="form-label">
                                                <i class="fas fa-box"></i> Jumlah Bantuan
                                            </label>
                                            <input type="number" class="form-control" id="quantity" placeholder="Jumlah bantuan" min="1" required>
                                        </div>
                                        <div class="col-md-6">
                                            <label class="form-label">
                                                <i class="fas fa-weight-hanging"></i> Satuan
                                            </label>
                                            <input type="text" class="form-control" id="unit" placeholder="Contoh: kg, liter, unit" required>
                                        </div>
                                    </div>
                                    
                                    <div class="mb-3">
                                        <label class="form-label">
                                            <i class="fas fa-link"></i> Link Google Drive (Dokumentasi)
                                        </label>
                                        <input type="url" class="form-control" id="driveLink" placeholder="https://drive.google.com/...">
                                    </div>
                                    
                                    <div class="mb-3">
                                        <label class="form-label">
                                            <i class="fas fa-file-lines"></i> Keterangan Tambahan
                                        </label>
                                        <textarea class="form-control" id="notes" rows="3" placeholder="Catatan tambahan mengenai bantuan"></textarea>
                                    </div>
                                    
                                    <div class="d-flex justify-content-end">
                                        <button type="reset" class="btn btn-secondary me-2">
                                            <i class="fas fa-eraser me-1"></i> Reset
                                        </button>
                                        <button type="submit" class="btn btn-primary">
                                            <i class="fas fa-save me-1"></i> Simpan Data
                                        </button>
                                    </div>
                                </form>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Data Table Section -->
                    <div class="content-section d-none" id="dataTable">
                        <h3 class="section-title">Tabel Data Bantuan</h3>
                        
                        <div class="filter-section">
                            <div class="row">
                                <div class="col-md-3">
                                    <label class="form-label">Jenis Bantuan</label>
                                    <select class="form-select" id="filterType">
                                        <option value="">Semua Jenis</option>
                                        <option value="Pakan Ternak">Pakan Ternak</option>
                                        <option value="Bibit Ikan">Bibit Ikan</option>
                                        <option value="Pupuk">Pupuk</option>
                                        <option value="Alat Pertanian">Alat Pertanian</option>
                                        <option value="Lainnya">Lainnya</option>
                                    </select>
                                </div>
                                <div class="col-md-3">
                                    <label class="form-label">Kecamatan</label>
                                    <select class="form-select" id="filterDistrict">
                                        <option value="">Semua Kecamatan</option>
                                        <option value="Banyuglugur">Banyuglugur</option>
                                        <option value="Besuki">Besuki</option>
                                        <option value="Jatibanteng">Jatibanteng</option>
                                        <option value="Kapongan">Kapongan</option>
                                        <option value="Kendit">Kendit</option>
                                        <option value="Mangaran">Mangaran</option>
                                        <option value="Panarukan">Panarukan</option>
                                        <option value="Panji">Panji</option>
                                        <option value="Situbondo">Situbondo</option>
                                        <option value="Suboh">Suboh</option>
                                    </select>
                                </div>
                                <div class="col-md-3">
                                    <label class="form-label">Tanggal Mulai</label>
                                    <input type="date" class="form-control" id="filterStartDate">
                                </div>
                                <div class="col-md-3">
                                    <label class="form-label">Tanggal Akhir</label>
                                    <input type="date" class="form-control" id="filterEndDate">
                                </div>
                            </div>
                            <div class="row mt-3">
                                <div class="col-md-6">
                                    <button class="btn btn-primary" id="applyFilters">
                                        <i class="fas fa-filter me-1"></i> Terapkan Filter
                                    </button>
                                    <button class="btn btn-secondary ms-2" id="resetFilters">
                                        <i class="fas fa-undo me-1"></i> Reset
                                    </button>
                                </div>
                                <div class="col-md-6 text-end">
                                    <div class="btn-group">
                                        <button class="btn btn-success" id="exportExcel">
                                            <i class="fas fa-file-excel me-1"></i> Excel
                                        </button>
                                        <button class="btn btn-danger" id="exportPDF">
                                            <i class="fas fa-file-pdf me-1"></i> PDF
                                        </button>
                                        <button class="btn btn-warning" id="printTable">
                                            <i class="fas fa-print me-1"></i> Cetak
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="table-responsive">
                            <table class="table table-striped table-bordered data-table" id="assistanceTable">
                                <thead>
                                    <tr>
                                        <th>No</th>
                                        <th>Tanggal</th>
                                        <th>Jenis Bantuan</th>
                                        <th>Penerima</th>
                                        <th>Kecamatan</th>
                                        <th>Desa</th>
                                        <th>Jumlah</th>
                                        <th>Dokumentasi</th>
                                        <th>Aksi</th>
                                    </tr>
                                </thead>
                                <tbody id="tableBody">
                                    <tr>
                                        <td colspan="9" class="text-center">Memuat data...</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                        
                        <div class="d-flex justify-content-between align-items-center mt-3">
                            <div class="fw-bold" id="tableInfo">Menampilkan 0 dari 0 data</div>
                            <nav>
                                <ul class="pagination mb-0" id="pagination">
                                    <li class="page-item disabled">
                                        <a class="page-link" href="#">Sebelumnya</a>
                                    </li>
                                    <li class="page-item active">
                                        <a class="page-link" href="#">1</a>
                                    </li>
                                    <li class="page-item disabled">
                                        <a class="page-link" href="#">Selanjutnya</a>
                                    </li>
                                </ul>
                            </nav>
                        </div>
                    </div>
                    
                    <!-- Settings Section -->
                    <div class="content-section d-none" id="settings">
                        <h3 class="section-title">Pengaturan Aplikasi</h3>
                        
                        <div class="row">
                            <div class="col-md-6">
                                <div class="card">
                                    <div class="card-header">
                                        <i class="fas fa-sliders-h me-2"></i>Pengaturan Umum
                                    </div>
                                    <div class="card-body">
                                        <div class="mb-3">
                                            <label class="form-label">Nama Instansi</label>
                                            <input type="text" class="form-control" id="institutionNameInput" value="Dinas Peternakan dan Perikanan Kabupaten Situbondo">
                                        </div>
                                        <div class="mb-3">
                                            <label class="form-label">Jumlah Data Per Halaman</label>
                                            <select class="form-select" id="itemsPerPage">
                                                <option value="10">10 Data</option>
                                                <option value="25">25 Data</option>
                                                <option value="50">50 Data</option>
                                                <option value="100">100 Data</option>
                                            </select>
                                        </div>
                                        <div class="form-check form-switch mb-3">
                                            <input class="form-check-input" type="checkbox" id="notificationsEnabled" checked>
                                            <label class="form-check-label" for="notificationsEnabled">Aktifkan Notifikasi</label>
                                        </div>
                                        <button class="btn btn-primary" id="saveSettings">
                                            <i class="fas fa-save me-1"></i> Simpan Pengaturan
                                        </button>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="col-md-6">
                                <div class="card">
                                    <div class="card-header">
                                        <i class="fas fa-database me-2"></i>Kelola Data
                                    </div>
                                    <div class="card-body">
                                        <div class="mb-3">
                                            <label class="form-label">Cadangkan Data</label>
                                            <p class="text-muted small">Unduh salinan data untuk cadangan</p>
                                            <button class="btn btn-outline-primary w-100" id="backupData">
                                                <i class="fas fa-download me-1"></i> Unduh Cadangan
                                            </button>
                                        </div>
                                        <div class="mb-3">
                                            <label class="form-label">Pulihkan Data</label>
                                            <p class="text-muted small">Unggah file cadangan data (.json)</p>
                                            <input type="file" class="form-control mb-2" id="restoreFile" accept=".json">
                                            <button class="btn btn-outline-secondary w-100" id="restoreData">
                                                <i class="fas fa-upload me-1"></i> Pulihkan Data
                                            </button>
                                        </div>
                                        <div class="mb-3">
                                            <label class="form-label">Hapus Semua Data</label>
                                            <p class="text-muted small">Hapus permanen semua data dari aplikasi</p>
                                            <button class="btn btn-outline-danger w-100" id="clearAllData">
                                                <i class="fas fa-trash me-1"></i> Hapus Semua Data
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="developer-info mt-4">
                            <h5 class="mb-3">Informasi Pengembang</h5>
                            <div class="row">
                                <div class="col-md-6">
                                    <p><strong>Lentera karya Situbondo</strong></p>
                                    <p>Pengembangan aplikasi dan sistem informasi</p>
                                </div>
                                <div class="col-md-6">
                                    <p><i class="fab fa-whatsapp me-2"></i> <a href="https://wa.me/6285647709114" target="_blank">+62 856-4770-9114</a></p>
                                    <p><i class="fas fa-envelope me-2"></i> <a href="mailto:admin@anekamarket.my.id">admin@anekamarket.my.id</a></p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="copyright">
                &copy; 2025 Lentera karya Situbondo. Hak Cipta Dilindungi.
            </div>
        </div>
        
        <!-- Floating Action Button -->
        <div class="floating-action-btn" id="fab">
            <i class="fas fa-plus"></i>
        </div>
        
        <!-- Notification Toast -->
        <div class="toast notification-toast" role="alert" aria-live="assertive" aria-atomic="true" data-bs-autohide="true" data-bs-delay="5000">
            <div class="toast-header">
                <strong class="me-auto" id="toastTitle">BARJAS</strong>
                <small id="toastTime">Baru saja</small>
                <button type="button" class="btn-close" data-bs-dismiss="toast" aria-label="Close"></button>
            </div>
            <div class="toast-body" id="toastMessage">
                Operasi berhasil dilakukan.
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-datepicker/1.9.0/js/bootstrap-datepicker.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script>
        // ==================== KONFIGURASI APLIKASI ====================
        const APP_CONFIG = {
            name: "BARJAS",
            version: "2.1.0",
            securityCode: "BARJAS2025", // Kode keamanan default
            maxLoginAttempts: 3,
            loginBlockTime: 30, // dalam detik
            itemsPerPage: 10,
            institutionName: "Dinas Peternakan dan Perikanan Kabupaten Situbondo"
        };

        // ==================== STATE APLIKASI ====================
        let appState = {
            isAuthenticated: false,
            loginAttempts: 0,
            isLoginBlocked: false,
            loginBlockTimeout: null,
            assistanceData: [],
            currentPage: 1,
            currentSection: 'dashboard',
            settings: {
                notifications: true,
                itemsPerPage: 10,
                institutionName: APP_CONFIG.institutionName
            }
        };

        // ==================== INISIALISASI APLIKASI ====================
        document.addEventListener('DOMContentLoaded', function() {
            // Cek status login
            checkLoginStatus();
            
            // Inisialisasi komponen UI
            initUIComponents();
            
            // Tampilkan splash screen
            showSplashScreen();
            
            // Setup event listeners
            setupEventListeners();
            
            // Load data dari localStorage
            loadAppData();
        });

        // ==================== FUNGSI LOGIN & AUTHENTICATION ====================
        function checkLoginStatus() {
            const isAuthenticated = localStorage.getItem('barjasAuthenticated') === 'true';
            const loginExpiry = localStorage.getItem('barjasLoginExpiry');
            
            // Periksa apakah login masih valid (belum melewati 8 jam)
            if (isAuthenticated && loginExpiry) {
                const now = new Date().getTime();
                if (now < parseInt(loginExpiry)) {
                    appState.isAuthenticated = true;
                    showAppContent();
                    return;
                }
            }
            
            // Jika tidak terautentikasi, tampilkan modal login
            showLoginModal();
        }

        function showLoginModal() {
            const loginModal = new bootstrap.Modal(document.getElementById('loginModal'));
            loginModal.show();
            
            // Reset form login
            document.getElementById('loginForm').reset();
            
            // Periksa status blokir login
            const loginBlockedUntil = localStorage.getItem('barjasLoginBlockedUntil');
            if (loginBlockedUntil) {
                const now = new Date().getTime();
                if (now < parseInt(loginBlockedUntil)) {
                    // Masih dalam status diblokir
                    const remainingTime = Math.ceil((parseInt(loginBlockedUntil) - now) / 1000);
                    blockLogin(remainingTime);
                    return;
                } else {
                    // Hapus status blokir jika sudah lewat
                    localStorage.removeItem('barjasLoginBlockedUntil');
                    localStorage.removeItem('barjasLoginAttempts');
                }
            }
            
            // Periksa jumlah percobaan login
            const attempts = localStorage.getItem('barjasLoginAttempts');
            if (attempts) {
                appState.loginAttempts = parseInt(attempts);
                updateAttemptsDisplay();
            }
        }

        function authenticateUser(securityCode) {
            // Validasi kode keamanan
            if (securityCode === APP_CONFIG.securityCode) {
                // Login berhasil
                appState.isAuthenticated = true;
                localStorage.setItem('barjasAuthenticated', 'true');
                
                // Set waktu kedaluwarsa login (8 jam dari sekarang)
                const expiryTime = new Date().getTime() + (8 * 60 * 60 * 1000);
                localStorage.setItem('barjasLoginExpiry', expiryTime.toString());
                
                // Reset percobaan login
                localStorage.removeItem('barjasLoginAttempts');
                appState.loginAttempts = 0;
                
                // Tutup modal login
                const loginModal = bootstrap.Modal.getInstance(document.getElementById('loginModal'));
                loginModal.hide();
                
                // Tampilkan konten aplikasi
                showAppContent();
                
                // Tampilkan notifikasi sukses
                showNotification('Login Berhasil', 'Selamat datang di aplikasi BARJAS', 'success');
                
                return true;
            } else {
                // Login gagal
                appState.loginAttempts++;
                localStorage.setItem('barjasLoginAttempts', appState.loginAttempts.toString());
                
                updateAttemptsDisplay();
                
                // Periksa apakah sudah melebihi batas percobaan
                if (appState.loginAttempts >= APP_CONFIG.maxLoginAttempts) {
                    // Blokir login untuk sementara
                    blockLogin(APP_CONFIG.loginBlockTime);
                    return false;
                }
                
                // Tampilkan pesan error
                showNotification('Login Gagal', 'Kode keamanan tidak valid', 'error');
                
                // Animasi shake pada form
                document.getElementById('loginForm').classList.add('login-shake');
                setTimeout(() => {
                    document.getElementById('loginForm').classList.remove('login-shake');
                }, 600);
                
                return false;
            }
        }

        function blockLogin(seconds) {
            appState.isLoginBlocked = true;
            
            // Simpan waktu blokir di localStorage
            const blockUntil = new Date().getTime() + (seconds * 1000);
            localStorage.setItem('barjasLoginBlockedUntil', blockUntil.toString());
            
            // Tampilkan pesan blokir
            document.getElementById('blockedMessage').classList.remove('d-none');
            document.getElementById('loginForm').classList.add('d-none');
            
            // Hitung mundur
            let countdown = seconds;
            document.getElementById('countdown').textContent = countdown;
            
            const countdownInterval = setInterval(() => {
                countdown--;
                document.getElementById('countdown').textContent = countdown;
                
                if (countdown <= 0) {
                    clearInterval(countdownInterval);
                    appState.isLoginBlocked = false;
                    localStorage.removeItem('barjasLoginBlockedUntil');
                    localStorage.removeItem('barjasLoginAttempts');
                    appState.loginAttempts = 0;
                    
                    document.getElementById('blockedMessage').classList.add('d-none');
                    document.getElementById('loginForm').classList.remove('d-none');
                    updateAttemptsDisplay();
                }
            }, 1000);
        }

        function updateAttemptsDisplay() {
            const attemptsElement = document.getElementById('attemptsCount');
            const remaining = APP_CONFIG.maxLoginAttempts - appState.loginAttempts;
            
            if (appState.loginAttempts > 0) {
                attemptsElement.textContent = `Percobaan login gagal: ${appState.loginAttempts}. Sisa percobaan: ${remaining}`;
                attemptsElement.classList.remove('d-none');
            } else {
                attemptsElement.classList.add('d-none');
            }
        }

        function logout() {
            // Hapus status login
            appState.isAuthenticated = false;
            localStorage.removeItem('barjasAuthenticated');
            localStorage.removeItem('barjasLoginExpiry');
            
            // Tampilkan modal login
            showLoginModal();
            
            // Sembunyikan konten aplikasi
            document.getElementById('appContent').classList.add('app-content-unauthenticated');
            
            // Tampilkan notifikasi
            showNotification('Logout Berhasil', 'Anda telah logout dari aplikasi', 'info');
        }

        // ==================== FUNGSI UI & TAMPILAN ====================
        function initUIComponents() {
            // Inisialisasi tooltip Bootstrap
            const tooltipTriggerList = [].slice.call(document.querySelectorAll('[data-bs-toggle="tooltip"]'));
            tooltipTriggerList.map(function (tooltipTriggerEl) {
                return new bootstrap.Tooltip(tooltipTriggerEl);
            });
            
            // Inisialisasi datepicker
            $('.datepicker').datepicker({
                format: 'yyyy-mm-dd',
                autoclose: true,
                todayHighlight: true
            });
        }

        function showSplashScreen() {
            // Tampilkan splash screen selama 5 detik
            let countdown = 5;
            const countdownElement = document.getElementById('countdownTimer');
            const countdownInterval = setInterval(() => {
                countdown--;
                countdownElement.textContent = countdown;
                
                if (countdown <= 0) {
                    clearInterval(countdownInterval);
                    hideSplashScreen();
                }
            }, 1000);
        }

        function hideSplashScreen() {
            document.getElementById('welcomeSplash').style.opacity = '0';
            setTimeout(() => {
                document.getElementById('welcomeSplash').style.display = 'none';
            }, 500);
        }

        function showAppContent() {
            document.getElementById('appContent').classList.remove('app-content-unauthenticated');
            
            // Update dashboard
            updateDashboard();
            
            // Render tabel data
            renderDataTable();
        }

        function showNotification(title, message, type = 'info') {
            if (!appState.settings.notifications) return;
            
            const toastElement = document.querySelector('.notification-toast');
            const toastTitle = document.getElementById('toastTitle');
            const toastTime = document.getElementById('toastTime');
            const toastMessage = document.getElementById('toastMessage');
            
            // Set warna berdasarkan jenis notifikasi
            if (type === 'success') {
                toastElement.querySelector('.toast-header').classList.add('bg-success', 'text-white');
            } else if (type === 'error') {
                toastElement.querySelector('.toast-header').classList.add('bg-danger', 'text-white');
            } else if (type === 'warning') {
                toastElement.querySelector('.toast-header').classList.add('bg-warning');
            } else {
                toastElement.querySelector('.toast-header').classList.add('bg-info', 'text-white');
            }
            
            // Set konten notifikasi
            toastTitle.textContent = title;
            toastMessage.textContent = message;
            toastTime.textContent = new Date().toLocaleTimeString();
            
            // Tampilkan notifikasi
            const toast = new bootstrap.Toast(toastElement);
            toast.show();
        }

        function switchSection(sectionId) {
            // Sembunyikan semua section
            document.querySelectorAll('.content-section').forEach(section => {
                section.classList.add('d-none');
            });
            
            // Tampilkan section yang dipilih
            document.getElementById(sectionId).classList.remove('d-none');
            
            // Update menu navigasi
            document.querySelectorAll('.nav-link').forEach(link => {
                link.classList.remove('active');
                if (link.getAttribute('data-bs-target') === sectionId) {
                    link.classList.add('active');
                }
            });
            
            // Simpan section aktif
            appState.currentSection = sectionId;
            
            // Jika section adalah dataTable, render ulang tabel
            if (sectionId === 'dataTable') {
                renderDataTable();
            }
            
            // Jika section adalah dashboard, update dashboard
            if (sectionId === 'dashboard') {
                updateDashboard();
            }
        }

        // ==================== FUNGSI MANAJEMEN DATA ====================
        function loadAppData() {
            // Load data bantuan dari localStorage
            const savedData = localStorage.getItem('barjasAssistanceData');
            if (savedData) {
                appState.assistanceData = JSON.parse(savedData);
            }
            
            // Load pengaturan dari localStorage
            const savedSettings = localStorage.getItem('barjasSettings');
            if (savedSettings) {
                appState.settings = { ...appState.settings, ...JSON.parse(savedSettings) };
                applySettings();
            }
        }

        function saveAppData() {
            // Simpan data bantuan ke localStorage
            localStorage.setItem('barjasAssistanceData', JSON.stringify(appState.assistanceData));
            
            // Simpan pengaturan ke localStorage
            localStorage.setItem('barjasSettings', JSON.stringify(appState.settings));
        }

        function addAssistanceData(data) {
            // Generate ID unik
            data.id = Date.now().toString();
            data.createdAt = new Date().toISOString();
            
            // Tambahkan ke array data
            appState.assistanceData.unshift(data);
            
            // Simpan ke localStorage
            saveAppData();
            
            // Tampilkan notifikasi
            showNotification('Data Tersimpan', 'Data bantuan berhasil ditambahkan', 'success');
            
            // Reset form
            document.getElementById('assistanceForm').reset();
            
            // Jika sedang di section dashboard, update dashboard
            if (appState.currentSection === 'dashboard') {
                updateDashboard();
            }
            
            // Jika sedang di section dataTable, render ulang tabel
            if (appState.currentSection === 'dataTable') {
                renderDataTable();
            }
        }

        function deleteAssistanceData(id) {
            if (confirm('Apakah Anda yakin ingin menghapus data ini?')) {
                // Hapus data dari array
                appState.assistanceData = appState.assistanceData.filter(item => item.id !== id);
                
                // Simpan ke localStorage
                saveAppData();
                
                // Render ulang tabel
                renderDataTable();
                
                // Update dashboard
                updateDashboard();
                
                // Tampilkan notifikasi
                showNotification('Data Dihapus', 'Data bantuan berhasil dihapus', 'info');
            }
        }

        function applySettings() {
            // Terapkan pengaturan items per page
            const itemsPerPageSelect = document.getElementById('itemsPerPage');
            if (itemsPerPageSelect) {
                itemsPerPageSelect.value = appState.settings.itemsPerPage;
            }
            
            // Terapkan pengaturan notifikasi
            const notificationsToggle = document.getElementById('notificationsEnabled');
            if (notificationsToggle) {
                notificationsToggle.checked = appState.settings.notifications;
            }
            
            // Terapkan nama instansi
            const institutionNameElement = document.getElementById('institutionName');
            const institutionNameInput = document.getElementById('institutionNameInput');
            if (institutionNameElement) {
                institutionNameElement.textContent = appState.settings.institutionName;
            }
            if (institutionNameInput) {
                institutionNameInput.value = appState.settings.institutionName;
            }
        }

        // ==================== FUNGSI DASHBOARD ====================
        function updateDashboard() {
            // Update statistik
            document.getElementById('totalRecipients').textContent = appState.assistanceData.length;
            
            // Hitung total bantuan
            const totalAssistance = appState.assistanceData.reduce((total, item) => {
                return total + parseInt(item.quantity || 0);
            }, 0);
            document.getElementById('totalAssistance').textContent = totalAssistance.toLocaleString();
            
            // Hitung distribusi terselesaikan (asumsi semua terselesaikan)
            document.getElementById('completedDistributions').textContent = appState.assistanceData.length;
            
            // Update aktivitas terbaru
            updateRecentActivities();
            
            // Update charts
            updateCharts();
        }

        function updateRecentActivities() {
            const activitiesContainer = document.getElementById('recentActivities');
            
            if (appState.assistanceData.length === 0) {
                activitiesContainer.innerHTML = '<tr><td colspan="5" class="text-center">Belum ada data</td></tr>';
                return;
            }
            
            // Ambil 5 data terbaru
            const recentData = [...appState.assistanceData]
                .sort((a, b) => new Date(b.distributionDate) - new Date(a.distributionDate))
                .slice(0, 5);
            
            activitiesContainer.innerHTML = '';
            recentData.forEach(item => {
                const row = document.createElement('tr');
                
                // Format tanggal
                const date = new Date(item.distributionDate);
                const formattedDate = date.toLocaleDateString('id-ID', {
                    day: '2-digit',
                    month: 'short',
                    year: 'numeric'
                });
                
                row.innerHTML = `
                    <td>${formattedDate}</td>
                    <td>${item.assistanceType}</td>
                    <td>${item.recipientName}</td>
                    <td>${item.district}, ${item.village}</td>
                    <td><span class="badge bg-success">Tersalurkan</span></td>
                `;
                
                activitiesContainer.appendChild(row);
            });
        }

        function updateCharts() {
            // Data untuk chart jenis bantuan
            const assistanceTypes = {};
            appState.assistanceData.forEach(item => {
                if (assistanceTypes[item.assistanceType]) {
                    assistanceTypes[item.assistanceType]++;
                } else {
                    assistanceTypes[item.assistanceType] = 1;
                }
            });
            
            const assistanceTypeCtx = document.getElementById('assistanceChart').getContext('2d');
            new Chart(assistanceTypeCtx, {
                type: 'bar',
                data: {
                    labels: Object.keys(assistanceTypes),
                    datasets: [{
                        label: 'Jumlah Distribusi',
                        data: Object.values(assistanceTypes),
                        backgroundColor: [
                            'rgba(13, 71, 161, 0.7)',
                            'rgba(0, 105, 92, 0.7)',
                            'rgba(255, 143, 0, 0.7)',
                            'rgba(121, 85, 72, 0.7)',
                            'rgba(156, 39, 176, 0.7)'
                        ],
                        borderColor: [
                            'rgba(13, 71, 161, 1)',
                            'rgba(0, 105, 92, 1)',
                            'rgba(255, 143, 0, 1)',
                            'rgba(121, 85, 72, 1)',
                            'rgba(156, 39, 176, 1)'
                        ],
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: {
                            display: false
                        },
                        title: {
                            display: true,
                            text: 'Distribusi per Jenis Bantuan'
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: {
                                precision: 0
                            }
                        }
                    }
                }
            });
            
            // Data untuk chart distribusi per kecamatan
            const districts = {};
            appState.assistanceData.forEach(item => {
                if (districts[item.district]) {
                    districts[item.district]++;
                } else {
                    districts[item.district] = 1;
                }
            });
            
            const distributionCtx = document.getElementById('distributionChart').getContext('2d');
            new Chart(distributionCtx, {
                type: 'pie',
                data: {
                    labels: Object.keys(districts),
                    datasets: [{
                        data: Object.values(districts),
                        backgroundColor: [
                            'rgba(13, 71, 161, 0.7)',
                            'rgba(0, 105, 92, 0.7)',
                            'rgba(255, 143, 0, 0.7)',
                            'rgba(121, 85, 72, 0.7)',
                            'rgba(156, 39, 176, 0.7)',
                            'rgba(103, 58, 183, 0.7)',
                            'rgba(33, 150, 243, 0.7)',
                            'rgba(3, 169, 244, 0.7)',
                            'rgba(0, 188, 212, 0.7)',
                            'rgba(0, 150, 136, 0.7)'
                        ],
                        borderColor: [
                            'rgba(13, 71, 161, 1)',
                            'rgba(0, 105, 92, 1)',
                            'rgba(255, 143, 0, 1)',
                            'rgba(121, 85, 72, 1)',
                            'rgba(156, 39, 176, 1)',
                            'rgba(103, 58, 183, 1)',
                            'rgba(33, 150, 243, 1)',
                            'rgba(3, 169, 244, 1)',
                            'rgba(0, 188, 212, 1)',
                            'rgba(0, 150, 136, 1)'
                        ],
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: {
                            position: 'bottom'
                        },
                        title: {
                            display: true,
                            text: 'Distribusi per Kecamatan'
                        }
                    }
                }
            });
        }

        // ==================== FUNGSI TABEL DATA ====================
        function renderDataTable() {
            const tableBody = document.getElementById('tableBody');
            const tableInfo = document.getElementById('tableInfo');
            const pagination = document.getElementById('pagination');
            
            if (appState.assistanceData.length === 0) {
                tableBody.innerHTML = '<tr><td colspan="9" class="text-center">Belum ada data</td></tr>';
                tableInfo.textContent = 'Menampilkan 0 dari 0 data';
                pagination.innerHTML = '';
                return;
            }
            
            // Ambil nilai filter
            const typeFilter = document.getElementById('filterType').value;
            const districtFilter = document.getElementById('filterDistrict').value;
            const startDateFilter = document.getElementById('filterStartDate').value;
            const endDateFilter = document.getElementById('filterEndDate').value;
            
            // Filter data
            let filteredData = appState.assistanceData.filter(item => {
                let passFilter = true;
                
                if (typeFilter && item.assistanceType !== typeFilter) {
                    passFilter = false;
                }
                
                if (districtFilter && item.district !== districtFilter) {
                    passFilter = false;
                }
                
                if (startDateFilter && item.distributionDate < startDateFilter) {
                    passFilter = false;
                }
                
                if (endDateFilter && item.distributionDate > endDateFilter) {
                    passFilter = false;
                }
                
                return passFilter;
            });
            
            // Hitung total halaman
            const itemsPerPage = appState.settings.itemsPerPage;
            const totalPages = Math.ceil(filteredData.length / itemsPerPage);
            
            // Pastikan currentPage valid
            if (appState.currentPage > totalPages) {
                appState.currentPage = 1;
            }
            
            // Data untuk halaman saat ini
            const startIndex = (appState.currentPage - 1) * itemsPerPage;
            const endIndex = Math.min(startIndex + itemsPerPage, filteredData.length);
            const currentData = filteredData.slice(startIndex, endIndex);
            
            // Render tabel
            tableBody.innerHTML = '';
            currentData.forEach((item, index) => {
                const rowNumber = startIndex + index + 1;
                
                // Format tanggal
                const date = new Date(item.distributionDate);
                const formattedDate = date.toLocaleDateString('id-ID', {
                    day: '2-digit',
                    month: 'short',
                    year: 'numeric'
                });
                
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td class="text-center">${rowNumber}</td>
                    <td>${formattedDate}</td>
                    <td>${item.assistanceType}</td>
                    <td>${item.recipientName}</td>
                    <td>${item.district}</td>
                    <td>${item.village}</td>
                    <td class="text-center">${item.quantity} ${item.unit}</td>
                    <td class="text-center">
                        ${item.driveLink ? 
                            `<a href="${item.driveLink}" target="_blank" class="drive-link">
                                <i class="fas fa-link me-1"></i>Lihat
                            </a>` : 
                            '<span class="text-muted">Tidak ada</span>'
                        }
                    </td>
                    <td class="text-center">
                        <button class="btn btn-sm btn-danger delete-btn" data-id="${item.id}">
                            <i class="fas fa-trash"></i>
                        </button>
                    </td>
                `;
                
                tableBody.appendChild(row);
            });
            
            // Update info tabel
            tableInfo.textContent = `Menampilkan ${startIndex + 1} sampai ${endIndex} dari ${filteredData.length} data`;
            
            // Render pagination
            renderPagination(totalPages);
            
            // Tambahkan event listener untuk tombol hapus
            document.querySelectorAll('.delete-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    const id = this.getAttribute('data-id');
                    deleteAssistanceData(id);
                });
            });
        }

        function renderPagination(totalPages) {
            const pagination = document.getElementById('pagination');
            
            if (totalPages <= 1) {
                pagination.innerHTML = '';
                return;
            }
            
            let paginationHTML = '';
            
            // Tombol sebelumnya
            if (appState.currentPage > 1) {
                paginationHTML += `
                    <li class="page-item">
                        <a class="page-link" href="#" data-page="${appState.currentPage - 1}">Sebelumnya</a>
                    </li>
                `;
            } else {
                paginationHTML += `
                    <li class="page-item disabled">
                        <a class="page-link" href="#">Sebelumnya</a>
                    </li>
                `;
            }
            
            // Halaman
            const maxVisiblePages = 5;
            let startPage = Math.max(1, appState.currentPage - Math.floor(maxVisiblePages / 2));
            let endPage = Math.min(totalPages, startPage + maxVisiblePages - 1);
            
            if (endPage - startPage + 1 < maxVisiblePages) {
                startPage = Math.max(1, endPage - maxVisiblePages + 1);
            }
            
            for (let i = startPage; i <= endPage; i++) {
                if (i === appState.currentPage) {
                    paginationHTML += `
                        <li class="page-item active">
                            <a class="page-link" href="#">${i}</a>
                        </li>
                    `;
                } else {
                    paginationHTML += `
                        <li class="page-item">
                            <a class="page-link" href="#" data-page="${i}">${i}</a>
                        </li>
                    `;
                }
            }
            
            // Tombol selanjutnya
            if (appState.currentPage < totalPages) {
                paginationHTML += `
                    <li class="page-item">
                        <a class="page-link" href="#" data-page="${appState.currentPage + 1}">Selanjutnya</a>
                    </li>
                `;
            } else {
                paginationHTML += `
                    <li class="page-item disabled">
                        <a class="page-link" href="#">Selanjutnya</a>
                    </li>
                `;
            }
            
            pagination.innerHTML = paginationHTML;
            
            // Tambahkan event listener untuk pagination
            pagination.querySelectorAll('.page-link').forEach(link => {
                link.addEventListener('click', function(e) {
                    e.preventDefault();
                    const page = this.getAttribute('data-page');
                    if (page) {
                        appState.currentPage = parseInt(page);
                        renderDataTable();
                    }
                });
            });
        }

        // ==================== FUNGSI EKSPOR DATA ====================
        function exportToExcel() {
            if (appState.assistanceData.length === 0) {
                showNotification('Tidak Ada Data', 'Tidak ada data untuk diekspor', 'warning');
                return;
            }
            
            // Siapkan data untuk Excel
            const data = appState.assistanceData.map(item => {
                return {
                    'Tanggal Distribusi': item.distributionDate,
                    'Jenis Bantuan': item.assistanceType,
                    'Nama Penerima': item.recipientName,
                    'Nomor Telepon': item.recipientPhone || '',
                    'Kecamatan': item.district,
                    'Desa/Kelurahan': item.village,
                    'Jumlah': item.quantity,
                    'Satuan': item.unit,
                    'Link Dokumentasi': item.driveLink || '',
                    'Keterangan': item.notes || ''
                };
            });
            
            // Buat worksheet
            const worksheet = XLSX.utils.json_to_sheet(data);
            
            // Buat workbook
            const workbook = XLSX.utils.book_new();
            XLSX.utils.book_append_sheet(workbook, worksheet, 'Data Bantuan');
            
            // Ekspor ke file
            XLSX.writeFile(workbook, `data_bantuan_${new Date().toISOString().split('T')[0]}.xlsx`);
            
            // Tampilkan notifikasi
            showNotification('Ekspor Berhasil', 'Data berhasil diekspor ke Excel', 'success');
        }

        function exportToPDF() {
            if (appState.assistanceData.length === 0) {
                showNotification('Tidak Ada Data', 'Tidak ada data untuk diekspor', 'warning');
                return;
            }
            
            // Buat instance jsPDF
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF();
            
            // Tambahkan judul
            doc.setFontSize(18);
            doc.text('LAPORAN DATA BANTUAN', 105, 15, { align: 'center' });
            doc.setFontSize(12);
            doc.text(appState.settings.institutionName, 105, 22, { align: 'center' });
            
            // Tambahkan tanggal cetak
            const printDate = new Date().toLocaleDateString('id-ID', {
                day: '2-digit',
                month: 'long',
                year: 'numeric'
            });
            doc.setFontSize(10);
            doc.text(`Dicetak pada: ${printDate}`, 105, 29, { align: 'center' });
            
            // Siapkan data untuk tabel
            const tableData = appState.assistanceData.map(item => {
                return [
                    new Date(item.distributionDate).toLocaleDateString('id-ID'),
                    item.assistanceType,
                    item.recipientName,
                    item.district,
                    item.village,
                    `${item.quantity} ${item.unit}`
                ];
            });
            
            // Buat tabel
            doc.autoTable({
                startY: 35,
                head: [['Tanggal', 'Jenis', 'Penerima', 'Kecamatan', 'Desa', 'Jumlah']],
                body: tableData,
                theme: 'grid',
                headStyles: {
                    fillColor: [13, 71, 161],
                    textColor: 255
                },
                styles: {
                    fontSize: 9
                },
                margin: { top: 35 }
            });
            
            // Simpan PDF
            doc.save(`data_bantuan_${new Date().toISOString().split('T')[0]}.pdf`);
            
            // Tampilkan notifikasi
            showNotification('Ekspor Berhasil', 'Data berhasil diekspor ke PDF', 'success');
        }

        function printTable() {
            if (appState.assistanceData.length === 0) {
                showNotification('Tidak Ada Data', 'Tidak ada data untuk dicetak', 'warning');
                return;
            }
            
            // Buat elemen untuk cetak
            const printWindow = window.open('', '_blank');
            printWindow.document.write(`
                <!DOCTYPE html>
                <html>
                <head>
                    <title>Cetak Data Bantuan</title>
                    <style>
                        body { font-family: Arial, sans-serif; margin: 20px; }
                        h1 { text-align: center; font-size: 18px; margin-bottom: 5px; }
                        h2 { text-align: center; font-size: 14px; font-weight: normal; margin-bottom: 15px; }
                        .print-date { text-align: right; font-size: 12px; margin-bottom: 15px; }
                        table { width: 100%; border-collapse: collapse; font-size: 12px; }
                        th, td { border: 1px solid #ddd; padding: 6px; text-align: left; }
                        th { background-color: #0d47a1; color: white; }
                        tr:nth-child(even) { background-color: #f2f2f2; }
                        @media print {
                            @page { size: landscape; margin: 0.5cm; }
                            body { margin: 0; }
                        }
                    </style>
                </head>
                <body>
                    <h1>LAPORAN DATA BANTUAN</h1>
                    <h2>${appState.settings.institutionName}</h2>
                    <div class="print-date">Dicetak pada: ${new Date().toLocaleDateString('id-ID', {
                        day: '2-digit',
                        month: 'long',
                        year: 'numeric'
                    })}</div>
                    <table>
                        <thead>
                            <tr>
                                <th>No</th>
                                <th>Tanggal</th>
                                <th>Jenis Bantuan</th>
                                <th>Penerima</th>
                                <th>Kecamatan</th>
                                <th>Desa</th>
                                <th>Jumlah</th>
                            </tr>
                        </thead>
                        <tbody>
            `);
            
            // Isi data
            appState.assistanceData.forEach((item, index) => {
                printWindow.document.write(`
                    <tr>
                        <td>${index + 1}</td>
                        <td>${new Date(item.distributionDate).toLocaleDateString('id-ID')}</td>
                        <td>${item.assistanceType}</td>
                        <td>${item.recipientName}</td>
                        <td>${item.district}</td>
                        <td>${item.village}</td>
                        <td>${item.quantity} ${item.unit}</td>
                    </tr>
                `);
            });
            
            printWindow.document.write(`
                        </tbody>
                    </table>
                </body>
                </html>
            `);
            
            printWindow.document.close();
            printWindow.focus();
            
            // Tunggu sebentar sebelum mencetak
            setTimeout(() => {
                printWindow.print();
                // printWindow.close(); // Opsional: tutup window setelah mencetak
            }, 250);
        }

        // ==================== FUNGSI BACKUP & RESTORE ====================
        function backupData() {
            if (appState.assistanceData.length === 0) {
                showNotification('Tidak Ada Data', 'Tidak ada data untuk dicadangkan', 'warning');
                return;
            }
            
            // Buat objek backup
            const backup = {
                app: 'BARJAS',
                version: APP_CONFIG.version,
                exportedAt: new Date().toISOString(),
                data: appState.assistanceData
            };
            
            // Konversi ke JSON
            const dataStr = JSON.stringify(backup, null, 2);
            const dataUri = 'data:application/json;charset=utf-8,'+ encodeURIComponent(dataStr);
            
            // Buat elemen unduh
            const exportFileDefaultName = `backup_barjas_${new Date().toISOString().split('T')[0]}.json`;
            const linkElement = document.createElement('a');
            linkElement.setAttribute('href', dataUri);
            linkElement.setAttribute('download', exportFileDefaultName);
            linkElement.click();
            
            // Tampilkan notifikasi
            showNotification('Backup Berhasil', 'Data berhasil dicadangkan', 'success');
        }

        function restoreData() {
            const fileInput = document.getElementById('restoreFile');
            const file = fileInput.files[0];
            
            if (!file) {
                showNotification('Peringatan', 'Pilih file backup terlebih dahulu', 'warning');
                return;
            }
            
            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const backup = JSON.parse(e.target.result);
                    
                    // Validasi file backup
                    if (!backup.app || backup.app !== 'BARJAS') {
                        showNotification('Error', 'File backup tidak valid', 'error');
                        return;
                    }
                    
                    // Konfirmasi restore
                    if (confirm('Restore data akan menggantikan semua data saat ini. Lanjutkan?')) {
                        appState.assistanceData = backup.data || [];
                        saveAppData();
                        
                        // Render ulang tabel
                        renderDataTable();
                        
                        // Update dashboard
                        updateDashboard();
                        
                        // Reset file input
                        fileInput.value = '';
                        
                        // Tampilkan notifikasi
                        showNotification('Restore Berhasil', 'Data berhasil dipulihkan', 'success');
                    }
                } catch (error) {
                    showNotification('Error', 'Gagal memproses file backup', 'error');
                    console.error('Restore error:', error);
                }
            };
            reader.readAsText(file);
        }

        function clearAllData() {
            if (appState.assistanceData.length === 0) {
                showNotification('Tidak Ada Data', 'Tidak ada data untuk dihapus', 'warning');
                return;
            }
            
            if (confirm('Apakah Anda yakin ingin menghapus semua data? Tindakan ini tidak dapat dibatalkan.')) {
                // Hapus semua data
                appState.assistanceData = [];
                saveAppData();
                
                // Render ulang tabel
                renderDataTable();
                
                // Update dashboard
                updateDashboard();
                
                // Tampilkan notifikasi
                showNotification('Data Dihapus', 'Semua data berhasil dihapus', 'info');
            }
        }

        // ==================== SETUP EVENT LISTENERS ====================
        function setupEventListeners() {
            // Event listener untuk form login
            document.getElementById('loginForm').addEventListener('submit', function(e) {
                e.preventDefault();
                
                // Tampilkan spinner
                document.getElementById('loginSpinner').classList.remove('d-none');
                document.querySelector('.login-button-text').textContent = 'Memproses...';
                document.getElementById('loginButton').disabled = true;
                
                // Dapatkan kode keamanan
                const securityCode = document.getElementById('securityCode').value;
                
                // Authenticate setelah delay kecil untuk menunjukkan spinner
                setTimeout(() => {
                    const authResult = authenticateUser(securityCode);
                    
                    // Sembunyikan spinner
                    document.getElementById('loginSpinner').classList.add('d-none');
                    document.querySelector('.login-button-text').textContent = 'Masuk ke Aplikasi';
                    document.getElementById('loginButton').disabled = false;
                    
                    if (!authResult) {
                        // Reset field kode keamanan
                        document.getElementById('securityCode').value = '';
                        document.getElementById('securityCode').focus();
                    }
                }, 800);
            });
            
            // Toggle password visibility
            document.querySelector('.toggle-password').addEventListener('click', function() {
                const passwordInput = document.getElementById('securityCode');
                const icon = this.querySelector('i');
                
                if (passwordInput.type === 'password') {
                    passwordInput.type = 'text';
                    icon.classList.remove('fa-eye');
                    icon.classList.add('fa-eye-slash');
                } else {
                    passwordInput.type = 'password';
                    icon.classList.remove('fa-eye-slash');
                    icon.classList.add('fa-eye');
                }
            });
            
            // Event listener untuk menu navigasi
            document.querySelectorAll('.nav-link').forEach(link => {
                link.addEventListener('click', function(e) {
                    e.preventDefault();
                    const target = this.getAttribute('data-bs-target');
                    switchSection(target);
                    
                    // Pada perangkat mobile, tutup sidebar setelah memilih menu
                    if (window.innerWidth < 992) {
                        document.getElementById('sidebar').classList.remove('mobile-show');
                        document.getElementById('sidebarOverlay').classList.remove('mobile-show');
                    }
                });
            });
            
            // Event listener untuk form input data
            document.getElementById('assistanceForm').addEventListener('submit', function(e) {
                e.preventDefault();
                
                // Validasi form
                const assistanceType = document.getElementById('assistanceType').value;
                const distributionDate = document.getElementById('distributionDate').value;
                const recipientName = document.getElementById('recipientName').value;
                const district = document.getElementById('district').value;
                const village = document.getElementById('village').value;
                const quantity = document.getElementById('quantity').value;
                const unit = document.getElementById('unit').value;
                
                if (!assistanceType || !distributionDate || !recipientName || !district || !village || !quantity || !unit) {
                    showNotification('Form Tidak Lengkap', 'Harap isi semua field yang wajib diisi', 'error');
                    return;
                }
                
                // Buat objek data
                const assistanceData = {
                    assistanceType,
                    distributionDate,
                    recipientName,
                    recipientPhone: document.getElementById('recipientPhone').value,
                    district,
                    village,
                    quantity,
                    unit,
                    driveLink: document.getElementById('driveLink').value,
                    notes: document.getElementById('notes').value
                };
                
                // Tambahkan data
                addAssistanceData(assistanceData);
            });
            
            // Event listener untuk filter data
            document.getElementById('applyFilters').addEventListener('click', function() {
                appState.currentPage = 1;
                renderDataTable();
            });
            
            document.getElementById('resetFilters').addEventListener('click', function() {
                document.getElementById('filterType').value = '';
                document.getElementById('filterDistrict').value = '';
                document.getElementById('filterStartDate').value = '';
                document.getElementById('filterEndDate').value = '';
                
                appState.currentPage = 1;
                renderDataTable();
            });
            
            // Event listener untuk ekspor data
            document.getElementById('exportExcel').addEventListener('click', exportToExcel);
            document.getElementById('exportPDF').addEventListener('click', exportToPDF);
            document.getElementById('printTable').addEventListener('click', printTable);
            
            // Event listener untuk pengaturan
            document.getElementById('saveSettings').addEventListener('click', function() {
                // Simpan pengaturan
                appState.settings.itemsPerPage = parseInt(document.getElementById('itemsPerPage').value);
                appState.settings.notifications = document.getElementById('notificationsEnabled').checked;
                appState.settings.institutionName = document.getElementById('institutionNameInput').value;
                
                saveAppData();
                applySettings();
                
                // Render ulang tabel jika diperlukan
                if (appState.currentSection === 'dataTable') {
                    appState.currentPage = 1;
                    renderDataTable();
                }
                
                // Tampilkan notifikasi
                showNotification('Pengaturan Tersimpan', 'Pengaturan berhasil disimpan', 'success');
            });
            
            // Event listener untuk backup & restore
            document.getElementById('backupData').addEventListener('click', backupData);
            document.getElementById('restoreData').addEventListener('click', restoreData);
            document.getElementById('clearAllData').addEventListener('click', clearAllData);
            
            // Event listener untuk logout
            document.getElementById('logoutButton').addEventListener('click', function(e) {
                e.preventDefault();
                logout();
            });
            
            // Event listener untuk tombol menu mobile
            document.getElementById('mobileMenuBtn').addEventListener('click', function() {
                document.getElementById('sidebar').classList.add('mobile-show');
                document.getElementById('sidebarOverlay').classList.add('mobile-show');
            });
            
            document.getElementById('sidebarOverlay').addEventListener('click', function() {
                document.getElementById('sidebar').classList.remove('mobile-show');
                this.classList.remove('mobile-show');
            });
            
            // Event listener untuk tombol tutup splash screen
            document.getElementById('closeSplash').addEventListener('click', hideSplashScreen);
            
            // Event listener untuk FAB (Floating Action Button)
            document.getElementById('fab').addEventListener('click', function() {
                switchSection('inputData');
            });
        }
    </script>
</body>
</html>
