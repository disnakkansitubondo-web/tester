<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>APLIKASI BARJAS - SISTEM BANTUAN</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-datepicker/1.9.0/css/bootstrap-datepicker.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.28/jspdf.plugin.autotable.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <style>
        :root {
            --primary-color: #0d47a1;
            --secondary-color: #00695c;
            --accent-color: #ff8f00;
            --light-blue: #e3f2fd;
            --dark-blue: #082e5c;
            --gradient-primary: linear-gradient(135deg, var(--primary-color), var(--dark-blue));
            --gradient-secondary: linear-gradient(135deg, var(--secondary-color), #004d40);
            --gradient-accent: linear-gradient(135deg, var(--accent-color), #e65100);
            --shadow-sm: 0 2px 8px rgba(0,0,0,0.08);
            --shadow-md: 0 4px 16px rgba(0,0,0,0.12);
            --shadow-lg: 0 8px 28px rgba(0,0,0,0.15);
            --login-gradient: linear-gradient(135deg, #0d47a1, #00695c, #ff8f00);
        }
        
        body {
            background: linear-gradient(135deg, #f5f9ff 0%, #e8f5e9 100%);
            font-family: 'Poppins', 'Segoe UI', sans-serif;
            min-height: 100vh;
            padding: 10px 0;
            overflow-x: hidden;
        }
        
        .app-container {
            max-width: 1600px;
            margin: 0 auto;
            background: white;
            box-shadow: var(--shadow-lg);
            border-radius: 12px;
            overflow: hidden;
            position: relative;
            z-index: 10;
        }
        
        .app-header {
            background: var(--gradient-primary);
            color: white;
            padding: 20px 15px;
            text-align: center;
            position: relative;
            overflow: hidden;
        }
        
        .app-header::before {
            content: "";
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(255,255,255,0.15) 0%, transparent 70%);
            pointer-events: none;
        }
        
        .app-logo {
            font-size: 2.5rem;
            margin-bottom: 10px;
            position: relative;
            z-index: 1;
        }
        
        .app-title {
            font-size: 1.8rem;
            font-weight: 800;
            margin: 0;
            position: relative;
            z-index: 1;
            text-shadow: 1px 1px 4px rgba(0,0,0,0.3);
        }
        
        .app-subtitle {
            font-size: 1rem;
            opacity: 0.95;
            position: relative;
            z-index: 1;
            font-weight: 300;
            letter-spacing: 0.5px;
            margin-bottom: 5px;
        }
        
        .nav-pills .nav-link {
            border-radius: 8px;
            margin-bottom: 8px;
            padding: 12px 15px;
            font-weight: 500;
            color: #444;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            font-size: 0.9rem;
        }
        
        .nav-pills .nav-link:hover {
            background-color: #f0f7ff;
            transform: translateX(3px);
        }
        
        .nav-pills .nav-link.active {
            background: var(--gradient-primary);
            font-weight: 600;
            box-shadow: var(--shadow-md);
            transform: translateX(3px);
            color: white;
        }
        
        .section-title {
            border-left: 4px solid var(--primary-color);
            padding-left: 12px;
            margin: 20px 0;
            font-weight: 700;
            color: var(--dark-blue);
            font-size: 1.4rem;
            position: relative;
        }
        
        .section-title::after {
            content: "";
            position: absolute;
            bottom: -5px;
            left: 12px;
            width: 40px;
            height: 2px;
            background: var(--gradient-primary);
            border-radius: 2px;
        }
        
        .btn-primary {
            background: var(--gradient-primary);
            border: none;
            padding: 10px 20px;
            font-weight: 600;
            box-shadow: var(--shadow-md);
            border-radius: 8px;
            transition: all 0.3s;
            font-size: 0.9rem;
        }
        
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-lg);
        }
        
        .btn-success {
            background: var(--gradient-secondary);
            border: none;
            padding: 10px 20px;
            font-weight: 600;
            box-shadow: var(--shadow-md);
            border-radius: 8px;
            transition: all 0.3s;
            font-size: 0.9rem;
        }
        
        .btn-success:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-lg);
        }
        
        .btn-warning {
            background: var(--gradient-accent);
            border: none;
            padding: 10px 20px;
            font-weight: 600;
            box-shadow: var(--shadow-md);
            border-radius: 8px;
            transition: all 0.3s;
            font-size: 0.9rem;
        }
        
        .btn-warning:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-lg);
        }
        
        .form-label {
            font-weight: 600;
            color: #444;
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            font-size: 0.9rem;
        }
        
        .form-label i {
            margin-right: 6px;
            color: var(--primary-color);
        }
        
        .form-control, .form-select {
            border-radius: 8px;
            padding: 12px 15px;
            border: 1px solid #ddd;
            transition: all 0.3s;
            box-shadow: var(--shadow-sm);
            font-size: 0.9rem;
        }
        
        .form-control:focus, .form-select:focus {
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(13, 71, 161, 0.2);
            transform: translateY(-2px);
        }
        
        .copyright {
            text-align: center;
            padding: 20px;
            background-color: var(--light-blue);
            color: var(--dark-blue);
            font-size: 0.9rem;
            font-weight: 500;
        }
        
        .data-table {
            font-size: 0.85rem;
            border-collapse: separate;
            border-spacing: 0;
            box-shadow: var(--shadow-sm);
            border-radius: 8px;
            overflow: hidden;
        }
        
        .data-table th {
            background: var(--gradient-primary);
            color: white;
            font-weight: 600;
            padding: 12px 10px;
            text-align: center;
            position: relative;
            font-size: 0.85rem;
        }
        
        .data-table th::after {
            content: "";
            position: absolute;
            bottom: 0;
            left: 0;
            width: 100%;
            height: 1px;
            background: rgba(255,255,255,0.3);
        }
        
        .data-table td {
            padding: 10px 8px;
            vertical-align: middle;
            border-bottom: 1px solid #eee;
            font-size: 0.85rem;
        }
        
        .data-table tr:nth-child(even) {
            background-color: #f9fbff;
        }
        
        .data-table tr:hover {
            background-color: #edf5ff;
        }
        
        .feature-icon {
            font-size: 1.1rem;
            margin-right: 8px;
            width: 24px;
            text-align: center;
        }
        
        .card {
            border-radius: 10px;
            border: none;
            box-shadow: var(--shadow-md);
            transition: all 0.3s ease;
            overflow: hidden;
            margin-bottom: 15px;
        }
        
        .card:hover {
            transform: translateY(-5px);
            box-shadow: var(--shadow-lg);
        }
        
        .card-header {
            border-radius: 10px 10px 0 0 !important;
            font-weight: 600;
            padding: 15px 20px;
            background: var(--gradient-primary);
            color: white;
            font-size: 0.95rem;
        }
        
        .stats-box {
            text-align: center;
            padding: 20px 15px;
            border-radius: 10px;
            background: white;
            box-shadow: var(--shadow-md);
            transition: all 0.3s;
            position: relative;
            overflow: hidden;
            margin-bottom: 15px;
        }
        
        .stats-box::before {
            content: "";
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 4px;
            background: var(--gradient-primary);
            border-radius: 2px;
        }
        
        .stats-box:hover {
            transform: translateY(-3px);
            box-shadow: var(--shadow-lg);
        }
        
        .stats-number {
            font-size: 1.8rem;
            font-weight: 800;
            color: var(--primary-color);
            margin: 10px 0;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.1);
        }
        
        .stats-label {
            font-size: 0.9rem;
            color: #666;
            font-weight: 500;
        }
        
        .notification-toast {
            position: fixed;
            bottom: 20px;
            right: 20px;
            z-index: 1050;
            min-width: 280px;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: var(--shadow-lg);
            max-width: calc(100vw - 40px);
        }
        
        .input-error {
            border-color: #dc3545;
            box-shadow: 0 0 0 3px rgba(220, 53, 69, 0.2);
        }
        
        .error-message {
            color: #dc3545;
            font-size: 0.8rem;
            margin-top: 5px;
            display: none;
            font-weight: 500;
        }
        
        .watermark {
            position: absolute;
            bottom: 10px;
            right: 15px;
            opacity: 0.8;
            font-size: 0.8rem;
            color: white;
            font-weight: 300;
        }
        
        .control-panel {
            background: #f8f9fa;
            border-radius: 8px;
            padding: 15px;
            margin-top: 15px;
            box-shadow: var(--shadow-sm);
        }
        
        .control-title {
            font-size: 1rem;
            color: var(--primary-color);
            font-weight: 600;
            margin-bottom: 15px;
            padding-bottom: 8px;
            border-bottom: 1px solid var(--light-blue);
        }
        
        .floating-action-btn {
            position: fixed;
            bottom: 20px;
            right: 20px;
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background: var(--gradient-primary);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: var(--shadow-lg);
            z-index: 1000;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .floating-action-btn:hover {
            transform: scale(1.1) rotate(90deg);
        }
        
        .filter-section {
            background: white;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 20px;
            box-shadow: var(--shadow-sm);
        }
        
        .badge-custom {
            background: var(--gradient-primary);
            color: white;
            padding: 6px 12px;
            border-radius: 16px;
            font-weight: 600;
            font-size: 0.8rem;
        }
        
        .mobile-menu-btn {
            display: none;
            position: fixed;
            top: 15px;
            left: 15px;
            z-index: 1050;
            background: var(--gradient-primary);
            color: white;
            border: none;
            border-radius: 50%;
            width: 45px;
            height: 45px;
            box-shadow: var(--shadow-lg);
        }
        
        .sidebar-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 1040;
        }
        
        /* Animations */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .animate-fadeIn {
            animation: fadeIn 0.5s ease forwards;
        }
        
        /* Custom scrollbar */
        ::-webkit-scrollbar {
            width: 6px;
        }
        
        ::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 8px;
        }
        
        ::-webkit-scrollbar-thumb {
            background: var(--primary-color);
            border-radius: 8px;
        }
        
        ::-webkit-scrollbar-thumb:hover {
            background: var(--dark-blue);
        }
        
        /* Responsive styles */
        @media (max-width: 991.98px) {
            .col-md-3.col-lg-2 {
                position: fixed;
                left: -300px;
                top: 0;
                bottom: 0;
                z-index: 1050;
                width: 280px;
                transition: left 0.3s ease;
                overflow-y: auto;
                padding-top: 60px;
            }
            
            .col-md-3.col-lg-2.mobile-show {
                left: 0;
            }
            
            .col-md-9.col-lg-10 {
                width: 100%;
                flex: 0 0 100%;
                max-width: 100%;
            }
            
            .mobile-menu-btn {
                display: flex;
                align-items: center;
                justify-content: center;
            }
            
            .sidebar-overlay.mobile-show {
                display: block;
            }
        }
        
        /* Print Styles - IMPROVED FOR LANDSCAPE */
        @media print {
            @page {
                size: landscape;
                margin: 0.5cm;
            }
            
            body * {
                visibility: hidden;
            }
            
            .app-container, .app-container * {
                visibility: visible;
            }
            
            .app-container {
                position: absolute;
                left: 0;
                top: 0;
                width: 100%;
                box-shadow: none;
            }
            
            .nav-pills, .mobile-menu-btn, .sidebar-overlay, .floating-action-btn,
            .btn-group, .filter-section, .toast {
                display: none !important;
            }
            
            .col-md-3.col-lg-2.p-4.bg-light {
                display: none !important;
            }
            
            .col-md-9.col-lg-10.p-5 {
                width: 100%;
                flex: 0 0 100%;
                max-width: 100%;
                padding: 0 !important;
            }
            
            .copyright {
                display: none;
            }
            
            .data-table {
                font-size: 10px;
                width: 100% !important;
            }
            
            .data-table th, .data-table td {
                padding: 4px 2px;
            }
            
            /* Sembunyikan kolom aksi dan link Google Drive saat mencetak */
            .data-table th:last-child,
            .data-table td:last-child {
                display: none !important;
            }
            
            /* Judul untuk laporan cetak */
            .print-header {
                display: block !important;
                text-align: center;
                margin-bottom: 15px;
            }
            
            .print-title {
                font-size: 18px;
                font-weight: bold;
                margin-bottom: 5px;
            }
            
            .print-subtitle {
                font-size: 14px;
                margin-bottom: 10px;
            }
            
            .print-date {
                font-size: 12px;
                text-align: right;
                margin-bottom: 10px;
            }
        }

        /* WhatsApp link style */
        .whatsapp-link {
            color: #25D366;
            text-decoration: none;
        }
        
        .whatsapp-link:hover {
            text-decoration: underline;
        }
        
        /* View Link Button */
        .btn-view {
            background: linear-gradient(135deg, #17a2b8, #138496);
            color: white;
            border: none;
            padding: 5px 10px;
            border-radius: 4px;
            font-size: 0.8rem;
        }
        
        .btn-view:hover {
            background: linear-gradient(135deg, #138496, #117a8b);
            color: white;
        }
        
        /* Undo Button */
        .btn-undo {
            background: linear-gradient(135deg, #6c757d, #5a6268);
            color: white;
            border: none;
        }
        
        .btn-undo:hover {
            background: linear-gradient(135deg, #5a6268, #4e555b);
            color: white;
        }
        
        /* WhatsApp number link in table */
        .whatsapp-number {
            color: #25D366;
            cursor: pointer;
            text-decoration: underline;
        }
        
        /* Welcome Modal Styles */
        .welcome-modal .modal-content {
            border-radius: 15px;
            overflow: hidden;
            border: none;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }
        
        .welcome-header {
            background: var(--gradient-primary);
            color: white;
            text-align: center;
            padding: 25px;
        }
        
        .welcome-icon {
            font-size: 3rem;
            margin-bottom: 15px;
            color: white;
        }
        
        .welcome-body {
            padding: 25px;
            text-align: center;
        }
        
        .welcome-footer {
            background: #f8f9fa;
            padding: 15px;
            text-align: center;
            border-top: 1px solid #eee;
        }
        
        .countdown-timer {
            font-size: 0.9rem;
            color: #6c757d;
            margin-top: 10px;
        }
        
        /* Button untuk cetak per data */
        .btn-print-individual {
            background: linear-gradient(135deg, #6f42c1, #5a2d95);
            color: white;
            border: none;
            padding: 5px 10px;
            border-radius: 4px;
            font-size: 0.8rem;
        }
        
        .btn-print-individual:hover {
            background: linear-gradient(135deg, #5a2d95, #4a2479);
            color: white;
        }
        
        /* Developer Info Styles */
        .developer-info {
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            border-radius: 10px;
            padding: 15px;
            margin-top: 20px;
            box-shadow: var(--shadow-sm);
        }
        
        .developer-info h6 {
            color: var(--primary-color);
            font-weight: 600;
            margin-bottom: 15px;
            padding-bottom: 8px;
            border-bottom: 1px solid #ddd;
        }
        
        .developer-contact p {
            margin-bottom: 8px;
            font-size: 0.85rem;
        }
        
        .developer-contact a {
            color: var(--primary-color);
            text-decoration: none;
            transition: all 0.3s;
        }
        
        .developer-contact a:hover {
            color: var(--dark-blue);
            text-decoration: underline;
        }
        
        /* Loading spinner */
        .spinner-border-sm {
            width: 1rem;
            height: 1rem;
        }

        /* Login Modal Styles */
        .login-modal .modal-content {
            border-radius: 15px;
            overflow: hidden;
            border: none;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
        }

        .login-header {
            background: var(--login-gradient);
            color: white;
            text-align: center;
            padding: 25px 20px;
            position: relative;
        }

        .login-icon {
            font-size: 3rem;
            margin-bottom: 15px;
            color: white;
        }

        .login-title {
            font-size: 1.8rem;
            font-weight: 700;
            margin: 0;
        }

        .login-subtitle {
            font-size: 1rem;
            opacity: 0.9;
            margin: 5px 0 0;
        }

        .login-body {
            padding: 25px;
            position: relative;
            z-index: 1;
        }

        .login-form-group {
            margin-bottom: 20px;
        }

        .login-form-label {
            font-weight: 600;
            color: var(--dark-blue);
            margin-bottom: 8px;
            display: flex;
            align-items: center;
        }

        .login-form-label i {
            margin-right: 10px;
            color: var(--dark-blue);
        }

        .login-form-control {
            border-radius: 8px;
            padding: 12px 15px;
            border: 2px solid #ddd;
            transition: all 0.3s;
        }

        .login-form-control:focus {
            border-color: var(--dark-blue);
            box-shadow: 0 0 0 3px rgba(13, 71, 161, 0.2);
        }

        .login-input-group-text {
            background: var(--light-blue);
            border: 2px solid #ddd;
            border-left: none;
        }

        .btn-login {
            background: var(--gradient-secondary);
            color: white;
            border: none;
            padding: 12px;
            font-weight: 600;
            border-radius: 8px;
            width: 100%;
            transition: all 0.3s;
            margin-top: 10px;
        }

        .btn-login:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 105, 92, 0.4);
        }

        .btn-login:disabled {
            background: #ccc;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        .login-security-notice {
            text-align: center;
            margin-top: 20px;
            font-size: 0.85rem;
            color: #666;
        }

        .login-attempts-count {
            text-align: center;
            font-size: 0.9rem;
            color: #ff8f00;
            font-weight: 500;
            margin-top: 5px;
        }

        .login-blocked-message {
            text-align: center;
            background: rgba(220, 53, 69, 0.1);
            border-radius: 8px;
            padding: 15px;
            margin-top: 20px;
            color: #dc3545;
            font-weight: 500;
        }

        .login-countdown {
            font-size: 1.2rem;
            font-weight: 700;
            color: var(--dark-blue);
        }

        .login-developer-info {
            background: var(--light-blue);
            border-radius: 10px;
            padding: 20px;
            margin-top: 25px;
            text-align: center;
        }

        .login-developer-logo {
            max-width: 180px;
            margin-bottom: 15px;
            border-radius: 8px;
        }

        .login-developer-contact a {
            color: var(--dark-blue);
            text-decoration: none;
            transition: all 0.3s;
            display: inline-block;
            margin: 5px 0;
        }

        .login-developer-contact a:hover {
            color: var(--primary-color);
            text-decoration: underline;
            transform: translateY(-2px);
        }

        .login-copyright {
            text-align: center;
            margin-top: 20px;
            color: #666;
            font-size: 0.9rem;
            opacity: 0.9;
        }

        /* Animations */
        @keyframes login-shake {
            0%, 100% { transform: translateX(0); }
            10%, 30%, 50%, 70%, 90% { transform: translateX(-10px); }
            20%, 40%, 60%, 80% { transform: translateX(10px); }
        }

        .login-shake {
            animation: login-shake 0.6s cubic-bezier(.36,.07,.19,.97) both;
        }

        /* Login particle background */
        #login-particles {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 1040; /* Higher than modal backdrop */
            display: none;
        }

        /* Link Google Drive dalam tabel */
        .drive-link {
            color: #0d47a1;
            text-decoration: none;
            cursor: pointer;
        }

        .drive-link:hover {
            text-decoration: underline;
        }

        /* Modal untuk menambah link */
        .link-modal .modal-dialog {
            max-width: 600px;
        }
        
        /* App content when not authenticated */
        .app-content-unauthenticated {
            display: none;
        }

        /* Search box for desa dropdown */
        .dropdown-search-container {
            position: relative;
        }

        .dropdown-search {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            z-index: 1000;
            background: white;
            border: 1px solid #ddd;
            border-radius: 8px;
            padding: 8px;
            display: none;
        }

        .dropdown-search input {
            width: 100%;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
        }

        /* Kode Validasi Styles */
        .kode-validasi-container {
            display: flex;
            align-items: center;
        }
        
        .kode-validasi-input {
            flex: 1;
            margin-right: 10px;
        }
        
        .btn-generate-kode {
            white-space: nowrap;
        }

        /* Auto-fill button styles */
        .btn-auto-fill {
            background: linear-gradient(135deg, #6c757d, #5a6268);
            color: white;
            border: none;
            padding: 10px 15px;
            border-radius: 8px;
            font-size: 0.85rem;
            margin-top: 8px;
        }
        
        .btn-auto-fill:hover {
            background: linear-gradient(135deg, #5a6268, #4e555b);
            color: white;
        }

        .login-hint {
            font-size: 0.85rem;
            color: #0d6efd;
            margin-top: 5px;
            text-align: center;
            background-color: #f8f9fa;
            padding: 8px;
            border-radius: 4px;
            border-left: 3px solid #0d6efd;
        }

        /* New styles for additional fields */
        .btn-not-group {
            background: linear-gradient(135deg, #6c757d, #5a6268);
            color: white;
            border: none;
            padding: 10px 15px;
            border-radius: 8px;
            font-size: 0.85rem;
            margin-top: 8px;
        }
        
        .btn-not-group:hover {
            background: linear-gradient(135deg, #5a6268, #4e555b);
            color: white;
        }

        .jenis-bantuan-container {
            display: flex;
            gap: 10px;
        }

        .jenis-bantuan-container select,
        .jenis-bantuan-container input {
            flex: 1;
        }

        /* WhatsApp input styling */
        .whatsapp-input-container {
            position: relative;
        }

        .whatsapp-prefix {
            position: absolute;
            left: 10px;
            top: 50%;
            transform: translateY(-50%);
            color: #25D366;
            font-weight: bold;
        }

        .whatsapp-input {
            padding-left: 30px;
        }
    </style>
</head>
<body>
    <!-- Login Modal -->
    <div class="modal fade login-modal" id="loginModal" tabindex="-1" aria-hidden="true" data-bs-backdrop="static" data-bs-keyboard="false">
        <!-- Konten modal login dipertahankan -->
    </div>
    
    <!-- Login particle background -->
    <div id="login-particles"></div>
    
    <!-- Main Application Content (initially hidden) -->
    <div class="app-content-unauthenticated" id="appContent">
        <!-- Konten aplikasi dipertahankan -->
    </div>
    
    <!-- Modal Konfirmasi Reset Data -->
    <div class="modal fade" id="confirmResetModal" tabindex="-1" aria-hidden="true">
        <!-- Konten modal dipertahankan -->
    </div>
    
    <!-- Modal Preview Laporan -->
    <div class="modal fade" id="previewModal" tabindex="-1" aria-hidden="true">
        <!-- Konten modal dipertahankan -->
    </div>
    
    <!-- Modal Tambah Link Google Drive -->
    <div class="modal fade link-modal" id="driveLinkModal" tabindex="-1" aria-hidden="true">
        <!-- Konten modal dipertahankan -->
    </div>

    <!-- Modal Generic untuk berbagai keperluan -->
    <div class="modal fade" id="genericModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="modalTitle">Modal title</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body" id="modalBody">
                    <!-- Konten akan diisi secara dinamis -->
                </div>
                <div class="modal-footer" id="modalFooter">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Tutup</button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Scripts -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-datepicker/1.9.0/js/bootstrap-datepicker.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.28/jspdf.plugin.autotable.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    
    <script>
        // Inisialisasi variabel global
        let appData = [];
        let currentPage = 1;
        let itemsPerPage = 25;
        let filteredData = [];
        let isFilterActive = false;
        let loginAttempts = 0;
        let isBlocked = false;
        let blockTimeout;
        let generatedCodes = {}; // Menyimpan kode yang sudah digenerate per NIK
        
        // Data desa dan kecamatan
        const kecamatanList = [
            "Arjasa", "Asembagus", "Banyuglugur", "Banyuputih", "Besuki", 
            "Bungatan", "Jangkar", "Jatibanteng", "Kapongan", "Kendit", 
            "Mangaran", "Mlandingan", "Panarukan", "Panji", "Situbondo", 
            "Suboh", "Sumbermalang"
        ];
        
        const desaList = [
            "Agel", "Alas Bayur", "Alasmalang", "Alastengah", "Arjasa", "Ardirejo", "Asembagus", 
            "Awar-awar", "Awang-awang", "Baderan", "Balung", "Bantal", "Battal", "Bayeman", "Besuki", "Bletok", "Blimbing", "Bloro", "Buduan", "Bugeman", "Bungatan", 
            "Campoan", "Cemara", "Curah Cottok", "Curah Jeru", "Curah Kalak", "Curah Suri", "Curah Tatal", "Dawuhan", "Demung", "Duwet", "Gadingan", "Gebangan", 
            "Gelung", "Gudang", "Gunung Malang", "Gunung Putri", "Jangkar", "Jatisari", "Jatibanteng", "Jetis", "Juglangan", "Kalianget", "Kalibagor", "Kalimas", 
            "Kalirejo", "Kalisari", "Kandang", "Kayu Putih", "Kayumas", "Kedungdowo", "Kedunglo", "Kembangsari", "Ketah", "Ketawan", "Kilensari", "Klampokan", 
            "Klatakan", "Kotakan", "Kumbangsari", "Kukusan", "Lamongan", "Landangan", "Langkap", "Lebeng", "Lubawang", "Mangaran", "Mimbaan", "Mlandingan Kulon", 
            "Mlandingan Wetan", "Mojodungkol", "Mojosari", "Olean", "Palangan", "Panarukan", "Panji Kidul", "Panji Lor", "Parante", "Pasir Putih", "Patemon", 
            "Patokan", "Paowan", "Peleyan", "Pesisir", "Pesanggrahan", "Pategalan", "Patemon", "Plalangan", "Pokaan", "Rajekwesi", "Seletreng", "Selobanteng", 
            "Selomukti", "Selowogo", "Semambung", "Semiring", "Sliwung", "Sopet", "Sumber Pinang", "Sumberanyar", "Sumberargo", "Sumberkolak", "Sumberejo", 
            "Sumbertengah", "Sumberwaru", "Tamankursi", "Tamansari", "Taman", "Talkandang", "Tanjung Glugur", "Tanjung Kamal", "Tanjung Pecinan", "Tambak Ukir", 
            "Telempong", "Tenggir", "Tepos", "Tokelan", "Tlogosari", "Trigonco", "Trebungan", "Widoropayung", "Wonokoyo", "Wonorejo", "Wringinanom"
        ];
        
        // DOM Ready
        document.addEventListener('DOMContentLoaded', function() {
            // Inisialisasi aplikasi
            initializeApp();
            
            // Setup event listeners
            setupEventListeners();
            
            // Load data dari localStorage
            loadData();
            
            // Update dashboard
            updateDashboard();
            
            // Tampilkan modal login
            const loginModal = new bootstrap.Modal(document.getElementById('loginModal'));
            loginModal.show();
        });
        
        // Fungsi inisialisasi aplikasi
        function initializeApp() {
            // Isi dropdown tahun (2020-2090)
            fillYearDropdowns();
            
            // Isi dropdown kecamatan dan desa
            fillKecamatanDropdown();
            fillDesaDropdown();
            
            // Set tahun default ke tahun sekarang
            const currentYear = new Date().getFullYear();
            document.getElementById('tahunAnggaran').value = currentYear;
            document.getElementById('defaultTahun').value = currentYear;
            
            // Set tanggal hari ini untuk input tanggal
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('tanggalTerima').value = today;
            
            // Inisialisasi chart
            initializeCharts();
            
            // Setup browser info
            setupBrowserInfo();
        }
        
        // Fungsi untuk mengisi dropdown tahun (2020-2090)
        function fillYearDropdowns() {
            const yearSelects = [
                'tahunAnggaran', 'filterTahun', 'printTahun', 
                'exportTahun', 'defaultTahun'
            ];
            
            for (const selectId of yearSelects) {
                const select = document.getElementById(selectId);
                if (!select) continue;
                
                // Kosongkan select terlebih dahulu
                select.innerHTML = '';
                
                // Tambahkan opsi default
                if (selectId !== 'tahunAnggaran') {
                    const defaultOption = document.createElement('option');
                    defaultOption.value = '';
                    defaultOption.textContent = selectId === 'defaultTahun' ? 'Pilih Tahun' : 'Semua Tahun';
                    select.appendChild(defaultOption);
                }
                
                // Tambahkan opsi tahun dari 2020 hingga 2090
                for (let year = 2020; year <= 2090; year++) {
                    const option = document.createElement('option');
                    option.value = year;
                    option.textContent = year;
                    select.appendChild(option);
                }
                
                // Set nilai default untuk tahun anggaran
                if (selectId === 'tahunAnggaran') {
                    select.value = new Date().getFullYear();
                }
            }
        }
        
        // Fungsi untuk mengisi dropdown kecamatan
        function fillKecamatanDropdown() {
            const kecamatanSelects = ['kecamatan', 'filterKecamatan', 'printKecamatan', 'exportKecamatan'];
            
            for (const selectId of kecamatanSelects) {
                const select = document.getElementById(selectId);
                if (!select) continue;
                
                // Kosongkan select terlebih dahulu
                select.innerHTML = '';
                
                // Tambahkan opsi default
                const defaultOption = document.createElement('option');
                defaultOption.value = '';
                defaultOption.textContent = selectId === 'kecamatan' ? 'Pilih Kecamatan' : 'Semua Kecamatan';
                select.appendChild(defaultOption);
                
                // Tambahkan opsi kecamatan
                for (const kecamatan of kecamatanList) {
                    const option = document.createElement('option');
                    option.value = kecamatan;
                    option.textContent = kecamatan;
                    select.appendChild(option);
                }
            }
        }
        
        // Fungsi untuk mengisi dropdown desa
        function fillDesaDropdown() {
            const desaSelects = ['desa', 'filterDesa'];
            
            for (const selectId of desaSelects) {
                const select = document.getElementById(selectId);
                if (!select) continue;
                
                // Kosongkan select terlebih dahulu
                select.innerHTML = '';
                
                // Tambahkan opsi default
                const defaultOption = document.createElement('option');
                defaultOption.value = '';
                defaultOption.textContent = selectId === 'desa' ? 'Pilih Desa' : 'Semua Desa';
                select.appendChild(defaultOption);
                
                // Tambahkan opsi desa
                for (const desa of desaList) {
                    const option = document.createElement('option');
                    option.value = desa;
                    option.textContent = desa;
                    select.appendChild(option);
                }
            }
        }
        
        // Fungsi untuk setup event listeners
        function setupEventListeners() {
            // Login form
            document.getElementById('loginForm').addEventListener('submit', handleLogin);
            document.querySelector('.toggle-password').addEventListener('click', togglePasswordVisibility);
            
            // Input form
            document.getElementById('inputForm').addEventListener('submit', handleFormSubmit);
            document.getElementById('btnBukanKelompok').addEventListener('click', setBukanKelompok);
            document.getElementById('generateKodeBtn').addEventListener('click', generateKodeValidasi);
            
            // WhatsApp number formatting
            const whatsappInput = document.getElementById('whatsapp');
            if (whatsappInput) {
                whatsappInput.addEventListener('input', formatWhatsAppNumber);
            }
            
            // Data table
            const searchInput = document.getElementById('searchData');
            if (searchInput) {
                searchInput.addEventListener('input', handleSearch);
            }
            
            const clearSearchBtn = document.getElementById('clearSearchBtn');
            if (clearSearchBtn) {
                clearSearchBtn.addEventListener('click', clearSearch);
            }
            
            // Filter
            const applyFilterBtn = document.getElementById('applyFilterBtn');
            if (applyFilterBtn) {
                applyFilterBtn.addEventListener('click', applyFilter);
            }
            
            const resetFilterBtn = document.getElementById('resetFilterBtn');
            if (resetFilterBtn) {
                resetFilterBtn.addEventListener('click', resetFilter);
            }
            
            // Print & Export
            const printPdfBtn = document.getElementById('printPdfBtn');
            if (printPdfBtn) {
                printPdfBtn.addEventListener('click', printToPdf);
            }
            
            const printDirectBtn = document.getElementById('printDirectBtn');
            if (printDirectBtn) {
                printDirectBtn.addEventListener('click', printDirect);
            }
            
            const previewBtn = document.getElementById('previewBtn');
            if (previewBtn) {
                previewBtn.addEventListener('click', showPreview);
            }
            
            const printFromPreviewBtn = document.getElementById('printFromPreviewBtn');
            if (printFromPreviewBtn) {
                printFromPreviewBtn.addEventListener('click', printFromPreview);
            }
            
            const exportExcelBtn = document.getElementById('exportExcelBtn');
            if (exportExcelBtn) {
                exportExcelBtn.addEventListener('click', exportToExcel);
            }
            
            const exportCsvBtn = document.getElementById('exportCsvBtn');
            if (exportCsvBtn) {
                exportCsvBtn.addEventListener('click', exportToCsv);
            }
            
            const exportJsonBtn = document.getElementById('exportJsonBtn');
            if (exportJsonBtn) {
                exportJsonBtn.addEventListener('click', exportToJson);
            }
            
            const exportPdfBtn = document.getElementById('exportPdfBtn');
            if (exportPdfBtn) {
                exportPdfBtn.addEventListener('click', exportToPdf);
            }
            
            // Backup & Restore
            const backupDataBtn = document.getElementById('backupDataBtn');
            if (backupDataBtn) {
                backupDataBtn.addEventListener('click', backupData);
            }
            
            const restoreFileInput = document.getElementById('restoreFileInput');
            if (restoreFileInput) {
                restoreFileInput.addEventListener('change', enableRestoreButton);
            }
            
            const restoreDataBtn = document.getElementById('restoreDataBtn');
            if (restoreDataBtn) {
                restoreDataBtn.addEventListener('click', restoreData);
            }
            
            const resetConfirmationInput = document.getElementById('resetConfirmationInput');
            if (resetConfirmationInput) {
                resetConfirmationInput.addEventListener('input', enableResetButton);
            }
            
            const confirmResetBtn = document.getElementById('confirmResetBtn');
            if (confirmResetBtn) {
                confirmResetBtn.addEventListener('click', resetData);
            }
            
            // Settings
            const settingsForm = document.getElementById('settingsForm');
            if (settingsForm) {
                settingsForm.addEventListener('submit', saveSettings);
            }
            
            // Mobile menu
            const mobileMenuBtn = document.getElementById('mobileMenuBtn');
            if (mobileMenuBtn) {
                mobileMenuBtn.addEventListener('click', toggleMobileMenu);
            }
            
            const sidebarOverlay = document.getElementById('sidebarOverlay');
            if (sidebarOverlay) {
                sidebarOverlay.addEventListener('click', toggleMobileMenu);
            }
            
            // FAB button
            const fabBtn = document.getElementById('fabBtn');
            if (fabBtn) {
                fabBtn.addEventListener('click', scrollToTop);
            }
            
            // Kecamatan change event untuk update desa
            const kecamatanSelect = document.getElementById('kecamatan');
            if (kecamatanSelect) {
                kecamatanSelect.addEventListener('change', updateDesaDropdown);
            }
            
            const filterKecamatanSelect = document.getElementById('filterKecamatan');
            if (filterKecamatanSelect) {
                filterKecamatanSelect.addEventListener('change', updateFilterDesaDropdown);
            }
            
            // Jenis bantuan change event
            const jenisBantuanSelect = document.getElementById('jenisBantuan');
            if (jenisBantuanSelect) {
                jenisBantuanSelect.addEventListener('change', updateSatuanBantuan);
            }
        }
        
        // Fungsi untuk handle login
        function handleLogin(e) {
            e.preventDefault();
            
            if (isBlocked) {
                showNotification('Anda masih dalam masa pemblokiran. Silakan coba lagi nanti.', 'error');
                return;
            }
            
            const securityCode = document.getElementById('securityCode').value;
            
            // Tampilkan spinner
            document.getElementById('loginSpinner').classList.remove('d-none');
            document.querySelector('.login-button-text').textContent = 'Memproses...';
            document.getElementById('loginButton').disabled = true;
            
            // Simulasi proses login
            setTimeout(() => {
                if (securityCode === '1234') { // Kode default
                    // Login berhasil
                    document.getElementById('loginSpinner').classList.add('d-none');
                    document.querySelector('.login-button-text').textContent = 'Masuk ke Aplikasi';
                    document.getElementById('loginButton').disabled = false;
                    
                    // Sembunyikan modal login
                    const loginModal = bootstrap.Modal.getInstance(document.getElementById('loginModal'));
                    if (loginModal) {
                        loginModal.hide();
                    }
                    
                    // Tampilkan konten aplikasi
                    document.getElementById('appContent').style.display = 'block';
                    
                    // Reset percobaan login
                    loginAttempts = 0;
                    updateAttemptsCount();
                    
                    showNotification('Login berhasil! Selamat datang di aplikasi BARJAS.', 'success');
                } else {
                    // Login gagal
                    document.getElementById('loginSpinner').classList.add('d-none');
                    document.querySelector('.login-button-text').textContent = 'Masuk ke Aplikasi';
                    document.getElementById('loginButton').disabled = false;
                    
                    loginAttempts++;
                    updateAttemptsCount();
                    
                    // Goyangkan form
                    document.getElementById('loginForm').classList.add('login-shake');
                    setTimeout(() => {
                        document.getElementById('loginForm').classList.remove('login-shake');
                    }, 600);
                    
                    if (loginAttempts >= 3) {
                        // Blokir akses sementara
                        blockAccess();
                    }
                    
                    showNotification('Kode keamanan salah. Silakan coba lagi.', 'error');
                }
            }, 1000);
        }
        
        // Fungsi untuk toggle password visibility
        function togglePasswordVisibility() {
            const passwordInput = document.getElementById('securityCode');
            const toggleButton = document.querySelector('.toggle-password');
            
            if (passwordInput && toggleButton) {
                if (passwordInput.type === 'password') {
                    passwordInput.type = 'text';
                    toggleButton.innerHTML = '<i class="fas fa-eye-slash"></i>';
                } else {
                    passwordInput.type = 'password';
                    toggleButton.innerHTML = '<i class="fas fa-eye"></i>';
                }
            }
        }
        
        // Fungsi untuk update attempts count
        function updateAttemptsCount() {
            const attemptsElement = document.getElementById('attemptsCount');
            const blockedMessage = document.getElementById('blockedMessage');
            
            if (attemptsElement) {
                if (loginAttempts > 0) {
                    attemptsElement.textContent = `Percobaan login gagal: ${loginAttempts}/3`;
                    attemptsElement.style.display = 'block';
                } else {
                    attemptsElement.style.display = 'none';
                }
            }
            
            if (blockedMessage) {
                if (isBlocked) {
                    blockedMessage.classList.remove('d-none');
                } else {
                    blockedMessage.classList.add('d-none');
                }
            }
        }
        
        // Fungsi untuk memblokir akses sementara
        function blockAccess() {
            isBlocked = true;
            updateAttemptsCount();
            
            let countdown = 30;
            const countdownElement = document.getElementById('countdown');
            if (countdownElement) {
                countdownElement.textContent = countdown;
            }
            
            blockTimeout = setInterval(() => {
                countdown--;
                if (countdownElement) {
                    countdownElement.textContent = countdown;
                }
                
                if (countdown <= 0) {
                    clearInterval(blockTimeout);
                    isBlocked = false;
                    updateAttemptsCount();
                }
            }, 1000);
        }
        
        // Fungsi untuk logout
        function logout() {
            if (confirm('Apakah Anda yakin ingin keluar dari aplikasi?')) {
                // Sembunyikan konten aplikasi
                document.getElementById('appContent').style.display = 'none';
                
                // Tampilkan modal login
                const loginModal = new bootstrap.Modal(document.getElementById('loginModal'));
                loginModal.show();
                
                showNotification('Anda telah logout dari aplikasi.', 'info');
            }
        }
        
        // Fungsi untuk handle form submit
        function handleFormSubmit(e) {
            e.preventDefault();
            
            // Validasi form
            if (!validateForm()) {
                return;
            }
            
            // Ambil nilai dari form
            const formData = {
                id: Date.now(), // ID unik berdasarkan timestamp
                nama: document.getElementById('nama').value,
                nik: document.getElementById('nik').value,
                whatsapp: document.getElementById('whatsapp').value,
                namaKelompok: document.getElementById('namaKelompok').value,
                jabatan: document.getElementById('jabatan').value,
                tahunAnggaran: document.getElementById('tahunAnggaran').value,
                kecamatan: document.getElementById('kecamatan').value,
                desa: document.getElementById('desa').value,
                alamat: document.getElementById('alamat').value,
                jenisBantuan: document.getElementById('jenisBantuan').value,
                jumlahBantuan: document.getElementById('jumlahBantuan').value,
                satuanBantuan: document.getElementById('satuanBantuan').value,
                tanggalTerima: document.getElementById('tanggalTerima').value,
                driveLink: document.getElementById('driveLink').value,
                kodeValidasi: document.getElementById('kodeValidasi').value,
                keterangan: document.getElementById('keterangan').value,
                tanggalInput: new Date().toISOString()
            };
            
            // Simpan data
            appData.push(formData);
            saveData();
            
            // Reset form
            document.getElementById('inputForm').reset();
            
            // Reset jabatan ke default
            document.getElementById('jabatan').value = 'Individu';
            
            // Set tahun ke default
            document.getElementById('tahunAnggaran').value = new Date().getFullYear();
            
            // Set tanggal hari ini
            document.getElementById('tanggalTerima').value = new Date().toISOString().split('T')[0];
            
            // Reset kode validasi
            document.getElementById('kodeValidasi').value = '';
            
            // Update UI
            updateDashboard();
            renderDataTable();
            
            showNotification('Data berhasil disimpan!', 'success');
        }
        
        // Fungsi untuk validasi form
        function validateForm() {
            let isValid = true;
            
            // Validasi Nama
            const nama = document.getElementById('nama').value;
            if (!nama) {
                document.getElementById('namaError').textContent = 'Nama harus diisi';
                document.getElementById('namaError').style.display = 'block';
                document.getElementById('nama').classList.add('input-error');
                isValid = false;
            } else {
                document.getElementById('namaError').style.display = 'none';
                document.getElementById('nama').classList.remove('input-error');
            }
            
            // Validasi NIK
            const nik = document.getElementById('nik').value;
            if (!nik) {
                document.getElementById('nikError').textContent = 'NIK harus diisi';
                document.getElementById('nikError').style.display = 'block';
                document.getElementById('nik').classList.add('input-error');
                isValid = false;
            } else if (isNikExists(nik)) {
                document.getElementById('nikError').textContent = 'NIK sudah terdaftar dalam sistem';
                document.getElementById('nikError').style.display = 'block';
                document.getElementById('nik').classList.add('input-error');
                isValid = false;
            } else {
                document.getElementById('nikError').style.display = 'none';
                document.getElementById('nik').classList.remove('input-error');
            }
            
            // Validasi WhatsApp
            const whatsapp = document.getElementById('whatsapp').value;
            if (!whatsapp) {
                document.getElementById('whatsappError').textContent = 'Nomor WhatsApp harus diisi';
                document.getElementById('whatsappError').style.display = 'block';
                document.getElementById('whatsapp').classList.add('input-error');
                isValid = false;
            } else {
                document.getElementById('whatsappError').style.display = 'none';
                document.getElementById('whatsapp').classList.remove('input-error');
            }
            
            // Validasi Kode Validasi
            const kodeValidasi = document.getElementById('kodeValidasi').value;
            if (!kodeValidasi) {
                showNotification('Harap generate kode validasi terlebih dahulu', 'error');
                isValid = false;
            }
            
            return isValid;
        }
        
        // Fungsi untuk format nomor WhatsApp
        function formatWhatsAppNumber(e) {
            let value = e.target.value.replace(/\D/g, '');
            
            // Jika dimulai dengan 0, ganti dengan 62
            if (value.startsWith('0')) {
                value = '62' + value.substring(1);
            }
            
            // Format tampilan: 62-xxx-xxxx-xxxx
            if (value.length > 2) {
                value = value.substring(0, 2) + '-' + value.substring(2);
            }
            if (value.length > 6) {
                value = value.substring(0, 6) + '-' + value.substring(6);
            }
            if (value.length > 11) {
                value = value.substring(0, 11) + '-' + value.substring(11);
            }
            
            e.target.value = value;
        }
        
        // Fungsi untuk mengecek apakah NIK sudah ada
        function isNikExists(nik) {
            return appData.some(data => data.nik === nik);
        }
        
        // Fungsi untuk set "Bukan Kelompok"
        function setBukanKelompok() {
            document.getElementById('namaKelompok').value = 'Bukan Kelompok';
            document.getElementById('jabatan').value = 'Individu';
        }
        
        // Fungsi untuk generate kode unik
        function generateKodeValidasi() {
            const nik = document.getElementById('nik').value;
            const nama = document.getElementById('nama').value;
            
            if (!nik || !nama) {
                showNotification('Harap isi NIK dan Nama terlebih dahulu', 'error');
                return;
            }
            
            // Cek apakah sudah ada kode untuk NIK ini
            if (generatedCodes[nik]) {
                document.getElementById('kodeValidasi').value = generatedCodes[nik];
                showNotification('Kode validasi sudah digenerate untuk NIK ini', 'info');
                return;
            }
            
            // Generate kode unik 5 karakter (huruf kapital dan angka)
            const characters = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789';
            let result = '';
            
            for (let i = 0; i < 5; i++) {
                result += characters.charAt(Math.floor(Math.random() * characters.length));
            }
            
            // Simpan kode untuk NIK ini
            generatedCodes[nik] = result;
            
            // Set nilai kode validasi
            document.getElementById('kodeValidasi').value = result;
            
            showNotification('Kode validasi berhasil digenerate', 'success');
        }
        
        // Fungsi untuk update dropdown desa berdasarkan kecamatan
        function updateDesaDropdown() {
            const kecamatan = document.getElementById('kecamatan').value;
            const desaSelect = document.getElementById('desa');
            
            if (!desaSelect) return;
            
            // Reset dropdown desa
            desaSelect.innerHTML = '<option value="">Pilih Desa</option>';
            
            // Jika tidak ada kecamatan yang dipilih, tampilkan semua desa
            if (!kecamatan) {
                for (const desa of desaList) {
                    const option = document.createElement('option');
                    option.value = desa;
                    option.textContent = desa;
                    desaSelect.appendChild(option);
                }
                return;
            }
            
            // Daftar desa berdasarkan kecamatan (dalam aplikasi nyata, ini akan disesuaikan)
            // Untuk sementara, tampilkan semua desa tanpa filter
            for (const desa of desaList) {
                const option = document.createElement('option');
                option.value = desa;
                option.textContent = desa;
                desaSelect.appendChild(option);
            }
        }
        
        // Fungsi untuk update dropdown desa filter berdasarkan kecamatan
        function updateFilterDesaDropdown() {
            const kecamatan = document.getElementById('filterKecamatan').value;
            const desaSelect = document.getElementById('filterDesa');
            
            if (!desaSelect) return;
            
            // Reset dropdown desa
            desaSelect.innerHTML = '<option value="">Semua Desa</option>';
            
            // Jika tidak ada kecamatan yang dipilih, tampilkan semua desa
            if (!kecamatan) {
                for (const desa of desaList) {
                    const option = document.createElement('option');
                    option.value = desa;
                    option.textContent = desa;
                    desaSelect.appendChild(option);
                }
                return;
            }
            
            // Daftar desa berdasarkan kecamatan (dalam aplikasi nyata, ini akan disesuaikan)
            // Untuk sementara, tampilkan semua desa tanpa filter
            for (const desa of desaList) {
                const option = document.createElement('option');
                option.value = desa;
                option.textContent = desa;
                desaSelect.appendChild(option);
            }
        }
        
        // Fungsi untuk update satuan bantuan berdasarkan jenis bantuan
        function updateSatuanBantuan() {
            const jenisBantuan = document.getElementById('jenisBantuan').value;
            const satuanBantuan = document.getElementById('satuanBantuan');
            
            if (!satuanBantuan) return;
            
            // Reset dropdown satuan
            satuanBantuan.innerHTML = '';
            
            // Set opsi satuan berdasarkan jenis bantuan
            if (jenisBantuan === 'Uang') {
                satuanBantuan.innerHTML = '<option value="Rupiah">Rupiah</option>';
            } else if (jenisBantuan === 'Barang') {
                satuanBantuan.innerHTML = `
                    <option value="Unit">Unit</option>
                    <option value="Paket">Paket</option>
                    <option value="Set">Set</option>
                `;
            } else if (jenisBantuan === 'Jasa') {
                satuanBantuan.innerHTML = `
                    <option value="Jam">Jam</option>
                    <option value="Hari">Hari</option>
                    <option value="Paket">Paket</option>
                `;
            }
        }
        
        // Fungsi untuk load data dari localStorage
        function loadData() {
            const savedData = localStorage.getItem('barjasData');
            if (savedData) {
                appData = JSON.parse(savedData);
            }
            
            const savedCodes = localStorage.getItem('barjasGeneratedCodes');
            if (savedCodes) {
                generatedCodes = JSON.parse(savedCodes);
            }
            
            renderDataTable();
        }
        
        // Fungsi untuk save data ke localStorage
        function saveData() {
            localStorage.setItem('barjasData', JSON.stringify(appData));
            localStorage.setItem('barjasGeneratedCodes', JSON.stringify(generatedCodes));
        }
        
        // Fungsi untuk render data table
        function renderDataTable() {
            const tableBody = document.getElementById('dataTableBody');
            if (!tableBody) return;
            
            tableBody.innerHTML = '';
            
            const dataToRender = isFilterActive ? filteredData : appData;
            const startIndex = (currentPage - 1) * itemsPerPage;
            const endIndex = Math.min(startIndex + itemsPerPage, dataToRender.length);
            
            for (let i = startIndex; i < endIndex; i++) {
                const data = dataToRender[i];
                const row = document.createElement('tr');
                
                // Format nomor WhatsApp untuk tampilan
                const whatsappDisplay = data.whatsapp ? data.whatsapp.replace('62', '0') : '-';
                
                row.innerHTML = `
                    <td>${i + 1}</td>
                    <td>${data.nama}</td>
                    <td>${data.nik}</td>
                    <td>
                        <span class="whatsapp-number" data-phone="${data.whatsapp}">
                            ${whatsappDisplay}
                        </span>
                    </td>
                    <td>${data.namaKelompok}</td>
                    <td>${data.jabatan}</td>
                    <td>${data.tahunAnggaran}</td>
                    <td>${data.kecamatan}</td>
                    <td>${data.desa}</td>
                    <td>${data.jenisBantuan}</td>
                    <td>${data.jumlahBantuan} ${data.satuanBantuan}</td>
                    <td>${formatDate(data.tanggalTerima)}</td>
                    <td>
                        ${data.driveLink ? 
                            `<a href="${data.driveLink}" target="_blank" class="btn btn-sm btn-outline-primary">
                                <i class="fas fa-external-link-alt"></i> Link
                            </a>` : 
                            '-'
                        }
                    </td>
                    <td>${data.kodeValidasi}</td>
                    <td>
                        <button class="btn btn-sm btn-outline-info view-details" data-id="${data.id}">
                            <i class="fas fa-eye"></i>
                        </button>
                        <button class="btn btn-sm btn-outline-warning edit-data" data-id="${data.id}">
                            <i class="fas fa-edit"></i>
                        </button>
                        <button class="btn btn-sm btn-outline-danger delete-data" data-id="${data.id}">
                            <i class="fas fa-trash"></i>
                        </button>
                    </td>
                `;
                
                tableBody.appendChild(row);
            }
            
            // Update pagination
            updatePagination(dataToRender.length);
            
            // Add event listeners to buttons
            addTableEventListeners();
        }
        
        // Fungsi untuk menambahkan event listeners pada tabel
        function addTableEventListeners() {
            // View details buttons
            document.querySelectorAll('.view-details').forEach(button => {
                button.addEventListener('click', function() {
                    const id = parseInt(this.getAttribute('data-id'));
                    viewDataDetails(id);
                });
            });
            
            // Edit buttons
            document.querySelectorAll('.edit-data').forEach(button => {
                button.addEventListener('click', function() {
                    const id = parseInt(this.getAttribute('data-id'));
                    editData(id);
                });
            });
            
            // Delete buttons
            document.querySelectorAll('.delete-data').forEach(button => {
                button.addEventListener('click', function() {
                    const id = parseInt(this.getAttribute('data-id'));
                    deleteData(id);
                });
            });
            
            // WhatsApp number click
            document.querySelectorAll('.whatsapp-number').forEach(element => {
                element.addEventListener('click', function() {
                    const phone = this.getAttribute('data-phone');
                    if (phone) {
                        window.open(`https://wa.me/${phone}`, '_blank');
                    }
                });
            });
        }
        
        // Fungsi untuk view data details
        function viewDataDetails(id) {
            const data = appData.find(item => item.id === id);
            if (!data) return;
            
            const modalTitle = document.getElementById('modalTitle');
            const modalBody = document.getElementById('modalBody');
            const modalFooter = document.getElementById('modalFooter');
            
            if (modalTitle && modalBody && modalFooter) {
                modalTitle.textContent = 'Detail Penerima Bantuan';
                
                // Format nomor WhatsApp untuk tampilan
                const whatsappDisplay = data.whatsapp ? data.whatsapp.replace('62', '0') : '-';
                
                modalBody.innerHTML = `
                    <div class="row">
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label class="fw-bold">Nama Lengkap:</label>
                                <p>${data.nama}</p>
                            </div>
                            <div class="mb-3">
                                <label class="fw-bold">NIK:</label>
                                <p>${data.nik}</p>
                            </div>
                            <div class="mb-3">
                                <label class="fw-bold">WhatsApp:</label>
                                <p>${whatsappDisplay}</p>
                            </div>
                            <div class="mb-3">
                                <label class="fw-bold">Nama Kelompok:</label>
                                <p>${data.namaKelompok}</p>
                            </div>
                            <div class="mb-3">
                                <label class="fw-bold">Jabatan:</label>
                                <p>${data.jabatan}</p>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label class="fw-bold">Tahun Anggaran:</label>
                                <p>${data.tahunAnggaran}</p>
                            </div>
                            <div class="mb-3">
                                <label class="fw-bold">Kecamatan:</label>
                                <p>${data.kecamatan}</p>
                            </div>
                            <div class="mb-3">
                                <label class="fw-bold">Desa:</label>
                                <p>${data.desa}</p>
                            </div>
                            <div class="mb-3">
                                <label class="fw-bold">Alamat:</label>
                                <p>${data.alamat || '-'}</p>
                            </div>
                            <div class="mb-3">
                                <label class="fw-bold">Tanggal Terima:</label>
                                <p>${formatDate(data.tanggalTerima)}</p>
                            </div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label class="fw-bold">Jenis Bantuan:</label>
                                <p>${data.jenisBantuan}</p>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label class="fw-bold">Jumlah Bantuan:</label>
                                <p>${data.jumlahBantuan} ${data.satuanBantuan}</p>
                            </div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-12">
                            <div class="mb-3">
                                <label class="fw-bold">Link Google Drive:</label>
                                <p>${data.driveLink ? `<a href="${data.driveLink}" target="_blank">${data.driveLink}</a>` : '-'}</p>
                            </div>
                            <div class="mb-3">
                                <label class="fw-bold">Kode Validasi:</label>
                                <p>${data.kodeValidasi}</p>
                            </div>
                            <div class="mb-3">
                                <label class="fw-bold">Keterangan:</label>
                                <p>${data.keterangan || '-'}</p>
                            </div>
                        </div>
                    </div>
                `;
                
                modalFooter.innerHTML = `
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Tutup</button>
                    <button type="button" class="btn btn-primary" onclick="editData(${data.id})">
                        <i class="fas fa-edit me-1"></i> Edit Data
                    </button>
                `;
                
                const modal = new bootstrap.Modal(document.getElementById('genericModal'));
                modal.show();
            }
        }
        
        // Fungsi untuk edit data
        function editData(id) {
            const data = appData.find(item => item.id === id);
            if (!data) return;
            
            // Sembunyikan modal jika sedang terbuka
            const existingModal = bootstrap.Modal.getInstance(document.getElementById('genericModal'));
            if (existingModal) {
                existingModal.hide();
            }
            
            // Isi form dengan data yang akan diedit
            document.getElementById('nama').value = data.nama;
            document.getElementById('nik').value = data.nik;
            document.getElementById('whatsapp').value = data.whatsapp;
            document.getElementById('namaKelompok').value = data.namaKelompok;
            document.getElementById('jabatan').value = data.jabatan;
            document.getElementById('tahunAnggaran').value = data.tahunAnggaran;
            document.getElementById('kecamatan').value = data.kecamatan;
            document.getElementById('desa').value = data.desa;
            document.getElementById('alamat').value = data.alamat || '';
            document.getElementById('jenisBantuan').value = data.jenisBantuan;
            document.getElementById('jumlahBantuan').value = data.jumlahBantuan;
            document.getElementById('satuanBantuan').value = data.satuanBantuan;
            document.getElementById('tanggalTerima').value = data.tanggalTerima;
            document.getElementById('driveLink').value = data.driveLink || '';
            document.getElementById('kodeValidasi').value = data.kodeValidasi;
            document.getElementById('keterangan').value = data.keterangan || '';
            
            // Update satuan bantuan
            updateSatuanBantuan();
            
            // Hapus data lama
            deleteData(id, false);
            
            // Scroll ke form input
            document.getElementById('inputForm').scrollIntoView({ behavior: 'smooth' });
            
            showNotification('Data siap untuk diedit. Silakan lakukan perubahan dan simpan.', 'info');
        }
        
        // Fungsi untuk delete data
        function deleteData(id, showNotification = true) {
            if (confirm('Apakah Anda yakin ingin menghapus data ini?')) {
                const index = appData.findIndex(item => item.id === id);
                if (index !== -1) {
                    appData.splice(index, 1);
                    saveData();
                    
                    if (showNotification) {
                        showNotification('Data berhasil dihapus!', 'success');
                    }
                    
                    // Update UI
                    updateDashboard();
                    renderDataTable();
                }
            }
        }
        
        // Fungsi untuk update pagination
        function updatePagination(totalItems) {
            const totalPages = Math.ceil(totalItems / itemsPerPage);
            const paginationElement = document.getElementById('pagination');
            
            if (!paginationElement) return;
            
            paginationElement.innerHTML = '';
            
            // Previous button
            const prevLi = document.createElement('li');
            prevLi.className = `page-item ${currentPage === 1 ? 'disabled' : ''}`;
            prevLi.innerHTML = `<a class="page-link" href="#" data-page="${currentPage - 1}">Sebelumnya</a>`;
            paginationElement.appendChild(prevLi);
            
            // Page numbers
            const startPage = Math.max(1, currentPage - 2);
            const endPage = Math.min(totalPages, startPage + 4);
            
            for (let i = startPage; i <= endPage; i++) {
                const pageLi = document.createElement('li');
                pageLi.className = `page-item ${i === currentPage ? 'active' : ''}`;
                pageLi.innerHTML = `<a class="page-link" href="#" data-page="${i}">${i}</a>`;
                paginationElement.appendChild(pageLi);
            }
            
            // Next button
            const nextLi = document.createElement('li');
            nextLi.className = `page-item ${currentPage === totalPages ? 'disabled' : ''}`;
            nextLi.innerHTML = `<a class="page-link" href="#" data-page="${currentPage + 1}">Selanjutnya</a>`;
            paginationElement.appendChild(nextLi);
            
            // Add event listeners to pagination links
            paginationElement.querySelectorAll('.page-link').forEach(link => {
                link.addEventListener('click', function(e) {
                    e.preventDefault();
                    const page = parseInt(this.getAttribute('data-page'));
                    if (!isNaN(page)) {
                        currentPage = page;
                        renderDataTable();
                    }
                });
            });
            
            // Update info pagination
            const paginationInfo = document.getElementById('paginationInfo');
            if (paginationInfo) {
                const startIndex = (currentPage - 1) * itemsPerPage + 1;
                const endIndex = Math.min(startIndex + itemsPerPage - 1, totalItems);
                paginationInfo.textContent = `Menampilkan ${startIndex} sampai ${endIndex} dari ${totalItems} data`;
            }
        }
        
        // Fungsi untuk handle search
        function handleSearch() {
            const searchTerm = document.getElementById('searchData').value.toLowerCase();
            
            if (searchTerm) {
                filteredData = appData.filter(item => 
                    item.nama.toLowerCase().includes(searchTerm) ||
                    item.nik.toLowerCase().includes(searchTerm) ||
                    item.namaKelompok.toLowerCase().includes(searchTerm) ||
                    item.kecamatan.toLowerCase().includes(searchTerm) ||
                    item.desa.toLowerCase().includes(searchTerm) ||
                    item.jenisBantuan.toLowerCase().includes(searchTerm)
                );
                
                isFilterActive = true;
            } else {
                isFilterActive = false;
            }
            
            currentPage = 1;
            renderDataTable();
        }
        
        // Fungsi untuk clear search
        function clearSearch() {
            document.getElementById('searchData').value = '';
            isFilterActive = false;
            currentPage = 1;
            renderDataTable();
        }
        
        // Fungsi untuk apply filter
        function applyFilter() {
            const tahun = document.getElementById('filterTahun').value;
            const kecamatan = document.getElementById('filterKecamatan').value;
            const desa = document.getElementById('filterDesa').value;
            const jenisBantuan = document.getElementById('filterJenisBantuan').value;
            
            filteredData = appData.filter(item => {
                return (
                    (!tahun || item.tahunAnggaran == tahun) &&
                    (!kecamatan || item.kecamatan === kecamatan) &&
                    (!desa || item.desa === desa) &&
                    (!jenisBantuan || item.jenisBantuan === jenisBantuan)
                );
            });
            
            isFilterActive = true;
            currentPage = 1;
            renderDataTable();
            
            showNotification('Filter berhasil diterapkan', 'success');
        }
        
        // Fungsi untuk reset filter
        function resetFilter() {
            document.getElementById('filterTahun').value = '';
            document.getElementById('filterKecamatan').value = '';
            document.getElementById('filterDesa').value = '';
            document.getElementById('filterJenisBantuan').value = '';
            
            isFilterActive = false;
            currentPage = 1;
            renderDataTable();
            
            showNotification('Filter direset', 'info');
        }
        
        // Fungsi untuk update dashboard
        function updateDashboard() {
            // Update statistik
            document.getElementById('totalData').textContent = appData.length;
            
            // Hitung data tahun ini
            const currentYear = new Date().getFullYear();
            const dataThisYear = appData.filter(item => item.tahunAnggaran == currentYear).length;
            document.getElementById('dataTahunIni').textContent = dataThisYear;
            
            // Hitung data bulan ini
            const currentMonth = new Date().getMonth() + 1;
            const dataThisMonth = appData.filter(item => {
                const itemDate = new Date(item.tanggalInput);
                return itemDate.getMonth() + 1 === currentMonth && itemDate.getFullYear() === currentYear;
            }).length;
            document.getElementById('dataBulanIni').textContent = dataThisMonth;
            
            // Hitung data hari ini
            const today = new Date().toDateString();
            const dataToday = appData.filter(item => new Date(item.tanggalInput).toDateString() === today).length;
            document.getElementById('dataHariIni').textContent = dataToday;
            
            // Update charts
            updateCharts();
        }
        
        // Fungsi untuk inisialisasi charts
        function initializeCharts() {
            // Inisialisasi chart distribusi bantuan
            const ctxDistribution = document.getElementById('distributionChart');
            if (ctxDistribution) {
                window.distributionChart = new Chart(ctxDistribution, {
                    type: 'pie',
                    data: {
                        labels: [],
                        datasets: [{
                            data: [],
                            backgroundColor: [
                                'rgba(255, 99, 132, 0.7)',
                                'rgba(54, 162, 235, 0.7)',
                                'rgba(255, 206, 86, 0.7)',
                                'rgba(75, 192, 192, 0.7)',
                                'rgba(153, 102, 255, 0.7)',
                                'rgba(255, 159, 64, 0.7)'
                            ],
                            borderWidth: 1
                        }]
                    },
                    options: {
                        responsive: true,
                        plugins: {
                            legend: {
                                position: 'bottom'
                            },
                            title: {
                                display: true,
                                text: 'Distribusi Bantuan per Kecamatan'
                            }
                        }
                    }
                });
            }
            
            // Inisialisasi chart trend bantuan
            const ctxTrend = document.getElementById('trendChart');
            if (ctxTrend) {
                window.trendChart = new Chart(ctxTrend, {
                    type: 'line',
                    data: {
                        labels: [],
                        datasets: [{
                            label: 'Jumlah Bantuan per Tahun',
                            data: [],
                            backgroundColor: 'rgba(54, 162, 235, 0.2)',
                            borderColor: 'rgba(54, 162, 235, 1)',
                            borderWidth: 2,
                            tension: 0.3,
                            fill: true
                        }]
                    },
                    options: {
                        responsive: true,
                        plugins: {
                            legend: {
                                position: 'bottom'
                            },
                            title: {
                                display: true,
                                text: 'Trend Bantuan per Tahun'
                            }
                        },
                        scales: {
                            y: {
                                beginAtZero: true,
                                ticks: {
                                    precision: 0
                                }
                            }
                        }
                    }
                });
            }
            
            // Inisialisasi chart jenis bantuan
            const ctxJenis = document.getElementById('jenisBantuanChart');
            if (ctxJenis) {
                window.jenisBantuanChart = new Chart(ctxJenis, {
                    type: 'bar',
                    data: {
                        labels: [],
                        datasets: [{
                            label: 'Jumlah Bantuan',
                            data: [],
                            backgroundColor: 'rgba(75, 192, 192, 0.7)',
                            borderColor: 'rgba(75, 192, 192, 1)',
                            borderWidth: 1
                        }]
                    },
                    options: {
                        responsive: true,
                        plugins: {
                            legend: {
                                display: false
                            },
                            title: {
                                display: true,
                                text: 'Distribusi Jenis Bantuan'
                            }
                        },
                        scales: {
                            y: {
                                beginAtZero: true,
                                ticks: {
                                    precision: 0
                                }
                            }
                        }
                    }
                });
            }
        }
        
        // Fungsi untuk update charts
        function updateCharts() {
            if (appData.length === 0) return;
            
            // Update distribution chart (per kecamatan)
            const kecamatanCount = {};
            appData.forEach(item => {
                kecamatanCount[item.kecamatan] = (kecamatanCount[item.kecamatan] || 0) + 1;
            });
            
            if (window.distributionChart) {
                window.distributionChart.data.labels = Object.keys(kecamatanCount);
                window.distributionChart.data.datasets[0].data = Object.values(kecamatanCount);
                window.distributionChart.update();
            }
            
            // Update trend chart (per tahun)
            const tahunCount = {};
            appData.forEach(item => {
                tahunCount[item.tahunAnggaran] = (tahunCount[item.tahunAnggaran] || 0) + 1;
            });
            
            // Urutkan tahun
            const sortedYears = Object.keys(tahunCount).sort();
            const trendData = sortedYears.map(year => tahunCount[year]);
            
            if (window.trendChart) {
                window.trendChart.data.labels = sortedYears;
                window.trendChart.data.datasets[0].data = trendData;
                window.trendChart.update();
            }
            
            // Update jenis bantuan chart
            const jenisCount = {};
            appData.forEach(item => {
                jenisCount[item.jenisBantuan] = (jenisCount[item.jenisBantuan] || 0) + 1;
            });
            
            if (window.jenisBantuanChart) {
                window.jenisBantuanChart.data.labels = Object.keys(jenisCount);
                window.jenisBantuanChart.data.datasets[0].data = Object.values(jenisCount);
                window.jenisBantuanChart.update();
            }
        }
        
        // Fungsi untuk print to PDF
        function printToPdf() {
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF();
            
            // Add title
            doc.setFontSize(18);
            doc.text('LAPORAN DATA BANTUAN', 105, 15, { align: 'center' });
            
            // Add date
            doc.setFontSize(12);
            doc.text(`Tanggal Cetak: ${new Date().toLocaleDateString('id-ID')}`, 105, 22, { align: 'center' });
            
            // Get filtered data
            const dataToPrint = isFilterActive ? filteredData : appData;
            
            if (dataToPrint.length === 0) {
                doc.text('Tidak ada data untuk dicetak', 20, 30);
                doc.save('laporan-bantuan.pdf');
                return;
            }
            
            // Prepare table data
            const tableData = dataToPrint.map((item, index) => [
                index + 1,
                item.nama,
                item.nik,
                item.namaKelompok,
                item.tahunAnggaran,
                item.kecamatan,
                item.desa,
                `${item.jumlahBantuan} ${item.satuanBantuan}`,
                formatDate(item.tanggalTerima)
            ]);
            
            // Add table
            doc.autoTable({
                head: [['No', 'Nama', 'NIK', 'Kelompok', 'Tahun', 'Kecamatan', 'Desa', 'Jumlah', 'Tanggal']],
                body: tableData,
                startY: 30,
                theme: 'grid',
                styles: { fontSize: 8 },
                headStyles: { fillColor: [41, 128, 185] }
            });
            
            // Save PDF
            doc.save('laporan-bantuan.pdf');
            
            showNotification('PDF berhasil diunduh', 'success');
        }
        
        // Fungsi untuk print langsung
        function printDirect() {
            const dataToPrint = isFilterActive ? filteredData : appData;
            
            if (dataToPrint.length === 0) {
                showNotification('Tidak ada data untuk dicetak', 'warning');
                return;
            }
            
            // Create print content
            const printContent = `
                <!DOCTYPE html>
                <html>
                <head>
                    <title>Cetak Laporan Bantuan</title>
                    <style>
                        body { font-family: Arial, sans-serif; margin: 20px; }
                        h1 { text-align: center; margin-bottom: 20px; }
                        table { width: 100%; border-collapse: collapse; margin-bottom: 20px; }
                        th, td { border: 1px solid #ddd; padding: 8px; text-align: left; }
                        th { background-color: #f2f2f2; }
                        .print-date { text-align: right; margin-bottom: 20px; }
                    </style>
                </head>
                <body>
                    <h1>LAPORAN DATA BANTUAN</h1>
                    <div class="print-date">Tanggal Cetak: ${new Date().toLocaleDateString('id-ID')}</div>
                    <table>
                        <thead>
                            <tr>
                                <th>No</th>
                                <th>Nama</th>
                                <th>NIK</th>
                                <th>Kelompok</th>
                                <th>Tahun</th>
                                <th>Kecamatan</th>
                                <th>Desa</th>
                                <th>Jumlah</th>
                                <th>Tanggal</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${dataToPrint.map((item, index) => `
                                <tr>
                                    <td>${index + 1}</td>
                                    <td>${item.nama}</td>
                                    <td>${item.nik}</td>
                                    <td>${item.namaKelompok}</td>
                                    <td>${item.tahunAnggaran}</td>
                                    <td>${item.kecamatan}</td>
                                    <td>${item.desa}</td>
                                    <td>${item.jumlahBantuan} ${item.satuanBantuan}</td>
                                    <td>${formatDate(item.tanggalTerima)}</td>
                                </tr>
                            `).join('')}
                        </tbody>
                    </table>
                </body>
                </html>
            `;
            
            // Open print window
            const printWindow = window.open('', '_blank');
            printWindow.document.write(printContent);
            printWindow.document.close();
            printWindow.print();
        }
        
        // Fungsi untuk show preview
        function showPreview() {
            const dataToPreview = isFilterActive ? filteredData : appData;
            
            if (dataToPreview.length === 0) {
                showNotification('Tidak ada data untuk dipratinjau', 'warning');
                return;
            }
            
            const previewBody = document.getElementById('previewBody');
            if (!previewBody) return;
            
            previewBody.innerHTML = '';
            
            dataToPreview.forEach((item, index) => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${index + 1}</td>
                    <td>${item.nama}</td>
                    <td>${item.nik}</td>
                    <td>${item.namaKelompok}</td>
                    <td>${item.tahunAnggaran}</td>
                    <td>${item.kecamatan}</td>
                    <td>${item.desa}</td>
                    <td>${item.jenisBantuan}</td>
                    <td>${item.jumlahBantuan} ${item.satuanBantuan}</td>
                    <td>${formatDate(item.tanggalTerima)}</td>
                `;
                previewBody.appendChild(row);
            });
            
            // Update preview info
            const previewInfo = document.getElementById('previewInfo');
            if (previewInfo) {
                previewInfo.textContent = `Menampilkan ${dataToPreview.length} data`;
            }
            
            // Show preview modal
            const previewModal = new bootstrap.Modal(document.getElementById('previewModal'));
            previewModal.show();
        }
        
        // Fungsi untuk print dari preview
        function printFromPreview() {
            window.print();
        }
        
        // Fungsi untuk export ke Excel
        function exportToExcel() {
            const dataToExport = isFilterActive ? filteredData : appData;
            
            if (dataToExport.length === 0) {
                showNotification('Tidak ada data untuk diexport', 'warning');
                return;
            }
            
            // Prepare data for Excel
            const excelData = dataToExport.map(item => ({
                'Nama': item.nama,
                'NIK': item.nik,
                'WhatsApp': item.whatsapp,
                'Nama Kelompok': item.namaKelompok,
                'Jabatan': item.jabatan,
                'Tahun Anggaran': item.tahunAnggaran,
                'Kecamatan': item.kecamatan,
                'Desa': item.desa,
                'Alamat': item.alamat || '',
                'Jenis Bantuan': item.jenisBantuan,
                'Jumlah Bantuan': item.jumlahBantuan,
                'Satuan Bantuan': item.satuanBantuan,
                'Tanggal Terima': formatDate(item.tanggalTerima),
                'Link Google Drive': item.driveLink || '',
                'Kode Validasi': item.kodeValidasi,
                'Keterangan': item.keterangan || ''
            }));
            
            // Create worksheet
            const worksheet = XLSX.utils.json_to_sheet(excelData);
            
            // Create workbook
            const workbook = XLSX.utils.book_new();
            XLSX.utils.book_append_sheet(workbook, worksheet, 'Data Bantuan');
            
            // Export to Excel
            XLSX.writeFile(workbook, 'data-bantuan.xlsx');
            
            showNotification('Data berhasil diexport ke Excel', 'success');
        }
        
        // Fungsi untuk export ke CSV
        function exportToCsv() {
            const dataToExport = isFilterActive ? filteredData : appData;
            
            if (dataToExport.length === 0) {
                showNotification('Tidak ada data untuk diexport', 'warning');
                return;
            }
            
            // Prepare headers
            const headers = [
                'Nama', 'NIK', 'WhatsApp', 'Nama Kelompok', 'Jabatan', 
                'Tahun Anggaran', 'Kecamatan', 'Desa', 'Alamat', 
                'Jenis Bantuan', 'Jumlah Bantuan', 'Satuan Bantuan', 
                'Tanggal Terima', 'Link Google Drive', 'Kode Validasi', 'Keterangan'
            ];
            
            // Prepare data rows
            const csvData = dataToExport.map(item => [
                item.nama,
                item.nik,
                item.whatsapp,
                item.namaKelompok,
                item.jabatan,
                item.tahunAnggaran,
                item.kecamatan,
                item.desa,
                item.alamat || '',
                item.jenisBantuan,
                item.jumlahBantuan,
                item.satuanBantuan,
                formatDate(item.tanggalTerima),
                item.driveLink || '',
                item.kodeValidasi,
                item.keterangan || ''
            ]);
            
            // Combine headers and data
            const csvContent = [headers, ...csvData]
                .map(row => row.map(field => `"${field}"`).join(','))
                .join('\n');
            
            // Create download link
            const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement('a');
            const url = URL.createObjectURL(blob);
            
            link.setAttribute('href', url);
            link.setAttribute('download', 'data-bantuan.csv');
            link.style.visibility = 'hidden';
            
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            
            showNotification('Data berhasil diexport ke CSV', 'success');
        }
        
        // Fungsi untuk export ke JSON
        function exportToJson() {
            const dataToExport = isFilterActive ? filteredData : appData;
            
            if (dataToExport.length === 0) {
                showNotification('Tidak ada data untuk diexport', 'warning');
                return;
            }
            
            // Create JSON string
            const jsonString = JSON.stringify(dataToExport, null, 2);
            
            // Create download link
            const blob = new Blob([jsonString], { type: 'application/json' });
            const link = document.createElement('a');
            const url = URL.createObjectURL(blob);
            
            link.setAttribute('href', url);
            link.setAttribute('download', 'data-bantuan.json');
            link.style.visibility = 'hidden';
            
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            
            showNotification('Data berhasil diexport ke JSON', 'success');
        }
        
        // Fungsi untuk export ke PDF
        function exportToPdf() {
            printToPdf(); // Reuse the printToPdf function
        }
        
        // Fungsi untuk backup data
        function backupData() {
            // Create backup object with data and metadata
            const backup = {
                appData: appData,
                generatedCodes: generatedCodes,
                backupDate: new Date().toISOString(),
                version: '1.0'
            };
            
            // Create JSON string
            const jsonString = JSON.stringify(backup, null, 2);
            
            // Create download link
            const blob = new Blob([jsonString], { type: 'application/json' });
            const link = document.createElement('a');
            const url = URL.createObjectURL(blob);
            
            link.setAttribute('href', url);
            link.setAttribute('download', `backup-barjas-${new Date().toISOString().split('T')[0]}.json`);
            link.style.visibility = 'hidden';
            
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            
            showNotification('Backup data berhasil dibuat', 'success');
        }
        
        // Fungsi untuk enable restore button
        function enableRestoreButton() {
            const fileInput = document.getElementById('restoreFileInput');
            const restoreButton = document.getElementById('restoreDataBtn');
            
            if (fileInput && restoreButton) {
                restoreButton.disabled = !fileInput.files || fileInput.files.length === 0;
            }
        }
        
        // Fungsi untuk restore data
        function restoreData() {
            const fileInput = document.getElementById('restoreFileInput');
            
            if (!fileInput.files || fileInput.files.length === 0) {
                showNotification('Pilih file backup terlebih dahulu', 'error');
                return;
            }
            
            const file = fileInput.files[0];
            const reader = new FileReader();
            
            reader.onload = function(e) {
                try {
                    const backup = JSON.parse(e.target.result);
                    
                    // Validate backup file
                    if (!backup.appData || !backup.generatedCodes) {
                        throw new Error('Format file backup tidak valid');
                    }
                    
                    // Confirm restoration
                    if (confirm('Apakah Anda yakin ingin memulihkan data dari backup? Data saat ini akan digantikan.')) {
                        appData = backup.appData;
                        generatedCodes = backup.generatedCodes;
                        
                        saveData();
                        
                        // Update UI
                        updateDashboard();
                        renderDataTable();
                        
                        showNotification('Data berhasil dipulihkan dari backup', 'success');
                        
                        // Reset file input
                        fileInput.value = '';
                        document.getElementById('restoreDataBtn').disabled = true;
                    }
                } catch (error) {
                    console.error('Error restoring backup:', error);
                    showNotification('Gagal memulihkan data: ' + error.message, 'error');
                }
            };
            
            reader.onerror = function() {
                showNotification('Gagal membaca file backup', 'error');
            };
            
            reader.readAsText(file);
        }
        
        // Fungsi untuk enable reset button
        function enableResetButton() {
            const confirmationInput = document.getElementById('resetConfirmationInput');
            const resetButton = document.getElementById('confirmResetBtn');
            
            if (confirmationInput && resetButton) {
                resetButton.disabled = confirmationInput.value.toLowerCase() !== 'reset data';
            }
        }
        
        // Fungsi untuk reset data
        function resetData() {
            // Clear all data
            appData = [];
            generatedCodes = {};
            
            saveData();
            
            // Update UI
            updateDashboard();
            renderDataTable();
            
            // Close modal
            const resetModal = bootstrap.Modal.getInstance(document.getElementById('confirmResetModal'));
            if (resetModal) {
                resetModal.hide();
            }
            
            // Reset confirmation input
            document.getElementById('resetConfirmationInput').value = '';
            document.getElementById('confirmResetBtn').disabled = true;
            
            showNotification('Semua data berhasil direset', 'success');
        }
        
        // Fungsi untuk save settings
        function saveSettings(e) {
            e.preventDefault();
            
            // Get settings values
            const defaultTahun = document.getElementById('defaultTahun').value;
            const itemsPerPageSetting = document.getElementById('itemsPerPage').value;
            
            // Save to localStorage
            localStorage.setItem('barjasDefaultTahun', defaultTahun);
            localStorage.setItem('barjasItemsPerPage', itemsPerPageSetting);
            
            // Update current items per page
            itemsPerPage = parseInt(itemsPerPageSetting) || 25;
            
            // Update UI
            renderDataTable();
            
            showNotification('Pengaturan berhasil disimpan', 'success');
        }
        
        // Fungsi untuk toggle mobile menu
        function toggleMobileMenu() {
            const sidebar = document.getElementById('sidebar');
            const overlay = document.getElementById('sidebarOverlay');
            
            if (sidebar && overlay) {
                sidebar.classList.toggle('mobile-show');
                overlay.classList.toggle('show');
            }
        }
        
        // Fungsi untuk scroll to top
        function scrollToTop() {
            window.scrollTo({
                top: 0,
                behavior: 'smooth'
            });
        }
        
        // Fungsi untuk setup browser info
        function setupBrowserInfo() {
            const browserInfo = document.getElementById('browserInfo');
            if (!browserInfo) return;
            
            const userAgent = navigator.userAgent;
            let browserName = 'Browser tidak dikenali';
            
            if (userAgent.includes('Firefox')) {
                browserName = 'Mozilla Firefox';
            } else if (userAgent.includes('Chrome')) {
                browserName = 'Google Chrome';
            } else if (userAgent.includes('Safari')) {
                browserName = 'Apple Safari';
            } else if (userAgent.includes('Edge')) {
                browserName = 'Microsoft Edge';
            } else if (userAgent.includes('Opera')) {
                browserName = 'Opera';
            } else if (userAgent.includes('Trident')) {
                browserName = 'Internet Explorer';
            }
            
            browserInfo.textContent = `Browser: ${browserName}`;
        }
        
        // Fungsi untuk format tanggal
        function formatDate(dateString) {
            if (!dateString) return '-';
            
            const date = new Date(dateString);
            if (isNaN(date.getTime())) return dateString;
            
            return date.toLocaleDateString('id-ID', {
                day: '2-digit',
                month: '2-digit',
                year: 'numeric'
            });
        }
        
        // Fungsi untuk show notification
        function showNotification(message, type = 'info') {
            // Remove existing notifications
            const existingNotifications = document.querySelectorAll('.custom-notification');
            existingNotifications.forEach(notification => {
                notification.remove();
            });
            
            // Create notification element
            const notification = document.createElement('div');
            notification.className = `custom-notification custom-notification-${type}`;
            
            // Set icon based on type
            let icon = 'info-circle';
            if (type === 'success') icon = 'check-circle';
            if (type === 'error') icon = 'exclamation-circle';
            if (type === 'warning') icon = 'exclamation-triangle';
            
            notification.innerHTML = `
                <div class="custom-notification-content">
                    <i class="fas fa-${icon}"></i>
                    <span>${message}</span>
                </div>
            `;
            
            // Add to document
            document.body.appendChild(notification);
            
            // Show notification
            setTimeout(() => {
                notification.classList.add('show');
            }, 10);
            
            // Auto remove after 5 seconds
            setTimeout(() => {
                notification.classList.remove('show');
                setTimeout(() => {
                    if (notification.parentNode) {
                        notification.parentNode.removeChild(notification);
                    }
                }, 300);
            }, 5000);
        }
    </script>
</body>
</html>
