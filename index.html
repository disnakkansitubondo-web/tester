<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>APLIKASI BARJAS - SISTEM BANTUAN</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-datepicker/1.9.0/css/bootstrap-datepicker.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.28/jspdf.plugin.autotable.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <style>
        :root {
            --primary-color: #0d47a1;
            --secondary-color: #00695c;
            --accent-color: #ff8f00;
            --light-blue: #e3f2fd;
            --dark-blue: #082e5c;
            --gradient-primary: linear-gradient(135deg, var(--primary-color), var(--dark-blue));
            --gradient-secondary: linear-gradient(135deg, var(--secondary-color), #004d40);
            --gradient-accent: linear-gradient(135deg, var(--accent-color), #e65100);
            --shadow-sm: 0 2px 8px rgba(0,0,0,0.08);
            --shadow-md: 0 4px 16px rgba(0,0,0,0.12);
            --shadow-lg: 0 8px 28px rgba(0,0,0,0.15);
            --login-gradient: linear-gradient(135deg, #0d47a1, #00695c, #ff8f00);
        }
        
        body {
            background: linear-gradient(135deg, #f5f9ff 0%, #e8f5e9 100%);
            font-family: 'Poppins', 'Segoe UI', sans-serif;
            min-height: 100vh;
            padding: 10px 0;
            overflow-x: hidden;
        }
        
        .app-container {
            max-width: 1600px;
            margin: 0 auto;
            background: white;
            box-shadow: var(--shadow-lg);
            border-radius: 12px;
            overflow: hidden;
            position: relative;
            z-index: 10;
        }
        
        .app-header {
            background: var(--gradient-primary);
            color: white;
            padding: 20px 15px;
            text-align: center;
            position: relative;
            overflow: hidden;
        }
        
        .app-header::before {
            content: "";
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(255,255,255,0.15) 0%, transparent 70%);
            pointer-events: none;
        }
        
        .app-logo {
            font-size: 2.5rem;
            margin-bottom: 10px;
            position: relative;
            z-index: 1;
        }
        
        .app-title {
            font-size: 1.8rem;
            font-weight: 800;
            margin: 0;
            position: relative;
            z-index: 1;
            text-shadow: 1px 1px 4px rgba(0,0,0,0.3);
        }
        
        .app-subtitle {
            font-size: 1rem;
            opacity: 0.95;
            position: relative;
            z-index: 1;
            font-weight: 300;
            letter-spacing: 0.5px;
            margin-bottom: 5px;
        }
        
        .nav-pills .nav-link {
            border-radius: 8px;
            margin-bottom: 8px;
            padding: 12px 15px;
            font-weight: 500;
            color: #444;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            font-size: 0.9rem;
        }
        
        .nav-pills .nav-link:hover {
            background-color: #f0f7ff;
            transform: translateX(3px);
        }
        
        .nav-pills .nav-link.active {
            background: var(--gradient-primary);
            font-weight: 600;
            box-shadow: var(--shadow-md);
            transform: translateX(3px);
            color: white;
        }
        
        .section-title {
            border-left: 4px solid var(--primary-color);
            padding-left: 12px;
            margin: 20px 0;
            font-weight: 700;
            color: var(--dark-blue);
            font-size: 1.4rem;
            position: relative;
        }
        
        .section-title::after {
            content: "";
            position: absolute;
            bottom: -5px;
            left: 12px;
            width: 40px;
            height: 2px;
            background: var(--gradient-primary);
            border-radius: 2px;
        }
        
        .btn-primary {
            background: var(--gradient-primary);
            border: none;
            padding: 10px 20px;
            font-weight: 600;
            box-shadow: var(--shadow-md);
            border-radius: 8px;
            transition: all 0.3s;
            font-size: 0.9rem;
        }
        
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-lg);
        }
        
        .btn-success {
            background: var(--gradient-secondary);
            border: none;
            padding: 10px 20px;
            font-weight: 600;
            box-shadow: var(--shadow-md);
            border-radius: 8px;
            transition: all 0.3s;
            font-size: 0.9rem;
        }
        
        .btn-success:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-lg);
        }
        
        .btn-warning {
            background: var(--gradient-accent);
            border: none;
            padding: 10px 20px;
            font-weight: 600;
            box-shadow: var(--shadow-md);
            border-radius: 8px;
            transition: all 0.3s;
            font-size: 0.9rem;
        }
        
        .btn-warning:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-lg);
        }
        
        .form-label {
            font-weight: 600;
            color: #444;
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            font-size: 0.9rem;
        }
        
        .form-label i {
            margin-right: 6px;
            color: var(--primary-color);
        }
        
        .form-control, .form-select {
            border-radius: 8px;
            padding: 12px 15px;
            border: 1px solid #ddd;
            transition: all 0.3s;
            box-shadow: var(--shadow-sm);
            font-size: 0.9rem;
        }
        
        .form-control:focus, .form-select:focus {
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(13, 71, 161, 0.2);
            transform: translateY(-2px);
        }
        
        .copyright {
            text-align: center;
            padding: 20px;
            background-color: var(--light-blue);
            color: var(--dark-blue);
            font-size: 0.9rem;
            font-weight: 500;
        }
        
        .data-table {
            font-size: 0.85rem;
            border-collapse: separate;
            border-spacing: 0;
            box-shadow: var(--shadow-sm);
            border-radius: 8px;
            overflow: hidden;
        }
        
        .data-table th {
            background: var(--gradient-primary);
            color: white;
            font-weight: 600;
            padding: 12px 10px;
            text-align: center;
            position: relative;
            font-size: 0.85rem;
        }
        
        .data-table th::after {
            content: "";
            position: absolute;
            bottom: 0;
            left: 0;
            width: 100%;
            height: 1px;
            background: rgba(255,255,255,0.3);
        }
        
        .data-table td {
            padding: 10px 8px;
            vertical-align: middle;
            border-bottom: 1px solid #eee;
            font-size: 0.85rem;
        }
        
        .data-table tr:nth-child(even) {
            background-color: #f9fbff;
        }
        
        .data-table tr:hover {
            background-color: #edf5ff;
        }
        
        .feature-icon {
            font-size: 1.1rem;
            margin-right: 8px;
            width: 24px;
            text-align: center;
        }
        
        .card {
            border-radius: 10px;
            border: none;
            box-shadow: var(--shadow-md);
            transition: all 0.3s ease;
            overflow: hidden;
            margin-bottom: 15px;
        }
        
        .card:hover {
            transform: translateY(-5px);
            box-shadow: var(--shadow-lg);
        }
        
        .card-header {
            border-radius: 10px 10px 0 0 !important;
            font-weight: 600;
            padding: 15px 20px;
            background: var(--gradient-primary);
            color: white;
            font-size: 0.95rem;
        }
        
        .stats-box {
            text-align: center;
            padding: 20px 15px;
            border-radius: 10px;
            background: white;
            box-shadow: var(--shadow-md);
            transition: all 0.3s;
            position: relative;
            overflow: hidden;
            margin-bottom: 15px;
        }
        
        .stats-box::before {
            content: "";
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 4px;
            background: var(--gradient-primary);
            border-radius: 2px;
        }
        
        .stats-box:hover {
            transform: translateY(-3px);
            box-shadow: var(--shadow-lg);
        }
        
        .stats-number {
            font-size: 1.8rem;
            font-weight: 800;
            color: var(--primary-color);
            margin: 10px 0;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.1);
        }
        
        .stats-label {
            font-size: 0.9rem;
            color: #666;
            font-weight: 500;
        }
        
        .notification-toast {
            position: fixed;
            bottom: 20px;
            right: 20px;
            z-index: 1050;
            min-width: 280px;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: var(--shadow-lg);
            max-width: calc(100vw - 40px);
        }
        
        .input-error {
            border-color: #dc3545;
            box-shadow: 0 0 0 3px rgba(220, 53, 69, 0.2);
        }
        
        .error-message {
            color: #dc3545;
            font-size: 0.8rem;
            margin-top: 5px;
            display: none;
            font-weight: 500;
        }
        
        .watermark {
            position: absolute;
            bottom: 10px;
            right: 15px;
            opacity: 0.8;
            font-size: 0.8rem;
            color: white;
            font-weight: 300;
        }
        
        .control-panel {
            background: #f8f9fa;
            border-radius: 8px;
            padding: 15px;
            margin-top: 15px;
            box-shadow: var(--shadow-sm);
        }
        
        .control-title {
            font-size: 1rem;
            color: var(--primary-color);
            font-weight: 600;
            margin-bottom: 15px;
            padding-bottom: 8px;
            border-bottom: 1px solid var(--light-blue);
        }
        
        .floating-action-btn {
            position: fixed;
            bottom: 20px;
            right: 20px;
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background: var(--gradient-primary);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: var(--shadow-lg);
            z-index: 1000;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .floating-action-btn:hover {
            transform: scale(1.1) rotate(90deg);
        }
        
        .filter-section {
            background: white;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 20px;
            box-shadow: var(--shadow-sm);
        }
        
        .badge-custom {
            background: var(--gradient-primary);
            color: white;
            padding: 6px 12px;
            border-radius: 16px;
            font-weight: 600;
            font-size: 0.8rem;
        }
        
        .mobile-menu-btn {
            display: none;
            position: fixed;
            top: 15px;
            left: 15px;
            z-index: 1050;
            background: var(--gradient-primary);
            color: white;
            border: none;
            border-radius: 50%;
            width: 45px;
            height: 45px;
            box-shadow: var(--shadow-lg);
        }
        
        .sidebar-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 1040;
        }
        
        /* Animations */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .animate-fadeIn {
            animation: fadeIn 0.5s ease forwards;
        }
        
        /* Custom scrollbar */
        ::-webkit-scrollbar {
            width: 6px;
        }
        
        ::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 8px;
        }
        
        ::-webkit-scrollbar-thumb {
            background: var(--primary-color);
            border-radius: 8px;
        }
        
        ::-webkit-scrollbar-thumb:hover {
            background: var(--dark-blue);
        }
        
        /* Responsive styles */
        @media (max-width: 991.98px) {
            .col-md-3.col-lg-2 {
                position: fixed;
                left: -300px;
                top: 0;
                bottom: 0;
                z-index: 1050;
                width: 280px;
                transition: left 0.3s ease;
                overflow-y: auto;
                padding-top: 60px;
            }
            
            .col-md-3.col-lg-2.mobile-show {
                left: 0;
            }
            
            .col-md-9.col-lg-10 {
                width: 100%;
                flex: 0 0 100%;
                max-width: 100%;
            }
            
            .mobile-menu-btn {
                display: flex;
                align-items: center;
                justify-content: center;
            }
            
            .sidebar-overlay.mobile-show {
                display: block;
            }
        }
        
        /* Print Styles - IMPROVED FOR LANDSCAPE */
        @media print {
            @page {
                size: landscape;
                margin: 0.5cm;
            }
            
            body * {
                visibility: hidden;
            }
            
            .app-container, .app-container * {
                visibility: visible;
            }
            
            .app-container {
                position: absolute;
                left: 0;
                top: 0;
                width: 100%;
                box-shadow: none;
            }
            
            .nav-pills, .mobile-menu-btn, .sidebar-overlay, .floating-action-btn,
            .btn-group, .filter-section, .toast {
                display: none !important;
            }
            
            .col-md-3.col-lg-2.p-4.bg-light {
                display: none !important;
            }
            
            .col-md-9.col-lg-10.p-5 {
                width: 100%;
                flex: 0 0 100%;
                max-width: 100%;
                padding: 0 !important;
            }
            
            .copyright {
                display: none;
            }
            
            .data-table {
                font-size: 10px;
                width: 100% !important;
            }
            
            .data-table th, .data-table td {
                padding: 4px 2px;
            }
            
            /* Sembunyikan kolom aksi dan link Google Drive saat mencetak */
            .data-table th:last-child,
            .data-table td:last-child {
                display: none !important;
            }
            
            /* Judul untuk laporan cetak */
            .print-header {
                display: block !important;
                text-align: center;
                margin-bottom: 15px;
            }
            
            .print-title {
                font-size: 18px;
                font-weight: bold;
                margin-bottom: 5px;
            }
            
            .print-subtitle {
                font-size: 14px;
                margin-bottom: 10px;
            }
            
            .print-date {
                font-size: 12px;
                text-align: right;
                margin-bottom: 10px;
            }
        }

        /* WhatsApp link style */
        .whatsapp-link {
            color: #25D366;
            text-decoration: none;
        }
        
        .whatsapp-link:hover {
            text-decoration: underline;
        }
        
        /* View Link Button */
        .btn-view {
            background: linear-gradient(135deg, #17a2b8, #138496);
            color: white;
            border: none;
            padding: 5px 10px;
            border-radius: 4px;
            font-size: 0.8rem;
        }
        
        .btn-view:hover {
            background: linear-gradient(135deg, #138496, #117a8b);
            color: white;
        }
        
        /* Undo Button */
        .btn-undo {
            background: linear-gradient(135deg, #6c757d, #5a6268);
            color: white;
            border: none;
        }
        
        .btn-undo:hover {
            background: linear-gradient(135deg, #5a6268, #4e555b);
            color: white;
        }
        
        /* WhatsApp number link in table */
        .whatsapp-number {
            color: #25D366;
            cursor: pointer;
            text-decoration: underline;
        }
        
        /* Welcome Modal Styles */
        .welcome-modal .modal-content {
            border-radius: 15px;
            overflow: hidden;
            border: none;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }
        
        .welcome-header {
            background: var(--gradient-primary);
            color: white;
            text-align: center;
            padding: 25px;
        }
        
        .welcome-icon {
            font-size: 3rem;
            margin-bottom: 15px;
            color: white;
        }
        
        .welcome-body {
            padding: 25px;
            text-align: center;
        }
        
        .welcome-footer {
            background: #f8f9fa;
            padding: 15px;
            text-align: center;
            border-top: 1px solid #eee;
        }
        
        .countdown-timer {
            font-size: 0.9rem;
            color: #6c757d;
            margin-top: 10px;
        }
        
        /* Button untuk cetak per data */
        .btn-print-individual {
            background: linear-gradient(135deg, #6f42c1, #5a2d95);
            color: white;
            border: none;
            padding: 5px 10px;
            border-radius: 4px;
            font-size: 0.8rem;
        }
        
        .btn-print-individual:hover {
            background: linear-gradient(135deg, #5a2d95, #4a2479);
            color: white;
        }
        
        /* Developer Info Styles */
        .developer-info {
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            border-radius: 10px;
            padding: 15px;
            margin-top: 20px;
            box-shadow: var(--shadow-sm);
        }
        
        .developer-info h6 {
            color: var(--primary-color);
            font-weight: 600;
            margin-bottom: 15px;
            padding-bottom: 8px;
            border-bottom: 1px solid #ddd;
        }
        
        .developer-contact p {
            margin-bottom: 8px;
            font-size: 0.85rem;
        }
        
        .developer-contact a {
            color: var(--primary-color);
            text-decoration: none;
            transition: all 0.3s;
        }
        
        .developer-contact a:hover {
            color: var(--dark-blue);
            text-decoration: underline;
        }
        
        /* Loading spinner */
        .spinner-border-sm {
            width: 1rem;
            height: 1rem;
        }

        /* Login Modal Styles */
        .login-modal .modal-content {
            border-radius: 15px;
            overflow: hidden;
            border: none;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
        }

        .login-header {
            background: var(--login-gradient);
            color: white;
            text-align: center;
            padding: 25px 20px;
            position: relative;
        }

        .login-icon {
            font-size: 3rem;
            margin-bottom: 15px;
            color: white;
        }

        .login-title {
            font-size: 1.8rem;
            font-weight: 700;
            margin: 0;
        }

        .login-subtitle {
            font-size: 1rem;
            opacity: 0.9;
            margin: 5px 0 0;
        }

        .login-body {
            padding: 25px;
            position: relative;
            z-index: 1;
        }

        .login-form-group {
            margin-bottom: 20px;
        }

        .login-form-label {
            font-weight: 600;
            color: var(--dark-blue);
            margin-bottom: 8px;
            display: flex;
            align-items: center;
        }

        .login-form-label i {
            margin-right: 10px;
            color: var(--dark-blue);
        }

        .login-form-control {
            border-radius: 8px;
            padding: 12px 15px;
            border: 2px solid #ddd;
            transition: all 0.3s;
        }

        .login-form-control:focus {
            border-color: var(--dark-blue);
            box-shadow: 0 0 0 3px rgba(13, 71, 161, 0.2);
        }

        .login-input-group-text {
            background: var(--light-blue);
            border: 2px solid #ddd;
            border-left: none;
        }

        .btn-login {
            background: var(--gradient-secondary);
            color: white;
            border: none;
            padding: 12px;
            font-weight: 600;
            border-radius: 8px;
            width: 100%;
            transition: all 0.3s;
            margin-top: 10px;
        }

        .btn-login:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 105, 92, 0.4);
        }

        .btn-login:disabled {
            background: #ccc;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        .login-security-notice {
            text-align: center;
            margin-top: 20px;
            font-size: 0.85rem;
            color: #666;
        }

        .login-attempts-count {
            text-align: center;
            font-size: 0.9rem;
            color: #ff8f00;
            font-weight: 500;
            margin-top: 5px;
        }

        .login-blocked-message {
            text-align: center;
            background: rgba(220, 53, 69, 0.1);
            border-radius: 8px;
            padding: 15px;
            margin-top: 20px;
            color: #dc3545;
            font-weight: 500;
        }

        .login-countdown {
            font-size: 1.2rem;
            font-weight: 700;
            color: var(--dark-blue);
        }

        .login-developer-info {
            background: var(--light-blue);
            border-radius: 10px;
            padding: 20px;
            margin-top: 25px;
            text-align: center;
        }

        .login-developer-logo {
            max-width: 180px;
            margin-bottom: 15px;
            border-radius: 8px;
        }

        .login-developer-contact a {
            color: var(--dark-blue);
            text-decoration: none;
            transition: all 0.3s;
            display: inline-block;
            margin: 5px 0;
        }

        .login-developer-contact a:hover {
            color: var(--primary-color);
            text-decoration: underline;
            transform: translateY(-2px);
        }

        .login-copyright {
            text-align: center;
            margin-top: 20px;
            color: #666;
            font-size: 0.9rem;
            opacity: 0.9;
        }

        /* Animations */
        @keyframes login-shake {
            0%, 100% { transform: translateX(0); }
            10%, 30%, 50%, 70%, 90% { transform: translateX(-10px); }
            20%, 40%, 60%, 80% { transform: translateX(10px); }
        }

        .login-shake {
            animation: login-shake 0.6s cubic-bezier(.36,.07,.19,.97) both;
        }

        /* Login particle background */
        #login-particles {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 1040; /* Higher than modal backdrop */
            display: none;
        }

        /* Link Google Drive dalam tabel */
        .drive-link {
            color: #0d47a1;
            text-decoration: none;
            cursor: pointer;
        }

        .drive-link:hover {
            text-decoration: underline;
        }

        /* Modal untuk menambah link */
        .link-modal .modal-dialog {
            max-width: 600px;
        }
        
        /* App content when not authenticated */
        .app-content-unauthenticated {
            display: none;
        }

        /* Search box for desa dropdown */
        .dropdown-search-container {
            position: relative;
        }

        .dropdown-search {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            z-index: 1000;
            background: white;
            border: 1px solid #ddd;
            border-radius: 8px;
            padding: 8px;
            display: none;
        }

        .dropdown-search input {
            width: 100%;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
        }

        /* Kode Validasi Styles */
        .kode-validasi-container {
            display: flex;
            align-items: center;
        }
        
        .kode-validasi-input {
            flex: 1;
            margin-right: 10px;
        }
        
        .btn-generate-kode {
            white-space: nowrap;
        }

        /* Auto-fill button styles */
        .btn-auto-fill {
            background: linear-gradient(135deg, #6c757d, #5a6268);
            color: white;
            border: none;
            padding: 10px 15px;
            border-radius: 8px;
            font-size: 0.85rem;
            margin-top: 8px;
        }
        
        .btn-auto-fill:hover {
            background: linear-gradient(135deg, #5a6268, #4e555b);
            color: white;
        }

        .login-hint {
            font-size: 0.85rem;
            color: #0d6efd;
            margin-top: 5px;
            text-align: center;
            background-color: #f8f9fa;
            padding: 8px;
            border-radius: 4px;
            border-left: 3px solid #0d6efd;
        }

        /* New styles for additional fields */
        .btn-not-group {
            background: linear-gradient(135deg, #6c757d, #5a6268);
            color: white;
            border: none;
            padding: 10px 15px;
            border-radius: 8px;
            font-size: 0.85rem;
            margin-top: 8px;
        }
        
        .btn-not-group:hover {
            background: linear-gradient(135deg, #5a6268, #4e555b);
            color: white;
        }

        .jenis-bantuan-container {
            display: flex;
            gap: 10px;
        }

        .jenis-bantuan-container select,
        .jenis-bantuan-container input {
            flex: 1;
        }

        /* WhatsApp input styling */
        .whatsapp-input-container {
            position: relative;
        }

        .whatsapp-prefix {
            position: absolute;
            left: 10px;
            top: 50%;
            transform: translateY(-50%);
            color: #25D366;
            font-weight: bold;
        }

        .whatsapp-input {
            padding-left: 30px;
        }

        /* Agreement checkbox */
        .agreement-check {
            margin-top: 15px;
            padding: 10px;
            background-color: #f8f9fa;
            border-radius: 8px;
        }
    </style>
</head>
<body>
     <!-- Login Modal -->
    <div class="modal fade login-modal" id="loginModal" tabindex="-1" aria-hidden="true" data-bs-backdrop="static" data-bs-keyboard="false">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="login-header">
                    <div class="login-icon">
                        <i class="fas fa-lock"></i>
                    </div>
                    <h2 class="login-title">AUTHENTICATION REQUIRED</h2>
                    <p class="login-subtitle">Masukkan Kode Keamanan untuk Mengakses Aplikasi</p>
                </div>
                <div class="login-body">
                    <form id="loginForm">
                        <div class="mb-3 login-form-group">
                            <label class="form-label login-form-label">
                                <i class="fas fa-key"></i> Kode Keamanan
                            </label>
                            <div class="input-group">
                                <input type="password" class="form-control login-form-control" id="securityCode" placeholder="Masukkan kode akses aplikasi">
                                <button class="btn btn-outline-secondary toggle-password" type="button">
                                    <i class="fas fa-eye"></i>
                                </button>
                            </div>
                            <div class="form-text text-danger login-attempts-count" id="attemptsCount"></div>
                            <div class="login-hint">
                                <i class="fas fa-lightbulb"></i> Kode default: 1234
                            </div>
                        </div>
                        
                        <!-- Form Nama Petugas setelah login berhasil -->
                        <div class="mb-3 login-form-group" id="petugasForm" style="display: none;">
                            <label class="form-label login-form-label">
                                <i class="fas fa-user"></i> Nama Petugas
                            </label>
                            <input type="text" class="form-control login-form-control" id="namaPetugas" placeholder="Masukkan nama petugas">
                            <div class="form-text">Nama petugas akan tersimpan untuk input data</div>
                        </div>

                        <!-- Checkbox Persetujuan -->
                        <div class="mb-3 agreement-check" id="agreementCheck" style="display: none;">
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" id="agreeTerms">
                                <label class="form-check-label" for="agreeTerms">
                                    Saya menyetujui syarat dan ketentuan penggunaan aplikasi ini
                                </label>
                            </div>
                            <div class="error-message" id="agreeTermsError">Anda harus menyetujui syarat dan ketentuan</div>
                        </div>
                        
                        <button type="submit" class="btn btn-login" id="loginButton" disabled>
                            <span class="login-button-text">Masuk ke Aplikasi</span>
                            <span class="spinner-border spinner-border-sm d-none" id="loginSpinner"></span>
                        </button>
                    </form>
                    
                    <div class="login-blocked-message d-none" id="blockedMessage">
                        <i class="fas fa-ban me-2"></i>
                        <span id="blockedText">Terlalu banyak percobaan gagal. Silakan coba lagi dalam </span>
                        <span class="login-countdown" id="countdown">30</span> detik.
                    </div>
                    
                    <div class="login-security-notice">
                        <i class="fas fa-info-circle me-2"></i>
                        Hubungi Administrator untuk mendapatkan kode akses
                    </div>
                    
                    <div class="login-developer-info">
                        <h5 class="mb-3">Developer Information</h5>
                        <div class="login-developer-contact">
                            <p><i class="fab fa-whatsapp me-2"></i> <a href="https://wa.me/6285647709114" target="_blank">+62 856-4770-9114</a></p>
                            <p><i class="fas fa-envelope me-2"></i> <a href="mailto:admin@anekamarket.my.id">admin@anekamarket.my.id</a></p>
                        </div>
                    </div>
                    
                    <div class="login-copyright">
                        &copy; 2025 Lentera karya Situbondo
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Login particle background -->
    <div id="login-particles"></div>
    
    <!-- Main Application Content (initially hidden) -->
    <div class="app-content-unauthenticated" id="appContent">
        <div class="app-container">
            <div class="app-header">
                <div class="app-logo">
                    <i class="fas fa-hands-helping"></i>
                </div>
                <h1 class="app-title">SISTEM BARJAS</h1>
                <p class="app-subtitle">Bantuan Langsung Masyarakat - Pemerintah Kabupaten Situbondo</p>
                <div class="watermark">v2.0.1 | 2025</div>
            </div>
            
            <div class="row g-0">
                <!-- Sidebar Navigation -->
                <div class="col-md-3 col-lg-2 p-4 bg-light">
                    <ul class="nav nav-pills flex-column" id="mainNav">
                        <li class="nav-item">
                            <a class="nav-link active" href="#" data-bs-target="dashboard">
                                <i class="fas fa-tachometer-alt feature-icon"></i> Dashboard
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="#" data-bs-target="inputData">
                                <i class="fas fa-pen-to-square feature-icon"></i> Input Data
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="#" data-bs-target="dataTables">
                                <i class="fas fa-table feature-icon"></i> Data Tables
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="#" data-bs-target="reports">
                                <i class="fas fa-chart-pie feature-icon"></i> Reports
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="#" data-bs-target="settings">
                                <i class="fas fa-cog feature-icon"></i> Settings
                            </a>
                        </li>
                        <li class="nav-item mt-4">
                            <a class="nav-link text-danger" href="#" id="logoutButton">
                                <i class="fas fa-sign-out-alt feature-icon"></i> Logout
                            </a>
                        </li>
                    </ul>
                    
                    <div class="developer-info">
                        <h6>Developer Contact</h6>
                        <div class="developer-contact">
                            <p><i class="fab fa-whatsapp"></i> <a href="https://wa.me/6285647709114" target="_blank" class="whatsapp-link">+62 856-4770-9114</a></p>
                            <p><i class="fas fa-envelope"></i> <a href="mailto:admin@anekamarket.my.id">admin@anekamarket.my.id</a></p>
                        </div>
                    </div>
                </div>
                
                <!-- Main Content -->
                <div class="col-md-9 col-lg-10 p-5">
                    <!-- Dashboard Section -->
                    <div class="content-section" id="dashboard">
                        <h3 class="section-title">Dashboard</h3>
                        
                        <div class="row">
                            <div class="col-md-3">
                                <div class="stats-box">
                                    <i class="fas fa-users fa-2x text-primary"></i>
                                    <div class="stats-number" id="totalPenerima">0</div>
                                    <div class="stats-label">Total Penerima</div>
                                </div>
                            </div>
                            <div class="col-md-3">
                                <div class="stats-box">
                                    <i class="fas fa-map-marker-alt fa-2x text-success"></i>
                                    <div class="stats-number" id="totalDesa">0</div>
                                    <div class="stats-label">Desa Terdata</div>
                                </div>
                            </div>
                            <div class="col-md-3">
                                <div class="stats-box">
                                    <i class="fas fa-money-bill-wave fa-2x text-warning"></i>
                                    <div class="stats-number" id="totalDana">0</div>
                                    <div class="stats-label">Total Dana Disalurkan</div>
                                </div>
                            </div>
                            <div class="col-md-3">
                                <div class="stats-box">
                                    <i class="fas fa-chart-line fa-2x text-info"></i>
                                    <div class="stats-number" id="avgPerPenerima">0</div>
                                    <div class="stats-label">Rata-rata per Penerima</div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="row mt-4">
                            <div class="col-md-6">
                                <div class="card">
                                    <div class="card-header">
                                        <i class="fas fa-chart-bar me-2"></i> Data per Desa
                                    </div>
                                    <div class="card-body">
                                        <canvas id="desaChart" height="250"></canvas>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="card">
                                    <div class="card-header">
                                        <i class="fas fa-chart-pie me-2"></i> Jenis Bantuan
                                    </div>
                                    <div class="card-body">
                                        <canvas id="jenisBantuanChart" height="250"></canvas>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Input Data Section -->
                    <div class="content-section d-none" id="inputData">
                        <h3 class="section-title">Input Data Penerima Bantuan</h3>
                        
                        <form id="dataForm">
                            <div class="row">
                                <div class="col-md-6">
                                    <div class="mb-3">
                                        <label class="form-label"><i class="fas fa-calendar"></i> Tahun Anggaran</label>
                                        <select class="form-select" id="tahunAnggaran" name="tahunAnggaran" required>
                                            <option value="" selected disabled>Pilih Tahun Anggaran</option>
                                            <!-- Tahun dari 2020 sampai 2090 -->
                                        </select>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="mb-3">
                                        <label class="form-label"><i class="fas fa-user"></i> Nama Petugas</label>
                                        <input type="text" class="form-control" id="inputNamaPetugas" name="inputNamaPetugas" readonly>
                                    </div>
                                </div>
                            </div>

                            <div class="row">
                                <div class="col-md-6">
                                    <div class="mb-3">
                                        <label class="form-label"><i class="fas fa-map-marker-alt"></i> Desa</label>
                                        <select class="form-select" id="desa" name="desa" required>
                                            <option value="" selected disabled>Pilih Desa</option>
                                            <!-- Opsi desa akan diisi oleh JavaScript -->
                                        </select>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="mb-3">
                                        <label class="form-label"><i class="fas fa-users"></i> Nama Kelompok</label>
                                        <input type="text" class="form-control text-uppercase" id="namaKelompok" name="namaKelompok" placeholder="Masukkan nama kelompok" required>
                                    </div>
                                </div>
                            </div>

                            <div class="row">
                                <div class="col-md-6">
                                    <div class="mb-3">
                                        <label class="form-label"><i class="fas fa-user-tie"></i> Jabatan</label>
                                        <select class="form-select" id="jabatan" name="jabatan" required>
                                            <option value="" selected disabled>Pilih Jabatan</option>
                                            <option value="Ketua Kelompok">Ketua Kelompok</option>
                                            <option value="Sekretaris">Sekretaris</option>
                                            <option value="Bendahara">Bendahara</option>
                                            <option value="Pengawas">Pengawas</option>
                                            <option value="Anggota">Anggota</option>
                                        </select>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="mb-3">
                                        <label class="form-label"><i class="fas fa-user"></i> Nama Penerima</label>
                                        <input type="text" class="form-control" id="namaPenerima" name="namaPenerima" placeholder="Masukkan nama lengkap penerima" required>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="row">
                                <div class="col-md-6">
                                    <div class="mb-3">
                                        <label class="form-label"><i class="fas fa-venus-mars"></i> Jenis Kelamin</label>
                                        <select class="form-select" id="jenisKelamin" name="jenisKelamin" required>
                                            <option value="" selected disabled>Pilih Jenis Kelamin</option>
                                            <option value="Laki-laki">Laki-laki</option>
                                            <option value="Perempuan">Perempuan</option>
                                        </select>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="mb-3">
                                        <label class="form-label"><i class="fas fa-id-card"></i> NIK</label>
                                        <input type="text" class="form-control" id="nik" name="nik" placeholder="Masukkan NIK" required>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="row">
                                <div class="col-md-6">
                                    <div class="mb-3">
                                        <label class="form-label"><i class="fas fa-phone"></i> Nomor WhatsApp</label>
                                        <div class="whatsapp-input-container">
                                            <span class="whatsapp-prefix">+62</span>
                                            <input type="text" class="form-control whatsapp-input" id="whatsapp" name="whatsapp" placeholder="812-3456-7890" required>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="mb-3">
                                        <label class="form-label"><i class="fas fa-home"></i> Alamat Lengkap</label>
                                        <input type="text" class="form-control" id="alamat" name="alamat" placeholder="Masukkan alamat lengkap" required>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="row">
                                <div class="col-md-6">
                                    <div class="mb-3">
                                        <label class="form-label"><i class="fas fa-hand-holding-usd"></i> Jenis Bantuan</label>
                                        <div class="jenis-bantuan-container">
                                            <select class="form-select" id="jenisBantuan" name="jenisBantuan" required>
                                                <option value="" selected disabled>Pilih Jenis</option>
                                                <option value="Tunai">Tunai</option>
                                                <option value="Non Tunai">Non Tunai</option>
                                            </select>
                                            <input type="text" class="form-control" id="detailBantuan" name="detailBantuan" placeholder="Detail bantuan" required>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="mb-3">
                                        <label class="form-label"><i class="fas fa-money-bill-wave"></i> Jumlah Bantuan (Rp)</label>
                                        <input type="text" class="form-control" id="jumlahBantuan" name="jumlahBantuan" placeholder="Masukkan jumlah bantuan" required>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="row">
                                <div class="col-md-6">
                                    <div class="mb-3">
                                        <label class="form-label"><i class="fas fa-calendar-day"></i> Tanggal Pencairan</label>
                                        <input type="date" class="form-control" id="tanggalPencairan" name="tanggalPencairan" required>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="mb-3">
                                        <label class="form-label"><i class="fas fa-link"></i> Link Google Drive</label>
                                        <input type="url" class="form-control" id="driveLink" name="driveLink" placeholder="https://drive.google.com/..." required>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="mb-3">
                                <label class="form-label"><i class="fas fa-sticky-note"></i> Keterangan</label>
                                <textarea class="form-control" id="keterangan" name="keterangan" rows="3" placeholder="Tambahkan keterangan jika diperlukan"></textarea>
                            </div>
                            
                            <div class="d-flex justify-content-between mt-4">
                                <button type="reset" class="btn btn-secondary">
                                    <i class="fas fa-undo me-2"></i> Reset Form
                                </button>
                                <button type="submit" class="btn btn-primary">
                                    <i class="fas fa-save me-2"></i> Simpan Data
                                </button>
                            </div>
                        </form>
                    </div>
                    
                    <!-- Data Tables Section -->
                    <div class="content-section d-none" id="dataTables">
                        <h3 class="section-title">Data Penerima Bantuan</h3>
                        
                        <div class="filter-section">
                            <div class="row">
                                <div class="col-md-3">
                                    <div class="mb-3">
                                        <label class="form-label"><i class="fas fa-filter"></i> Filter by Desa</label>
                                        <select class="form-select" id="filterDesa">
                                            <option value="">Semua Desa</option>
                                            <!-- Opsi desa akan diisi oleh JavaScript -->
                                        </select>
                                    </div>
                                </div>
                                <div class="col-md-3">
                                    <div class="mb-3">
                                        <label class="form-label"><i class="fas fa-filter"></i> Filter by Tahun</label>
                                        <select class="form-select" id="filterTahun">
                                            <option value="">Semua Tahun</option>
                                            <!-- Opsi tahun akan diisi oleh JavaScript -->
                                        </select>
                                    </div>
                                </div>
                                <div class="col-md-3">
                                    <div class="mb-3">
                                        <label class="form-label"><i class="fas fa-filter"></i> Filter by Jenis Bantuan</label>
                                        <select class="form-select" id="filterJenisBantuan">
                                            <option value="">Semua Jenis</option>
                                            <option value="Tunai">Tunai</option>
                                            <option value="Non Tunai">Non Tunai</option>
                                        </select>
                                    </div>
                                </div>
                                <div class="col-md-3">
                                    <div class="mb-3">
                                        <label class="form-label"><i class="fas fa-search"></i> Cari</label>
                                        <input type="text" class="form-control" id="searchInput" placeholder="Cari nama, desa, dll...">
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="table-responsive">
                            <table class="table table-hover data-table" id="dataTable">
                                <thead>
                                    <tr>
                                        <th>No</th>
                                        <th>Tahun</th>
                                        <th>Desa</th>
                                        <th>Nama Kelompok</th>
                                        <th>Jabatan</th>
                                        <th>Nama Penerima</th>
                                        <th>Jenis Kelamin</th>
                                        <th>NIK</th>
                                        <th>WhatsApp</th>
                                        <th>Alamat</th>
                                        <th>Jenis Bantuan</th>
                                        <th>Jumlah</th>
                                        <th>Tanggal</th>
                                        <th>Keterangan</th>
                                        <th>Drive</th>
                                        <th>Aksi</th>
                                    </tr>
                                </thead>
                                <tbody id="tableBody">
                                    <!-- Data akan diisi oleh JavaScript -->
                                </tbody>
                            </table>
                        </div>
                        
                        <div class="d-flex justify-content-between align-items-center mt-3">
                            <div class="fw-bold" id="tableInfo">Menampilkan 0 data</div>
                            <div>
                                <button class="btn btn-sm btn-outline-secondary me-2" id="prevPage">
                                    <i class="fas fa-chevron-left"></i> Sebelumnya
                                </button>
                                <span id="currentPage">1</span> / <span id="totalPages">1</span>
                                <button class="btn btn-sm btn-outline-secondary ms-2" id="nextPage">
                                    Selanjutnya <i class="fas fa-chevron-right"></i>
                                </button>
                            </div>
                            <div>
                                <button class="btn btn-success me-2" id="exportExcelBtn">
                                    <i class="fas fa-file-excel me-2"></i> Excel
                                </button>
                                <button class="btn btn-danger" id="exportPdfBtn">
                                    <i class="fas fa-file-pdf me-2"></i> PDF
                                </button>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Reports Section -->
                    <div class="content-section d-none" id="reports">
                        <h3 class="section-title">Laporan dan Statistik</h3>
                        
                        <div class="row">
                            <div class="col-md-6">
                                <div class="card">
                                    <div class="card-header">
                                        <i class="fas fa-print me-2"></i> Cetak Laporan
                                    </div>
                                    <div class="card-body">
                                        <form id="reportForm">
                                            <div class="mb-3">
                                                <label class="form-label"><i class="fas fa-calendar"></i> Tahun</label>
                                                <select class="form-select" id="reportTahun" name="reportTahun">
                                                    <option value="">Semua Tahun</option>
                                                    <!-- Opsi tahun akan diisi oleh JavaScript -->
                                                </select>
                                            </div>
                                            <div class="mb-3">
                                                <label class="form-label"><i class="fas fa-map-marker-alt"></i> Desa</label>
                                                <select class="form-select" id="reportDesa" name="reportDesa">
                                                    <option value="">Semua Desa</option>
                                                    <!-- Opsi desa akan diisi oleh JavaScript -->
                                                </select>
                                            </div>
                                            <div class="mb-3">
                                                <label class="form-label"><i class="fas fa-filter"></i> Jenis Bantuan</label>
                                                <select class="form-select" id="reportJenisBantuan" name="reportJenisBantuan">
                                                    <option value="">Semua Jenis</option>
                                                    <option value="Tunai">Tunai</option>
                                                    <option value="Non Tunai">Non Tunai</option>
                                                </select>
                                            </div>
                                            <button type="submit" class="btn btn-primary w-100">
                                                <i class="fas fa-print me-2"></i> Cetak Laporan
                                            </button>
                                        </form>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="card">
                                    <div class="card-header">
                                        <i class="fas fa-chart-line me-2"></i> Statistik Bantuan per Tahun
                                    </div>
                                    <div class="card-body">
                                        <canvas id="tahunChart" height="250"></canvas>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="card mt-4">
                            <div class="card-header">
                                <i class="fas fa-table me-2"></i> Ringkasan Data
                            </div>
                            <div class="card-body">
                                <div class="table-responsive">
                                    <table class="table table-bordered" id="summaryTable">
                                        <thead>
                                            <tr>
                                                <th>Tahun</th>
                                                <th>Jumlah Penerima</th>
                                                <th>Total Dana</th>
                                                <th>Rata-rata per Penerima</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            <!-- Data akan diisi oleh JavaScript -->
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Settings Section -->
                    <div class="content-section d-none" id="settings">
                        <h3 class="section-title">Pengaturan Aplikasi</h3>
                        
                        <div class="row">
                            <div class="col-md-6">
                                <div class="card">
                                    <div class="card-header">
                                        <i class="fas fa-key me-2"></i> Ubah Kode Keamanan
                                    </div>
                                    <div class="card-body">
                                        <form id="securityForm">
                                            <div class="mb-3">
                                                <label class="form-label">Kode Saat Ini</label>
                                                <input type="password" class="form-control" id="currentCode" required>
                                            </div>
                                            <div class="mb-3">
                                                <label class="form-label">Kode Baru</label>
                                                <input type="password" class="form-control" id="newCode" required>
                                            </div>
                                            <div class="mb-3">
                                                <label class="form-label">Konfirmasi Kode Baru</label>
                                                <input type="password" class="form-control" id="confirmCode" required>
                                            </div>
                                            <button type="submit" class="btn btn-primary">
                                                <i class="fas fa-save me-2"></i> Simpan Perubahan
                                            </button>
                                        </form>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="card">
                                    <div class="card-header">
                                        <i class="fas fa-database me-2"></i> Kelola Data
                                    </div>
                                    <div class="card-body">
                                        <div class="d-grid gap-2">
                                            <button class="btn btn-success mb-2" id="backupDataBtn">
                                                <i class="fas fa-download me-2"></i> Backup Data
                                            </button>
                                            <button class="btn btn-warning mb-2" id="restoreDataBtn">
                                                <i class="fas fa-upload me-2"></i> Restore Data
                                            </button>
                                            <input type="file" id="restoreFile" class="d-none" accept=".json">
                                            <button class="btn btn-danger" id="resetDataBtn">
                                                <i class="fas fa-trash me-2"></i> Reset Semua Data
                                            </button>
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="card mt-4">
                                    <div class="card-header">
                                        <i class="fas fa-info-circle me-2"></i> Informasi Aplikasi
                                    </div>
                                    <div class="card-body">
                                        <p><strong>Versi:</strong> 2.0.1</p>
                                        <p><strong>Dikembangkan oleh:</strong> Lentera Karya Situbondo</p>
                                        <p><strong>Kontak:</strong> 
                                            <a href="https://wa.me/6285647709114" target="_blank" class="whatsapp-link">
                                                <i class="fab fa-whatsapp me-1"></i> +62 856-4770-9114
                                            </a>
                                        </p>
                                        <p><strong>Email:</strong> 
                                            <a href="mailto:admin@anekamarket.my.id">admin@anekamarket.my.id</a>
                                        </p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="copyright">
                &copy; 2025 Aplikasi BARJAS - Bantuan Langsung Masyarakat. Hak Cipta Dilindungi.
            </div>
        </div>
    </div>
    
    <!-- Floating Action Button -->
    <div class="floating-action-btn" id="fab">
        <i class="fas fa-plus"></i>
    </div>
    
    <!-- Mobile Menu Button -->
    <button class="mobile-menu-btn" id="mobileMenuBtn">
        <i class="fas fa-bars"></i>
    </button>
    
    <!-- Sidebar Overlay for Mobile -->
    <div class="sidebar-overlay" id="sidebarOverlay"></div>
    
    <!-- Notification Toast -->
    <div class="toast notification-toast" role="alert" aria-live="assertive" aria-atomic="true" data-bs-autohide="true" data-bs-delay="5000">
        <div class="toast-header">
            <i class="fas fa-bell text-primary me-2"></i>
            <strong class="me-auto">Notifikasi</strong>
            <small>Baru saja</small>
            <button type="button" class="btn-close" data-bs-dismiss="toast" aria-label="Close"></button>
        </div>
        <div class="toast-body" id="toastMessage">
            Pesan notifikasi akan muncul di sini.
        </div>
    </div>
    
    <!-- Scripts -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-datepicker/1.9.0/js/bootstrap-datepicker.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.28/jspdf.plugin.autotable.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    
    <script>
        // Inisialisasi variabel global
        window.jsPDF = window.jspdf.jsPDF;
        let appData = [];
        let currentPage = 1;
        const itemsPerPage = 10;
        let loginAttempts = 0;
        let isBlocked = false;
        let namaPetugas = "";
        
        // Daftar desa yang lengkap
        const daftarDesa = [
            "Agel", "Alas Bayur", "Alasmalang", "Alastengah", "Arjasa", "Ardirejo", "Asembagus",
            "Awar-awar", "Awang-awang", "Baderan", "Balung", "Bantal", "Battal", "Bayeman", "Besuki", "Bletok", "Blimbing", "Bloro", "Buduan", "Bugeman", "Bungatan",
            "Campoan", "Cemara", "Curah Cottok", "Curah Jeru", "Curah Kalak", "Curah Suri", "Curah Tatal", "Dawuhan", "Demung", "Duwet", "Gadingan", "Gebangan",
            "Gelung", "Gudang", "Gunung Malang", "Gunung Putri", "Jangkar", "Jatisari", "Jatibanteng", "Jetis", "Juglangan", "Kalianget", "Kalibagor", "Kalimas",
            "Kalirejo", "Kalisari", "Kandang", "Kayu Putih", "Kayumas", "Kedungdowo", "Kedunglo", "Kembangsari", "Ketah", "Ketowan", "Kilensari", "Klampokan",
            "Klatakan", "Kotakan", "Kumbangsari", "Kukusan", "Lamongan", "Landangan", "Langkap", "Lebeng", "Lubawang", "Mangaran", "Mimbaan", "Mlandingan Kulon",
            "Mlandingan Wetan", "Mojodungkol", "Mojosari", "Olean", "Palangan", "Panarukan", "Panji Kidul", "Panji Lor", "Parante", "Pasir Putih", "Patemon",
            "Patokan", "Paowan", "Peleyan", "Pesisir", "Pesanggrahan", "Pategalan", "Patemon", "Plalangan", "Pokaan", "Rajekwesi", "Seletreng", "Selobanteng",
            "Selomukti", "Selowogo", "Semambung", "Semiring", "Sliwung", "Sopet", "Sumber Pinang", "Sumberanyar", "Sumberargo", "Sumberkolak", "Sumberejo",
            "Sumbertengah", "Sumberwaru", "Tamankursi", "Tamansari", "Taman", "Talkandang", "Tanjung Glugur", "Tanjung Kamal", "Tanjung Pecinan", "Tambak Ukir",
            "Telempong", "Tenggir", "Tepos", "Tokelan", "Tlogosari", "Trigonco", "Trebungan", "Widoropayung", "Wonokoyo", "Wonorejo", "Wringinanom"
        ];

        // Fungsi untuk menampilkan notifikasi
        function showToast(message, type = 'info') {
            const toast = document.querySelector('.notification-toast');
            const toastMessage = document.getElementById('toastMessage');
            
            // Set warna header berdasarkan tipe
            const toastHeader = toast.querySelector('.toast-header');
            toastHeader.classList.remove('bg-primary', 'bg-success', 'bg-warning', 'bg-danger');
            
            switch(type) {
                case 'success':
                    toastHeader.classList.add('bg-success', 'text-white');
                    break;
                case 'warning':
                    toastHeader.classList.add('bg-warning', 'text-dark');
                    break;
                case 'error':
                    toastHeader.classList.add('bg-danger', 'text-white');
                    break;
                default:
                    toastHeader.classList.add('bg-primary', 'text-white');
            }
            
            toastMessage.textContent = message;
            const bsToast = new bootstrap.Toast(toast);
            bsToast.show();
        }

        // Fungsi untuk memuat data dari localStorage
        function loadData() {
            const data = localStorage.getItem('barjasData');
            if (data) {
                appData = JSON.parse(data);
            } else {
                appData = [];
            }
            return appData;
        }

        // Fungsi untuk menyimpan data ke localStorage
        function saveData() {
            localStorage.setItem('barjasData', JSON.stringify(appData));
        }

        // Fungsi untuk memformat angka ke format Rupiah
        function formatRupiah(angka) {
            return new Intl.NumberFormat('id-ID', {
                style: 'currency',
                currency: 'IDR',
                minimumFractionDigits: 0
            }).format(angka);
        }

        // Fungsi untuk mengisi opsi tahun (2020-2090)
        function populateTahunOptions() {
            const tahunAnggaran = document.getElementById('tahunAnggaran');
            const filterTahun = document.getElementById('filterTahun');
            const reportTahun = document.getElementById('reportTahun');
            
            // Kosongkan opsi yang ada
            tahunAnggaran.innerHTML = '<option value="" selected disabled>Pilih Tahun Anggaran</option>';
            filterTahun.innerHTML = '<option value="">Semua Tahun</option>';
            reportTahun.innerHTML = '<option value="">Semua Tahun</option>';
            
            // Tambahkan opsi tahun dari 2020 hingga 2090
            for (let tahun = 2020; tahun <= 2090; tahun++) {
                const option = document.createElement('option');
                option.value = tahun;
                option.textContent = tahun;
                
                tahunAnggaran.appendChild(option.cloneNode(true));
                filterTahun.appendChild(option.cloneNode(true));
                reportTahun.appendChild(option);
            }
        }

        // Fungsi untuk mengisi opsi desa
        function populateDesaOptions() {
            const desaSelect = document.getElementById('desa');
            const filterDesa = document.getElementById('filterDesa');
            const reportDesa = document.getElementById('reportDesa');
            
            // Kosongkan opsi yang ada
            desaSelect.innerHTML = '<option value="" selected disabled>Pilih Desa</option>';
            filterDesa.innerHTML = '<option value="">Semua Desa</option>';
            reportDesa.innerHTML = '<option value="">Semua Desa</option>';
            
            // Tambahkan opsi desa
            daftarDesa.forEach(desa => {
                const option = document.createElement('option');
                option.value = desa;
                option.textContent = desa;
                
                desaSelect.appendChild(option.cloneNode(true));
                filterDesa.appendChild(option.cloneNode(true));
                reportDesa.appendChild(option.cloneNode(true));
            });
        }

        // Fungsi untuk mengisi data tabel
        function populateTable() {
            const tableBody = document.getElementById('tableBody');
            const filterDesa = document.getElementById('filterDesa').value;
            const filterTahun = document.getElementById('filterTahun').value;
            const filterJenisBantuan = document.getElementById('filterJenisBantuan').value;
            const searchInput = document.getElementById('searchInput').value.toLowerCase();
            
            // Filter data
            let filteredData = appData.filter(item => {
                return (
                    (filterDesa === '' || item.desa === filterDesa) &&
                    (filterTahun === '' || item.tahunAnggaran == filterTahun) &&
                    (filterJenisBantuan === '' || item.jenisBantuan === filterJenisBantuan) &&
                    (
                        item.namaPenerima.toLowerCase().includes(searchInput) ||
                        item.desa.toLowerCase().includes(searchInput) ||
                        item.nik.toLowerCase().includes(searchInput) ||
                        item.whatsapp.toLowerCase().includes(searchInput) ||
                        item.alamat.toLowerCase().includes(searchInput) ||
                        item.namaKelompok.toLowerCase().includes(searchInput) ||
                        item.jabatan.toLowerCase().includes(searchInput)
                    )
                );
            });
            
            // Hitung total halaman
            const totalPages = Math.ceil(filteredData.length / itemsPerPage);
            document.getElementById('totalPages').textContent = totalPages;
            document.getElementById('currentPage').textContent = currentPage;
            
            // Tampilkan info tabel
            document.getElementById('tableInfo').textContent = `Menampilkan ${filteredData.length} data`;
            
            // Tentukan data yang akan ditampilkan untuk halaman saat ini
            const startIndex = (currentPage - 1) * itemsPerPage;
            const endIndex = startIndex + itemsPerPage;
            const currentData = filteredData.slice(startIndex, endIndex);
            
            // Kosongkan tabel
            tableBody.innerHTML = '';
            
            // Isi tabel dengan data
            currentData.forEach((item, index) => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${startIndex + index + 1}</td>
                    <td>${item.tahunAnggaran}</td>
                    <td>${item.desa}</td>
                    <td>${item.namaKelompok}</td>
                    <td>${item.jabatan}</td>
                    <td>${item.namaPenerima}</td>
                    <td>${item.jenisKelamin}</td>
                    <td>${item.nik}</td>
                    <td>
                        <a href="https://wa.me/62${item.whatsapp}" target="_blank" class="whatsapp-number">
                            ${item.whatsapp}
                        </a>
                    </td>
                    <td>${item.alamat}</td>
                    <td>${item.jenisBantuan} - ${item.detailBantuan}</td>
                    <td>${formatRupiah(item.jumlahBantuan)}</td>
                    <td>${new Date(item.tanggalPencairan).toLocaleDateString('id-ID')}</td>
                    <td>${item.keterangan || '-'}</td>
                    <td>
                        <a href="${item.driveLink}" target="_blank" class="drive-link">
                            <i class="fas fa-external-link-alt"></i>
                        </a>
                    </td>
                    <td>
                        <button class="btn btn-sm btn-primary edit-btn" data-id="${item.id}">
                            <i class="fas fa-edit"></i>
                        </button>
                        <button class="btn btn-sm btn-danger delete-btn" data-id="${item.id}">
                            <i class="fas fa-trash"></i>
                        </button>
                    </td>
                `;
                tableBody.appendChild(row);
            });
            
            // Tambahkan event listener untuk tombol edit dan hapus
            document.querySelectorAll('.edit-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    const id = this.getAttribute('data-id');
                    editData(id);
                });
            });
            
            document.querySelectorAll('.delete-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    const id = this.getAttribute('data-id');
                    deleteData(id);
                });
            });
            
            // Nonaktifkan tombol navigasi jika diperlukan
            document.getElementById('prevPage').disabled = currentPage === 1;
            document.getElementById('nextPage').disabled = currentPage === totalPages || totalPages === 0;
        }

        // Fungsi untuk menambah data baru
        function addData(data) {
            data.id = Date.now().toString(); // ID unik berdasarkan timestamp
            appData.push(data);
            saveData();
            showToast('Data berhasil ditambahkan', 'success');
            updateDashboard();
            populateTable();
        }

        // Fungsi untuk mengedit data
        function editData(id) {
            const data = appData.find(item => item.id === id);
            if (data) {
                // Isi form dengan data yang akan diedit
                document.getElementById('tahunAnggaran').value = data.tahunAnggaran;
                document.getElementById('desa').value = data.desa;
                document.getElementById('namaKelompok').value = data.namaKelompok;
                document.getElementById('jabatan').value = data.jabatan;
                document.getElementById('namaPenerima').value = data.namaPenerima;
                document.getElementById('jenisKelamin').value = data.jenisKelamin;
                document.getElementById('nik').value = data.nik;
                document.getElementById('whatsapp').value = data.whatsapp;
                document.getElementById('alamat').value = data.alamat;
                document.getElementById('jenisBantuan').value = data.jenisBantuan;
                document.getElementById('detailBantuan').value = data.detailBantuan;
                document.getElementById('jumlahBantuan').value = data.jumlahBantuan;
                document.getElementById('tanggalPencairan').value = data.tanggalPencairan;
                document.getElementById('driveLink').value = data.driveLink;
                document.getElementById('keterangan').value = data.keterangan || '';
                
                // Hapus data lama
                deleteData(id, false);
                
                // Scroll ke form input data
                document.querySelector('[data-bs-target="inputData"]').click();
                showToast('Data siap diedit. Silakan perbarui dan simpan.', 'info');
            }
        }

        // Fungsi untuk menghapus data
        function deleteData(id, showNotification = true) {
            if (confirm('Apakah Anda yakin ingin menghapus data ini?')) {
                appData = appData.filter(item => item.id !== id);
                saveData();
                if (showNotification) {
                    showToast('Data berhasil dihapus', 'success');
                }
                updateDashboard();
                populateTable();
            }
        }

        // Fungsi untuk memperbarui dashboard
        function updateDashboard() {
            // Hitung total penerima
            document.getElementById('totalPenerima').textContent = appData.length;
            
            // Hitung total desa
            const uniqueDesa = new Set(appData.map(item => item.desa));
            document.getElementById('totalDesa').textContent = uniqueDesa.size;
            
            // Hitung total dana
            const totalDana = appData.reduce((sum, item) => sum + parseInt(item.jumlahBantuan), 0);
            document.getElementById('totalDana').textContent = formatRupiah(totalDana);
            
            // Hitung rata-rata per penerima
            const avgPerPenerima = appData.length > 0 ? totalDana / appData.length : 0;
            document.getElementById('avgPerPenerima').textContent = formatRupiah(avgPerPenerima);
            
            // Update chart data
            updateCharts();
        }

        // Fungsi untuk memperbarui chart
        function updateCharts() {
            // Data untuk chart desa (top 5 desa dengan penerima terbanyak)
            const desaCount = {};
            appData.forEach(item => {
                desaCount[item.desa] = (desaCount[item.desa] || 0) + 1;
            });
            
            const sortedDesa = Object.entries(desaCount)
                .sort((a, b) => b[1] - a[1])
                .slice(0, 5);
            
            const desaLabels = sortedDesa.map(item => item[0]);
            const desaData = sortedDesa.map(item => item[1]);
            
            // Data untuk chart jenis bantuan
            const jenisCount = {};
            appData.forEach(item => {
                jenisCount[item.jenisBantuan] = (jenisCount[item.jenisBantuan] || 0) + 1;
            });
            
            const jenisLabels = Object.keys(jenisCount);
            const jenisData = Object.values(jenisCount);
            
            // Data untuk chart per tahun
            const tahunCount = {};
            appData.forEach(item => {
                tahunCount[item.tahunAnggaran] = (tahunCount[item.tahunAnggaran] || 0) + 1;
            });
            
            const tahunLabels = Object.keys(tahunCount).sort();
            const tahunData = tahunLabels.map(year => tahunCount[year]);
            
            // Render chart
            renderCharts(desaLabels, desaData, jenisLabels, jenisData, tahunLabels, tahunData);
            
            // Update summary table
            updateSummaryTable(tahunLabels, tahunCount);
        }

        // Fungsi untuk merender chart
        function renderCharts(desaLabels, desaData, jenisLabels, jenisData, tahunLabels, tahunData) {
            // Chart untuk data per desa
            const desaCtx = document.getElementById('desaChart').getContext('2d');
            if (window.desaChartInstance) {
                window.desaChartInstance.destroy();
            }
            window.desaChartInstance = new Chart(desaCtx, {
                type: 'bar',
                data: {
                    labels: desaLabels,
                    datasets: [{
                        label: 'Jumlah Penerima',
                        data: desaData,
                        backgroundColor: 'rgba(54, 162, 235, 0.7)',
                        borderColor: 'rgba(54, 162, 235, 1)',
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: {
                            display: false
                        },
                        title: {
                            display: true,
                            text: 'Top 5 Desa dengan Penerima Terbanyak'
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: {
                                stepSize: 1
                            }
                        }
                    }
                }
            });
            
            // Chart untuk jenis bantuan
            const jenisCtx = document.getElementById('jenisBantuanChart').getContext('2d');
            if (window.jenisChartInstance) {
                window.jenisChartInstance.destroy();
            }
            window.jenisChartInstance = new Chart(jenisCtx, {
                type: 'pie',
                data: {
                    labels: jenisLabels,
                    datasets: [{
                        data: jenisData,
                        backgroundColor: [
                            'rgba(255, 99, 132, 0.7)',
                            'rgba(54, 162, 235, 0.7)',
                            'rgba(255, 206, 86, 0.7)',
                            'rgba(75, 192, 192, 0.7)',
                            'rgba(153, 102, 255, 0.7)'
                        ],
                        borderColor: [
                            'rgba(255, 99, 132, 1)',
                            'rgba(54, 162, 235, 1)',
                            'rgba(255, 206, 86, 1)',
                            'rgba(75, 192, 192, 1)',
                            'rgba(153, 102, 255, 1)'
                        ],
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: {
                            position: 'top',
                        },
                        title: {
                            display: true,
                            text: 'Distribusi Jenis Bantuan'
                        }
                    }
                }
            });
            
            // Chart untuk data per tahun
            const tahunCtx = document.getElementById('tahunChart').getContext('2d');
            if (window.tahunChartInstance) {
                window.tahunChartInstance.destroy();
            }
            window.tahunChartInstance = new Chart(tahunCtx, {
                type: 'line',
                data: {
                    labels: tahunLabels,
                    datasets: [{
                        label: 'Jumlah Penerima per Tahun',
                        data: tahunData,
                        fill: false,
                        backgroundColor: 'rgba(75, 192, 192, 0.7)',
                        borderColor: 'rgba(75, 192, 192, 1)',
                        tension: 0.1,
                        pointBackgroundColor: 'rgba(75, 192, 192, 1)',
                        pointRadius: 5,
                        pointHoverRadius: 7
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: {
                            position: 'top',
                        },
                        title: {
                            display: true,
                            text: 'Trend Penerima Bantuan per Tahun'
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: {
                                stepSize: 1
                            }
                        }
                    }
                }
            });
        }

        // Fungsi untuk memperbarui tabel ringkasan
        function updateSummaryTable(tahunLabels, tahunCount) {
            const summaryTable = document.getElementById('summaryTable').querySelector('tbody');
            summaryTable.innerHTML = '';
            
            tahunLabels.forEach(year => {
                const yearData = appData.filter(item => item.tahunAnggaran == year);
                const totalPenerima = yearData.length;
                const totalDana = yearData.reduce((sum, item) => sum + parseInt(item.jumlahBantuan), 0);
                const avgPerPenerima = totalPenerima > 0 ? totalDana / totalPenerima : 0;
                
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${year}</td>
                    <td>${totalPenerima}</td>
                    <td>${formatRupiah(totalDana)}</td>
                    <td>${formatRupiah(avgPerPenerima)}</td>
                `;
                summaryTable.appendChild(row);
            });
        }

        // Fungsi untuk mengekspor data ke Excel
        function exportToExcel() {
            // Buat workbook baru
            const wb = XLSX.utils.book_new();
            
            // Siapkan data untuk diekspor
            const dataToExport = appData.map(item => ({
                'Tahun Anggaran': item.tahunAnggaran,
                'Desa': item.desa,
                'Nama Kelompok': item.namaKelompok,
                'Jabatan': item.jabatan,
                'Nama Penerima': item.namaPenerima,
                'Jenis Kelamin': item.jenisKelamin,
                'NIK': item.nik,
                'WhatsApp': item.whatsapp,
                'Alamat': item.alamat,
                'Jenis Bantuan': item.jenisBantuan,
                'Detail Bantuan': item.detailBantuan,
                'Jumlah Bantuan': item.jumlahBantuan,
                'Tanggal Pencairan': new Date(item.tanggalPencairan).toLocaleDateString('id-ID'),
                'Keterangan': item.keterangan || '',
                'Link Google Drive': item.driveLink
            }));
            
            // Konversi data ke worksheet
            const ws = XLSX.utils.json_to_sheet(dataToExport);
            
            // Tambahkan worksheet ke workbook
            XLSX.utils.book_append_sheet(wb, ws, 'Data Penerima Bantuan');
            
            // Ekspor ke file Excel
            XLSX.writeFile(wb, 'Data_Penerima_Bantuan.xlsx');
            
            showToast('Data berhasil diekspor ke Excel', 'success');
        }

        // Fungsi untuk mengekspor data ke PDF
        function exportToPDF() {
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF();
            
            // Judul laporan
            doc.setFontSize(18);
            doc.text('LAPORAN DATA PENERIMA BANTUAN', 105, 15, { align: 'center' });
            doc.setFontSize(12);
            doc.text(`Dicetak pada: ${new Date().toLocaleDateString('id-ID')}`, 105, 22, { align: 'center' });
            
            // Siapkan data untuk tabel
            const tableData = appData.map(item => [
                item.tahunAnggaran,
                item.desa,
                item.namaPenerima,
                item.jenisKelamin,
                item.nik,
                item.whatsapp,
                item.jenisBantuan,
                formatRupiah(item.jumlahBantuan),
                new Date(item.tanggalPencairan).toLocaleDateString('id-ID')
            ]);
            
            // Buat tabel
            doc.autoTable({
                head: [['Tahun', 'Desa', 'Nama', 'JK', 'NIK', 'WhatsApp', 'Jenis', 'Jumlah', 'Tanggal']],
                body: tableData,
                startY: 30,
                theme: 'grid',
                headStyles: {
                    fillColor: [13, 71, 161],
                    textColor: 255
                },
                alternateRowStyles: {
                    fillColor: [240, 240, 240]
                },
                margin: { top: 30 }
            });
            
            // Simpan PDF
            doc.save('Data_Penerima_Bantuan.pdf');
            
            showToast('Data berhasil diekspor ke PDF', 'success');
        }

        // Fungsi untuk mencetak laporan
        function printReport() {
            const reportTahun = document.getElementById('reportTahun').value;
            const reportDesa = document.getElementById('reportDesa').value;
            const reportJenisBantuan = document.getElementById('reportJenisBantuan').value;
            
            // Filter data berdasarkan kriteria laporan
            let filteredData = appData.filter(item => {
                return (
                    (reportTahun === '' || item.tahunAnggaran == reportTahun) &&
                    (reportDesa === '' || item.desa === reportDesa) &&
                    (reportJenisBantuan === '' || item.jenisBantuan === reportJenisBantuan)
                );
            });
            
            // Buat jendela cetak
            const printWindow = window.open('', '_blank');
            printWindow.document.write(`
                <!DOCTYPE html>
                <html>
                <head>
                    <title>Laporan Penerima Bantuan</title>
                    <style>
                        body { font-family: Arial, sans-serif; margin: 20px; }
                        .print-header { text-align: center; margin-bottom: 20px; }
                        .print-title { font-size: 18px; font-weight: bold; }
                        .print-subtitle { font-size: 14px; }
                        .print-date { text-align: right; font-size: 12px; margin-bottom: 10px; }
                        table { width: 100%; border-collapse: collapse; font-size: 10px; }
                        th, td { border: 1px solid #ddd; padding: 5px; text-align: left; }
                        th { background-color: #f2f2f2; }
                        tr:nth-child(even) { background-color: #f9f9f9; }
                        @media print {
                            @page { size: landscape; margin: 0.5cm; }
                            body { margin: 0; }
                        }
                    </style>
                </head>
                <body>
                    <div class="print-header">
                        <div class="print-title">LAPORAN DATA PENERIMA BANTUAN</div>
                        <div class="print-subtitle">Pemerintah Kabupaten Situbondo</div>
                    </div>
                    <div class="print-date">Dicetak pada: ${new Date().toLocaleDateString('id-ID')}</div>
                    <table>
                        <thead>
                            <tr>
                                <th>No</th>
                                <th>Tahun</th>
                                <th>Desa</th>
                                <th>Nama Kelompok</th>
                                <th>Jabatan</th>
                                <th>Nama Penerima</th>
                                <th>JK</th>
                                <th>NIK</th>
                                <th>WhatsApp</th>
                                <th>Alamat</th>
                                <th>Jenis Bantuan</th>
                                <th>Jumlah</th>
                                <th>Tanggal</th>
                                <th>Keterangan</th>
                            </tr>
                        </thead>
                        <tbody>
            `);
            
            // Isi tabel dengan data
            filteredData.forEach((item, index) => {
                printWindow.document.write(`
                    <tr>
                        <td>${index + 1}</td>
                        <td>${item.tahunAnggaran}</td>
                        <td>${item.desa}</td>
                        <td>${item.namaKelompok}</td>
                        <td>${item.jabatan}</td>
                        <td>${item.namaPenerima}</td>
                        <td>${item.jenisKelamin}</td>
                        <td>${item.nik}</td>
                        <td>${item.whatsapp}</td>
                        <td>${item.alamat}</td>
                        <td>${item.jenisBantuan} - ${item.detailBantuan}</td>
                        <td>${formatRupiah(item.jumlahBantuan)}</td>
                        <td>${new Date(item.tanggalPencairan).toLocaleDateString('id-ID')}</td>
                        <td>${item.keterangan || '-'}</td>
                    </tr>
                `);
            });
            
            printWindow.document.write(`
                        </tbody>
                    </table>
                </body>
                </html>
            `);
            
            printWindow.document.close();
            printWindow.focus();
            
            // Tunggu sebentar sebelum mencetak agar konten terload dengan baik
            setTimeout(() => {
                printWindow.print();
                printWindow.close();
            }, 250);
            
            showToast('Laporan berhasil dicetak', 'success');
        }

        // Fungsi untuk backup data
        function backupData() {
            const dataStr = JSON.stringify(appData);
            const dataUri = 'data:application/json;charset=utf-8,'+ encodeURIComponent(dataStr);
            
            const exportFileDefaultName = `backup_barjas_${new Date().toISOString().slice(0,10)}.json`;
            
            const linkElement = document.createElement('a');
            linkElement.setAttribute('href', dataUri);
            linkElement.setAttribute('download', exportFileDefaultName);
            linkElement.click();
            
            showToast('Backup data berhasil', 'success');
        }

        // Fungsi untuk restore data
        function restoreData() {
            const fileInput = document.getElementById('restoreFile');
            fileInput.click();
            
            fileInput.onchange = function() {
                const file = this.files[0];
                if (file) {
                    const reader = new FileReader();
                    reader.onload = function(e) {
                        try {
                            const restoredData = JSON.parse(e.target.result);
                            if (Array.isArray(restoredData)) {
                                if (confirm('Apakah Anda yakin ingin memulihkan data? Data saat ini akan digantikan.')) {
                                    appData = restoredData;
                                    saveData();
                                    updateDashboard();
                                    populateTable();
                                    showToast('Data berhasil dipulihkan', 'success');
                                }
                            } else {
                                showToast('Format file tidak valid', 'error');
                            }
                        } catch (error) {
                            showToast('Gagal memproses file: ' + error.message, 'error');
                        }
                    };
                    reader.readAsText(file);
                }
            };
        }

        // Fungsi untuk reset data
        function resetData() {
            if (confirm('Apakah Anda yakin ingin menghapus semua data? Tindakan ini tidak dapat dibatalkan.')) {
                appData = [];
                saveData();
                updateDashboard();
                populateTable();
                showToast('Semua data telah dihapus', 'success');
            }
        }

        // Fungsi untuk mengubah kode keamanan
        function changeSecurityCode() {
            const currentCode = document.getElementById('currentCode').value;
            const newCode = document.getElementById('newCode').value;
            const confirmCode = document.getElementById('confirmCode').value;
            
            const savedCode = localStorage.getItem('securityCode') || '1234';
            
            if (currentCode !== savedCode) {
                showToast('Kode saat ini salah', 'error');
                return;
            }
            
            if (newCode !== confirmCode) {
                showToast('Konfirmasi kode baru tidak cocok', 'error');
                return;
            }
            
            localStorage.setItem('securityCode', newCode);
            showToast('Kode keamanan berhasil diubah', 'success');
            document.getElementById('securityForm').reset();
        }

        // Fungsi untuk validasi login
        function validateLogin() {
            const securityCode = document.getElementById('securityCode').value;
            const savedCode = localStorage.getItem('securityCode') || '1234';
            
            if (isBlocked) {
                showToast('Anda sedang dalam masa pemblokiran. Silakan coba lagi nanti.', 'error');
                return false;
            }
            
            if (securityCode !== savedCode) {
                loginAttempts++;
                
                if (loginAttempts >= 3) {
                    isBlocked = true;
                    document.getElementById('blockedMessage').classList.remove('d-none');
                    document.getElementById('loginButton').disabled = true;
                    
                    let countdown = 30;
                    const countdownElement = document.getElementById('countdown');
                    countdownElement.textContent = countdown;
                    
                    const countdownInterval = setInterval(() => {
                        countdown--;
                        countdownElement.textContent = countdown;
                        
                        if (countdown <= 0) {
                            clearInterval(countdownInterval);
                            isBlocked = false;
                            loginAttempts = 0;
                            document.getElementById('blockedMessage').classList.add('d-none');
                            document.getElementById('loginButton').disabled = false;
                        }
                    }, 1000);
                }
                
                showToast(`Kode keamanan salah. Percobaan ${loginAttempts} dari 3.`, 'error');
                document.getElementById('securityCode').classList.add('login-shake');
                setTimeout(() => {
                    document.getElementById('securityCode').classList.remove('login-shake');
                }, 600);
                
                document.getElementById('attemptsCount').textContent = `Percobaan login gagal: ${loginAttempts}`;
                
                return false;
            }
            
            // Jika kode benar, tampilkan form nama petugas
            document.getElementById('petugasForm').style.display = 'block';
            document.getElementById('agreementCheck').style.display = 'block';
            document.getElementById('loginButton').disabled = false;
            
            // Fokus ke input nama petugas
            document.getElementById('namaPetugas').focus();
            
            return true;
        }

        // Fungsi untuk melakukan login
        function performLogin() {
            const securityCode = document.getElementById('securityCode').value;
            const savedCode = localStorage.getItem('securityCode') || '1234';
            
            if (securityCode !== savedCode) {
                return false;
            }
            
            // Validasi nama petugas dan persetujuan
            namaPetugas = document.getElementById('namaPetugas').value.trim();
            const agreeTerms = document.getElementById('agreeTerms').checked;
            
            if (!namaPetugas) {
                showToast('Harap isi nama petugas', 'error');
                document.getElementById('namaPetugas').focus();
                return false;
            }
            
            if (!agreeTerms) {
                showToast('Harap setujui syarat dan ketentuan', 'error');
                document.getElementById('agreeTermsError').style.display = 'block';
                return false;
            }
            
            // Set nama petugas di form input data
            document.getElementById('inputNamaPetugas').value = namaPetugas;
            
            // Sembunyikan modal login
            const loginModal = bootstrap.Modal.getInstance(document.getElementById('loginModal'));
            loginModal.hide();
            
            // Tampilkan aplikasi
            document.getElementById('appContent').style.display = 'block';
            
            // Reset form login
            document.getElementById('loginForm').reset();
            document.getElementById('petugasForm').style.display = 'none';
            document.getElementById('agreementCheck').style.display = 'none';
            document.getElementById('loginButton').disabled = true;
            
            showToast(`Selamat datang, ${namaPetugas}!`, 'success');
            
            return true;
        }

        // Fungsi untuk melakukan logout
        function performLogout() {
            if (confirm('Apakah Anda yakin ingin logout?')) {
                // Sembunyikan aplikasi
                document.getElementById('appContent').style.display = 'none';
                
                // Tampilkan modal login
                const loginModal = new bootstrap.Modal(document.getElementById('loginModal'));
                loginModal.show();
                
                // Reset state login
                loginAttempts = 0;
                isBlocked = false;
                document.getElementById('blockedMessage').classList.add('d-none');
                document.getElementById('attemptsCount').textContent = '';
                
                showToast('Anda telah logout', 'info');
            }
        }

        // Event listener ketika DOM sudah dimuat
        document.addEventListener('DOMContentLoaded', function() {
            // Inisialisasi aplikasi
            loadData();
            populateTahunOptions();
            populateDesaOptions();
            updateDashboard();
            populateTable();
            
            // Set tanggal hari ini sebagai default untuk input tanggal
            document.getElementById('tanggalPencairan').valueAsDate = new Date();
            
            // Tampilkan modal login saat aplikasi pertama kali dibuka
            const loginModal = new bootstrap.Modal(document.getElementById('loginModal'));
            loginModal.show();
            
            // Event listener untuk form login
            document.getElementById('loginForm').addEventListener('submit', function(e) {
                e.preventDefault();
                
                if (document.getElementById('petugasForm').style.display === 'none') {
                    // Validasi kode keamanan
                    if (validateLogin()) {
                        // Lanjut ke form nama petugas
                    }
                } else {
                    // Validasi nama petugas dan persetujuan, lalu login
                    performLogin();
                }
            });
            
            // Event listener untuk toggle password visibility
            document.querySelector('.toggle-password').addEventListener('click', function() {
                const passwordInput = document.getElementById('securityCode');
                const icon = this.querySelector('i');
                
                if (passwordInput.type === 'password') {
                    passwordInput.type = 'text';
                    icon.classList.remove('fa-eye');
                    icon.classList.add('fa-eye-slash');
                } else {
                    passwordInput.type = 'password';
                    icon.classList.remove('fa-eye-slash');
                    icon.classList.add('fa-eye');
                }
            });
            
            // Event listener untuk input nama petugas
            document.getElementById('namaPetugas').addEventListener('input', function() {
                document.getElementById('agreeTermsError').style.display = 'none';
            });
            
            // Event listener untuk checkbox persetujuan
            document.getElementById('agreeTerms').addEventListener('change', function() {
                document.getElementById('agreeTermsError').style.display = 'none';
            });
            
            // Event listener untuk form input data
            document.getElementById('dataForm').addEventListener('submit', function(e) {
                e.preventDefault();
                
                // Validasi form
                const tahunAnggaran = document.getElementById('tahunAnggaran').value;
                const desa = document.getElementById('desa').value;
                const namaKelompok = document.getElementById('namaKelompok').value;
                const jabatan = document.getElementById('jabatan').value;
                const namaPenerima = document.getElementById('namaPenerima').value;
                const jenisKelamin = document.getElementById('jenisKelamin').value;
                const nik = document.getElementById('nik').value;
                const whatsapp = document.getElementById('whatsapp').value;
                const alamat = document.getElementById('alamat').value;
                const jenisBantuan = document.getElementById('jenisBantuan').value;
                const detailBantuan = document.getElementById('detailBantuan').value;
                const jumlahBantuan = document.getElementById('jumlahBantuan').value;
                const tanggalPencairan = document.getElementById('tanggalPencairan').value;
                const driveLink = document.getElementById('driveLink').value;
                const keterangan = document.getElementById('keterangan').value;
                
                // Validasi NIK harus angka
                if (isNaN(nik) || nik.length < 16) {
                    showToast('NIK harus berupa angka dan terdiri dari 16 digit', 'error');
                    return;
                }
                
                // Validasi WhatsApp harus angka
                if (isNaN(whatsapp)) {
                    showToast('Nomor WhatsApp harus berupa angka', 'error');
                    return;
                }
                
                // Validasi jumlah bantuan harus angka
                if (isNaN(jumlahBantuan.replace(/\./g, ''))) {
                    showToast('Jumlah bantuan harus berupa angka', 'error');
                    return;
                }
                
                // Format jumlah bantuan
                const formattedJumlah = parseInt(jumlahBantuan.replace(/\./g, ''));
                
                // Tambahkan data
                addData({
                    tahunAnggaran,
                    desa,
                    namaKelompok: namaKelompok.toUpperCase(),
                    jabatan,
                    namaPenerima,
                    jenisKelamin,
                    nik,
                    whatsapp,
                    alamat,
                    jenisBantuan,
                    detailBantuan,
                    jumlahBantuan: formattedJumlah,
                    tanggalPencairan,
                    driveLink,
                    keterangan
                });
                
                // Reset form
                this.reset();
                document.getElementById('inputNamaPetugas').value = namaPetugas;
                document.getElementById('tanggalPencairan').valueAsDate = new Date();
            });
            
            // Event listener untuk filter data
            document.getElementById('filterDesa').addEventListener('change', populateTable);
            document.getElementById('filterTahun').addEventListener('change', populateTable);
            document.getElementById('filterJenisBantuan').addEventListener('change', populateTable);
            document.getElementById('searchInput').addEventListener('input', populateTable);
            
            // Event listener untuk navigasi halaman
            document.getElementById('prevPage').addEventListener('click', function() {
                if (currentPage > 1) {
                    currentPage--;
                    populateTable();
                }
            });
            
            document.getElementById('nextPage').addEventListener('click', function() {
                const totalPages = Math.ceil(appData.length / itemsPerPage);
                if (currentPage < totalPages) {
                    currentPage++;
                    populateTable();
                }
            });
            
            // Event listener untuk menu navigasi
            document.querySelectorAll('.nav-link').forEach(link => {
                link.addEventListener('click', function(e) {
                    e.preventDefault();
                    
                    // Jika logout button diklik
                    if (this.id === 'logoutButton') {
                        performLogout();
                        return;
                    }
                    
                    // Aktifkan menu yang dipilih
                    document.querySelectorAll('.nav-link').forEach(item => {
                        item.classList.remove('active');
                    });
                    this.classList.add('active');
                    
                    // Tampilkan section yang sesuai
                    const target = this.getAttribute('data-bs-target');
                    document.querySelectorAll('.content-section').forEach(section => {
                        section.classList.add('d-none');
                    });
                    document.getElementById(target).classList.remove('d-none');
                    
                    // Jika target adalah dataTables, perbarui tabel
                    if (target === 'dataTables') {
                        populateTable();
                    }
                    
                    // Jika target adalah reports, perbarui chart
                    if (target === 'reports') {
                        updateDashboard();
                    }
                });
            });
            
            // Event listener untuk tombol ekspor
            document.getElementById('exportExcelBtn').addEventListener('click', exportToExcel);
            document.getElementById('exportPdfBtn').addEventListener('click', exportToPDF);
            
            // Event listener untuk form laporan
            document.getElementById('reportForm').addEventListener('submit', function(e) {
                e.preventDefault();
                printReport();
            });
            
            // Event listener untuk pengaturan
            document.getElementById('securityForm').addEventListener('submit', function(e) {
                e.preventDefault();
                changeSecurityCode();
            });
            
            document.getElementById('backupDataBtn').addEventListener('click', backupData);
            document.getElementById('restoreDataBtn').addEventListener('click', restoreData);
            document.getElementById('resetDataBtn').addEventListener('click', resetData);
            
            // Event listener untuk mobile menu
            document.getElementById('mobileMenuBtn').addEventListener('click', function() {
                document.querySelector('.col-md-3.col-lg-2').classList.add('mobile-show');
                document.getElementById('sidebarOverlay').classList.add('mobile-show');
            });
            
            document.getElementById('sidebarOverlay').addEventListener('click', function() {
                document.querySelector('.col-md-3.col-lg-2').classList.remove('mobile-show');
                this.classList.remove('mobile-show');
            });
            
            // Event listener untuk floating action button
            document.getElementById('fab').addEventListener('click', function() {
                document.querySelector('[data-bs-target="inputData"]').click();
            });
            
            // Auto kapitalisasi untuk nama kelompok
            document.getElementById('namaKelompok').addEventListener('input', function() {
                this.value = this.value.toUpperCase();
            });
            
            // Format input jumlah bantuan
            document.getElementById('jumlahBantuan').addEventListener('input', function(e) {
                // Hapus semua karakter non-digit
                let value = this.value.replace(/\D/g, '');
                
                // Format dengan titik sebagai pemisah ribuan
                if (value.length > 0) {
                    value = parseInt(value).toLocaleString('id-ID');
                }
                
                this.value = value;
            });
            
            // Validasi input hanya angka untuk NIK dan WhatsApp
            document.getElementById('nik').addEventListener('input', function(e) {
                this.value = this.value.replace(/\D/g, '');
            });
            
            document.getElementById('whatsapp').addEventListener('input', function(e) {
                this.value = this.value.replace(/\D/g, '');
            });
            
            // Toggle detail bantuan berdasarkan jenis bantuan
            document.getElementById('jenisBantuan').addEventListener('change', function() {
                const detailBantuan = document.getElementById('detailBantuan');
                if (this.value === 'Tunai') {
                    detailBantuan.value = 'Uang Tunai';
                } else if (this.value === 'Non Tunai') {
                    detailBantuan.value = 'Bantuan Barang';
                }
            });
        });
    </script>
</body>
</html>
