<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>APLIKASI BARJAS - SISTEM BANTUAN</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-datepicker/1.9.0/css/bootstrap-datepicker.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.28/jspdf.plugin.autotable.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <style>
        :root {
            --primary-color: #0d47a1;
            --secondary-color: #00695c;
            --accent-color: #ff8f00;
            --light-blue: #e3f2fd;
            --dark-blue: #082e5c;
            --gradient-primary: linear-gradient(135deg, var(--primary-color), var(--dark-blue));
            --gradient-secondary: linear-gradient(135deg, var(--secondary-color), #004d40);
            --gradient-accent: linear-gradient(135deg, var(--accent-color), #e65100);
            --shadow-sm: 0 2px 8px rgba(0,0,0,0.08);
            --shadow-md: 0 4px 16px rgba(0,0,0,0.12);
            --shadow-lg: 0 8px 28px rgba(0,0,0,0.15);
            --login-gradient: linear-gradient(135deg, #0d47a1, #00695c, #ff8f00);
        }
        
        body {
            background: linear-gradient(135deg, #f5f9ff 0%, #e8f5e9 100%);
            font-family: 'Poppins', 'Segoe UI', sans-serif;
            min-height: 100vh;
            padding: 10px 0;
            overflow-x: hidden;
        }
        
        .app-container {
            max-width: 1600px;
            margin: 0 auto;
            background: white;
            box-shadow: var(--shadow-lg);
            border-radius: 12px;
            overflow: hidden;
            position: relative;
            z-index: 10;
        }
        
        .app-header {
            background: var(--gradient-primary);
            color: white;
            padding: 20px 15px;
            text-align: center;
            position: relative;
            overflow: hidden;
        }
        
        .app-header::before {
            content: "";
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(255,255,255,0.15) 0%, transparent 70%);
            pointer-events: none;
        }
        
        .app-logo {
            font-size: 2.5rem;
            margin-bottom: 10px;
            position: relative;
            z-index: 1;
        }
        
        .app-title {
            font-size: 1.8rem;
            font-weight: 800;
            margin: 0;
            position: relative;
            z-index: 1;
            text-shadow: 1px 1px 4px rgba(0,0,0,0.3);
        }
        
        .app-subtitle {
            font-size: 1rem;
            opacity: 0.95;
            position: relative;
            z-index: 1;
            font-weight: 300;
            letter-spacing: 0.5px;
            margin-bottom: 5px;
        }
        
        .nav-pills .nav-link {
            border-radius: 8px;
            margin-bottom: 8px;
            padding: 12px 15px;
            font-weight: 500;
            color: #444;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            font-size: 0.9rem;
        }
        
        .nav-pills .nav-link:hover {
            background-color: #f0f7ff;
            transform: translateX(3px);
        }
        
        .nav-pills .nav-link.active {
            background: var(--gradient-primary);
            font-weight: 600;
            box-shadow: var(--shadow-md);
            transform: translateX(3px);
            color: white;
        }
        
        .section-title {
            border-left: 4px solid var(--primary-color);
            padding-left: 12px;
            margin: 20px 0;
            font-weight: 700;
            color: var(--dark-blue);
            font-size: 1.4rem;
            position: relative;
        }
        
        .section-title::after {
            content: "";
            position: absolute;
            bottom: -5px;
            left: 12px;
            width: 40px;
            height: 2px;
            background: var(--gradient-primary);
            border-radius: 2px;
        }
        
        .btn-primary {
            background: var(--gradient-primary);
            border: none;
            padding: 10px 20px;
            font-weight: 600;
            box-shadow: var(--shadow-md);
            border-radius: 8px;
            transition: all 0.3s;
            font-size: 0.9rem;
        }
        
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-lg);
        }
        
        .btn-success {
            background: var(--gradient-secondary);
            border: none;
            padding: 10px 20px;
            font-weight: 600;
            box-shadow: var(--shadow-md);
            border-radius: 8px;
            transition: all 0.3s;
            font-size: 0.9rem;
        }
        
        .btn-success:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-lg);
        }
        
        .btn-warning {
            background: var(--gradient-accent);
            border: none;
            padding: 10px 20px;
            font-weight: 600;
            box-shadow: var(--shadow-md);
            border-radius: 8px;
            transition: all 0.3s;
            font-size: 0.9rem;
        }
        
        .btn-warning:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-lg);
        }
        
        .form-label {
            font-weight: 600;
            color: #444;
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            font-size: 0.9rem;
        }
        
        .form-label i {
            margin-right: 6px;
            color: var(--primary-color);
        }
        
        .form-control, .form-select {
            border-radius: 8px;
            padding: 12px 15px;
            border: 1px solid #ddd;
            transition: all 0.3s;
            box-shadow: var(--shadow-sm);
            font-size: 0.9rem;
        }
        
        .form-control:focus, .form-select:focus {
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(13, 71, 161, 0.2);
            transform: translateY(-2px);
        }
        
        .copyright {
            text-align: center;
            padding: 20px;
            background-color: var(--light-blue);
            color: var(--dark-blue);
            font-size: 0.9rem;
            font-weight: 500;
        }
        
        .data-table {
            font-size: 0.85rem;
            border-collapse: separate;
            border-spacing: 0;
            box-shadow: var(--shadow-sm);
            border-radius: 8px;
            overflow: hidden;
        }
        
        .data-table th {
            background: var(--gradient-primary);
            color: white;
            font-weight: 600;
            padding: 12px 10px;
            text-align: center;
            position: relative;
            font-size: 0.85rem;
        }
        
        .data-table th::after {
            content: "";
            position: absolute;
            bottom: 0;
            left: 0;
            width: 100%;
            height: 1px;
            background: rgba(255,255,255,0.3);
        }
        
        .data-table td {
            padding: 10px 8px;
            vertical-align: middle;
            border-bottom: 1px solid #eee;
            font-size: 0.85rem;
        }
        
        .data-table tr:nth-child(even) {
            background-color: #f9fbff;
        }
        
        .data-table tr:hover {
            background-color: #edf5ff;
        }
        
        .feature-icon {
            font-size: 1.1rem;
            margin-right: 8px;
            width: 24px;
            text-align: center;
        }
        
        .card {
            border-radius: 10px;
            border: none;
            box-shadow: var(--shadow-md);
            transition: all 0.3s ease;
            overflow: hidden;
            margin-bottom: 15px;
        }
        
        .card:hover {
            transform: translateY(-5px);
            box-shadow: var(--shadow-lg);
        }
        
        .card-header {
            border-radius: 10px 10px 0 0 !important;
            font-weight: 600;
            padding: 15px 20px;
            background: var(--gradient-primary);
            color: white;
            font-size: 0.95rem;
        }
        
        .stats-box {
            text-align: center;
            padding: 20px 15px;
            border-radius: 10px;
            background: white;
            box-shadow: var(--shadow-md);
            transition: all 0.3s;
            position: relative;
            overflow: hidden;
            margin-bottom: 15px;
        }
        
        .stats-box::before {
            content: "";
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 4px;
            background: var(--gradient-primary);
            border-radius: 2px;
        }
        
        .stats-box:hover {
            transform: translateY(-3px);
            box-shadow: var(--shadow-lg);
        }
        
        .stats-number {
            font-size: 1.8rem;
            font-weight: 800;
            color: var(--primary-color);
            margin: 10px 0;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.1);
        }
        
        .stats-label {
            font-size: 0.9rem;
            color: #666;
            font-weight: 500;
        }
        
        .notification-toast {
            position: fixed;
            bottom: 20px;
            right: 20px;
            z-index: 1050;
            min-width: 280px;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: var(--shadow-lg);
            max-width: calc(100vw - 40px);
        }
        
        .input-error {
            border-color: #dc3545;
            box-shadow: 0 0 0 3px rgba(220, 53, 69, 0.2);
        }
        
        .error-message {
            color: #dc3545;
            font-size: 0.8rem;
            margin-top: 5px;
            display: none;
            font-weight: 500;
        }
        
        .watermark {
            position: absolute;
            bottom: 10px;
            right: 15px;
            opacity: 0.8;
            font-size: 0.8rem;
            color: white;
            font-weight: 300;
        }
        
        .control-panel {
            background: #f8f9fa;
            border-radius: 8px;
            padding: 15px;
            margin-top: 15px;
            box-shadow: var(--shadow-sm);
        }
        
        .control-title {
            font-size: 1rem;
            color: var(--primary-color);
            font-weight: 600;
            margin-bottom: 15px;
            padding-bottom: 8px;
            border-bottom: 1px solid var(--light-blue);
        }
        
        .floating-action-btn {
            position: fixed;
            bottom: 20px;
            right: 20px;
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background: var(--gradient-primary);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: var(--shadow-lg);
            z-index: 1000;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .floating-action-btn:hover {
            transform: scale(1.1) rotate(90deg);
        }
        
        .filter-section {
            background: white;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 20px;
            box-shadow: var(--shadow-sm);
        }
        
        .badge-custom {
            background: var(--gradient-primary);
            color: white;
            padding: 6px 12px;
            border-radius: 16px;
            font-weight: 600;
            font-size: 0.8rem;
        }
        
        .mobile-menu-btn {
            display: none;
            position: fixed;
            top: 15px;
            left: 15px;
            z-index: 1050;
            background: var(--gradient-primary);
            color: white;
            border: none;
            border-radius: 50%;
            width: 45px;
            height: 45px;
            box-shadow: var(--shadow-lg);
        }
        
        .sidebar-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 1040;
        }
        
        /* Animations */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .animate-fadeIn {
            animation: fadeIn 0.5s ease forwards;
        }
        
        /* Custom scrollbar */
        ::-webkit-scrollbar {
            width: 6px;
        }
        
        ::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 8px;
        }
        
        ::-webkit-scrollbar-thumb {
            background: var(--primary-color);
            border-radius: 8px;
        }
        
        ::-webkit-scrollbar-thumb:hover {
            background: var(--dark-blue);
        }
        
        /* Responsive styles */
        @media (max-width: 991.98px) {
            .col-md-3.col-lg-2 {
                position: fixed;
                left: -300px;
                top: 0;
                bottom: 0;
                z-index: 1050;
                width: 280px;
                transition: left 0.3s ease;
                overflow-y: auto;
                padding-top: 60px;
            }
            
            .col-md-3.col-lg-2.mobile-show {
                left: 0;
            }
            
            .col-md-9.col-lg-10 {
                width: 100%;
                flex: 0 0 100%;
                max-width: 100%;
            }
            
            .mobile-menu-btn {
                display: flex;
                align-items: center;
                justify-content: center;
            }
            
            .sidebar-overlay.mobile-show {
                display: block;
            }
        }
        
        /* Print Styles - IMPROVED FOR LANDSCAPE */
        @media print {
            @page {
                size: landscape;
                margin: 0.5cm;
            }
            
            body * {
                visibility: hidden;
            }
            
            .app-container, .app-container * {
                visibility: visible;
            }
            
            .app-container {
                position: absolute;
                left: 0;
                top: 0;
                width: 100%;
                box-shadow: none;
            }
            
            .nav-pills, .mobile-menu-btn, .sidebar-overlay, .floating-action-btn,
            .btn-group, .filter-section, .toast {
                display: none !important;
            }
            
            .col-md-3.col-lg-2.p-4.bg-light {
                display: none !important;
            }
            
            .col-md-9.col-lg-10.p-5 {
                width: 100%;
                flex: 0 0 100%;
                max-width: 100%;
                padding: 0 !important;
            }
            
            .copyright {
                display: none;
            }
            
            .data-table {
                font-size: 10px;
                width: 100% !important;
            }
            
            .data-table th, .data-table td {
                padding: 4px 2px;
            }
            
            /* Sembunyikan kolom aksi dan link Google Drive saat mencetak */
            .data-table th:last-child,
            .data-table td:last-child {
                display: none !important;
            }
            
            /* Judul untuk laporan cetak */
            .print-header {
                display: block !important;
                text-align: center;
                margin-bottom: 15px;
            }
            
            .print-title {
                font-size: 18px;
                font-weight: bold;
                margin-bottom: 5px;
            }
            
            .print-subtitle {
                font-size: 14px;
                margin-bottom: 10px;
            }
            
            .print-date {
                font-size: 12px;
                text-align: right;
                margin-bottom: 10px;
            }
        }

        /* WhatsApp link style */
        .whatsapp-link {
            color: #25D366;
            text-decoration: none;
        }
        
        .whatsapp-link:hover {
            text-decoration: underline;
        }
        
        /* View Link Button */
        .btn-view {
            background: linear-gradient(135deg, #17a2b8, #138496);
            color: white;
            border: none;
            padding: 5px 10px;
            border-radius: 4px;
            font-size: 0.8rem;
        }
        
        .btn-view:hover {
            background: linear-gradient(135deg, #138496, #117a8b);
            color: white;
        }
        
        /* Undo Button */
        .btn-undo {
            background: linear-gradient(135deg, #6c757d, #5a6268);
            color: white;
            border: none;
        }
        
        .btn-undo:hover {
            background: linear-gradient(135deg, #5a6268, #4e555b);
            color: white;
        }
        
        /* WhatsApp number link in table */
        .whatsapp-number {
            color: #25D366;
            cursor: pointer;
            text-decoration: underline;
        }
        
        /* Welcome Modal Styles */
        .welcome-modal .modal-content {
            border-radius: 15px;
            overflow: hidden;
            border: none;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }
        
        .welcome-header {
            background: var(--gradient-primary);
            color: white;
            text-align: center;
            padding: 25px;
        }
        
        .welcome-icon {
            font-size: 3rem;
            margin-bottom: 15px;
            color: white;
        }
        
        .welcome-body {
            padding: 25px;
            text-align: center;
        }
        
        .welcome-footer {
            background: #f8f9fa;
            padding: 15px;
            text-align: center;
            border-top: 1px solid #eee;
        }
        
        .countdown-timer {
            font-size: 0.9rem;
            color: #6c757d;
            margin-top: 10px;
        }
        
        /* Button untuk cetak per data */
        .btn-print-individual {
            background: linear-gradient(135deg, #6f42c1, #5a2d95);
            color: white;
            border: none;
            padding: 5px 10px;
            border-radius: 4px;
            font-size: 0.8rem;
        }
        
        .btn-print-individual:hover {
            background: linear-gradient(135deg, #5a2d95, #4a2479);
            color: white;
        }
        
        /* Developer Info Styles */
        .developer-info {
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            border-radius: 10px;
            padding: 15px;
            margin-top: 20px;
            box-shadow: var(--shadow-sm);
        }
        
        .developer-info h6 {
            color: var(--primary-color);
            font-weight: 600;
            margin-bottom: 15px;
            padding-bottom: 8px;
            border-bottom: 1px solid #ddd;
        }
        
        .developer-contact p {
            margin-bottom: 8px;
            font-size: 0.85rem;
        }
        
        .developer-contact a {
            color: var(--primary-color);
            text-decoration: none;
            transition: all 0.3s;
        }
        
        .developer-contact a:hover {
            color: var(--dark-blue);
            text-decoration: underline;
        }
        
        /* Welcome Splash Screen */
        .welcome-splash {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: var(--gradient-primary);
            color: white;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 9999;
            transition: opacity 0.5s ease;
        }
        
        .welcome-splash-content {
            text-align: center;
            max-width: 600px;
            padding: 30px;
        }
        
        .welcome-splash-logo {
            font-size: 4rem;
            margin-bottom: 20px;
        }
        
        .welcome-splash-title {
            font-size: 2.2rem;
            font-weight: 800;
            margin-bottom: 15px;
        }
        
        .welcome-splash-message {
            font-size: 1.1rem;
            line-height: 1.6;
            margin-bottom: 25px;
        }
        
        .welcome-splash-countdown {
            font-size: 1rem;
            margin-top: 20px;
        }
        
        .welcome-splash-close {
            position: absolute;
            top: 20px;
            right: 20px;
            background: rgba(255,255,255,0.2);
            border: none;
            color: white;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .welcome-splash-close:hover {
            background: rgba(255,255,255,0.3);
            transform: rotate(90deg);
        }
        
        /* Loading spinner */
        .spinner-border-sm {
            width: 1rem;
            height: 1rem;
        }

        /* Login Modal Styles */
        .login-modal .modal-content {
            border-radius: 15px;
            overflow: hidden;
            border: none;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
        }

        .login-header {
            background: var(--login-gradient);
            color: white;
            text-align: center;
            padding: 25px 20px;
            position: relative;
        }

        .login-icon {
            font-size: 3rem;
            margin-bottom: 15px;
            color: white;
        }

        .login-title {
            font-size: 1.8rem;
            font-weight: 700;
            margin: 0;
        }

        .login-subtitle {
            font-size: 1rem;
            opacity: 0.9;
            margin: 5px 0 0;
        }

        .login-body {
            padding: 25px;
            position: relative;
            z-index: 1;
        }

        .login-form-group {
            margin-bottom: 20px;
        }

        .login-form-label {
            font-weight: 600;
            color: var(--dark-blue);
            margin-bottom: 8px;
            display: flex;
            align-items: center;
        }

        .login-form-label i {
            margin-right: 10px;
            color: var(--dark-blue);
        }

        .login-form-control {
            border-radius: 8px;
            padding: 12px 15px;
            border: 2px solid #ddd;
            transition: all 0.3s;
        }

        .login-form-control:focus {
            border-color: var(--dark-blue);
            box-shadow: 0 0 0 3px rgba(13, 71, 161, 0.2);
        }

        .login-input-group-text {
            background: var(--light-blue);
            border: 2px solid #ddd;
            border-left: none;
        }

        .btn-login {
            background: var(--gradient-secondary);
            color: white;
            border: none;
            padding: 12px;
            font-weight: 600;
            border-radius: 8px;
            width: 100%;
            transition: all 0.3s;
            margin-top: 10px;
        }

        .btn-login:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 105, 92, 0.4);
        }

        .btn-login:disabled {
            background: #ccc;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        .login-security-notice {
            text-align: center;
            margin-top: 20px;
            font-size: 0.85rem;
            color: #666;
        }

        .login-attempts-count {
            text-align: center;
            font-size: 0.9rem;
            color: #ff8f00;
            font-weight: 500;
            margin-top: 5px;
        }

        .login-blocked-message {
            text-align: center;
            background: rgba(220, 53, 69, 0.1);
            border-radius: 8px;
            padding: 15px;
            margin-top: 20px;
            color: #dc3545;
            font-weight: 500;
        }

        .login-countdown {
            font-size: 1.2rem;
            font-weight: 700;
            color: var(--dark-blue);
        }

        .login-developer-info {
            background: var(--light-blue);
            border-radius: 10px;
            padding: 20px;
            margin-top: 25px;
            text-align: center;
        }

        .login-developer-logo {
            max-width: 180px;
            margin-bottom: 15px;
            border-radius: 8px;
        }

        .login-developer-contact a {
            color: var(--dark-blue);
            text-decoration: none;
            transition: all 0.3s;
            display: inline-block;
            margin: 5px 0;
        }

        .login-developer-contact a:hover {
            color: var(--primary-color);
            text-decoration: underline;
            transform: translateY(-2px);
        }

        .login-copyright {
            text-align: center;
            margin-top: 20px;
            color: #666;
            font-size: 0.9rem;
            opacity: 0.9;
        }

        /* Animations */
        @keyframes login-shake {
            0%, 100% { transform: translateX(0); }
            10%, 30%, 50%, 70%, 90% { transform: translateX(-10px); }
            20%, 40%, 60%, 80% { transform: translateX(10px); }
        }

        .login-shake {
            animation: login-shake 0.6s cubic-bezier(.36,.07,.19,.97) both;
        }

        /* Login particle background */
        #login-particles {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 1040; /* Higher than modal backdrop */
            display: none;
        }

        /* Link Google Drive dalam tabel */
        .drive-link {
            color: #0d47a1;
            text-decoration: none;
            cursor: pointer;
        }

        .drive-link:hover {
            text-decoration: underline;
        }

        /* Modal untuk menambah link */
        .link-modal .modal-dialog {
            max-width: 600px;
        }
        
        /* App content when not authenticated */
        .app-content-unauthenticated {
            display: none;
        }

        /* Search box for desa dropdown */
        .dropdown-search-container {
            position: relative;
        }

        .dropdown-search {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            z-index: 1000;
            background: white;
            border: 1px solid #ddd;
            border-radius: 8px;
            padding: 8px;
            display: none;
        }

        .dropdown-search input {
            width: 100%;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
        }
    </style>
</head>
<body>
    <!-- Login Modal -->
    <div class="modal fade login-modal" id="loginModal" tabindex="-1" aria-hidden="true" data-bs-backdrop="static" data-bs-keyboard="false">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="login-header">
                    <div class="login-icon">
                        <i class="fas fa-lock"></i>
                    </div>
                    <h2 class="login-title">AUTHENTICATION REQUIRED</h2>
                    <p class="login-subtitle">Masukkan Kode Keamanan untuk Mengakses Aplikasi</p>
                </div>
                <div class="login-body">
                    <form id="loginForm">
                        <div class="mb-3 login-form-group">
                            <label class="form-label login-form-label">
                                <i class="fas fa-key"></i> Kode Keamanan
                            </label>
                            <div class="input-group">
                                <input type="password" class="form-control login-form-control" id="securityCode" placeholder="Masukkan kode akses aplikasi">
                                <button class="btn btn-outline-secondary toggle-password" type="button">
                                    <i class="fas fa-eye"></i>
                                </button>
                            </div>
                            <div class="form-text text-danger login-attempts-count" id="attemptsCount"></div>
                        </div>
                        <button type="submit" class="btn btn-login" id="loginButton">
                            <span class="login-button-text">Masuk ke Aplikasi</span>
                            <span class="spinner-border spinner-border-sm d-none" id="loginSpinner"></span>
                        </button>
                    </form>
                    
                    <div class="login-blocked-message d-none" id="blockedMessage">
                        <i class="fas fa-ban me-2"></i>
                        <span id="blockedText">Terlalu banyak percobaan gagal. Silakan coba lagi dalam </span>
                        <span class="login-countdown" id="countdown">30</span> detik.
                    </div>
                    
                    <div class="login-security-notice">
                        <i class="fas fa-info-circle me-2"></i>
                        Hubungi Administrator untuk mendapatkan kode akses
                    </div>
                    
                    <div class="login-developer-info">
                        <h5 class="mb-3">Developer Information</h5>
                        <div class="login-developer-contact">
                            <p><i class="fab fa-whatsapp me-2"></i> <a href="https://wa.me/6285647709114" target="_blank">+62 856-4770-9114</a></p>
                            <p><i class="fas fa-envelope me-2"></i> <a href="mailto:admin@anekamarket.my.id">admin@anekamarket.my.id</a></p>
                        </div>
                    </div>
                    
                    <div class="login-copyright">
                        &copy; 2025 Lentera karya Situbondo
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Login particle background -->
    <div id="login-particles"></div>
    
    <!-- Welcome Splash Screen -->
    <div class="welcome-splash" id="welcomeSplash">
        <button class="welcome-splash-close" id="closeSplash">
            <i class="fas fa-times"></i>
        </button>
        <div class="welcome-splash-content">
            <div class="welcome-splash-logo">
                <i class="fas fa-hands-helping"></i>
            </div>
            <h1 class="welcome-splash-title">SISTEM BANTUAN BARJAS</h1>
            <p class="welcome-splash-message">
                Aplikasi Sistem Bantuan BARJAS merupakan platform terpadu yang dirancang untuk mentransformasi pendataan, penyaluran, 
                dan monitoring program bantuan pemerintah. Aplikasi ini kami ciptakan untuk mendorong efisiensi, akurasi, 
                dan transparansi dalam pengelolaan bantuan, guna mempercepat penyerapan dan meningkatkan akuntabilitas.
            </p>
            <div class="welcome-splash-countdown" id="splashCountdown">
                Membuka aplikasi dalam <span id="countdownTimer">5</span> detik...
            </div>
        </div>
    </div>
    
    <!-- Main Application Content (initially hidden) -->
    <div class="app-content-unauthenticated" id="appContent">
        <!-- Mobile Menu Button -->
        <button class="mobile-menu-btn" id="mobileMenuBtn">
            <i class="fas fa-bars"></i>
        </button>
        
        <!-- Sidebar Overlay -->
        <div class="sidebar-overlay" id="sidebarOverlay"></div>
        
        <div class="app-container animate-fadeIn">
            <div class="app-header">
                <div class="app-logo">
                    <i class="fas fa-hands-helping"></i>
                </div>
                <h1 class="app-title">BARJAS</h1>
                <p class="app-subtitle">Sistem Bantuan Terpadu</p>
                <p class="app-subtitle" id="institutionName">Dinas Peternakan dan Perikanan Kabupaten Situbondo</p>
                <div class="watermark">v2.5.0</div>
            </div>
            
            <div class="row g-0">
                <!-- Sidebar Navigation -->
                <div class="col-md-3 col-lg-2 p-4 bg-light" id="sidebarMenu">
                    <ul class="nav nav-pills flex-column">
                        <li class="nav-item">
                            <a class="nav-link active" href="#" data-bs-target="dashboard">
                                <i class="fas fa-tachometer-alt feature-icon"></i> Dashboard
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="#" data-bs-target="inputData">
                                <i class="fas fa-pencil-alt feature-icon"></i> Input Data
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="#" data-bs-target="dataTable">
                                <i class="fas fa-table feature-icon"></i> Data Bantuan
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="#" data-bs-target="statistik">
                                <i class="fas fa-chart-pie feature-icon"></i> Statistik
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="#" data-bs-target="pengaturan">
                                <i class="fas fa-cog feature-icon"></i> Pengaturan
                            </a>
                        </li>
                        <li class="nav-item mt-4">
                            <a class="nav-link text-danger" href="#" id="logoutBtn">
                                <i class="fas fa-sign-out-alt feature-icon"></i> Keluar
                            </a>
                        </li>
                    </ul>
                    
                    <div class="developer-info mt-5">
                        <h6>Developer Contact</h6>
                        <div class="developer-contact">
                            <p><i class="fab fa-whatsapp me-2"></i> <a href="https://wa.me/6285647709114" target="_blank">+62 856-4770-9114</a></p>
                            <p><i class="fas fa-envelope me-2"></i> <a href="mailto:admin@anekamarket.my.id">admin@anekamarket.my.id</a></p>
                        </div>
                    </div>
                </div>
                
                <!-- Main Content Area -->
                <div class="col-md-9 col-lg-10 p-5">
                    <!-- Dashboard Section -->
                    <div class="content-section" id="dashboard">
                        <h3 class="section-title">Dashboard</h3>
                        
                        <div class="row">
                            <div class="col-md-4">
                                <div class="stats-box">
                                    <i class="fas fa-users fa-2x text-primary"></i>
                                    <div class="stats-number" id="totalPenerima">0</div>
                                    <div class="stats-label">Total Penerima Bantuan</div>
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="stats-box">
                                    <i class="fas fa-check-circle fa-2x text-success"></i>
                                    <div class="stats-number" id="totalTersalurkan">0</div>
                                    <div class="stats-label">Bantuan Tersalurkan</div>
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="stats-box">
                                    <i class="fas fa-chart-line fa-2x text-warning"></i>
                                    <div class="stats-number" id="persentaseTersalurkan">0%</div>
                                    <div class="stats-label">Persentase Tersalurkan</div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="row mt-4">
                            <div class="col-md-6">
                                <div class="card">
                                    <div class="card-header">
                                        <i class="fas fa-chart-bar me-2"></i> Statistik Bantuan per Kecamatan
                                    </div>
                                    <div class="card-body">
                                        <canvas id="kecamatanChart" height="250"></canvas>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="card">
                                    <div class="card-header">
                                        <i class="fas fa-chart-pie me-2"></i> Distribusi Jenis Bantuan
                                    </div>
                                    <div class="card-body">
                                        <canvas id="jenisBantuanChart" height="250"></canvas>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="row mt-4">
                            <div class="col-12">
                                <div class="card">
                                    <div class="card-header">
                                        <i class="fas fa-history me-2"></i> Aktivitas Terbaru
                                    </div>
                                    <div class="card-body">
                                        <div class="table-responsive">
                                            <table class="table table-hover" id="recentActivityTable">
                                                <thead>
                                                    <tr>
                                                        <th>Tanggal</th>
                                                        <th>Nama Penerima</th>
                                                        <th>Desa/Kelurahan</th>
                                                        <th>Jenis Bantuan</th>
                                                        <th>Status</th>
                                                    </tr>
                                                </thead>
                                                <tbody>
                                                    <!-- Data aktivitas akan diisi oleh JavaScript -->
                                                </tbody>
                                            </table>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Input Data Section -->
                    <div class="content-section d-none" id="inputData">
                        <h3 class="section-title">Input Data Bantuan</h3>
                        
                        <div class="card">
                            <div class="card-header">
                                <i class="fas fa-pencil-alt me-2"></i> Formulir Input Data Penerima Bantuan
                            </div>
                            <div class="card-body">
                                <form id="bantuanForm">
                                    <div class="row">
                                        <div class="col-md-6 mb-3">
                                            <label for="namaPenerima" class="form-label">
                                                <i class="fas fa-user"></i> Nama Penerima
                                            </label>
                                            <input type="text" class="form-control" id="namaPenerima" placeholder="Masukkan nama lengkap penerima">
                                            <div class="error-message" id="namaPenerimaError">Nama penerima harus diisi</div>
                                        </div>
                                        <div class="col-md-6 mb-3">
                                            <label for="namaKelompok" class="form-label">
                                                <i class="fas fa-users"></i> Nama Kelompok
                                            </label>
                                            <input type="text" class="form-control" id="namaKelompok" placeholder="Masukkan nama kelompok" oninput="this.value = this.value.toUpperCase()">
                                        </div>
                                    </div>
                                    
                                    <div class="row">
                                        <div class="col-md-6 mb-3">
                                            <label for="nomorWhatsApp" class="form-label">
                                                <i class="fab fa-whatsapp"></i> Nomor WhatsApp
                                            </label>
                                            <input type="text" class="form-control" id="nomorWhatsApp" placeholder="Contoh: 628123456789">
                                            <div class="error-message" id="whatsappError">Format nomor WhatsApp tidak valid</div>
                                        </div>
                                        <div class="col-md-6 mb-3">
                                            <label for="jumlahBantuan" class="form-label">
                                                <i class="fas fa-box"></i> Jumlah Bantuan
                                            </label>
                                            <input type="number" class="form-control" id="jumlahBantuan" placeholder="Masukkan jumlah bantuan">
                                        </div>
                                    </div>
                                    
                                    <div class="row">
                                        <div class="col-md-6 mb-3">
                                            <label for="jenisBantuan" class="form-label">
                                                <i class="fas fa-gift"></i> Jenis Bantuan
                                            </label>
                                            <select class="form-select" id="jenisBantuan">
                                                <option value="" selected disabled>Pilih Jenis Bantuan</option>
                                                <option value="Pakan Ternak">Pakan Ternak</option>
                                                <option value="Bibit Ikan">Bibit Ikan</option>
                                                <option value="Pupuk">Pupuk</option>
                                                <option value="Alat Pertanian">Alat Pertanian</option>
                                                <option value="Bantuan Tunai">Bantuan Tunai</option>
                                                <option value="Lainnya">Lainnya</option>
                                            </select>
                                            <div class="error-message" id="jenisBantuanError">Jenis bantuan harus dipilih</div>
                                        </div>
                                        <div class="col-md-6 mb-3">
                                            <label for="tanggalPenyaluran" class="form-label">
                                                <i class="fas fa-calendar-alt"></i> Tanggal Penyaluran
                                            </label>
                                            <input type="date" class="form-control" id="tanggalPenyaluran">
                                            <div class="error-message" id="tanggalError">Tanggal penyaluran harus diisi</div>
                                        </div>
                                    </div>
                                    
                                    <div class="row">
                                        <div class="col-md-6 mb-3">
                                            <label for="kecamatan" class="form-label">
                                                <i class="fas fa-map-marker-alt"></i> Kecamatan
                                            </label>
                                            <select class="form-select" id="kecamatan">
                                                <option value="" selected disabled>Pilih Kecamatan</option>
                                                <option value="Arjasa">Arjasa</option>
                                                <option value="Asembagus">Asembagus</option>
                                                <option value="Banyuglugur">Banyuglugur</option>
                                                <option value="Banyuputih">Banyuputih</option>
                                                <option value="Besuki">Besuki</option>
                                                <option value="Bungatan">Bungatan</option>
                                                <option value="Jangkar">Jangkar</option>
                                                <option value="Jatibanteng">Jatibanteng</option>
                                                <option value="Kapongan">Kapongan</option>
                                                <option value="Kendit">Kendit</option>
                                                <option value="Mangaran">Mangaran</option>
                                                <option value="Mlandingan">Mlandingan</option>
                                                <option value="Panarukan">Panarukan</option>
                                                <option value="Panji">Panji</option>
                                                <option value="Situbondo">Situbondo (Kecamatan Pusat Kota)</option>
                                                <option value="Suboh">Suboh</option>
                                                <option value="Sumbermalang">Sumbermalang</option>
                                            </select>
                                            <div class="error-message" id="kecamatanError">Kecamatan harus dipilih</div>
                                        </div>
                                        <div class="col-md-6 mb-3">
                                            <label for="desa" class="form-label">
                                                <i class="fas fa-map-marked-alt"></i> Desa/Kelurahan
                                            </label>
                                            <input type="text" class="form-control" id="desa" placeholder="Masukkan nama desa/kelurahan">
                                            <div class="error-message" id="desaError">Desa/kelurahan harus diisi</div>
                                        </div>
                                    </div>
                                    
                                    <div class="mb-3">
                                        <label for="alamatLengkap" class="form-label">
                                            <i class="fas fa-home"></i> Alamat Lengkap
                                        </label>
                                        <textarea class="form-control" id="alamatLengkap" rows="3" placeholder="Masukkan alamat lengkap penerima"></textarea>
                                    </div>
                                    
                                    <div class="mb-3">
                                        <label for="keterangan" class="form-label">
                                            <i class="fas fa-sticky-note"></i> Keterangan (Opsional)
                                        </label>
                                        <textarea class="form-control" id="keterangan" rows="2" placeholder="Tambahkan keterangan jika diperlukan"></textarea>
                                    </div>
                                    
                                    <div class="mb-3">
                                        <label for="statusPenyaluran" class="form-label">
                                            <i class="fas fa-check-circle"></i> Status Penyaluran
                                        </label>
                                        <select class="form-select" id="statusPenyaluran">
                                            <option value="Tersalurkan">Tersalurkan</option>
                                            <option value="Belum Tersalurkan">Belum Tersalurkan</option>
                                            <option value="Dalam Proses">Dalam Proses</option>
                                        </select>
                                    </div>
                                    
                                    <div class="d-flex justify-content-between mt-4">
                                        <button type="reset" class="btn btn-secondary">
                                            <i class="fas fa-undo me-2"></i> Reset Form
                                        </button>
                                        <button type="submit" class="btn btn-primary">
                                            <i class="fas fa-save me-2"></i> Simpan Data
                                        </button>
                                    </div>
                                </form>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Data Table Section -->
                    <div class="content-section d-none" id="dataTable">
                        <h3 class="section-title">Data Bantuan</h3>
                        
                        <div class="filter-section">
                            <div class="row">
                                <div class="col-md-3 mb-2">
                                    <label for="filterKecamatan" class="form-label">Filter Kecamatan</label>
                                    <select class="form-select" id="filterKecamatan">
                                        <option value="">Semua Kecamatan</option>
                                        <option value="Arjasa">Arjasa</option>
                                        <option value="Asembagus">Asembagus</option>
                                        <option value="Banyuglugur">Banyuglugur</option>
                                        <option value="Banyuputih">Banyuputih</option>
                                        <option value="Besuki">Besuki</option>
                                        <option value="Bungatan">Bungatan</option>
                                        <option value="Jangkar">Jangkar</option>
                                        <option value="Jatibanteng">Jatibanteng</option>
                                        <option value="Kapongan">Kapongan</option>
                                        <option value="Kendit">Kendit</option>
                                        <option value="Mangaran">Mangaran</option>
                                        <option value="Mlandingan">Mlandingan</option>
                                        <option value="Panarukan">Panarukan</option>
                                        <option value="Panji">Panji</option>
                                        <option value="Situbondo">Situbondo</option>
                                        <option value="Suboh">Suboh</option>
                                        <option value="Sumbermalang">Sumbermalang</option>
                                    </select>
                                </div>
                                <div class="col-md-3 mb-2">
                                    <label for="filterStatus" class="form-label">Filter Status</label>
                                    <select class="form-select" id="filterStatus">
                                        <option value="">Semua Status</option>
                                        <option value="Tersalurkan">Tersalurkan</option>
                                        <option value="Belum Tersalurkan">Belum Tersalurkan</option>
                                        <option value="Dalam Proses">Dalam Proses</option>
                                    </select>
                                </div>
                                <div class="col-md-3 mb-2">
                                    <label for="filterJenis" class="form-label">Filter Jenis Bantuan</label>
                                    <select class="form-select" id="filterJenis">
                                        <option value="">Semua Jenis</option>
                                        <option value="Pakan Ternak">Pakan Ternak</option>
                                        <option value="Bibit Ikan">Bibit Ikan</option>
                                        <option value="Pupuk">Pupuk</option>
                                        <option value="Alat Pertanian">Alat Pertanian</option>
                                        <option value="Bantuan Tunai">Bantuan Tunai</option>
                                        <option value="Lainnya">Lainnya</option>
                                    </select>
                                </div>
                                <div class="col-md-3 mb-2">
                                    <label for="searchInput" class="form-label">Cari Data</label>
                                    <div class="input-group">
                                        <input type="text" class="form-control" id="searchInput" placeholder="Cari...">
                                        <button class="btn btn-outline-secondary" type="button" id="clearSearch">
                                            <i class="fas fa-times"></i>
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="control-panel">
                            <h6 class="control-title">Kelola Data</h6>
                            <div class="d-flex flex-wrap gap-2">
                                <button class="btn btn-primary btn-sm" id="exportExcelBtn">
                                    <i class="fas fa-file-excel me-2"></i> Export Excel
                                </button>
                                <button class="btn btn-success btn-sm" id="exportPDFBtn">
                                    <i class="fas fa-file-pdf me-2"></i> Export PDF
                                </button>
                                <button class="btn btn-warning btn-sm" id="printBtn">
                                    <i class="fas fa-print me-2"></i> Cetak Laporan
                                </button>
                                <button class="btn btn-danger btn-sm" id="deleteAllBtn">
                                    <i class="fas fa-trash-alt me-2"></i> Hapus Semua Data
                                </button>
                            </div>
                        </div>
                        
                        <div class="table-responsive mt-3">
                            <table class="table table-striped table-bordered data-table" id="bantuanTable">
                                <thead>
                                    <tr>
                                        <th>No</th>
                                        <th>Tanggal</th>
                                        <th>Nama Penerima</th>
                                        <th>Nama Kelompok</th>
                                        <th>WhatsApp</th>
                                        <th>Jumlah</th>
                                        <th>Jenis Bantuan</th>
                                        <th>Kecamatan</th>
                                        <th>Desa/Kelurahan</th>
                                        <th>Alamat</th>
                                        <th>Status</th>
                                        <th>Aksi</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <!-- Data akan diisi oleh JavaScript -->
                                </tbody>
                            </table>
                        </div>
                        
                        <div class="d-flex justify-content-between align-items-center mt-3">
                            <div class="text-muted" id="tableInfo">Menampilkan 0 data</div>
                            <nav>
                                <ul class="pagination pagination-sm" id="pagination">
                                    <!-- Pagination akan diisi oleh JavaScript -->
                                </ul>
                            </nav>
                        </div>
                    </div>
                    
                    <!-- Statistik Section -->
                    <div class="content-section d-none" id="statistik">
                        <h3 class="section-title">Statistik Bantuan</h3>
                        
                        <div class="row">
                            <div class="col-md-6">
                                <div class="card">
                                    <div class="card-header">
                                        <i class="fas fa-chart-bar me-2"></i> Statistik per Kecamatan
                                    </div>
                                    <div class="card-body">
                                        <canvas id="statistikKecamatanChart" height="300"></canvas>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="card">
                                    <div class="card-header">
                                        <i class="fas fa-chart-pie me-2"></i> Distribusi Status Penyaluran
                                    </div>
                                    <div class="card-body">
                                        <canvas id="statistikStatusChart" height="300"></canvas>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="row mt-4">
                            <div class="col-md-12">
                                <div class="card">
                                    <div class="card-header">
                                        <i class="fas fa-table me-2"></i> Data Statistik Detail
                                    </div>
                                    <div class="card-body">
                                        <div class="table-responsive">
                                            <table class="table table-bordered" id="statistikTable">
                                                <thead>
                                                    <tr>
                                                        <th>Kecamatan</th>
                                                        <th>Jumlah Penerima</th>
                                                        <th>Tersalurkan</th>
                                                        <th>Belum Tersalurkan</th>
                                                        <th>Dalam Proses</th>
                                                        <th>Persentase Tersalurkan</th>
                                                    </tr>
                                                </thead>
                                                <tbody>
                                                    <!-- Data statistik akan diisi oleh JavaScript -->
                                                </tbody>
                                            </table>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Pengaturan Section -->
                    <div class="content-section d-none" id="pengaturan">
                        <h3 class="section-title">Pengaturan Aplikasi</h3>
                        
                        <div class="row">
                            <div class="col-md-6">
                                <div class="card">
                                    <div class="card-header">
                                        <i class="fas fa-cog me-2"></i> Pengaturan Umum
                                    </div>
                                    <div class="card-body">
                                        <form id="settingsForm">
                                            <div class="mb-3">
                                                <label for="institutionNameInput" class="form-label">Nama Instansi</label>
                                                <input type="text" class="form-control" id="institutionNameInput" value="Dinas Peternakan dan Perikanan Kabupaten Situbondo">
                                            </div>
                                            <div class="mb-3">
                                                <label for="itemsPerPage" class="form-label">Item per Halaman</label>
                                                <select class="form-select" id="itemsPerPage">
                                                    <option value="5">5</option>
                                                    <option value="10" selected>10</option>
                                                    <option value="25">25</option>
                                                    <option value="50">50</option>
                                                    <option value="100">100</option>
                                                </select>
                                            </div>
                                            <div class="form-check form-switch mb-3">
                                                <input class="form-check-input" type="checkbox" id="notificationsEnabled" checked>
                                                <label class="form-check-label" for="notificationsEnabled">Aktifkan Notifikasi</label>
                                            </div>
                                            <div class="form-check form-switch mb-3">
                                                <input class="form-check-input" type="checkbox" id="autoSaveEnabled" checked>
                                                <label class="form-check-label" for="autoSaveEnabled">Simpan Otomatis</label>
                                            </div>
                                            <button type="submit" class="btn btn-primary">
                                                <i class="fas fa-save me-2"></i> Simpan Pengaturan
                                            </button>
                                        </form>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="col-md-6">
                                <div class="card">
                                    <div class="card-header">
                                        <i class="fas fa-database me-2"></i> Kelola Data
                                    </div>
                                    <div class="card-body">
                                        <div class="d-grid gap-2">
                                            <button class="btn btn-success mb-2" id="backupDataBtn">
                                                <i class="fas fa-download me-2"></i> Backup Data
                                            </button>
                                            <button class="btn btn-warning mb-2" id="restoreDataBtn">
                                                <i class="fas fa-upload me-2"></i> Restore Data
                                            </button>
                                            <input type="file" class="d-none" id="restoreFileInput" accept=".json">
                                            <button class="btn btn-danger mb-2" id="resetDataBtn">
                                                <i class="fas fa-trash-alt me-2"></i> Reset Semua Data
                                            </button>
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="card mt-4">
                                    <div class="card-header">
                                        <i class="fas fa-info-circle me-2"></i> Informasi Aplikasi
                                    </div>
                                    <div class="card-body">
                                        <div class="mb-3">
                                            <strong>Versi Aplikasi:</strong> 2.5.0
                                        </div>
                                        <div class="mb-3">
                                            <strong>Tanggal Pembaruan:</strong> 25 Agustus 2025
                                        </div>
                                        <div class="mb-3">
                                            <strong>Developer:</strong> Lentera Karya Situbondo
                                        </div>
                                        <div>
                                            <strong>Kontak:</strong> 
                                            <a href="https://wa.me/6285647709114" target="_blank">+62 856-4770-9114</a>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="copyright">
                &copy; 2025 BARJAS - Sistem Bantuan Terpadu. Dikembangkan oleh <strong>Lentera Karya Situbondo</strong>
            </div>
        </div>
        
        <!-- Floating Action Button -->
        <div class="floating-action-btn" id="fabBtn">
            <i class="fas fa-plus"></i>
        </div>
        
        <!-- Notification Toast -->
        <div class="toast notification-toast" role="alert" aria-live="assertive" aria-atomic="true" id="notificationToast">
            <div class="toast-header">
                <strong class="me-auto" id="toastTitle">BARJAS Notification</strong>
                <small id="toastTime">Just now</small>
                <button type="button" class="btn-close" data-bs-dismiss="toast" aria-label="Close"></button>
            </div>
            <div class="toast-body" id="toastMessage">
                <!-- Message will be inserted here -->
            </div>
        </div>
    </div>
    
    <!-- Print Header (hidden by default) -->
    <div class="print-header d-none">
        <h2 class="print-title">LAPORAN DATA BANTUAN</h2>
        <p class="print-subtitle" id="printInstitutionName">Dinas Peternakan dan Perikanan Kabupaten Situbondo</p>
        <p class="print-date" id="printDate"></p>
    </div>

    <!-- Scripts -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-datepicker/1.9.0/js/bootstrap-datepicker.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script>
        // Konfigurasi dan variabel global
        const APP_CONFIG = {
            appName: 'BARJAS',
            appVersion: '2.5.0',
            securityCode: 'barjas2025', // Kode keamanan default
            maxLoginAttempts: 3,
            loginBlockTime: 30, // dalam detik
            itemsPerPage: 10,
            dataKey: 'barjas_data',
            settingsKey: 'barjas_settings'
        };

        // Inisialisasi data default
        let barjasData = [];
        let settings = {
            institutionName: 'Dinas Peternakan dan Perikanan Kabupaten Situbondo',
            itemsPerPage: 10,
            notificationsEnabled: true,
            autoSaveEnabled: true
        };

        // Elemen DOM
        const elements = {
            loginModal: null,
            welcomeSplash: null,
            appContent: null,
            bantuanForm: null,
            bantuanTable: null,
            totalPenerima: null,
            totalTersalurkan: null,
            persentaseTersalurkan: null,
            notificationToast: null,
            filterKecamatan: null,
            filterStatus: null,
            filterJenis: null,
            searchInput: null,
            pagination: null,
            tableInfo: null
        };

        // Status aplikasi
        let currentPage = 1;
        let filteredData = [];
        let loginAttempts = 0;
        let isBlocked = false;
        let loginTimer = null;

        // Fungsi inisialisasi aplikasi
        function initApp() {
            // Inisialisasi elemen DOM
            initializeElements();
            
            // Muat data dari localStorage
            loadData();
            
            // Setup event listeners
            setupEventListeners();
            
            // Setup chart
            setupCharts();
            
            // Tampilkan splash screen
            showSplashScreen();
        }

        // Inisialisasi elemen DOM
        function initializeElements() {
            elements.loginModal = new bootstrap.Modal(document.getElementById('loginModal'));
            elements.welcomeSplash = document.getElementById('welcomeSplash');
            elements.appContent = document.getElementById('appContent');
            elements.bantuanForm = document.getElementById('bantuanForm');
            elements.bantuanTable = document.getElementById('bantuanTable');
            elements.totalPenerima = document.getElementById('totalPenerima');
            elements.totalTersalurkan = document.getElementById('totalTersalurkan');
            elements.persentaseTersalurkan = document.getElementById('persentaseTersalurkan');
            elements.notificationToast = new bootstrap.Toast(document.getElementById('notificationToast'));
            elements.filterKecamatan = document.getElementById('filterKecamatan');
            elements.filterStatus = document.getElementById('filterStatus');
            elements.filterJenis = document.getElementById('filterJenis');
            elements.searchInput = document.getElementById('searchInput');
            elements.pagination = document.getElementById('pagination');
            elements.tableInfo = document.getElementById('tableInfo');
        }

        // Muat data dari localStorage
        function loadData() {
            const savedData = localStorage.getItem(APP_CONFIG.dataKey);
            const savedSettings = localStorage.getItem(APP_CONFIG.settingsKey);
            
            if (savedData) {
                barjasData = JSON.parse(savedData);
            }
            
            if (savedSettings) {
                settings = JSON.parse(savedSettings);
                applySettings();
            }
        }

        // Terapkan pengaturan
        function applySettings() {
            document.getElementById('institutionName').textContent = settings.institutionName;
            document.getElementById('institutionNameInput').value = settings.institutionName;
            document.getElementById('itemsPerPage').value = settings.itemsPerPage;
            document.getElementById('notificationsEnabled').checked = settings.notificationsEnabled;
            document.getElementById('autoSaveEnabled').checked = settings.autoSaveEnabled;
            APP_CONFIG.itemsPerPage = settings.itemsPerPage;
        }

        // Setup event listeners
        function setupEventListeners() {
            // Navigation
            document.querySelectorAll('.nav-link').forEach(link => {
                link.addEventListener('click', function(e) {
                    e.preventDefault();
                    const target = this.getAttribute('data-bs-target');
                    showSection(target);
                });
            });
            
            // Mobile menu
            document.getElementById('mobileMenuBtn').addEventListener('click', toggleMobileMenu);
            document.getElementById('sidebarOverlay').addEventListener('click', toggleMobileMenu);
            
            // Form submission
            elements.bantuanForm.addEventListener('submit', handleFormSubmit);
            
            // Filter events
            elements.filterKecamatan.addEventListener('change', applyFilters);
            elements.filterStatus.addEventListener('change', applyFilters);
            elements.filterJenis.addEventListener('change', applyFilters);
            elements.searchInput.addEventListener('input', applyFilters);
            document.getElementById('clearSearch').addEventListener('click', clearSearch);
            
            // Control buttons
            document.getElementById('exportExcelBtn').addEventListener('click', exportToExcel);
            document.getElementById('exportPDFBtn').addEventListener('click', exportToPDF);
            document.getElementById('printBtn').addEventListener('click', printReport);
            document.getElementById('deleteAllBtn').addEventListener('click', confirmDeleteAll);
            document.getElementById('resetDataBtn').addEventListener('click', confirmResetData);
            document.getElementById('backupDataBtn').addEventListener('click', backupData);
            document.getElementById('restoreDataBtn').addEventListener('click', triggerRestore);
            document.getElementById('restoreFileInput').addEventListener('change', restoreData);
            
            // Settings form
            document.getElementById('settingsForm').addEventListener('submit', saveSettings);
            
            // Logout
            document.getElementById('logoutBtn').addEventListener('click', logout);
            
            // FAB button
            document.getElementById('fabBtn').addEventListener('click', function() {
                showSection('inputData');
                elements.bantuanForm.scrollIntoView({ behavior: 'smooth' });
            });
            
            // Login form
            document.getElementById('loginForm').addEventListener('submit', handleLogin);
            document.querySelector('.toggle-password').addEventListener('click', togglePasswordVisibility);
            
            // Close splash screen
            document.getElementById('closeSplash').addEventListener('click', closeSplashScreen);
        }

        // Tampilkan section tertentu
        function showSection(sectionId) {
            // Sembunyikan semua section
            document.querySelectorAll('.content-section').forEach(section => {
                section.classList.add('d-none');
            });
            
            // Tampilkan section yang dipilih
            document.getElementById(sectionId).classList.remove('d-none');
            
            // Update navigation
            document.querySelectorAll('.nav-link').forEach(link => {
                link.classList.remove('active');
                if (link.getAttribute('data-bs-target') === sectionId) {
                    link.classList.add('active');
                }
            });
            
            // Jika section adalah dataTable, refresh tabel
            if (sectionId === 'dataTable') {
                applyFilters();
            }
            
            // Jika section adalah dashboard, refresh dashboard
            if (sectionId === 'dashboard') {
                updateDashboard();
            }
            
            // Jika section adalah statistik, refresh statistik
            if (sectionId === 'statistik') {
                updateStatistik();
            }
            
            // Tutup mobile menu jika terbuka
            if (window.innerWidth < 992) {
                document.getElementById('sidebarMenu').classList.remove('mobile-show');
                document.getElementById('sidebarOverlay').classList.remove('mobile-show');
            }
        }

        // Toggle mobile menu
        function toggleMobileMenu() {
            const sidebar = document.getElementById('sidebarMenu');
            const overlay = document.getElementById('sidebarOverlay');
            
            sidebar.classList.toggle('mobile-show');
            overlay.classList.toggle('mobile-show');
        }

        // Handle form submission
        function handleFormSubmit(e) {
            e.preventDefault();
            
            if (validateForm()) {
                const formData = {
                    id: Date.now(),
                    tanggal: new Date().toISOString().split('T')[0],
                    namaPenerima: document.getElementById('namaPenerima').value,
                    namaKelompok: document.getElementById('namaKelompok').value,
                    nomorWhatsApp: document.getElementById('nomorWhatsApp').value,
                    jumlahBantuan: document.getElementById('jumlahBantuan').value,
                    jenisBantuan: document.getElementById('jenisBantuan').value,
                    tanggalPenyaluran: document.getElementById('tanggalPenyaluran').value,
                    kecamatan: document.getElementById('kecamatan').value,
                    desa: document.getElementById('desa').value,
                    alamatLengkap: document.getElementById('alamatLengkap').value,
                    keterangan: document.getElementById('keterangan').value,
                    statusPenyaluran: document.getElementById('statusPenyaluran').value
                };
                
                barjasData.push(formData);
                saveData();
                
                showNotification('Sukses', 'Data berhasil disimpan!', 'success');
                elements.bantuanForm.reset();
                
                // Jika sedang di dashboard, update dashboard
                if (!document.getElementById('dashboard').classList.contains('d-none')) {
                    updateDashboard();
                }
            }
        }

        // Validasi form
        function validateForm() {
            let isValid = true;
            
            // Validasi nama penerima
            const namaPenerima = document.getElementById('namaPenerima');
            const namaPenerimaError = document.getElementById('namaPenerimaError');
            
            if (!namaPenerima.value.trim()) {
                namaPenerima.classList.add('input-error');
                namaPenerimaError.style.display = 'block';
                isValid = false;
            } else {
                namaPenerima.classList.remove('input-error');
                namaPenerimaError.style.display = 'none';
            }
            
            // Validasi jenis bantuan
            const jenisBantuan = document.getElementById('jenisBantuan');
            const jenisBantuanError = document.getElementById('jenisBantuanError');
            
            if (!jenisBantuan.value) {
                jenisBantuan.classList.add('input-error');
                jenisBantuanError.style.display = 'block';
                isValid = false;
            } else {
                jenisBantuan.classList.remove('input-error');
                jenisBantuanError.style.display = 'none';
            }
            
            // Validasi tanggal penyaluran
            const tanggalPenyaluran = document.getElementById('tanggalPenyaluran');
            const tanggalError = document.getElementById('tanggalError');
            
            if (!tanggalPenyaluran.value) {
                tanggalPenyaluran.classList.add('input-error');
                tanggalError.style.display = 'block';
                isValid = false;
            } else {
                tanggalPenyaluran.classList.remove('input-error');
                tanggalError.style.display = 'none';
            }
            
            // Validasi kecamatan
            const kecamatan = document.getElementById('kecamatan');
            const kecamatanError = document.getElementById('kecamatanError');
            
            if (!kecamatan.value) {
                kecamatan.classList.add('input-error');
                kecamatanError.style.display = 'block';
                isValid = false;
            } else {
                kecamatan.classList.remove('input-error');
                kecamatanError.style.display = 'none';
            }
            
            // Validasi desa
            const desa = document.getElementById('desa');
            const desaError = document.getElementById('desaError');
            
            if (!desa.value.trim()) {
                desa.classList.add('input-error');
                desaError.style.display = 'block';
                isValid = false;
            } else {
                desa.classList.remove('input-error');
                desaError.style.display = 'none';
            }
            
            // Validasi WhatsApp (opsional, tapi jika diisi harus valid)
            const whatsapp = document.getElementById('nomorWhatsApp');
            const whatsappError = document.getElementById('whatsappError');
            
            if (whatsapp.value.trim() && !isValidWhatsApp(whatsapp.value)) {
                whatsapp.classList.add('input-error');
                whatsappError.style.display = 'block';
                isValid = false;
            } else {
                whatsapp.classList.remove('input-error');
                whatsappError.style.display = 'none';
            }
            
            return isValid;
        }

        // Validasi nomor WhatsApp
        function isValidWhatsApp(number) {
            // Format: 62xxxxxxxxxx atau 628xxxxxxxxx
            const regex = /^(\+62|62|0)8[1-9][0-9]{6,9}$/;
            return regex.test(number);
        }

        // Format nomor WhatsApp untuk ditampilkan
        function formatWhatsApp(number) {
            if (!number) return '-';
            // Hilangkan prefix 0 atau +62 atau 62
            let cleaned = number.replace(/^(\+62|62|0)/, '');
            // Pastikan dimulai dengan 8
            if (!cleaned.startsWith('8')) cleaned = '8' + cleaned;
            // Format menjadi 62xxxxxxxxxx
            return '62' + cleaned;
        }

        // Buat link WhatsApp
        function createWhatsAppLink(number) {
            if (!number) return '#';
            const formatted = formatWhatsApp(number);
            return `https://wa.me/${formatted}`;
        }

        // Simpan data ke localStorage
        function saveData() {
            localStorage.setItem(APP_CONFIG.dataKey, JSON.stringify(barjasData));
        }

        // Tampilkan notifikasi
        function showNotification(title, message, type = 'info') {
            if (!settings.notificationsEnabled) return;
            
            document.getElementById('toastTitle').textContent = title;
            document.getElementById('toastMessage').textContent = message;
            document.getElementById('toastTime').textContent = new Date().toLocaleTimeString();
            
            // Set background color based on type
            const toast = document.getElementById('notificationToast');
            toast.className = `toast notification-toast ${type}`;
            
            elements.notificationToast.show();
        }

        // Terapkan filter
        function applyFilters() {
            const kecamatan = elements.filterKecamatan.value;
            const status = elements.filterStatus.value;
            const jenis = elements.filterJenis.value;
            const searchTerm = elements.searchInput.value.toLowerCase();
            
            filteredData = barjasData.filter(item => {
                return (
                    (kecamatan ? item.kecamatan === kecamatan : true) &&
                    (status ? item.statusPenyaluran === status : true) &&
                    (jenis ? item.jenisBantuan === jenis : true) &&
                    (searchTerm ? 
                        item.namaPenerima.toLowerCase().includes(searchTerm) ||
                        item.desa.toLowerCase().includes(searchTerm) ||
                        item.jenisBantuan.toLowerCase().includes(searchTerm) ||
                        item.statusPenyaluran.toLowerCase().includes(searchTerm)
                    : true)
                );
            });
            
            currentPage = 1;
            renderTable();
            updatePagination();
        }

        // Bersihkan pencarian
        function clearSearch() {
            elements.searchInput.value = '';
            applyFilters();
        }

        // Render tabel
        function renderTable() {
            const tbody = elements.bantuanTable.querySelector('tbody');
            tbody.innerHTML = '';
            
            const startIndex = (currentPage - 1) * APP_CONFIG.itemsPerPage;
            const endIndex = startIndex + APP_CONFIG.itemsPerPage;
            const pageData = filteredData.slice(startIndex, endIndex);
            
            if (pageData.length === 0) {
                const tr = document.createElement('tr');
                tr.innerHTML = `<td colspan="12" class="text-center py-4">Tidak ada data yang ditemukan</td>`;
                tbody.appendChild(tr);
                return;
            }
            
            pageData.forEach((item, index) => {
                const tr = document.createElement('tr');
                const no = startIndex + index + 1;
                
                // Format WhatsApp number dengan link
                const whatsappLink = item.nomorWhatsApp ? 
                    `<a href="${createWhatsAppLink(item.nomorWhatsApp)}" target="_blank" class="whatsapp-link">
                        <i class="fab fa-whatsapp me-1"></i>${item.nomorWhatsApp}
                     </a>` : '-';
                
                tr.innerHTML = `
                    <td class="text-center">${no}</td>
                    <td>${formatDate(item.tanggal)}</td>
                    <td>${item.namaPenerima}</td>
                    <td>${item.namaKelompok || '-'}</td>
                    <td>${whatsappLink}</td>
                    <td class="text-center">${item.jumlahBantuan || '-'}</td>
                    <td>${item.jenisBantuan}</td>
                    <td>${item.kecamatan}</td>
                    <td>${item.desa}</td>
                    <td>${item.alamatLengkap || '-'}</td>
                    <td><span class="badge ${getStatusBadgeClass(item.statusPenyaluran)}">${item.statusPenyaluran}</span></td>
                    <td class="text-center">
                        <button class="btn btn-sm btn-danger delete-btn" data-id="${item.id}">
                            <i class="fas fa-trash-alt"></i>
                        </button>
                    </td>
                `;
                
                tbody.appendChild(tr);
            });
            
            // Add event listeners to delete buttons
            tbody.querySelectorAll('.delete-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    const id = parseInt(this.getAttribute('data-id'));
                    confirmDelete(id);
                });
            });
            
            // Update table info
            updateTableInfo();
        }

        // Dapatkan class badge berdasarkan status
        function getStatusBadgeClass(status) {
            switch (status) {
                case 'Tersalurkan': return 'bg-success';
                case 'Belum Tersalurkan': return 'bg-danger';
                case 'Dalam Proses': return 'bg-warning';
                default: return 'bg-secondary';
            }
        }

        // Format tanggal
        function formatDate(dateString) {
            const options = { day: '2-digit', month: '2-digit', year: 'numeric' };
            return new Date(dateString).toLocaleDateString('id-ID', options);
        }

        // Update info tabel
        function updateTableInfo() {
            const total = filteredData.length;
            const start = total === 0 ? 0 : (currentPage - 1) * APP_CONFIG.itemsPerPage + 1;
            const end = Math.min(currentPage * APP_CONFIG.itemsPerPage, total);
            
            elements.tableInfo.textContent = `Menampilkan ${start} sampai ${end} dari ${total} data`;
        }

        // Update pagination
        function updatePagination() {
            const totalPages = Math.ceil(filteredData.length / APP_CONFIG.itemsPerPage);
            elements.pagination.innerHTML = '';
            
            if (totalPages <= 1) return;
            
            // Previous button
            const prevLi = document.createElement('li');
            prevLi.className = `page-item ${currentPage === 1 ? 'disabled' : ''}`;
            prevLi.innerHTML = `<a class="page-link" href="#" aria-label="Previous"><span aria-hidden="true">&laquo;</span></a>`;
            prevLi.addEventListener('click', function(e) {
                e.preventDefault();
                if (currentPage > 1) {
                    currentPage--;
                    renderTable();
                    updatePagination();
                }
            });
            elements.pagination.appendChild(prevLi);
            
            // Page numbers
            const startPage = Math.max(1, currentPage - 2);
            const endPage = Math.min(totalPages, startPage + 4);
            
            for (let i = startPage; i <= endPage; i++) {
                const pageLi = document.createElement('li');
                pageLi.className = `page-item ${i === currentPage ? 'active' : ''}`;
                pageLi.innerHTML = `<a class="page-link" href="#">${i}</a>`;
                pageLi.addEventListener('click', function(e) {
                    e.preventDefault();
                    currentPage = i;
                    renderTable();
                    updatePagination();
                });
                elements.pagination.appendChild(pageLi);
            }
            
            // Next button
            const nextLi = document.createElement('li');
            nextLi.className = `page-item ${currentPage === totalPages ? 'disabled' : ''}`;
            nextLi.innerHTML = `<a class="page-link" href="#" aria-label="Next"><span aria-hidden="true">&raquo;</span></a>`;
            nextLi.addEventListener('click', function(e) {
                e.preventDefault();
                if (currentPage < totalPages) {
                    currentPage++;
                    renderTable();
                    updatePagination();
                }
            });
            elements.pagination.appendChild(nextLi);
        }

        // Konfirmasi hapus data
        function confirmDelete(id) {
            if (confirm('Apakah Anda yakin ingin menghapus data ini?')) {
                barjasData = barjasData.filter(item => item.id !== id);
                saveData();
                applyFilters();
                showNotification('Sukses', 'Data berhasil dihapus!', 'success');
                
                // Update dashboard jika sedang dilihat
                if (!document.getElementById('dashboard').classList.contains('d-none')) {
                    updateDashboard();
                }
            }
        }

        // Konfirmasi hapus semua data
        function confirmDeleteAll() {
            if (confirm('Apakah Anda yakin ingin menghapus SEMUA data? Tindakan ini tidak dapat dibatalkan!')) {
                barjasData = [];
                saveData();
                applyFilters();
                showNotification('Sukses', 'Semua data berhasil dihapus!', 'success');
                
                // Update dashboard
                updateDashboard();
            }
        }

        // Export ke Excel
        function exportToExcel() {
            if (barjasData.length === 0) {
                showNotification('Peringatan', 'Tidak ada data untuk diexport', 'warning');
                return;
            }
            
            try {
                // Prepare data for export
                const dataToExport = filteredData.map(item => ({
                    'Tanggal': formatDate(item.tanggal),
                    'Nama Penerima': item.namaPenerima,
                    'Nama Kelompok': item.namaKelompok || '',
                    'Nomor WhatsApp': item.nomorWhatsApp || '',
                    'Jumlah Bantuan': item.jumlahBantuan || '',
                    'Jenis Bantuan': item.jenisBantuan,
                    'Kecamatan': item.kecamatan,
                    'Desa/Kelurahan': item.desa,
                    'Alamat Lengkap': item.alamatLengkap || '',
                    'Status Penyaluran': item.statusPenyaluran,
                    'Keterangan': item.keterangan || ''
                }));
                
                // Create worksheet
                const ws = XLSX.utils.json_to_sheet(dataToExport);
                
                // Create workbook
                const wb = XLSX.utils.book_new();
                XLSX.utils.book_append_sheet(wb, ws, 'Data Bantuan');
                
                // Generate file and download
                const date = new Date().toISOString().split('T')[0];
                const fileName = `Data_Bantuan_${date}.xlsx`;
                XLSX.writeFile(wb, fileName);
                
                showNotification('Sukses', 'Data berhasil diexport ke Excel', 'success');
            } catch (error) {
                console.error('Error exporting to Excel:', error);
                showNotification('Error', 'Gagal mengekspor data ke Excel', 'error');
            }
        }

        // Export ke PDF
        function exportToPDF() {
            if (barjasData.length === 0) {
                showNotification('Peringatan', 'Tidak ada data untuk diexport', 'warning');
                return;
            }
            
            try {
                const { jsPDF } = window.jspdf;
                const doc = new jsPDF();
                
                // Add title
                doc.setFontSize(18);
                doc.text('LAPORAN DATA BANTUAN', 105, 15, { align: 'center' });
                
                doc.setFontSize(12);
                doc.text(settings.institutionName, 105, 22, { align: 'center' });
                
                // Add date
                const date = new Date().toLocaleDateString('id-ID', { 
                    day: 'numeric', 
                    month: 'long', 
                    year: 'numeric' 
                });
                doc.text(`Tanggal: ${date}`, 105, 29, { align: 'center' });
                
                // Prepare data for table
                const tableData = filteredData.map(item => [
                    formatDate(item.tanggal),
                    item.namaPenerima,
                    item.namaKelompok || '-',
                    item.nomorWhatsApp || '-',
                    item.jumlahBantuan || '-',
                    item.jenisBantuan,
                    item.kecamatan,
                    item.desa,
                    item.statusPenyaluran
                ]);
                
                // Add table
                doc.autoTable({
                    head: [['Tanggal', 'Nama', 'Kelompok', 'WhatsApp', 'Jumlah', 'Jenis', 'Kecamatan', 'Desa', 'Status']],
                    body: tableData,
                    startY: 35,
                    theme: 'grid',
                    headStyles: {
                        fillColor: [13, 71, 161],
                        textColor: 255
                    },
                    alternateRowStyles: {
                        fillColor: [240, 240, 240]
                    },
                    margin: { top: 35 }
                });
                
                // Add page numbers
                const pageCount = doc.internal.getNumberOfPages();
                for (let i = 1; i <= pageCount; i++) {
                    doc.setPage(i);
                    doc.setFontSize(10);
                    doc.text(`Halaman ${i} dari ${pageCount}`, 105, doc.internal.pageSize.height - 10, { align: 'center' });
                }
                
                // Save PDF
                const dateStr = new Date().toISOString().split('T')[0];
                doc.save(`Data_Bantuan_${dateStr}.pdf`);
                
                showNotification('Sukses', 'Data berhasil diexport ke PDF', 'success');
            } catch (error) {
                console.error('Error exporting to PDF:', error);
                showNotification('Error', 'Gagal mengekspor data ke PDF', 'error');
            }
        }

        // Cetak laporan
        function printReport() {
            if (barjasData.length === 0) {
                showNotification('Peringatan', 'Tidak ada data untuk dicetak', 'warning');
                return;
            }
            
            // Set print date
            const date = new Date().toLocaleDateString('id-ID', { 
                day: 'numeric', 
                month: 'long', 
                year: 'numeric' 
            });
            document.getElementById('printDate').textContent = `Dicetak pada: ${date}`;
            
            // Set institution name
            document.getElementById('printInstitutionName').textContent = settings.institutionName;
            
            // Trigger print
            window.print();
        }

        // Update dashboard
        function updateDashboard() {
            const total = barjasData.length;
            const tersalurkan = barjasData.filter(item => item.statusPenyaluran === 'Tersalurkan').length;
            const persentase = total > 0 ? Math.round((tersalurkan / total) * 100) : 0;
            
            elements.totalPenerima.textContent = total;
            elements.totalTersalurkan.textContent = tersalurkan;
            elements.persentaseTersalurkan.textContent = `${persentase}%`;
            
            // Update recent activity table
            updateRecentActivity();
            
            // Update charts
            updateCharts();
        }

        // Update aktivitas terbaru
        function updateRecentActivity() {
            const tbody = document.querySelector('#recentActivityTable tbody');
            tbody.innerHTML = '';
            
            // Get recent data (last 5)
            const recentData = [...barjasData]
                .sort((a, b) => new Date(b.tanggal) - new Date(a.tanggal))
                .slice(0, 5);
            
            if (recentData.length === 0) {
                const tr = document.createElement('tr');
                tr.innerHTML = `<td colspan="5" class="text-center py-3">Tidak ada data aktivitas</td>`;
                tbody.appendChild(tr);
                return;
            }
            
            recentData.forEach(item => {
                const tr = document.createElement('tr');
                tr.innerHTML = `
                    <td>${formatDate(item.tanggal)}</td>
                    <td>${item.namaPenerima}</td>
                    <td>${item.desa}</td>
                    <td>${item.jenisBantuan}</td>
                    <td><span class="badge ${getStatusBadgeClass(item.statusPenyaluran)}">${item.statusPenyaluran}</span></td>
                `;
                tbody.appendChild(tr);
            });
        }

        // Setup charts
        function setupCharts() {
            // Kecamatan chart
            window.kecamatanChart = new Chart(
                document.getElementById('kecamatanChart'),
                {
                    type: 'bar',
                    data: {
                        labels: [],
                        datasets: [{
                            label: 'Jumlah Penerima per Kecamatan',
                            data: [],
                            backgroundColor: 'rgba(13, 71, 161, 0.7)',
                            borderColor: 'rgba(13, 71, 161, 1)',
                            borderWidth: 1
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        scales: {
                            y: {
                                beginAtZero: true
                            }
                        }
                    }
                }
            );
            
            // Jenis bantuan chart
            window.jenisBantuanChart = new Chart(
                document.getElementById('jenisBantuanChart'),
                {
                    type: 'pie',
                    data: {
                        labels: [],
                        datasets: [{
                            data: [],
                            backgroundColor: [
                                'rgba(13, 71, 161, 0.7)',
                                'rgba(0, 105, 92, 0.7)',
                                'rgba(255, 143, 0, 0.7)',
                                'rgba(121, 85, 72, 0.7)',
                                'rgba(142, 36, 170, 0.7)',
                                'rgba(230, 81, 0, 0.7)'
                            ],
                            borderWidth: 1
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false
                    }
                }
            );
            
            // Statistik kecamatan chart
            window.statistikKecamatanChart = new Chart(
                document.getElementById('statistikKecamatanChart'),
                {
                    type: 'bar',
                    data: {
                        labels: [],
                        datasets: [
                            {
                                label: 'Tersalurkan',
                                data: [],
                                backgroundColor: 'rgba(56, 142, 60, 0.7)'
                            },
                            {
                                label: 'Belum Tersalurkan',
                                data: [],
                                backgroundColor: 'rgba(198, 40, 40, 0.7)'
                            },
                            {
                                label: 'Dalam Proses',
                                data: [],
                                backgroundColor: 'rgba(255, 179, 0, 0.7)'
                            }
                        ]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        scales: {
                            x: {
                                stacked: true
                            },
                            y: {
                                stacked: true,
                                beginAtZero: true
                            }
                        }
                    }
                }
            );
            
            // Statistik status chart
            window.statistikStatusChart = new Chart(
                document.getElementById('statistikStatusChart'),
                {
                    type: 'doughnut',
                    data: {
                        labels: ['Tersalurkan', 'Belum Tersalurkan', 'Dalam Proses'],
                        datasets: [{
                            data: [0, 0, 0],
                            backgroundColor: [
                                'rgba(56, 142, 60, 0.7)',
                                'rgba(198, 40, 40, 0.7)',
                                'rgba(255, 179, 0, 0.7)'
                            ],
                            borderWidth: 1
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false
                    }
                }
            );
            
            // Update charts with initial data
            updateCharts();
        }

        // Update charts
        function updateCharts() {
            if (barjasData.length === 0) return;
            
            // Kecamatan data
            const kecamatanCount = {};
            barjasData.forEach(item => {
                kecamatanCount[item.kecamatan] = (kecamatanCount[item.kecamatan] || 0) + 1;
            });
            
            const sortedKecamatan = Object.entries(kecamatanCount)
                .sort((a, b) => b[1] - a[1])
                .slice(0, 10);
            
            window.kecamatanChart.data.labels = sortedKecamatan.map(k => k[0]);
            window.kecamatanChart.data.datasets[0].data = sortedKecamatan.map(k => k[1]);
            window.kecamatanChart.update();
            
            // Jenis bantuan data
            const jenisCount = {};
            barjasData.forEach(item => {
                jenisCount[item.jenisBantuan] = (jenisCount[item.jenisBantuan] || 0) + 1;
            });
            
            window.jenisBantuanChart.data.labels = Object.keys(jenisCount);
            window.jenisBantuanChart.data.datasets[0].data = Object.values(jenisCount);
            window.jenisBantuanChart.update();
            
            // Update statistik charts if statistik section is active
            if (!document.getElementById('statistik').classList.contains('d-none')) {
                updateStatistik();
            }
        }

        // Update statistik
        function updateStatistik() {
            if (barjasData.length === 0) return;
            
            // Group data by kecamatan
            const kecamatanData = {};
            
            // Initialize with all kecamatan
            const allKecamatan = [
                'Arjasa', 'Asembagus', 'Banyuglugur', 'Banyuputih', 'Besuki', 'Bungatan',
                'Jangkar', 'Jatibanteng', 'Kapongan', 'Kendit', 'Mangaran', 'Mlandingan',
                'Panarukan', 'Panji', 'Situbondo', 'Suboh', 'Sumbermalang'
            ];
            
            allKecamatan.forEach(kec => {
                kecamatanData[kec] = {
                    Tersalurkan: 0,
                    'Belum Tersalurkan': 0,
                    'Dalam Proses': 0,
                    total: 0
                };
            });
            
            // Count data
            barjasData.forEach(item => {
                if (kecamatanData[item.kecamatan]) {
                    kecamatanData[item.kecamatan][item.statusPenyaluran]++;
                    kecamatanData[item.kecamatan].total++;
                }
            });
            
            // Filter kecamatan that have data
            const kecamatanWithData = allKecamatan.filter(kec => kecamatanData[kec].total > 0);
            
            // Update kecamatan chart
            window.statistikKecamatanChart.data.labels = kecamatanWithData;
            window.statistikKecamatanChart.data.datasets[0].data = kecamatanWithData.map(kec => kecamatanData[kec].Tersalurkan);
            window.statistikKecamatanChart.data.datasets[1].data = kecamatanWithData.map(kec => kecamatanData[kec]['Belum Tersalurkan']);
            window.statistikKecamatanChart.data.datasets[2].data = kecamatanWithData.map(kec => kecamatanData[kec]['Dalam Proses']);
            window.statistikKecamatanChart.update();
            
            // Update status chart
            const totalTersalurkan = barjasData.filter(item => item.statusPenyaluran === 'Tersalurkan').length;
            const totalBelum = barjasData.filter(item => item.statusPenyaluran === 'Belum Tersalurkan').length;
            const totalProses = barjasData.filter(item => item.statusPenyaluran === 'Dalam Proses').length;
            
            window.statistikStatusChart.data.datasets[0].data = [totalTersalurkan, totalBelum, totalProses];
            window.statistikStatusChart.update();
            
            // Update statistik table
            const tbody = document.querySelector('#statistikTable tbody');
            tbody.innerHTML = '';
            
            kecamatanWithData.forEach(kec => {
                const data = kecamatanData[kec];
                const persentase = data.total > 0 ? Math.round((data.Tersalurkan / data.total) * 100) : 0;
                
                const tr = document.createElement('tr');
                tr.innerHTML = `
                    <td>${kec}</td>
                    <td class="text-center">${data.total}</td>
                    <td class="text-center">${data.Tersalurkan}</td>
                    <td class="text-center">${data['Belum Tersalurkan']}</td>
                    <td class="text-center">${data['Dalam Proses']}</td>
                    <td class="text-center">${persentase}%</td>
                `;
                tbody.appendChild(tr);
            });
        }

        // Simpan pengaturan
        function saveSettings(e) {
            e.preventDefault();
            
            settings.institutionName = document.getElementById('institutionNameInput').value;
            settings.itemsPerPage = parseInt(document.getElementById('itemsPerPage').value);
            settings.notificationsEnabled = document.getElementById('notificationsEnabled').checked;
            settings.autoSaveEnabled = document.getElementById('autoSaveEnabled').checked;
            
            localStorage.setItem(APP_CONFIG.settingsKey, JSON.stringify(settings));
            applySettings();
            
            showNotification('Sukses', 'Pengaturan berhasil disimpan!', 'success');
        }

        // Backup data
        function backupData() {
            if (barjasData.length === 0) {
                showNotification('Peringatan', 'Tidak ada data untuk dibackup', 'warning');
                return;
            }
            
            const dataStr = JSON.stringify(barjasData);
            const dataUri = 'data:application/json;charset=utf-8,'+ encodeURIComponent(dataStr);
            
            const exportFileDefaultName = `backup_barjas_${new Date().toISOString().split('T')[0]}.json`;
            
            const linkElement = document.createElement('a');
            linkElement.setAttribute('href', dataUri);
            linkElement.setAttribute('download', exportFileDefaultName);
            linkElement.click();
            
            showNotification('Sukses', 'Backup data berhasil!', 'success');
        }

        // Trigger restore data
        function triggerRestore() {
            document.getElementById('restoreFileInput').click();
        }

        // Restore data
        function restoreData(e) {
            const file = e.target.files[0];
            if (!file) return;
            
            const reader = new FileReader();
            reader.onload = function(event) {
                try {
                    const restoredData = JSON.parse(event.target.result);
                    
                    if (Array.isArray(restoredData)) {
                        if (confirm('Apakah Anda yakin ingin memulihkan data? Data saat ini akan digantikan.')) {
                            barjasData = restoredData;
                            saveData();
                            applyFilters();
                            updateDashboard();
                            
                            showNotification('Sukses', 'Data berhasil dipulihkan!', 'success');
                        }
                    } else {
                        showNotification('Error', 'Format file backup tidak valid', 'error');
                    }
                } catch (error) {
                    console.error('Error restoring data:', error);
                    showNotification('Error', 'Gagal memulihkan data. File mungkin rusak.', 'error');
                }
            };
            reader.readAsText(file);
            
            // Reset input file
            e.target.value = '';
        }

        // Konfirmasi reset data
        function confirmResetData() {
            if (confirm('Apakah Anda yakin ingin mereset semua data dan pengaturan? Tindakan ini tidak dapat dibatalkan!')) {
                localStorage.removeItem(APP_CONFIG.dataKey);
                localStorage.removeItem(APP_CONFIG.settingsKey);
                
                barjasData = [];
                settings = {
                    institutionName: 'Dinas Peternakan dan Perikanan Kabupaten Situbondo',
                    itemsPerPage: 10,
                    notificationsEnabled: true,
                    autoSaveEnabled: true
                };
                
                applySettings();
                applyFilters();
                updateDashboard();
                
                showNotification('Sukses', 'Semua data dan pengaturan telah direset!', 'success');
            }
        }

        // Tampilkan splash screen
        function showSplashScreen() {
            elements.welcomeSplash.style.display = 'flex';
            
            let countdown = 5;
            const countdownElement = document.getElementById('countdownTimer');
            
            const timer = setInterval(() => {
                countdown--;
                countdownElement.textContent = countdown;
                
                if (countdown <= 0) {
                    clearInterval(timer);
                    closeSplashScreen();
                }
            }, 1000);
            
            // Juga tutup jika user mengklik close
            document.getElementById('closeSplash').addEventListener('click', function() {
                clearInterval(timer);
                closeSplashScreen();
            });
        }

        // Tutup splash screen
        function closeSplashScreen() {
            elements.welcomeSplash.style.opacity = '0';
            setTimeout(() => {
                elements.welcomeSplash.style.display = 'none';
                showLoginModal();
            }, 500);
        }

        // Tampilkan modal login
        function showLoginModal() {
            elements.loginModal.show();
            
            // Cek jika user sudah login sebelumnya (dalam session)
            const isLoggedIn = sessionStorage.getItem('barjas_logged_in');
            if (isLoggedIn === 'true') {
                // Jika sudah login, langsung akses aplikasi
                grantAccess();
            } else {
                // Reset status login
                resetLoginStatus();
            }
        }

        // Handle login
        function handleLogin(e) {
            e.preventDefault();
            
            if (isBlocked) {
                showNotification('Error', 'Anda telah melebihi batas percobaan login. Silakan coba lagi nanti.', 'error');
                return;
            }
            
            const code = document.getElementById('securityCode').value;
            const loginButton = document.getElementById('loginButton');
            const loginSpinner = document.getElementById('loginSpinner');
            const loginButtonText = document.querySelector('.login-button-text');
            
            // Tampilkan loading state
            loginButton.disabled = true;
            loginButtonText.classList.add('d-none');
            loginSpinner.classList.remove('d-none');
            
            // Simulasi proses login
            setTimeout(() => {
                if (code === APP_CONFIG.securityCode) {
                    // Login berhasil
                    grantAccess();
                    resetLoginStatus();
                } else {
                    // Login gagal
                    loginAttempts++;
                    
                    if (loginAttempts >= APP_CONFIG.maxLoginAttempts) {
                        blockLogin();
                    } else {
                        showNotification('Error', `Kode keamanan salah. Percobaan ${loginAttempts} dari ${APP_CONFIG.maxLoginAttempts}.`, 'error');
                        document.getElementById('attemptsCount').textContent = `Percobaan ${loginAttempts} dari ${APP_CONFIG.maxLoginAttempts}`;
                        document.getElementById('loginForm').classList.add('login-shake');
                        
                        setTimeout(() => {
                            document.getElementById('loginForm').classList.remove('login-shake');
                        }, 600);
                    }
                }
                
                // Reset loading state
                loginButton.disabled = false;
                loginButtonText.classList.remove('d-none');
                loginSpinner.classList.add('d-none');
            }, 1000);
        }

        // Reset status login
        function resetLoginStatus() {
            loginAttempts = 0;
            isBlocked = false;
            document.getElementById('attemptsCount').textContent = '';
            document.getElementById('blockedMessage').classList.add('d-none');
            document.getElementById('securityCode').value = '';
            
            if (loginTimer) {
                clearInterval(loginTimer);
            }
        }

        // Blokir login sementara
        function blockLogin() {
            isBlocked = true;
            let timeLeft = APP_CONFIG.loginBlockTime;
            
            document.getElementById('blockedMessage').classList.remove('d-none');
            document.getElementById('countdown').textContent = timeLeft;
            
            loginTimer = setInterval(() => {
                timeLeft--;
                document.getElementById('countdown').textContent = timeLeft;
                
                if (timeLeft <= 0) {
                    clearInterval(loginTimer);
                    resetLoginStatus();
                }
            }, 1000);
        }

        // Berikan akses ke aplikasi
        function grantAccess() {
            elements.loginModal.hide();
            elements.appContent.classList.remove('app-content-unauthenticated');
            sessionStorage.setItem('barjas_logged_in', 'true');
            
            // Update dashboard
            updateDashboard();
            
            showNotification('Selamat Datang', 'Anda berhasil login ke aplikasi BARJAS', 'success');
        }

        // Toggle visibility password
        function togglePasswordVisibility() {
            const passwordInput = document.getElementById('securityCode');
            const toggleIcon = document.querySelector('.toggle-password i');
            
            if (passwordInput.type === 'password') {
                passwordInput.type = 'text';
                toggleIcon.classList.remove('fa-eye');
                toggleIcon.classList.add('fa-eye-slash');
            } else {
                passwordInput.type = 'password';
                toggleIcon.classList.remove('fa-eye-slash');
                toggleIcon.classList.add('fa-eye');
            }
        }

        // Logout
        function logout() {
            if (confirm('Apakah Anda yakin ingin keluar dari aplikasi?')) {
                sessionStorage.removeItem('barjas_logged_in');
                elements.appContent.classList.add('app-content-unauthenticated');
                showLoginModal();
            }
        }

        // Inisialisasi aplikasi saat dokumen siap
        document.addEventListener('DOMContentLoaded', initApp);
    </script>
</body>
</html>
