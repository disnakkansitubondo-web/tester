<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>APLIKASI BARJAS - SISTEM BANTUAN</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-datepicker/1.9.0/css/bootstrap-datepicker.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.28/jspdf.plugin.autotable.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <style>
        :root {
            --primary-color: #0d47a1;
            --secondary-color: #00695c;
            --accent-color: #ff8f00;
            --light-blue: #e3f2fd;
            --dark-blue: #082e5c;
            --gradient-primary: linear-gradient(135deg, var(--primary-color), var(--dark-blue));
            --gradient-secondary: linear-gradient(135deg, var(--secondary-color), #004d40);
            --gradient-accent: linear-gradient(135deg, var(--accent-color), #e65100);
            --shadow-sm: 0 2px 8px rgba(0,0,0,0.08);
            --shadow-md: 0 4px 16px rgba(0,0,0,0.12);
            --shadow-lg: 0 8px 28px rgba(0,0,0,0.15);
            --login-gradient: linear-gradient(135deg, #0d47a1, #00695c, #ff8f00);
        }
        
        body {
            background: linear-gradient(135deg, #f5f9ff 0%, #e8f5e9 100%);
            font-family: 'Poppins', 'Segoe UI', sans-serif;
            min-height: 100vh;
            padding: 10px 0;
            overflow-x: hidden;
        }
        
        .app-container {
            max-width: 1600px;
            margin: 0 auto;
            background: white;
            box-shadow: var(--shadow-lg);
            border-radius: 12px;
            overflow: hidden;
            position: relative;
            z-index: 10;
        }
        
        .app-header {
            background: var(--gradient-primary);
            color: white;
            padding: 20px 15px;
            text-align: center;
            position: relative;
            overflow: hidden;
        }
        
        .app-header::before {
            content: "";
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(255,255,255,0.15) 0%, transparent 70%);
            pointer-events: none;
        }
        
        .app-logo {
            font-size: 2.5rem;
            margin-bottom: 10px;
            position: relative;
            z-index: 1;
        }
        
        .app-title {
            font-size: 1.8rem;
            font-weight: 800;
            margin: 0;
            position: relative;
            z-index: 1;
            text-shadow: 1px 1px 4px rgba(0,0,0,0.3);
        }
        
        .app-subtitle {
            font-size: 1rem;
            opacity: 0.95;
            position: relative;
            z-index: 1;
            font-weight: 300;
            letter-spacing: 0.5px;
            margin-bottom: 5px;
        }
        
        .nav-pills .nav-link {
            border-radius: 8px;
            margin-bottom: 8px;
            padding: 12px 15px;
            font-weight: 500;
            color: #444;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            font-size: 0.9rem;
        }
        
        .nav-pills .nav-link:hover {
            background-color: #f0f7ff;
            transform: translateX(3px);
        }
        
        .nav-pills .nav-link.active {
            background: var(--gradient-primary);
            font-weight: 600;
            box-shadow: var(--shadow-md);
            transform: translateX(3px);
            color: white;
        }
        
        .section-title {
            border-left: 4px solid var(--primary-color);
            padding-left: 12px;
            margin: 20px 0;
            font-weight: 700;
            color: var(--dark-blue);
            font-size: 1.4rem;
            position: relative;
        }
        
        .section-title::after {
            content: "";
            position: absolute;
            bottom: -5px;
            left: 12px;
            width: 40px;
            height: 2px;
            background: var(--gradient-primary);
            border-radius: 2px;
        }
        
        .btn-primary {
            background: var(--gradient-primary);
            border: none;
            padding: 10px 20px;
            font-weight: 600;
            box-shadow: var(--shadow-md);
            border-radius: 8px;
            transition: all 0.3s;
            font-size: 0.9rem;
        }
        
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-lg);
        }
        
        .btn-success {
            background: var(--gradient-secondary);
            border: none;
            padding: 10px 20px;
            font-weight: 600;
            box-shadow: var(--shadow-md);
            border-radius: 8px;
            transition: all 0.3s;
            font-size: 0.9rem;
        }
        
        .btn-success:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-lg);
        }
        
        .btn-warning {
            background: var(--gradient-accent);
            border: none;
            padding: 10px 20px;
            font-weight: 600;
            box-shadow: var(--shadow-md);
            border-radius: 8px;
            transition: all 0.3s;
            font-size: 0.9rem;
        }
        
        .btn-warning:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-lg);
        }
        
        .form-label {
            font-weight: 600;
            color: #444;
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            font-size: 0.9rem;
        }
        
        .form-label i {
            margin-right: 6px;
            color: var(--primary-color);
        }
        
        .form-control, .form-select {
            border-radius: 8px;
            padding: 12px 15px;
            border: 1px solid #ddd;
            transition: all 0.3s;
            box-shadow: var(--shadow-sm);
            font-size: 0.9rem;
        }
        
        .form-control:focus, .form-select:focus {
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(13, 71, 161, 0.2);
            transform: translateY(-2px);
        }
        
        .copyright {
            text-align: center;
            padding: 20px;
            background-color: var(--light-blue);
            color: var(--dark-blue);
            font-size: 0.9rem;
            font-weight: 500;
        }
        
        .data-table {
            font-size: 0.85rem;
            border-collapse: separate;
            border-spacing: 0;
            box-shadow: var(--shadow-sm);
            border-radius: 8px;
            overflow: hidden;
        }
        
        .data-table th {
            background: var(--gradient-primary);
            color: white;
            font-weight: 600;
            padding: 12px 10px;
            text-align: center;
            position: relative;
            font-size: 0.85rem;
        }
        
        .data-table th::after {
            content: "";
            position: absolute;
            bottom: 0;
            left: 0;
            width: 100%;
            height: 1px;
            background: rgba(255,255,255,0.3);
        }
        
        .data-table td {
            padding: 10px 8px;
            vertical-align: middle;
            border-bottom: 1px solid #eee;
            font-size: 0.85rem;
        }
        
        .data-table tr:nth-child(even) {
            background-color: #f9fbff;
        }
        
        .data-table tr:hover {
            background-color: #edf5ff;
        }
        
        .feature-icon {
            font-size: 1.1rem;
            margin-right: 8px;
            width: 24px;
            text-align: center;
        }
        
        .card {
            border-radius: 10px;
            border: none;
            box-shadow: var(--shadow-md);
            transition: all 0.3s ease;
            overflow: hidden;
            margin-bottom: 15px;
        }
        
        .card:hover {
            transform: translateY(-5px);
            box-shadow: var(--shadow-lg);
        }
        
        .card-header {
            border-radius: 10px 10px 0 0 !important;
            font-weight: 600;
            padding: 15px 20px;
            background: var(--gradient-primary);
            color: white;
            font-size: 0.95rem;
        }
        
        .stats-box {
            text-align: center;
            padding: 20px 15px;
            border-radius: 10px;
            background: white;
            box-shadow: var(--shadow-md);
            transition: all 0.3s;
            position: relative;
            overflow: hidden;
            margin-bottom: 15px;
        }
        
        .stats-box::before {
            content: "";
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 4px;
            background: var(--gradient-primary);
            border-radius: 2px;
        }
        
        .stats-box:hover {
            transform: translateY(-3px);
            box-shadow: var(--shadow-lg);
        }
        
        .stats-number {
            font-size: 1.8rem;
            font-weight: 800;
            color: var(--primary-color);
            margin: 10px 0;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.1);
        }
        
        .stats-label {
            font-size: 0.9rem;
            color: #666;
            font-weight: 500;
        }
        
        .notification-toast {
            position: fixed;
            bottom: 20px;
            right: 20px;
            z-index: 1050;
            min-width: 280px;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: var(--shadow-lg);
            max-width: calc(100vw - 40px);
        }
        
        .input-error {
            border-color: #dc3545;
            box-shadow: 0 0 0 3px rgba(220, 53, 69, 0.2);
        }
        
        .error-message {
            color: #dc3545;
            font-size: 0.8rem;
            margin-top: 5px;
            display: none;
            font-weight: 500;
        }
        
        .watermark {
            position: absolute;
            bottom: 10px;
            right: 15px;
            opacity: 0.8;
            font-size: 0.8rem;
            color: white;
            font-weight: 300;
        }
        
        .control-panel {
            background: #f8f9fa;
            border-radius: 8px;
            padding: 15px;
            margin-top: 15px;
            box-shadow: var(--shadow-sm);
        }
        
        .control-title {
            font-size: 1rem;
            color: var(--primary-color);
            font-weight: 600;
            margin-bottom: 15px;
            padding-bottom: 8px;
            border-bottom: 1px solid var(--light-blue);
        }
        
        .floating-action-btn {
            position: fixed;
            bottom: 20px;
            right: 20px;
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background: var(--gradient-primary);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: var(--shadow-lg);
            z-index: 1000;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .floating-action-btn:hover {
            transform: scale(1.1) rotate(90deg);
        }
        
        .filter-section {
            background: white;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 20px;
            box-shadow: var(--shadow-sm);
        }
        
        .badge-custom {
            background: var(--gradient-primary);
            color: white;
            padding: 6px 12px;
            border-radius: 16px;
            font-weight: 600;
            font-size: 0.8rem;
        }
        
        .mobile-menu-btn {
            display: none;
            position: fixed;
            top: 15px;
            left: 15px;
            z-index: 1050;
            background: var(--gradient-primary);
            color: white;
            border: none;
            border-radius: 50%;
            width: 45px;
            height: 45px;
            box-shadow: var(--shadow-lg);
        }
        
        .sidebar-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 1040;
        }
        
        /* Animations */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .animate-fadeIn {
            animation: fadeIn 0.5s ease forwards;
        }
        
        /* Custom scrollbar */
        ::-webkit-scrollbar {
            width: 6px;
        }
        
        ::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 8px;
        }
        
        ::-webkit-scrollbar-thumb {
            background: var(--primary-color);
            border-radius: 8px;
        }
        
        ::-webkit-scrollbar-thumb:hover {
            background: var(--dark-blue);
        }
        
        /* Responsive styles */
        @media (max-width: 991.98px) {
            .col-md-3.col-lg-2 {
                position: fixed;
                left: -300px;
                top: 0;
                bottom: 0;
                z-index: 1050;
                width: 280px;
                transition: left 0.3s ease;
                overflow-y: auto;
                padding-top: 60px;
            }
            
            .col-md-3.col-lg-2.mobile-show {
                left: 0;
            }
            
            .col-md-9.col-lg-10 {
                width: 100%;
                flex: 0 0 100%;
                max-width: 100%;
            }
            
            .mobile-menu-btn {
                display: flex;
                align-items: center;
                justify-content: center;
            }
            
            .sidebar-overlay.mobile-show {
                display: block;
            }
        }
        
        /* Print Styles - IMPROVED FOR LANDSCAPE */
        @media print {
            @page {
                size: landscape;
                margin: 0.5cm;
            }
            
            body * {
                visibility: hidden;
            }
            
            .app-container, .app-container * {
                visibility: visible;
            }
            
            .app-container {
                position: absolute;
                left: 0;
                top: 0;
                width: 100%;
                box-shadow: none;
            }
            
            .nav-pills, .mobile-menu-btn, .sidebar-overlay, .floating-action-btn,
            .btn-group, .filter-section, .toast {
                display: none !important;
            }
            
            .col-md-3.col-lg-2.p-4.bg-light {
                display: none !important;
            }
            
            .col-md-9.col-lg-10.p-5 {
                width: 100%;
                flex: 0 0 100%;
                max-width: 100%;
                padding: 0 !important;
            }
            
            .copyright {
                display: none;
            }
            
            .data-table {
                font-size: 10px;
                width: 100% !important;
            }
            
            .data-table th, .data-table td {
                padding: 4px 2px;
            }
            
            /* Sembunyikan kolom aksi dan link Google Drive saat mencetak */
            .data-table th:last-child,
            .data-table td:last-child {
                display: none !important;
            }
            
            /* Judul untuk laporan cetak */
            .print-header {
                display: block !important;
                text-align: center;
                margin-bottom: 15px;
            }
            
            .print-title {
                font-size: 18px;
                font-weight: bold;
                margin-bottom: 5px;
            }
            
            .print-subtitle {
                font-size: 14px;
                margin-bottom: 10px;
            }
            
            .print-date {
                font-size: 12px;
                text-align: right;
                margin-bottom: 10px;
            }
        }

        /* WhatsApp link style */
        .whatsapp-link {
            color: #25D366;
            text-decoration: none;
        }
        
        .whatsapp-link:hover {
            text-decoration: underline;
        }
        
        /* View Link Button */
        .btn-view {
            background: linear-gradient(135deg, #17a2b8, #138496);
            color: white;
            border: none;
            padding: 5px 10px;
            border-radius: 4px;
            font-size: 0.8rem;
        }
        
        .btn-view:hover {
            background: linear-gradient(135deg, #138496, #117a8b);
            color: white;
        }
        
        /* Undo Button */
        .btn-undo {
            background: linear-gradient(135deg, #6c757d, #5a6268);
            color: white;
            border: none;
        }
        
        .btn-undo:hover {
            background: linear-gradient(135deg, #5a6268, #4e555b);
            color: white;
        }
        
        /* WhatsApp number link in table */
        .whatsapp-number {
            color: #25D366;
            cursor: pointer;
            text-decoration: underline;
        }
        
        /* Welcome Modal Styles */
        .welcome-modal .modal-content {
            border-radius: 15px;
            overflow: hidden;
            border: none;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }
        
        .welcome-header {
            background: var(--gradient-primary);
            color: white;
            text-align: center;
            padding: 25px;
        }
        
        .welcome-icon {
            font-size: 3rem;
            margin-bottom: 15px;
            color: white;
        }
        
        .welcome-body {
            padding: 25px;
            text-align: center;
        }
        
        .welcome-footer {
            background: #f8f9fa;
            padding: 15px;
            text-align: center;
            border-top: 1px solid #eee;
        }
        
        .countdown-timer {
            font-size: 0.9rem;
            color: #6c757d;
            margin-top: 10px;
        }
        
        /* Button untuk cetak per data */
        .btn-print-individual {
            background: linear-gradient(135deg, #6f42c1, #5a2d95);
            color: white;
            border: none;
            padding: 5px 10px;
            border-radius: 4px;
            font-size: 0.8rem;
        }
        
        .btn-print-individual:hover {
            background: linear-gradient(135deg, #5a2d95, #4a2479);
            color: white;
        }
        
        /* Developer Info Styles */
        .developer-info {
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            border-radius: 10px;
            padding: 15px;
            margin-top: 20px;
            box-shadow: var(--shadow-sm);
        }
        
        .developer-info h6 {
            color: var(--primary-color);
            font-weight: 600;
            margin-bottom: 15px;
            padding-bottom: 8px;
            border-bottom: 1px solid #ddd;
        }
        
        .developer-contact p {
            margin-bottom: 8px;
            font-size: 0.85rem;
        }
        
        .developer-contact a {
            color: var(--primary-color);
            text-decoration: none;
            transition: all 0.3s;
        }
        
        .developer-contact a:hover {
            color: var(--dark-blue);
            text-decoration: underline;
        }
        
        /* Loading spinner */
        .spinner-border-sm {
            width: 1rem;
            height: 1rem;
        }

        /* Login Modal Styles */
        .login-modal .modal-content {
            border-radius: 15px;
            overflow: hidden;
            border: none;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
        }

        .login-header {
            background: var(--login-gradient);
            color: white;
            text-align: center;
            padding: 25px 20px;
            position: relative;
        }

        .login-icon {
            font-size: 3rem;
            margin-bottom: 15px;
            color: white;
        }

        .login-title {
            font-size: 1.8rem;
            font-weight: 700;
            margin: 0;
        }

        .login-subtitle {
            font-size: 1rem;
            opacity: 0.9;
            margin: 5px 0 0;
        }

        .login-body {
            padding: 25px;
            position: relative;
            z-index: 1;
        }

        .login-form-group {
            margin-bottom: 20px;
        }

        .login-form-label {
            font-weight: 600;
            color: var(--dark-blue);
            margin-bottom: 8px;
            display: flex;
            align-items: center;
        }

        .login-form-label i {
            margin-right: 10px;
            color: var(--dark-blue);
        }

        .login-form-control {
            border-radius: 8px;
            padding: 12px 15px;
            border: 2px solid #ddd;
            transition: all 0.3s;
        }

        .login-form-control:focus {
            border-color: var(--dark-blue);
            box-shadow: 0 0 0 3px rgba(13, 71, 161, 0.2);
        }

        .login-input-group-text {
            background: var(--light-blue);
            border: 2px solid #ddd;
            border-left: none;
        }

        .btn-login {
            background: var(--gradient-secondary);
            color: white;
            border: none;
            padding: 12px;
            font-weight: 600;
            border-radius: 8px;
            width: 100%;
            transition: all 0.3s;
            margin-top: 10px;
        }

        .btn-login:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 105, 92, 0.4);
        }

        .btn-login:disabled {
            background: #ccc;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        .login-security-notice {
            text-align: center;
            margin-top: 20px;
            font-size: 0.85rem;
            color: #666;
        }

        .login-attempts-count {
            text-align: center;
            font-size: 0.9rem;
            color: #ff8f00;
            font-weight: 500;
            margin-top: 5px;
        }

        .login-blocked-message {
            text-align: center;
            background: rgba(220, 53, 69, 0.1);
            border-radius: 8px;
            padding: 15px;
            margin-top: 20px;
            color: #dc3545;
            font-weight: 500;
        }

        .login-countdown {
            font-size: 1.2rem;
            font-weight: 700;
            color: var(--dark-blue);
        }

        .login-developer-info {
            background: var(--light-blue);
            border-radius: 10px;
            padding: 20px;
            margin-top: 25px;
            text-align: center;
        }

        .login-developer-logo {
            max-width: 180px;
            margin-bottom: 15px;
            border-radius: 8px;
        }

        .login-developer-contact a {
            color: var(--dark-blue);
            text-decoration: none;
            transition: all 0.3s;
            display: inline-block;
            margin: 5px 0;
        }

        .login-developer-contact a:hover {
            color: var(--primary-color);
            text-decoration: underline;
            transform: translateY(-2px);
        }

        .login-copyright {
            text-align: center;
            margin-top: 20px;
            color: #666;
            font-size: 0.9rem;
            opacity: 0.9;
        }

        /* Animations */
        @keyframes login-shake {
            0%, 100% { transform: translateX(0); }
            10%, 30%, 50%, 70%, 90% { transform: translateX(-10px); }
            20%, 40%, 60%, 80% { transform: translateX(10px); }
        }

        .login-shake {
            animation: login-shake 0.6s cubic-bezier(.36,.07,.19,.97) both;
        }

        /* Login particle background */
        #login-particles {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 1040; /* Higher than modal backdrop */
            display: none;
        }

        /* Link Google Drive dalam tabel */
        .drive-link {
            color: #0d47a1;
            text-decoration: none;
            cursor: pointer;
        }

        .drive-link:hover {
            text-decoration: underline;
        }

        /* Modal untuk menambah link */
        .link-modal .modal-dialog {
            max-width: 600px;
        }
        
        /* App content when not authenticated */
        .app-content-unauthenticated {
            display: none;
        }

        /* Search box for desa dropdown */
        .dropdown-search-container {
            position: relative;
        }

        .dropdown-search {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            z-index: 1000;
            background: white;
            border: 1px solid #ddd;
            border-radius: 8px;
            padding: 8px;
            display: none;
        }

        .dropdown-search input {
            width: 100%;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
        }

        /* Kode Validasi Styles */
        .kode-validasi-container {
            display: flex;
            align-items: center;
        }
        
        .kode-validasi-input {
            flex: 1;
            margin-right: 10px;
        }
        
        .btn-generate-kode {
            white-space: nowrap;
        }

        /* Auto-fill button styles */
        .btn-auto-fill {
            background: linear-gradient(135deg, #6c757d, #5a6268);
            color: white;
            border: none;
            padding: 10px 15px;
            border-radius: 8px;
            font-size: 0.85rem;
            margin-top: 8px;
        }
        
        .btn-auto-fill:hover {
            background: linear-gradient(135deg, #5a6268, #4e555b);
            color: white;
        }

        .login-hint {
            font-size: 0.85rem;
            color: #0d6efd;
            margin-top: 5px;
            text-align: center;
            background-color: #f8f9fa;
            padding: 8px;
            border-radius: 4px;
            border-left: 3px solid #0d6efd;
        }

        /* New styles for additional fields */
        .btn-not-group {
            background: linear-gradient(135deg, #6c757d, #5a6268);
            color: white;
            border: none;
            padding: 10px 15px;
            border-radius: 8px;
            font-size: 0.85rem;
            margin-top: 8px;
        }
        
        .btn-not-group:hover {
            background: linear-gradient(135deg, #5a6268, #4e555b);
            color: white;
        }

        .jenis-bantuan-container {
            display: flex;
            gap: 10px;
        }

        .jenis-bantuan-container select,
        .jenis-bantuan-container input {
            flex: 1;
        }

        /* WhatsApp input styling */
        .whatsapp-input-container {
            position: relative;
        }

        .whatsapp-prefix {
            position: absolute;
            left: 10px;
            top: 50%;
            transform: translateY(-50%);
            color: #25D366;
            font-weight: bold;
        }

        .whatsapp-input {
            padding-left: 30px;
        }

        /* Preview modal styles */
        .preview-container {
            max-height: 70vh;
            overflow-y: auto;
            border: 1px solid #ddd;
            border-radius: 8px;
            padding: 15px;
            background-color: #f9f9f9;
        }

        .preview-table {
            width: 100%;
            border-collapse: collapse;
            font-size: 0.9rem;
        }

        .preview-table th, 
        .preview-table td {
            padding: 8px;
            border: 1px solid #ddd;
            text-align: left;
        }

        .preview-table th {
            background-color: #f0f0f0;
            font-weight: bold;
        }

        .preview-table tr:nth-child(even) {
            background-color: #f8f8f8;
        }

        .preview-table tr:hover {
            background-color: #eaeaea;
        }
    </style>
</head>
<body>
    <!-- Login Modal -->
    <div class="modal fade login-modal" id="loginModal" tabindex="-1" aria-hidden="true" data-bs-backdrop="static" data-bs-keyboard="false">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="login-header">
                    <div class="login-icon">
                        <i class="fas fa-lock"></i>
                    </div>
                    <h2 class="login-title">AUTHENTICATION REQUIRED</h2>
                    <p class="login-subtitle">Masukkan Kode Keamanan untuk Mengakses Aplikasi</p>
                </div>
                <div class="login-body">
                    <form id="loginForm">
                        <div class="mb-3 login-form-group">
                            <label class="form-label login-form-label">
                                <i class="fas fa-key"></i> Kode Keamanan
                            </label>
                            <div class="input-group">
                                <input type="password" class="form-control login-form-control" id="securityCode" placeholder="Masukkan kode akses aplikasi">
                                <button class="btn btn-outline-secondary toggle-password" type="button">
                                    <i class="fas fa-eye"></i>
                                </button>
                            </div>
                            <div class="form-text text-danger login-attempts-count" id="attemptsCount"></div>
                            <div class="login-hint">
                                <i class="fas fa-lightbulb"></i> Kode default: 1234
                            </div>
                        </div>
                        <button type="submit" class="btn btn-login" id="loginButton">
                            <span class="login-button-text">Masuk ke Aplikasi</span>
                            <span class="spinner-border spinner-border-sm d-none" id="loginSpinner"></span>
                        </button>
                    </form>
                    
                    <div class="login-blocked-message d-none" id="blockedMessage">
                        <i class="fas fa-ban me-2"></i>
                        <span id="blockedText">Terlalu banyak percobaan gagal. Silakan coba lagi dalam </span>
                        <span class="login-countdown" id="countdown">30</span> detik.
                    </div>
                    
                    <div class="login-security-notice">
                        <i class="fas fa-info-circle me-2"></i>
                        Hubungi Administrator untuk mendapatkan kode akses
                    </div>
                    
                    <div class="login-developer-info">
                        <h5 class="mb-3">Developer Information</h5>
                        <div class="login-developer-contact">
                            <p><i class="fab fa-whatsapp me-2"></i> <a href="https://wa.me/6285647709114" target="_blank">+62 856-4770-9114</a></p>
                            <p><i class="fas fa-envelope me-2"></i> <a href="mailto:admin@anekamarket.my.id">admin@anekamarket.my.id</a></p>
                        </div>
                    </div>
                    
                    <div class="login-copyright">
                        &copy; 2025 Lentera karya Situbondo
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Login particle background -->
    <div id="login-particles"></div>
    
    <!-- Main Application Content (initially hidden) -->
    <div class="app-content-unauthenticated" id="appContent">
        <!-- Mobile Menu Button -->
        <button class="mobile-menu-btn" id="mobileMenuBtn">
            <i class="fas fa-bars"></i>
        </button>
        
        <!-- Sidebar Overlay -->
        <div class="sidebar-overlay" id="sidebarOverlay"></div>
        
        <div class="app-container animate-fadeIn">
            <div class="app-header">
                <div class="app-logo">
                    <i class="fas fa-hands-helping"></i>
                </div>
                <h1 class="app-title">BARJAS</h1>
                <p class="app-subtitle">Sistem Bantuan Terpadu</p>
                <p class="app-subtitle">KABUPATEN SITUBONDO</p>
                <div class="watermark">v2.0.1</div>
            </div>
            
            <div class="row g-0">
                <!-- Sidebar Navigation -->
                <div class="col-md-3 col-lg-2 p-4 bg-light" id="sidebarMenu">
                    <div class="nav flex-column nav-pills" id="v-pills-tab" role="tablist" aria-orientation="vertical">
                        <button class="nav-link active" id="v-pills-dashboard-tab" data-bs-toggle="pill" data-bs-target="#v-pills-dashboard" type="button" role="tab" aria-controls="v-pills-dashboard" aria-selected="true">
                            <i class="fas fa-tachometer-alt feature-icon"></i> Dashboard
                        </button>
                        <button class="nav-link" id="v-pills-input-tab" data-bs-toggle="pill" data-bs-target="#v-pills-input" type="button" role="tab" aria-controls="v-pills-input" aria-selected="false">
                            <i class="fas fa-pencil-alt feature-icon"></i> Input Data
                        </button>
                        <button class="nav-link" id="v-pills-data-tab" data-bs-toggle="pill" data-bs-target="#v-pills-data" type="button" role="tab" aria-controls="v-pills-data" aria-selected="false">
                            <i class="fas fa-database feature-icon"></i> Data Bantuan
                        </button>
                        <button class="nav-link" id="v-pills-filter-tab" data-bs-toggle="pill" data-bs-target="#v-pills-filter" type="button" role="tab" aria-controls="v-pills-filter" aria-selected="false">
                            <i class="fas fa-filter feature-icon"></i> Filter Data
                        </button>
                        <button class="nav-link" id="v-pills-print-tab" data-bs-toggle="pill" data-bs-target="#v-pills-print" type="button" role="tab" aria-controls="v-pills-print" aria-selected="false">
                            <i class="fas fa-print feature-icon"></i> Cetak Laporan
                        </button>
                        <button class="nav-link" id="v-pills-export-tab" data-bs-toggle="pill" data-bs-target="#v-pills-export" type="button" role="tab" aria-controls="v-pills-export" aria-selected="false">
                            <i class="fas fa-file-export feature-icon"></i> Ekspor Data
                        </button>
                        <button class="nav-link" id="v-pills-backup-tab" data-bs-toggle="pill" data-bs-target="#v-pills-backup" type="button" role="tab" aria-controls="v-pills-backup" aria-selected="false">
                            <i class="fas fa-download feature-icon"></i> Backup & Restore
                        </button>
                        <button class="nav-link" id="v-pills-settings-tab" data-bs-toggle="pill" data-bs-target="#v-pills-settings" type="button" role="tab" aria-controls="v-pills-settings" aria-selected="false">
                            <i class="fas fa-cog feature-icon"></i> Pengaturan
                        </button>
                        <button class="nav-link" id="v-pills-logout-tab" type="button" onclick="logout()">
                            <i class="fas fa-sign-out-alt feature-icon"></i> Keluar
                        </button>
                    </div>
                </div>
                
                <!-- Main Content -->
                <div class="col-md-9 col-lg-10 p-5">
                    <div class="tab-content" id="v-pills-tabContent">
                        <!-- Dashboard Tab -->
                        <div class="tab-pane fade show active" id="v-pills-dashboard" role="tabpanel" aria-labelledby="v-pills-dashboard-tab">
                            <h3 class="section-title">Dashboard</h3>
                            
                            <div class="row">
                                <div class="col-md-3">
                                    <div class="stats-box">
                                        <i class="fas fa-users fa-2x text-primary"></i>
                                        <div class="stats-number" id="totalPenerima">0</div>
                                        <div class="stats-label">Total Penerima</div>
                                    </div>
                                </div>
                                <div class="col-md-3">
                                    <div class="stats-box">
                                        <i class="fas fa-money-bill-wave fa-2x text-success"></i>
                                        <div class="stats-number" id="totalBantuan">0</div>
                                        <div class="stats-label">Total Bantuan</div>
                                    </div>
                                </div>
                                <div class="col-md-3">
                                    <div class="stats-box">
                                        <i class="fas fa-calendar-alt fa-2x text-warning"></i>
                                        <div class="stats-number" id="tahunAktif">2025</div>
                                        <div class="stats-label">Tahun Aktif</div>
                                    </div>
                                </div>
                                <div class="col-md-3">
                                    <div class="stats-box">
                                        <i class="fas fa-chart-line fa-2x text-info"></i>
                                        <div class="stats-number" id="rataBantuan">0</div>
                                        <div class="stats-label">Rata-rata Bantuan</div>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="row mt-4">
                                <div class="col-md-6">
                                    <div class="card">
                                        <div class="card-header">
                                            <i class="fas fa-chart-pie me-2"></i> Distribusi Bantuan per Kecamatan
                                        </div>
                                        <div class="card-body">
                                            <canvas id="kecamatanChart" height="250"></canvas>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="card">
                                        <div class="card-header">
                                            <i class="fas fa-chart-bar me-2"></i> Tren Bantuan per Tahun
                                        </div>
                                        <div class="card-body">
                                            <canvas id="tahunChart" height="250"></canvas>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Input Data Tab -->
                        <div class="tab-pane fade" id="v-pills-input" role="tabpanel" aria-labelledby="v-pills-input-tab">
                            <h3 class="section-title">Input Data Bantuan</h3>
                            
                            <div class="card">
                                <div class="card-header">
                                    <i class="fas fa-pencil-alt me-2"></i> Formulir Input Data
                                </div>
                                <div class="card-body">
                                    <form id="inputForm">
                                        <div class="row mb-3">
                                            <div class="col-md-6">
                                                <label for="nama" class="form-label">
                                                    <i class="fas fa-user"></i> Nama Penerima
                                                </label>
                                                <input type="text" class="form-control" id="nama" required>
                                                <div class="error-message" id="namaError"></div>
                                            </div>
                                            <div class="col-md-6">
                                                <label for="nik" class="form-label">
                                                    <i class="fas fa-id-card"></i> NIK
                                                </label>
                                                <input type="text" class="form-control" id="nik" required>
                                                <div class="error-message" id="nikError"></div>
                                            </div>
                                        </div>
                                        
                                        <div class="row mb-3">
                                            <div class="col-md-6">
                                                <label for="whatsapp" class="form-label">
                                                    <i class="fab fa-whatsapp"></i> Nomor WhatsApp
                                                </label>
                                                <div class="whatsapp-input-container">
                                                    <span class="whatsapp-prefix">+62</span>
                                                    <input type="text" class="form-control whatsapp-input" id="whatsapp" placeholder="8xx-xxxx-xxxx" required>
                                                </div>
                                                <div class="error-message" id="whatsappError"></div>
                                            </div>
                                            <div class="col-md-6">
                                                <label for="namaKelompok" class="form-label">
                                                    <i class="fas fa-users"></i> Nama Kelompok
                                                </label>
                                                <div class="d-flex">
                                                    <input type="text" class="form-control" id="namaKelompok">
                                                    <button type="button" class="btn btn-not-group ms-2" id="btnBukanKelompok">
                                                        Bukan Kelompok
                                                    </button>
                                                </div>
                                            </div>
                                        </div>
                                        
                                        <div class="row mb-3">
                                            <div class="col-md-6">
                                                <label for="jabatan" class="form-label">
                                                    <i class="fas fa-user-tag"></i> Jabatan
                                                </label>
                                                <select class="form-select" id="jabatan">
                                                    <option value="Ketua Kelompok">Ketua Kelompok</option>
                                                    <option value="Sekretaris">Sekretaris</option>
                                                    <option value="Bendahara">Bendahara</option>
                                                    <option value="Pengawas">Pengawas</option>
                                                    <option value="Anggota">Anggota</option>
                                                    <option value="Individu" selected>Individu</option>
                                                </select>
                                            </div>
                                            <div class="col-md-6">
                                                <label for="tahunAnggaran" class="form-label">
                                                    <i class="fas fa-calendar"></i> Tahun Anggaran
                                                </label>
                                                <select class="form-select" id="tahunAnggaran">
                                                    <!-- Tahun dari 2020-2090 akan diisi oleh JavaScript -->
                                                </select>
                                            </div>
                                        </div>
                                        
                                        <div class="row mb-3">
                                            <div class="col-md-6">
                                                <label for="kecamatan" class="form-label">
                                                    <i class="fas fa-map-marker-alt"></i> Kecamatan
                                                </label>
                                                <select class="form-select" id="kecamatan">
                                                    <option value="">Pilih Kecamatan</option>
                                                    <option value="Kecamatan A">Kecamatan A</option>
                                                    <option value="Kecamatan B">Kecamatan B</option>
                                                    <option value="Kecamatan C">Kecamatan C</option>
                                                </select>
                                            </div>
                                            <div class="col-md-6">
                                                <label for="desa" class="form-label">
                                                    <i class="fas fa-map-marked-alt"></i> Desa
                                                </label>
                                                <select class="form-select" id="desa">
                                                    <option value="">Pilih Desa</option>
                                                    <!-- Opsi desa akan diisi oleh JavaScript -->
                                                </select>
                                            </div>
                                        </div>
                                        
                                        <div class="row mb-3">
                                            <div class="col-md-6">
                                                <label for="alamat" class="form-label">
                                                    <i class="fas fa-home"></i> Alamat Lengkap
                                                </label>
                                                <textarea class="form-control" id="alamat" rows="1"></textarea>
                                            </div>
                                            <div class="col-md-6">
                                                <label for="jenisBantuan" class="form-label">
                                                    <i class="fas fa-gift"></i> Jenis Bantuan
                                                </label>
                                                <select class="form-select" id="jenisBantuan">
                                                    <option value="Uang">Uang</option>
                                                    <option value="Barang">Barang</option>
                                                    <option value="Jasa">Jasa</option>
                                                </select>
                                            </div>
                                        </div>
                                        
                                        <!-- TAMBAHAN: Form Nama Bantuan -->
                                        <div class="row mb-3">
                                            <div class="col-md-6">
                                                <label for="namaBantuan" class="form-label">
                                                    <i class="fas fa-gift"></i> Nama Bantuan
                                                </label>
                                                <input type="text" class="form-control" id="namaBantuan" placeholder="Contoh: Mesin, Uang Tunai BOS, Perbaikan Rumah">
                                                <div class="form-text">Masukkan nama spesifik bantuan yang diberikan</div>
                                            </div>
                                            <div class="col-md-6">
                                                <label for="jumlahBantuan" class="form-label">
                                                    <i class="fas fa-coins"></i> Jumlah Bantuan
                                                </label>
                                                <div class="jenis-bantuan-container">
                                                    <input type="text" class="form-control" id="jumlahBantuan" placeholder="Jumlah">
                                                    <select class="form-select" id="satuanBantuan">
                                                        <option value="Rupiah">Rupiah</option>
                                                        <option value="Unit">Unit</option>
                                                        <option value="Paket">Paket</option>
                                                    </select>
                                                </div>
                                            </div>
                                        </div>
                                        
                                        <div class="row mb-3">
                                            <div class="col-md-6">
                                                <label for="tanggalTerima" class="form-label">
                                                    <i class="fas fa-calendar-check"></i> Tanggal Menerima
                                                </label>
                                                <input type="date" class="form-control" id="tanggalTerima">
                                            </div>
                                            <!-- TAMBAHAN: Form Nama Petugas -->
                                            <div class="col-md-6">
                                                <label for="namaPetugas" class="form-label">
                                                    <i class="fas fa-user-tie"></i> Nama Petugas
                                                </label>
                                                <input type="text" class="form-control" id="namaPetugas" placeholder="Nama petugas yang menangani">
                                                <div class="error-message" id="namaPetugasError"></div>
                                            </div>
                                        </div>
                                        
                                        <div class="row mb-3">
                                            <div class="col-md-6">
                                                <label for="driveLink" class="form-label">
                                                    <i class="fab fa-google-drive"></i> Link Google Drive
                                                </label>
                                                <input type="url" class="form-control" id="driveLink" placeholder="https://drive.google.com/...">
                                            </div>
                                            <div class="col-md-6">
                                                <label for="kodeValidasi" class="form-label">
                                                    <i class="fas fa-qrcode"></i> Kode Validasi
                                                </label>
                                                <div class="kode-validasi-container">
                                                    <input type="text" class="form-control kode-validasi-input" id="kodeValidasi" placeholder="Kode validasi otomatis" readonly>
                                                    <button type="button" class="btn btn-primary btn-generate-kode" id="generateKodeBtn">
                                                        Generate Kode
                                                    </button>
                                                </div>
                                                <div class="form-text">Kode unik untuk validasi data</div>
                                            </div>
                                        </div>
                                        
                                        <div class="row mb-3">
                                            <div class="col-md-12">
                                                <label for="keterangan" class="form-label">
                                                    <i class="fas fa-sticky-note"></i> Keterangan
                                                </label>
                                                <textarea class="form-control" id="keterangan" rows="2" placeholder="Tambahkan keterangan jika diperlukan"></textarea>
                                            </div>
                                        </div>
                                        
                                        <div class="d-flex justify-content-end mt-4">
                                            <button type="reset" class="btn btn-secondary me-2">
                                                <i class="fas fa-undo me-1"></i> Reset
                                            </button>
                                            <button type="submit" class="btn btn-primary">
                                                <i class="fas fa-save me-1"></i> Simpan Data
                                            </button>
                                        </div>
                                    </form>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Data Bantuan Tab -->
                        <div class="tab-pane fade" id="v-pills-data" role="tabpanel" aria-labelledby="v-pills-data-tab">
                            <h3 class="section-title">Data Bantuan</h3>
                            
                            <div class="card">
                                <div class="card-header d-flex justify-content-between align-items-center">
                                    <div>
                                        <i class="fas fa-database me-2"></i> Daftar Penerima Bantuan
                                    </div>
                                    <div class="d-flex">
                                        <input type="text" class="form-control form-control-sm me-2" id="searchData" placeholder="Cari data...">
                                        <button class="btn btn-sm btn-outline-secondary" id="clearSearchBtn">
                                            <i class="fas fa-times"></i>
                                        </button>
                                    </div>
                                </div>
                                <div class="card-body">
                                    <div class="table-responsive">
                                        <table class="table table-hover data-table" id="dataTable">
                                            <thead>
                                                <tr>
                                                    <th>No</th>
                                                    <th>Nama</th>
                                                    <th>NIK</th>
                                                    <th>WhatsApp</th>
                                                    <th>Kelompok</th>
                                                    <th>Jabatan</th>
                                                    <th>Tahun</th>
                                                    <th>Kecamatan</th>
                                                    <th>Desa</th>
                                                    <th>Jenis Bantuan</th>
                                                    <th>Nama Bantuan</th>
                                                    <th>Jumlah</th>
                                                    <th>Tanggal</th>
                                                    <th>Petugas</th>
                                                    <th>Drive Link</th>
                                                    <th>Kode Validasi</th>
                                                    <th>Aksi</th>
                                                </tr>
                                            </thead>
                                            <tbody id="dataTableBody">
                                                <!-- Data akan diisi oleh JavaScript -->
                                            </tbody>
                                        </table>
                                    </div>
                                    
                                    <div class="d-flex justify-content-between align-items-center mt-3">
                                        <div class="text-muted" id="tableInfo">
                                            Menampilkan 0 dari 0 data
                                        </div>
                                        <nav>
                                            <ul class="pagination pagination-sm mb-0" id="pagination">
                                                <!-- Pagination akan diisi oleh JavaScript -->
                                            </ul>
                                        </nav>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Filter Data Tab -->
                        <div class="tab-pane fade" id="v-pills-filter" role="tabpanel" aria-labelledby="v-pills-filter-tab">
                            <h3 class="section-title">Filter Data Bantuan</h3>
                            
                            <div class="card">
                                <div class="card-header">
                                    <i class="fas fa-filter me-2"></i> Filter Data
                                </div>
                                <div class="card-body">
                                    <div class="row mb-3">
                                        <div class="col-md-3">
                                            <label for="filterTahun" class="form-label">Tahun</label>
                                            <select class="form-select" id="filterTahun">
                                                <option value="">Semua Tahun</option>
                                                <!-- Tahun akan diisi oleh JavaScript -->
                                            </select>
                                        </div>
                                        <div class="col-md-3">
                                            <label for="filterKecamatan" class="form-label">Kecamatan</label>
                                            <select class="form-select" id="filterKecamatan">
                                                <option value="">Semua Kecamatan</option>
                                                <option value="Kecamatan A">Kecamatan A</option>
                                                <option value="Kecamatan B">Kecamatan B</option>
                                                <option value="Kecamatan C">Kecamatan C</option>
                                            </select>
                                        </div>
                                        <div class="col-md-3">
                                            <label for="filterDesa" class="form-label">Desa</label>
                                            <select class="form-select" id="filterDesa">
                                                <option value="">Semua Desa</option>
                                                <!-- Desa akan diisi oleh JavaScript -->
                                            </select>
                                        </div>
                                        <div class="col-md-3">
                                            <label for="filterJenis" class="form-label">Jenis Bantuan</label>
                                            <select class="form-select" id="filterJenis">
                                                <option value="">Semua Jenis</option>
                                                <option value="Uang">Uang</option>
                                                <option value="Barang">Barang</option>
                                                <option value="Jasa">Jasa</option>
                                            </select>
                                        </div>
                                    </div>
                                    
                                    <div class="d-flex justify-content-end">
                                        <button type="button" class="btn btn-secondary me-2" id="resetFilterBtn">
                                            <i class="fas fa-undo me-1"></i> Reset Filter
                                        </button>
                                        <button type="button" class="btn btn-primary" id="applyFilterBtn">
                                            <i class="fas fa-check me-1"></i> Terapkan Filter
                                        </button>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="card mt-4">
                                <div class="card-header d-flex justify-content-between align-items-center">
                                    <div>
                                        <i class="fas fa-list me-2"></i> Data Hasil Filter
                                    </div>
                                    <div class="badge bg-primary" id="filterResultCount">0 Data</div>
                                </div>
                                <div class="card-body">
                                    <div class="table-responsive">
                                        <table class="table table-hover data-table" id="filterTable">
                                            <thead>
                                                <tr>
                                                    <th>No</th>
                                                    <th>Nama</th>
                                                    <th>NIK</th>
                                                    <th>WhatsApp</th>
                                                    <th>Kelompok</th>
                                                    <th>Jabatan</th>
                                                    <th>Tahun</th>
                                                    <th>Kecamatan</th>
                                                    <th>Desa</th>
                                                    <th>Jenis Bantuan</th>
                                                    <th>Nama Bantuan</th>
                                                    <th>Jumlah</th>
                                                    <th>Tanggal</th>
                                                    <th>Petugas</th>
                                                    <th>Drive Link</th>
                                                    <th>Kode Validasi</th>
                                                </tr>
                                            </thead>
                                            <tbody id="filterTableBody">
                                                <!-- Data hasil filter akan diisi oleh JavaScript -->
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Cetak Laporan Tab -->
                        <div class="tab-pane fade" id="v-pills-print" role="tabpanel" aria-labelledby="v-pills-print-tab">
                            <h3 class="section-title">Cetak Laporan</h3>
                            
                            <div class="card">
                                <div class="card-header">
                                    <i class="fas fa-print me-2"></i> Opsi Cetak Laporan
                                </div>
                                <div class="card-body">
                                    <div class="row mb-4">
                                        <div class="col-md-4">
                                            <div class="card bg-light">
                                                <div class="card-body text-center">
                                                    <i class="fas fa-file-pdf fa-3x text-danger mb-3"></i>
                                                    <h5>Cetak ke PDF</h5>
                                                    <p class="text-muted">Cetak laporan dalam format PDF</p>
                                                    <button class="btn btn-danger mt-2" id="printPdfBtn">
                                                        <i class="fas fa-file-pdf me-1"></i> Cetak PDF
                                                    </button>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="col-md-4">
                                            <div class="card bg-light">
                                                <div class="card-body text-center">
                                                    <i class="fas fa-eye fa-3x text-info mb-3"></i>
                                                    <h5>Pratinjau</h5>
                                                    <p class="text-muted">Pratinjau laporan sebelum dicetak</p>
                                                    <button class="btn btn-info mt-2" id="previewBtn">
                                                        <i class="fas fa-eye me-1"></i> Pratinjau
                                                    </button>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <div class="control-panel">
                                        <h6 class="control-title">Pengaturan Laporan</h6>
                                        <div class="row">
                                            <div class="col-md-3">
                                                <label for="printTahun" class="form-label">Tahun</label>
                                                <select class="form-select" id="printTahun">
                                                    <option value="">Semua Tahun</option>
                                                    <!-- Tahun akan diisi oleh JavaScript -->
                                                </select>
                                            </div>
                                            <div class="col-md-3">
                                                <label for="printKecamatan" class="form-label">Kecamatan</label>
                                                <select class="form-select" id="printKecamatan">
                                                    <option value="">Semua Kecamatan</option>
                                                    <option value="Kecamatan A">Kecamatan A</option>
                                                    <option value="Kecamatan B">Kecamatan B</option>
                                                    <option value="Kecamatan C">Kecamatan C</option>
                                                </select>
                                            </div>
                                            <div class="col-md-3">
                                                <label for="printJenis" class="form-label">Jenis Bantuan</label>
                                                <select class="form-select" id="printJenis">
                                                    <option value="">Semua Jenis</option>
                                                    <option value="Uang">Uang</option>
                                                    <option value="Barang">Barang</option>
                                                    <option value="Jasa">Jasa</option>
                                                </select>
                                            </div>
                                            <div class="col-md-3">
                                                <label for="printFormat" class="form-label">Format Laporan</label>
                                                <select class="form-select" id="printFormat">
                                                    <option value="detail">Detail Lengkap</option>
                                                    <option value="ringkas">Ringkas</option>
                                                    <option value="hanya-nama">Hanya Nama & Jumlah</option>
                                                </select>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Ekspor Data Tab -->
                        <div class="tab-pane fade" id="v-pills-export" role="tabpanel" aria-labelledby="v-pills-export-tab">
                            <h3 class="section-title">Ekspor Data</h3>
                            
                            <div class="card">
                                <div class="card-header">
                                    <i class="fas fa-file-export me-2"></i> Opsi Ekspor Data
                                </div>
                                <div class="card-body">
                                    <div class="row mb-4">
                                        <div class="col-md-3">
                                            <div class="card bg-light">
                                                <div class="card-body text-center">
                                                    <i class="fas fa-file-excel fa-3x text-success mb-3"></i>
                                                    <h5>Excel</h5>
                                                    <p class="text-muted">Ekspor data ke format Excel</p>
                                                    <button class="btn btn-success mt-2" id="exportExcelBtn">
                                                        <i class="fas fa-file-excel me-1"></i> Ekspor Excel
                                                    </button>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="col-md-3">
                                            <div class="card bg-light">
                                                <div class="card-body text-center">
                                                    <i class="fas fa-file-csv fa-3x text-info mb-3"></i>
                                                    <h5>CSV</h5>
                                                    <p class="text-muted">Ekspor data ke format CSV</p>
                                                    <button class="btn btn-info mt-2" id="exportCsvBtn">
                                                        <i class="fas fa-file-csv me-1"></i> Ekspor CSV
                                                    </button>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="col-md-3">
                                            <div class="card bg-light">
                                                <div class="card-body text-center">
                                                    <i class="fas fa-file-code fa-3x text-warning mb-3"></i>
                                                    <h5>JSON</h5>
                                                    <p class="text-muted">Ekspor data ke format JSON</p>
                                                    <button class="btn btn-warning mt-2" id="exportJsonBtn">
                                                        <i class="fas fa-file-code me-1"></i> Ekspor JSON
                                                    </button>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="col-md-3">
                                            <div class="card bg-light">
                                                <div class="card-body text-center">
                                                    <i class="fas fa-file-pdf fa-3x text-danger mb-3"></i>
                                                    <h5>PDF</h5>
                                                    <p class="text-muted">Ekspor data ke format PDF</p>
                                                    <button class="btn btn-danger mt-2" id="exportPdfBtn">
                                                        <i class="fas fa-file-pdf me-1"></i> Ekspor PDF
                                                    </button>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <div class="control-panel">
                                        <h6 class="control-title">Pengaturan Ekspor</h6>
                                        <div class="row">
                                            <div class="col-md-3">
                                                <label for="exportTahun" class="form-label">Tahun</label>
                                                <select class="form-select" id="exportTahun">
                                                    <option value="">Semua Tahun</option>
                                                    <!-- Tahun akan diisi oleh JavaScript -->
                                                </select>
                                            </div>
                                            <div class="col-md-3">
                                                <label for="exportKecamatan" class="form-label">Kecamatan</label>
                                                <select class="form-select" id="exportKecamatan">
                                                    <option value="">Semua Kecamatan</option>
                                                    <option value="Kecamatan A">Kecamatan A</option>
                                                    <option value="Kecamatan B">Kecamatan B</option>
                                                    <option value="Kecamatan C">Kecamatan C</option>
                                                </select>
                                            </div>
                                            <div class="col-md-3">
                                                <label for="exportJenis" class="form-label">Jenis Bantuan</label>
                                                <select class="form-select" id="exportJenis">
                                                    <option value="">Semua Jenis</option>
                                                    <option value="Uang">Uang</option>
                                                    <option value="Barang">Barang</option>
                                                    <option value="Jasa">Jasa</option>
                                                </select>
                                            </div>
                                            <div class="col-md-3">
                                                <label for="exportFormat" class="form-label">Format Data</label>
                                                <select class="form-select" id="exportFormat">
                                                    <option value="full">Lengkap</option>
                                                    <option value="essential">Penting Saja</option>
                                                    <option value="minimal">Minimal</option>
                                                </select>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Backup & Restore Tab -->
                        <div class="tab-pane fade" id="v-pills-backup" role="tabpanel" aria-labelledby="v-pills-backup-tab">
                            <h3 class="section-title">Backup & Restore Data</h3>
                            
                            <div class="row">
                                <div class="col-md-6">
                                    <div class="card">
                                        <div class="card-header">
                                            <i class="fas fa-download me-2"></i> Backup Data
                                        </div>
                                        <div class="card-body text-center">
                                            <i class="fas fa-database fa-4x text-primary mb-3"></i>
                                            <h5>Backup Seluruh Data</h5>
                                            <p class="text-muted">Simpan salinan data ke file JSON</p>
                                            <button class="btn btn-primary mt-3" id="backupDataBtn">
                                                <i class="fas fa-download me-1"></i> Backup Data
                                            </button>
                                            <div class="mt-4">
                                                <label for="backupFileName" class="form-label">Nama File Backup</label>
                                                <input type="text" class="form-control" id="backupFileName" value="backup-barjas">
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="card">
                                        <div class="card-header">
                                            <i class="fas fa-upload me-2"></i> Restore Data
                                        </div>
                                        <div class="card-body text-center">
                                            <i class="fas fa-file-upload fa-4x text-success mb-3"></i>
                                            <h5>Restore Data dari File</h5>
                                            <p class="text-muted">Muat ulang data dari file backup</p>
                                            <div class="mt-3">
                                                <input type="file" class="form-control" id="restoreFileInput" accept=".json">
                                                <button class="btn btn-success mt-3 w-100" id="restoreDataBtn" disabled>
                                                    <i class="fas fa-upload me-1"></i> Restore Data
                                                </button>
                                            </div>
                                            <div class="alert alert-warning mt-3">
                                                <i class="fas fa-exclamation-triangle me-1"></i>
                                                <strong>Peringatan:</strong> Restore akan menimpa data yang ada!
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="card mt-4">
                                <div class="card-header">
                                    <i class="fas fa-trash-alt me-2"></i> Reset Data
                                </div>
                                <div class="card-body text-center">
                                    <i class="fas fa-exclamation-triangle fa-4x text-danger mb-3"></i>
                                    <h5>Reset Seluruh Data</h5>
                                    <p class="text-muted">Hapus semua data dan kembali ke keadaan awal</p>
                                    <button class="btn btn-danger mt-2" id="resetDataBtn" data-bs-toggle="modal" data-bs-target="#confirmResetModal">
                                        <i class="fas fa-trash-alt me-1"></i> Reset Data
                                    </button>
                                    <div class="alert alert-danger mt-3">
                                        <i class="fas fa-radiation me-1"></i>
                                        <strong>PERINGATAN TINGGI:</strong> Tindakan ini tidak dapat dibatalkan! Semua data akan dihapus permanen.
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Pengaturan Tab -->
                        <div class="tab-pane fade" id="v-pills-settings" role="tabpanel" aria-labelledby="v-pills-settings-tab">
                            <h3 class="section-title">Pengaturan Aplikasi</h3>
                            
                            <div class="card">
                                <div class="card-header">
                                    <i class="fas fa-cog me-2"></i> Pengaturan Umum
                                </div>
                                <div class="card-body">
                                    <form id="settingsForm">
                                        <div class="row mb-3">
                                            <div class="col-md-6">
                                                <label for="appName" class="form-label">Nama Aplikasi</label>
                                                <input type="text" class="form-control" id="appName" value="BARJAS">
                                            </div>
                                            <div class="col-md-6">
                                                <label for="appSubtitle" class="form-label">Subjudul Aplikasi</label>
                                                <input type="text" class="form-control" id="appSubtitle" value="Sistem Bantuan Terpadu">
                                            </div>
                                        </div>
                                        
                                        <div class="row mb-3">
                                            <div class="col-md-6">
                                                <label for="defaultTahun" class="form-label">Tahun Default</label>
                                                <select class="form-select" id="defaultTahun">
                                                    <!-- Tahun akan diisi oleh JavaScript -->
                                                </select>
                                            </div>
                                            <div class="col-md-6">
                                                <label for="itemsPerPage" class="form-label">Item per Halaman</label>
                                                <select class="form-select" id="itemsPerPage">
                                                    <option value="10">10 Item</option>
                                                    <option value="25" selected>25 Item</option>
                                                    <option value="50">50 Item</option>
                                                    <option value="100">100 Item</option>
                                                </select>
                                            </div>
                                        </div>
                                        
                                        <div class="row mb-3">
                                            <div class="col-md-6">
                                                <label for="backupInterval" class="form-label">Interval Backup Otomatis</label>
                                                <select class="form-select" id="backupInterval">
                                                    <option value="0">Tidak Ada</option>
                                                    <option value="1">Setiap Hari</option>
                                                    <option value="7" selected>Setiap Minggu</option>
                                                    <option value="30">Setiap Bulan</option>
                                                </select>
                                            </div>
                                            <div class="col-md-6">
                                                <label for="securityCode" class="form-label">Kode Keamanan</label>
                                                <div class="input-group">
                                                    <input type="password" class="form-control" id="securityCodeInput" placeholder="Masukkan kode keamanan baru">
                                                    <button class="btn btn-outline-secondary toggle-security-password" type="button">
                                                        <i class="fas fa-eye"></i>
                                                    </button>
                                                </div>
                                                <div class="form-text">Kode untuk mengakses aplikasi</div>
                                                <div class="error-message" id="securityCodeError"></div>
                                            </div>
                                        </div>
                                        
                                        <div class="form-check form-switch mb-3">
                                            <input class="form-check-input" type="checkbox" id="autoSave" checked>
                                            <label class="form-check-label" for="autoSave">Simpan Otomatis</label>
                                        </div>
                                        
                                        <div class="form-check form-switch mb-3">
                                            <input class="form-check-input" type="checkbox" id="notifications" checked>
                                            <label class="form-check-label" for="notifications">Aktifkan Notifikasi</label>
                                        </div>
                                        
                                        <div class="d-flex justify-content-end">
                                            <button type="reset" class="btn btn-secondary me-2">Reset</button>
                                            <button type="submit" class="btn btn-primary">Simpan Pengaturan</button>
                                        </div>
                                    </form>
                                </div>
                            </div>
                            
                            <div class="card mt-4">
                                <div class="card-header">
                                    <i class="fas fa-info-circle me-2"></i> Informasi Aplikasi
                                </div>
                                <div class="card-body">
                                    <div class="row">
                                        <div class="col-md-6">
                                            <ul class="list-group list-group-flush">
                                                <li class="list-group-item d-flex justify-content-between align-items-center">
                                                    Versi Aplikasi
                                                    <span class="badge bg-primary">2.0.1</span>
                                                </li>
                                                <li class="list-group-item d-flex justify-content-between align-items-center">
                                                    Jumlah Data
                                                    <span class="badge bg-info" id="settingsDataCount">0</span>
                                                </li>
                                                <li class="list-group-item d-flex justify-content-between align-items-center">
                                                    Tanggal Backup Terakhir
                                                    <span class="badge bg-secondary" id="lastBackupDate">-</span>
                                                </li>
                                            </ul>
                                        </div>
                                        <div class="col-md-6">
                                            <ul class="list-group list-group-flush">
                                                <li class="list-group-item d-flex justify-content-between align-items-center">
                                                    Browser
                                                    <span class="badge bg-success" id="browserInfo">-</span>
                                                </li>
                                                <li class="list-group-item d-flex justify-content-between align-items-center">
                                                    Local Storage
                                                    <span class="badge bg-warning" id="storageInfo">-</span>
                                                </li>
                                                <li class="list-group-item d-flex justify-content-between align-items-center">
                                                    Status
                                                    <span class="badge bg-success" id="appStatus">Aktif</span>
                                                </li>
                                            </ul>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="copyright">
                &copy; 2025 BARJAS - Sistem Bantuan Terpadu. Hak Cipta Dilindungi.
            </div>
        </div>
        
        <!-- Floating Action Button -->
        <div class="floating-action-btn" id="fabBtn">
            <i class="fas fa-plus"></i>
        </div>
        
        <!-- Notification Toast -->
        <div class="toast notification-toast" role="alert" aria-live="assertive" aria-atomic="true" data-bs-autohide="true" data-bs-delay="5000">
            <div class="toast-header">
                <i class="fas fa-bell text-primary me-2"></i>
                <strong class="me-auto">BARJAS Notification</strong>
                <small>Just now</small>
                <button type="button" class="btn-close" data-bs-dismiss="toast" aria-label="Close"></button>
            </div>
            <div class="toast-body" id="toastMessage">
                <!-- Message will be inserted here -->
            </div>
        </div>
    </div>
    
    <!-- Modal Konfirmasi Reset Data -->
    <div class="modal fade" id="confirmResetModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header bg-danger text-white">
                    <h5 class="modal-title">
                        <i class="fas fa-exclamation-triangle me-2"></i> Konfirmasi Reset Data
                    </h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <p>Apakah Anda yakin ingin mereset semua data?</p>
                    <p class="text-danger"><strong>Peringatan:</strong> Tindakan ini akan menghapus semua data dan tidak dapat dibatalkan!</p>
                    <p>Ketik <strong>RESET</strong> pada kolom di bawah untuk mengonfirmasi:</p>
                    <input type="text" class="form-control" id="resetConfirmationInput">
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Batal</button>
                    <button type="button" class="btn btn-danger" id="confirmResetBtn" disabled>Reset Data</button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Modal Preview Laporan -->
    <div class="modal fade" id="previewModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog modal-xl">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Pratinjau Laporan</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <div class="preview-container" id="previewContent">
                        <!-- Konten pratinjau akan diisi oleh JavaScript -->
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Tutup</button>
                    <button type="button" class="btn btn-primary" id="printFromPreviewBtn">
                        <i class="fas fa-print me-1"></i> Cetak
                    </button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Modal Tambah Link Google Drive -->
    <div class="modal fade link-modal" id="driveLinkModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Tambah Link Google Drive</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <div class="mb-3">
                        <label for="modalDriveLink" class="form-label">Link Google Drive</label>
                        <input type="url" class="form-control" id="modalDriveLink" placeholder="https://drive.google.com/...">
                    </div>
                    <div class="form-text">
                        Pastikan link dapat diakses secara publik atau melalui izin yang sesuai.
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Batal</button>
                    <button type="button" class="btn btn-primary" id="saveDriveLinkBtn">Simpan</button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Scripts -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-datepicker/1.9.0/js/bootstrap-datepicker.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.28/jspdf.plugin.autotable.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    
    <script>
        // Inisialisasi variabel global
        let appData = [];
        let currentPage = 1;
        let itemsPerPage = 25;
        let filteredData = [];
        let isFilterActive = false;
        let loginAttempts = 0;
        let isBlocked = false;
        let blockTimeout;
        let generatedCodes = {}; // Menyimpan kode yang sudah digenerate per NIK
        
        // Data desa dan kecamatan
        const kecamatanList = [
            "Arjasa", "Asembagus", "Banyuglugur", "Banyuputih", "Besuki", 
            "Bungatan", "Jangkar", "Jatibanteng", "Kapongan", "Kendit", 
            "Mangaran", "Mlandingan", "Panarukan", "Panji", "Situbondo", 
            "Suboh", "Sumbermalang"
        ];
        
        const desaList = [
            "Agel", "Alas Bayur", "Alasmalang", "Alastengah", "Arjasa", "Ardirejo", "Asembagus", 
            "Awar-awar", "Awang-awang", "Baderan", "Balung", "Bantal", "Battal", "Bayeman", "Besuki", "Bletok", "Blimbing", "Bloro", "Buduan", "Bugeman", "Bungatan", 
            "Campoan", "Cemara", "Curah Cottok", "Curah Jeru", "Curah Kalak", "Curah Suri", "Curah Tatal", "Dawuhan", "Demung", "Duwet", "Gadingan", "Gebangan", 
            "Gelung", "Gudang", "Gunung Malang", "Gunung Putri", "Jangkar", "Jatisari", "Jatibanteng", "Jetis", "Juglangan", "Kalianget", "Kalibagor", "Kalimas", 
            "Kalirejo", "Kalisari", "Kandang", "Kayu Putih", "Kayumas", "Kedungdowo", "Kedunglo", "Kembangsari", "Ketah", "Ketawan", "Kilensari", "Klampokan", 
            "Klatakan", "Kotakan", "Kumbangsari", "Kukusan", "Lamongan", "Landangan", "Langkap", "Lebeng", "Lubawang", "Mangaran", "Mimbaan", "Mlandingan Kulon", 
            "Mlandingan Wetan", "Mojodungkol", "Mojosari", "Olean", "Palangan", "Panarukan", "Panji Kidul", "Panji Lor", "Parante", "Pasir Putih", "Patemon", 
            "Patokan", "Paowan", "Peleyan", "Pesisir", "Pesanggrahan", "Pategalan", "Patemon", "Plalangan", "Pokaan", "Rajekwesi", "Seletreng", "Selobanteng", 
            "Selomukti", "Selowogo", "Semambung", "Semiring", "Sliwung", "Sopet", "Sumber Pinang", "Sumberanyar", "Sumberargo", "Sumberkolak", "Sumberejo", 
            "Sumbertengah", "Sumberwaru", "Tamankursi", "Tamansari", "Taman", "Talkandang", "Tanjung Glugur", "Tanjung Kamal", "Tanjung Pecinan", "Tambak Ukir", 
            "Telempong", "Tenggir", "Tepos", "Tokelan", "Tlogosari", "Trigonco", "Trebungan", "Widoropayung", "Wonokoyo", "Wonorejo", "Wringinanom"
        ];
        
        // Konstanta untuk kode keamanan
        const DEFAULT_SECURITY_CODE = "1234";
        const MIN_SECURITY_CODE_LENGTH = 4;
        let securityCode = localStorage.getItem('barjasSecurityCode') || DEFAULT_SECURITY_CODE;
        
        // DOM Ready
        document.addEventListener('DOMContentLoaded', function() {
            // Inisialisasi aplikasi
            initializeApp();
            
            // Setup event listeners
            setupEventListeners();
            
            // Load data dari localStorage
            loadData();
            
            // Update dashboard
            updateDashboard();
            
            // Tampilkan modal login
            const loginModal = new bootstrap.Modal(document.getElementById('loginModal'));
            loginModal.show();
        });
        
        // Fungsi inisialisasi aplikasi
        function initializeApp() {
            // Isi dropdown tahun (2020-2090)
            fillYearDropdowns();
            
            // Isi dropdown kecamatan dan desa
            fillKecamatanDropdown();
            fillDesaDropdown();
            
            // Set tahun default ke tahun sekarang
            const currentYear = new Date().getFullYear();
            document.getElementById('tahunAnggaran').value = currentYear;
            document.getElementById('defaultTahun').value = currentYear;
            
            // Set tanggal hari ini untuk input tanggal
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('tanggalTerima').value = today;
            
            // Inisialisasi chart
            initializeCharts();
            
            // Setup browser info
            setupBrowserInfo();
            
            // Set nilai kode keamanan di form pengaturan
            document.getElementById('securityCodeInput').value = securityCode;
        }
        
        // Fungsi untuk mengisi dropdown tahun (2020-2090)
        function fillYearDropdowns() {
            const yearSelects = [
                'tahunAnggaran', 'filterTahun', 'printTahun', 
                'exportTahun', 'defaultTahun'
            ];
            
            for (const selectId of yearSelects) {
                const select = document.getElementById(selectId);
                // Kosongkan select terlebih dahulu
                select.innerHTML = '';
                
                // Tambahkan opsi default
                if (selectId !== 'tahunAnggaran') {
                    const defaultOption = document.createElement('option');
                    defaultOption.value = '';
                    defaultOption.textContent = selectId === 'defaultTahun' ? 'Pilih Tahun' : 'Semua Tahun';
                    select.appendChild(defaultOption);
                }
                
                // Tambahkan opsi tahun dari 2020 hingga 2090
                for (let year = 2020; year <= 2090; year++) {
                    const option = document.createElement('option');
                    option.value = year;
                    option.textContent = year;
                    select.appendChild(option);
                }
                
                // Set nilai default untuk tahun anggaran
                if (selectId === 'tahunAnggaran') {
                    select.value = new Date().getFullYear();
                }
            }
        }
        
        // Fungsi untuk mengisi dropdown kecamatan
        function fillKecamatanDropdown() {
            const kecamatanSelects = ['kecamatan', 'filterKecamatan', 'printKecamatan', 'exportKecamatan'];
            
            for (const selectId of kecamatanSelects) {
                const select = document.getElementById(selectId);
                // Kosongkan select terlebih dahulu
                select.innerHTML = '';
                
                // Tambahkan opsi default
                const defaultOption = document.createElement('option');
                defaultOption.value = '';
                defaultOption.textContent = selectId === 'kecamatan' ? 'Pilih Kecamatan' : 'Semua Kecamatan';
                select.appendChild(defaultOption);
                
                // Tambahkan opsi kecamatan
                for (const kecamatan of kecamatanList) {
                    const option = document.createElement('option');
                    option.value = kecamatan;
                    option.textContent = kecamatan;
                    select.appendChild(option);
                }
            }
        }
        
        // Fungsi untuk mengisi dropdown desa
        function fillDesaDropdown() {
            const desaSelects = ['desa', 'filterDesa'];
            
            for (const selectId of desaSelects) {
                const select = document.getElementById(selectId);
                // Kosongkan select terlebih dahulu
                select.innerHTML = '';
                
                // Tambahkan opsi default
                const defaultOption = document.createElement('option');
                defaultOption.value = '';
                defaultOption.textContent = selectId === 'desa' ? 'Pilih Desa' : 'Semua Desa';
                select.appendChild(defaultOption);
                
                // Tambahkan opsi desa
                for (const desa of desaList) {
                    const option = document.createElement('option');
                    option.value = desa;
                    option.textContent = desa;
                    select.appendChild(option);
                }
            }
        }
        
        // Fungsi untuk setup event listeners
        function setupEventListeners() {
            // Login form
            document.getElementById('loginForm').addEventListener('submit', handleLogin);
            document.querySelector('.toggle-password').addEventListener('click', togglePasswordVisibility);
            
            // Input form
            document.getElementById('inputForm').addEventListener('submit', handleFormSubmit);
            document.getElementById('btnBukanKelompok').addEventListener('click', setBukanKelompok);
            document.getElementById('generateKodeBtn').addEventListener('click', generateKodeValidasi);
            
            // WhatsApp number formatting
            document.getElementById('whatsapp').addEventListener('input', formatWhatsAppNumber);
            
            // Data table
            document.getElementById('searchData').addEventListener('input', handleSearch);
            document.getElementById('clearSearchBtn').addEventListener('click', clearSearch);
            
            // Filter
            document.getElementById('applyFilterBtn').addEventListener('click', applyFilter);
            document.getElementById('resetFilterBtn').addEventListener('click', resetFilter);
            
            // Print & Export
            document.getElementById('printPdfBtn').addEventListener('click', printToPdf);
            document.getElementById('previewBtn').addEventListener('click', showPreview);
            document.getElementById('exportExcelBtn').addEventListener('click', exportToExcel);
            document.getElementById('exportCsvBtn').addEventListener('click', exportToCsv);
            document.getElementById('exportJsonBtn').addEventListener('click', exportToJson);
            document.getElementById('exportPdfBtn').addEventListener('click', exportToPdf);
            
            // Backup & Restore
            document.getElementById('backupDataBtn').addEventListener('click', backupData);
            document.getElementById('restoreFileInput').addEventListener('change', enableRestoreButton);
            document.getElementById('restoreDataBtn').addEventListener('click', restoreData);
            document.getElementById('resetConfirmationInput').addEventListener('input', enableResetButton);
            document.getElementById('confirmResetBtn').addEventListener('click', resetData);
            
            // Settings
            document.getElementById('settingsForm').addEventListener('submit', saveSettings);
            document.querySelector('.toggle-security-password').addEventListener('click', toggleSecurityPasswordVisibility);
            
            // Mobile menu
            document.getElementById('mobileMenuBtn').addEventListener('click', toggleMobileMenu);
            document.getElementById('sidebarOverlay').addEventListener('click', toggleMobileMenu);
            
            // FAB button
            document.getElementById('fabBtn').addEventListener('click', scrollToTop);
            
            // Kecamatan change event untuk update desa
            document.getElementById('kecamatan').addEventListener('change', updateDesaDropdown);
            document.getElementById('filterKecamatan').addEventListener('change', updateFilterDesaDropdown);
            
            // Jenis bantuan change event
            document.getElementById('jenisBantuan').addEventListener('change', updateSatuanBantuan);

            // Print from preview button
            document.getElementById('printFromPreviewBtn').addEventListener('click', function() {
                window.print();
            });
        }
        
        // Fungsi untuk handle login
        function handleLogin(e) {
            e.preventDefault();
            
            if (isBlocked) {
                showNotification('Anda masih dalam masa pemblokiran. Silakan coba lagi nanti.', 'error');
                return;
            }
            
            const securityCodeInput = document.getElementById('securityCode').value;
            
            // Tampilkan spinner
            document.getElementById('loginSpinner').classList.remove('d-none');
            document.querySelector('.login-button-text').textContent = 'Memproses...';
            document.getElementById('loginButton').disabled = true;
            
            // Simulasi proses login
            setTimeout(() => {
                if (validateSecurityCode(securityCodeInput)) {
                    // Login berhasil
                    document.getElementById('loginSpinner').classList.add('d-none');
                    document.querySelector('.login-button-text').textContent = 'Masuk ke Aplikasi';
                    document.getElementById('loginButton').disabled = false;
                    
                    // Sembunyikan modal login
                    const loginModal = bootstrap.Modal.getInstance(document.getElementById('loginModal'));
                    loginModal.hide();
                    
                    // Tampilkan konten aplikasi
                    document.getElementById('appContent').style.display = 'block';
                    
                    // Reset percobaan login
                    loginAttempts = 0;
                    updateAttemptsCount();
                    
                    showNotification('Login berhasil! Selamat datang di aplikasi BARJAS.', 'success');
                } else {
                    // Login gagal
                    document.getElementById('loginSpinner').classList.add('d-none');
                    document.querySelector('.login-button-text').textContent = 'Masuk ke Aplikasi';
                    document.getElementById('loginButton').disabled = false;
                    
                    loginAttempts++;
                    updateAttemptsCount();
                    
                    // Goyangkan form
                    document.getElementById('loginForm').classList.add('login-shake');
                    setTimeout(() => {
                        document.getElementById('loginForm').classList.remove('login-shake');
                    }, 600);
                    
                    if (loginAttempts >= 3) {
                        // Blokir akses sementara
                        blockAccess();
                    }
                    
                    showNotification('Kode keamanan salah. Silakan coba lagi.', 'error');
                }
            }, 1000);
        }
        
        // Fungsi untuk validasi kode keamanan
        function validateSecurityCode(code) {
            return code === securityCode;
        }
        
        // Fungsi untuk update kode keamanan
        function updateSecurityCode(newCode) {
            // Validasi panjang kode
            if (newCode.length < MIN_SECURITY_CODE_LENGTH) {
                return {
                    success: false,
                    message: `Kode keamanan minimal ${MIN_SECURITY_CODE_LENGTH} karakter`
                };
            }
            
            // Update kode keamanan
            securityCode = newCode;
            localStorage.setItem('barjasSecurityCode', newCode);
            
            return {
                success: true,
                message: 'Kode keamanan berhasil diperbarui'
            };
        }
        
        // Fungsi untuk toggle password visibility
        function togglePasswordVisibility() {
            const passwordInput = document.getElementById('securityCode');
            const toggleButton = document.querySelector('.toggle-password');
            
            if (passwordInput.type === 'password') {
                passwordInput.type = 'text';
                toggleButton.innerHTML = '<i class="fas fa-eye-slash"></i>';
            } else {
                passwordInput.type = 'password';
                toggleButton.innerHTML = '<i class="fas fa-eye"></i>';
            }
        }
        
        // Fungsi untuk toggle security password visibility
        function toggleSecurityPasswordVisibility() {
            const passwordInput = document.getElementById('securityCodeInput');
            const toggleButton = document.querySelector('.toggle-security-password');
            
            if (passwordInput.type === 'password') {
                passwordInput.type = 'text';
                toggleButton.innerHTML = '<i class="fas fa-eye-slash"></i>';
            } else {
                passwordInput.type = 'password';
                toggleButton.innerHTML = '<i class="fas fa-eye"></i>';
            }
        }
        
        // Fungsi untuk update attempts count
        function updateAttemptsCount() {
            const attemptsElement = document.getElementById('attemptsCount');
            const blockedMessage = document.getElementById('blockedMessage');
            
            if (loginAttempts > 0) {
                attemptsElement.textContent = `Percobaan login gagal: ${loginAttempts}/3`;
                attemptsElement.style.display = 'block';
            } else {
                attemptsElement.style.display = 'none';
            }
            
            if (isBlocked) {
                blockedMessage.classList.remove('d-none');
            } else {
                blockedMessage.classList.add('d-none');
            }
        }
        
        // Fungsi untuk memblokir akses sementara
        function blockAccess() {
            isBlocked = true;
            updateAttemptsCount();
            
            let countdown = 30;
            document.getElementById('countdown').textContent = countdown;
            
            blockTimeout = setInterval(() => {
                countdown--;
                document.getElementById('countdown').textContent = countdown;
                
                if (countdown <= 0) {
                    clearInterval(blockTimeout);
                    isBlocked = false;
                    updateAttemptsCount();
                }
            }, 1000);
        }
        
        // Fungsi untuk logout
        function logout() {
            if (confirm('Apakah Anda yakin ingin keluar dari aplikasi?')) {
                // Sembunyikan konten aplikasi
                document.getElementById('appContent').style.display = 'none';
                
                // Tampilkan modal login
                const loginModal = new bootstrap.Modal(document.getElementById('loginModal'));
                loginModal.show();
                
                showNotification('Anda telah logout dari aplikasi.', 'info');
            }
        }
        
        // Fungsi untuk handle form submit
        function handleFormSubmit(e) {
            e.preventDefault();
            
            // Validasi form
            if (!validateForm()) {
                return;
            }
            
            // Ambil nilai dari form
            const formData = {
                nama: document.getElementById('nama').value,
                nik: document.getElementById('nik').value,
                whatsapp: document.getElementById('whatsapp').getAttribute('data-raw-value') || document.getElementById('whatsapp').value.replace(/\D/g, ''),
                namaKelompok: document.getElementById('namaKelompok').value,
                jabatan: document.getElementById('jabatan').value,
                tahunAnggaran: document.getElementById('tahunAnggaran').value,
                kecamatan: document.getElementById('kecamatan').value,
                desa: document.getElementById('desa').value,
                alamat: document.getElementById('alamat').value,
                jenisBantuan: document.getElementById('jenisBantuan').value,
                namaBantuan: document.getElementById('namaBantuan').value,
                jumlahBantuan: document.getElementById('jumlahBantuan').value,
                satuanBantuan: document.getElementById('satuanBantuan').value,
                tanggalTerima: document.getElementById('tanggalTerima').value,
                namaPetugas: document.getElementById('namaPetugas').value,
                driveLink: document.getElementById('driveLink').value,
                kodeValidasi: document.getElementById('kodeValidasi').value,
                keterangan: document.getElementById('keterangan').value,
                tanggalInput: new Date().toISOString()
            };
            
            // Cek apakah sedang dalam mode edit
            const editId = document.getElementById('inputForm').getAttribute('data-edit-id');
            if (editId) {
                // Mode edit - update data yang ada
                const id = parseInt(editId);
                const index = appData.findIndex(item => item.id === id);
                
                if (index !== -1) {
                    // Pertahankan ID asli
                    formData.id = id;
                    appData[index] = formData;
                    
                    showNotification('Data berhasil diperbarui!', 'success');
                }
            } else {
                // Mode tambah - buat data baru
                formData.id = Date.now(); // ID unik berdasarkan timestamp
                appData.push(formData);
                
                showNotification('Data berhasil disimpan!', 'success');
            }
            
            // Simpan data
            saveData();
            
            // Reset form
            cancelEdit();
            
            // Update UI
            updateDashboard();
            renderDataTable();
        }
        
        // Fungsi untuk validasi form
        function validateForm() {
            let isValid = true;
            
            // Validasi Nama
            const nama = document.getElementById('nama').value;
            if (!nama) {
                document.getElementById('namaError').textContent = 'Nama harus diisi';
                document.getElementById('namaError').style.display = 'block';
                document.getElementById('nama').classList.add('input-error');
                isValid = false;
            } else {
                document.getElementById('namaError').style.display = 'none';
                document.getElementById('nama').classList.remove('input-error');
            }
            
            // Validasi NIK
            const nik = document.getElementById('nik').value;
            if (!nik) {
                document.getElementById('nikError').textContent = 'NIK harus diisi';
                document.getElementById('nikError').style.display = 'block';
                document.getElementById('nik').classList.add('input-error');
                isValid = false;
            } else if (isNikExists(nik)) {
                document.getElementById('nikError').textContent = 'NIK sudah terdaftar dalam sistem';
                document.getElementById('nikError').style.display = 'block';
                document.getElementById('nik').classList.add('input-error');
                isValid = false;
            } else {
                document.getElementById('nikError').style.display = 'none';
                document.getElementById('nik').classList.remove('input-error');
            }
            
            // Validasi WhatsApp
            const whatsapp = document.getElementById('whatsapp').value;
            if (!whatsapp) {
                document.getElementById('whatsappError').textContent = 'Nomor WhatsApp harus diisi';
                document.getElementById('whatsappError').style.display = 'block';
                document.getElementById('whatsapp').classList.add('input-error');
                isValid = false;
            } else {
                document.getElementById('whatsappError').style.display = 'none';
                document.getElementById('whatsapp').classList.remove('input-error');
            }
            
            // Validasi Nama Petugas
            const namaPetugas = document.getElementById('namaPetugas').value;
            if (!namaPetugas) {
                document.getElementById('namaPetugasError').textContent = 'Nama petugas harus diisi';
                document.getElementById('namaPetugasError').style.display = 'block';
                document.getElementById('namaPetugas').classList.add('input-error');
                isValid = false;
            } else {
                document.getElementById('namaPetugasError').style.display = 'none';
                document.getElementById('namaPetugas').classList.remove('input-error');
            }
            
            // Validasi Kode Validasi
            const kodeValidasi = document.getElementById('kodeValidasi').value;
            if (!kodeValidasi) {
                showNotification('Harap generate kode validasi terlebih dahulu', 'error');
                isValid = false;
            }
            
            return isValid;
        }
        
        // Fungsi untuk format nomor WhatsApp
        function formatWhatsAppNumber(e) {
            let value = e.target.value.replace(/\D/g, '');
            
            // Jika dimulai dengan 0, ganti dengan 62
            if (value.startsWith('0')) {
                value = '62' + value.substring(1);
            }
            
            // Simpan nilai asli (tanpa tanda hubung) di data attribute
            e.target.setAttribute('data-raw-value', value);
            
            // Format tampilan: 62-xxx-xxxx-xxxx hanya untuk tampilan
            let displayValue = value;
            if (value.length > 2) {
                displayValue = value.substring(0, 2) + '-' + value.substring(2);
            }
            if (value.length > 6) {
                displayValue = value.substring(0, 6) + '-' + value.substring(6);
            }
            if (value.length > 11) {
                displayValue = value.substring(0, 11) + '-' + value.substring(11);
            }
            
            e.target.value = displayValue;
        }
        
        // Fungsi untuk mengecek apakah NIK sudah ada
        function isNikExists(nik) {
            const editId = document.getElementById('inputForm').getAttribute('data-edit-id');
            
            return appData.some(data => {
                // Jika sedang dalam mode edit, abaikan data yang sedang diedit
                if (editId && data.id === parseInt(editId)) {
                    return false;
                }
                return data.nik === nik;
            });
        }
        
        // Fungsi untuk set "Bukan Kelompok"
        function setBukanKelompok() {
            document.getElementById('namaKelompok').value = 'Bukan Kelompok';
            document.getElementById('jabatan').value = 'Individu';
        }
        
        // Fungsi untuk generate kode unik
        function generateKodeValidasi() {
            const nik = document.getElementById('nik').value;
            const nama = document.getElementById('nama').value;
            
            if (!nik || !nama) {
                showNotification('Harap isi NIK dan Nama terlebih dahulu', 'error');
                return;
            }
            
            // Cek apakah sudah ada kode untuk NIK ini
            if (generatedCodes[nik]) {
                document.getElementById('kodeValidasi').value = generatedCodes[nik];
                showNotification('Kode validasi sudah digenerate untuk NIK ini', 'info');
                return;
            }
            
            // Generate kode unik 5 karakter (huruf kapital dan angka)
            const characters = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789';
            let result = '';
            
            for (let i = 0; i < 5; i++) {
                result += characters.charAt(Math.floor(Math.random() * characters.length));
            }
            
            // Simpan kode untuk NIK ini
            generatedCodes[nik] = result;
            
            // Set nilai kode validasi
            document.getElementById('kodeValidasi').value = result;
            
            showNotification('Kode validasi berhasil digenerate', 'success');
        }
        
        // Fungsi untuk update dropdown desa berdasarkan kecamatan
        function updateDesaDropdown() {
            const kecamatan = document.getElementById('kecamatan').value;
            const desaSelect = document.getElementById('desa');
            
            // Reset dropdown desa
            desaSelect.innerHTML = '<option value="">Pilih Desa</option>';
            
            // Jika tidak ada kecamatan yang dipilih, tampilkan semua desa
            if (!kecamatan) {
                for (const desa of desaList) {
                    const option = document.createElement('option');
                    option.value = desa;
                    option.textContent = desa;
                    desaSelect.appendChild(option);
                }
                return;
            }
            
            // Daftar desa berdasarkan kecamatan (dalam aplikasi nyata, ini akan disesuaikan)
            // Untuk sementara, tampilkan semua desa tanpa filter
            for (const desa of desaList) {
                const option = document.createElement('option');
                option.value = desa;
                option.textContent = desa;
                desaSelect.appendChild(option);
            }
        }
        
        // Fungsi untuk update dropdown desa filter berdasarkan kecamatan
        function updateFilterDesaDropdown() {
            const kecamatan = document.getElementById('filterKecamatan').value;
            const desaSelect = document.getElementById('filterDesa');
            
            // Reset dropdown desa
            desaSelect.innerHTML = '<option value="">Semua Desa</option>';
            
            // Jika tidak ada kecamatan yang dipilih, tampilkan semua desa
            if (!kecamatan) {
                for (const desa of desaList) {
                    const option = document.createElement('option');
                    option.value = desa;
                    option.textContent = desa;
                    desaSelect.appendChild(option);
                }
                return;
            }
            
            // Daftar desa berdasarkan kecamatan (dalam aplikasi nyata, ini akan disesuaikan)
            // Untuk sementara, tampilkan semua desa tanpa filter
            for (const desa of desaList) {
                const option = document.createElement('option');
                option.value = desa;
                option.textContent = desa;
                desaSelect.appendChild(option);
            }
        }
        
        // Fungsi untuk update satuan bantuan berdasarkan jenis bantuan
        function updateSatuanBantuan() {
            const jenisBantuan = document.getElementById('jenisBantuan').value;
            const satuanBantuan = document.getElementById('satuanBantuan');
            
            // Reset dropdown satuan
            satuanBantuan.innerHTML = '';
            
            // Set opsi satuan berdasarkan jenis bantuan
            if (jenisBantuan === 'Uang') {
                satuanBantuan.innerHTML = '<option value="Rupiah">Rupiah</option>';
            } else if (jenisBantuan === 'Barang') {
                satuanBantuan.innerHTML = `
                    <option value="Unit">Unit</option>
                    <option value="Paket">Paket</option>
                    <option value="Set">Set</option>
                `;
            } else if (jenisBantuan === 'Jasa') {
                satuanBantuan.innerHTML = `
                    <option value="Jam">Jam</option>
                    <option value="Hari">Hari</option>
                    <option value="Paket">Paket</option>
                `;
            }
        }
        
        // Fungsi untuk load data dari localStorage
        function loadData() {
            const savedData = localStorage.getItem('barjasData');
            if (savedData) {
                appData = JSON.parse(savedData);
            }
            
            const savedCodes = localStorage.getItem('barjasGeneratedCodes');
            if (savedCodes) {
                generatedCodes = JSON.parse(savedCodes);
            }
            
            // Load kode keamanan
            const savedSecurityCode = localStorage.getItem('barjasSecurityCode');
            if (savedSecurityCode) {
                securityCode = savedSecurityCode;
            }
            
            renderDataTable();
        }
        
        // Fungsi untuk save data ke localStorage
        function saveData() {
            localStorage.setItem('barjasData', JSON.stringify(appData));
            localStorage.setItem('barjasGeneratedCodes', JSON.stringify(generatedCodes));
            localStorage.setItem('barjasSecurityCode', securityCode);
        }
        
        // Fungsi untuk render data table
        function renderDataTable() {
            const tableBody = document.getElementById('dataTableBody');
            tableBody.innerHTML = '';
            
            const dataToRender = isFilterActive ? filteredData : appData;
            const startIndex = (currentPage - 1) * itemsPerPage;
            const endIndex = Math.min(startIndex + itemsPerPage, dataToRender.length);
            
            for (let i = startIndex; i < endIndex; i++) {
                const data = dataToRender[i];
                const row = document.createElement('tr');
                
                // Format nomor WhatsApp untuk tampilan
                const whatsappDisplay = data.whatsapp ? data.whatsapp.replace('62', '0') : '-';
                
                row.innerHTML = `
                    <td>${i + 1}</td>
                    <td>${data.nama}</td>
                    <td>${data.nik}</td>
                    <td>
                        <span class="whatsapp-number" data-phone="${data.whatsapp}">
                            ${whatsappDisplay}
                        </span>
                    </td>
                    <td>${data.namaKelompok || '-'}</td>
                    <td>${data.jabatan || '-'}</td>
                    <td>${data.tahunAnggaran}</td>
                    <td>${data.kecamatan}</td>
                    <td>${data.desa}</td>
                    <td>${data.jenisBantuan}</td>
                    <td>${data.namaBantuan || '-'}</td>
                    <td>${data.jumlahBantuan} ${data.satuanBantuan}</td>
                    <td>${formatDate(data.tanggalTerima)}</td>
                    <td>${data.namaPetugas || '-'}</td>
                    <td>
                        ${data.driveLink ? 
                            `<a href="${data.driveLink}" class="drive-link" target="_blank">
                                <i class="fas fa-external-link-alt"></i> Buka
                            </a>` : 
                            '-'}
                    </td>
                    <td>${data.kodeValidasi}</td>
                    <td>
                        <div class="btn-group btn-group-sm">
                            <button class="btn btn-primary" onclick="editData(${data.id})">
                                <i class="fas fa-edit"></i>
                            </button>
                            <button class="btn btn-danger" onclick="deleteData(${data.id})">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>
                    </td>
                `;
                
                tableBody.appendChild(row);
            }
            
            // Update table info
            document.getElementById('tableInfo').textContent = 
                `Menampilkan ${startIndex + 1} sampai ${endIndex} dari ${dataToRender.length} data`;
            
            // Update pagination
            updatePagination(dataToRender.length);
            
            // Tambahkan event listener untuk nomor WhatsApp
            document.querySelectorAll('.whatsapp-number').forEach(element => {
                element.addEventListener('click', function() {
                    const phoneNumber = this.getAttribute('data-phone');
                    if (phoneNumber) {
                        window.open(`https://wa.me/${phoneNumber}`, '_blank');
                    }
                });
            });
        }
        
        // Fungsi untuk update pagination
        function updatePagination(totalItems) {
            const totalPages = Math.ceil(totalItems / itemsPerPage);
            const paginationElement = document.getElementById('pagination');
            paginationElement.innerHTML = '';
            
            // Previous button
            const prevLi = document.createElement('li');
            prevLi.classList.add('page-item');
            if (currentPage === 1) prevLi.classList.add('disabled');
            
            prevLi.innerHTML = `
                <a class="page-link" href="#" onclick="changePage(${currentPage - 1})">
                    <i class="fas fa-chevron-left"></i>
                </a>
            `;
            paginationElement.appendChild(prevLi);
            
            // Page numbers
            const startPage = Math.max(1, currentPage - 2);
            const endPage = Math.min(totalPages, startPage + 4);
            
            for (let i = startPage; i <= endPage; i++) {
                const pageLi = document.createElement('li');
                pageLi.classList.add('page-item');
                if (i === currentPage) pageLi.classList.add('active');
                
                pageLi.innerHTML = `<a class="page-link" href="#" onclick="changePage(${i})">${i}</a>`;
                paginationElement.appendChild(pageLi);
            }
            
            // Next button
            const nextLi = document.createElement('li');
            nextLi.classList.add('page-item');
            if (currentPage === totalPages) nextLi.classList.add('disabled');
            
            nextLi.innerHTML = `
                <a class="page-link" href="#" onclick="changePage(${currentPage + 1})">
                    <i class="fas fa-chevron-right"></i>
                </a>
            `;
            paginationElement.appendChild(nextLi);
        }
        
        // Fungsi untuk change page
        function changePage(page) {
            const totalPages = Math.ceil((isFilterActive ? filteredData.length : appData.length) / itemsPerPage);
            
            if (page < 1 || page > totalPages) return;
            
            currentPage = page;
            renderDataTable();
        }
        
        // Fungsi untuk handle search
        function handleSearch() {
            const searchTerm = document.getElementById('searchData').value.toLowerCase();
            
            if (searchTerm) {
                filteredData = appData.filter(data => 
                    data.nama.toLowerCase().includes(searchTerm) ||
                    data.nik.toLowerCase().includes(searchTerm) ||
                    (data.whatsapp && data.whatsapp.toLowerCase().includes(searchTerm)) ||
                    (data.namaKelompok && data.namaKelompok.toLowerCase().includes(searchTerm)) ||
                    data.kecamatan.toLowerCase().includes(searchTerm) ||
                    data.desa.toLowerCase().includes(searchTerm) ||
                    (data.namaBantuan && data.namaBantuan.toLowerCase().includes(searchTerm)) ||
                    (data.namaPetugas && data.namaPetugas.toLowerCase().includes(searchTerm))
                );
                
                isFilterActive = true;
            } else {
                isFilterActive = false;
            }
            
            currentPage = 1;
            renderDataTable();
        }
        
        // Fungsi untuk clear search
        function clearSearch() {
            document.getElementById('searchData').value = '';
            isFilterActive = false;
            currentPage = 1;
            renderDataTable();
        }
        
        // Fungsi untuk apply filter
        function applyFilter() {
            const tahun = document.getElementById('filterTahun').value;
            const kecamatan = document.getElementById('filterKecamatan').value;
            const desa = document.getElementById('filterDesa').value;
            const jenis = document.getElementById('filterJenis').value;
            
            filteredData = appData.filter(data => {
                return (
                    (!tahun || data.tahunAnggaran == tahun) &&
                    (!kecamatan || data.kecamatan === kecamatan) &&
                    (!desa || data.desa === desa) &&
                    (!jenis || data.jenisBantuan === jenis)
                );
            });
            
            isFilterActive = true;
            
            // Render filter table
            renderFilterTable();
            
            // Update result count
            document.getElementById('filterResultCount').textContent = `${filteredData.length} Data`;
            
            showNotification(`Filter diterapkan. Ditemukan ${filteredData.length} data.`, 'success');
        }
        
        // Fungsi untuk reset filter
        function resetFilter() {
            document.getElementById('filterTahun').value = '';
            document.getElementById('filterKecamatan').value = '';
            document.getElementById('filterDesa').value = '';
            document.getElementById('filterJenis').value = '';
            
            isFilterActive = false;
            filteredData = [];
            
            // Clear filter table
            document.getElementById('filterTableBody').innerHTML = '';
            
            // Reset result count
            document.getElementById('filterResultCount').textContent = '0 Data';
            
            showNotification('Filter direset.', 'info');
        }
        
        // Fungsi untuk render filter table
        function renderFilterTable() {
            const tableBody = document.getElementById('filterTableBody');
            tableBody.innerHTML = '';
            
            for (let i = 0; i < filteredData.length; i++) {
                const data = filteredData[i];
                const row = document.createElement('tr');
                
                // Format nomor WhatsApp untuk tampilan
                const whatsappDisplay = data.whatsapp ? data.whatsapp.replace('62', '0') : '-';
                
                row.innerHTML = `
                    <td>${i + 1}</td>
                    <td>${data.nama}</td>
                    <td>${data.nik}</td>
                    <td>
                        <span class="whatsapp-number" data-phone="${data.whatsapp}">
                            ${whatsappDisplay}
                        </span>
                    </td>
                    <td>${data.namaKelompok || '-'}</td>
                    <td>${data.jabatan || '-'}</td>
                    <td>${data.tahunAnggaran}</td>
                    <td>${data.kecamatan</td>
                    <td>${data.desa}</td>
                    <td>${data.jenisBantuan}</td>
                    <td>${data.namaBantuan || '-'}</td>
                    <td>${data.jumlahBantuan} ${data.satuanBantuan}</td>
                    <td>${formatDate(data.tanggalTerima)}</td>
                    <td>${data.namaPetugas || '-'}</td>
                    <td>
                        ${data.driveLink ? 
                            `<a href="${data.driveLink}" class="drive-link" target="_blank">
                                <i class="fas fa-external-link-alt"></i> Buka
                            </a>` : 
                            '-'}
                    </td>
                    <td>${data.kodeValidasi}</td>
                `;
                
                tableBody.appendChild(row);
            }
            
            // Tambahkan event listener untuk nomor WhatsApp
            document.querySelectorAll('.whatsapp-number').forEach(element => {
                element.addEventListener('click', function() {
                    const phoneNumber = this.getAttribute('data-phone');
                    if (phoneNumber) {
                        window.open(`https://wa.me/${phoneNumber}`, '_blank');
                    }
                });
            });
        }
        
        // Fungsi untuk edit data
        function editData(id) {
            const data = appData.find(item => item.id === id);
            if (!data) return;
            
            // Isi form dengan data yang akan diedit
            document.getElementById('nama').value = data.nama || '';
            document.getElementById('nik').value = data.nik || '';
            
            // Format nomor WhatsApp untuk tampilan
            let whatsappValue = data.whatsapp || '';
            if (whatsappValue && !whatsappValue.startsWith('0') && !whatsappValue.startsWith('62')) {
                whatsappValue = '62' + whatsappValue;
            }
            document.getElementById('whatsapp').value = whatsappValue;
            document.getElementById('whatsapp').setAttribute('data-raw-value', whatsappValue);
            
            document.getElementById('namaKelompok').value = data.namaKelompok || '';
            document.getElementById('jabatan').value = data.jabatan || 'Individu';
            document.getElementById('tahunAnggaran').value = data.tahunAnggaran || new Date().getFullYear();
            document.getElementById('kecamatan').value = data.kecamatan || '';
            document.getElementById('desa').value = data.desa || '';
            document.getElementById('alamat').value = data.alamat || '';
            document.getElementById('jenisBantuan').value = data.jenisBantuan || 'Uang';
            document.getElementById('namaBantuan').value = data.namaBantuan || '';
            document.getElementById('jumlahBantuan').value = data.jumlahBantuan || '';
            document.getElementById('satuanBantuan').value = data.satuanBantuan || 'Rupiah';
            document.getElementById('tanggalTerima').value = data.tanggalTerima || new Date().toISOString().split('T')[0];
            document.getElementById('namaPetugas').value = data.namaPetugas || '';
            document.getElementById('driveLink').value = data.driveLink || '';
            document.getElementById('kodeValidasi').value = data.kodeValidasi || '';
            document.getElementById('keterangan').value = data.keterangan || '';
            
            // Set data-id untuk mengetahui data mana yang sedang diedit
            document.getElementById('inputForm').setAttribute('data-edit-id', id);
            
            // Scroll ke form input
            document.getElementById('v-pills-input-tab').click();
            
            // Ubah tombol submit menjadi "Update Data"
            const submitButton = document.querySelector('#inputForm button[type="submit"]');
            submitButton.innerHTML = '<i class="fas fa-sync me-1"></i> Update Data';
            
            // Tambahkan tombol batal edit
            if (!document.getElementById('cancelEditBtn')) {
                const cancelButton = document.createElement('button');
                cancelButton.type = 'button';
                cancelButton.id = 'cancelEditBtn';
                cancelButton.className = 'btn btn-secondary me-2';
                cancelButton.innerHTML = '<i class="fas fa-times me-1"></i> Batal Edit';
                cancelButton.onclick = cancelEdit;
                
                submitButton.parentNode.insertBefore(cancelButton, submitButton);
            }
            
            showNotification('Data siap untuk diedit. Klik "Update Data" setelah melakukan perubahan.', 'info');
        }

        // Fungsi untuk membatalkan edit
        function cancelEdit() {
            // Reset form
            document.getElementById('inputForm').reset();
            
            // Reset jabatan ke default
            document.getElementById('jabatan').value = 'Individu';
            
            // Set tahun ke default
            document.getElementById('tahunAnggaran').value = new Date().getFullYear();
            
            // Set tanggal hari ini
            document.getElementById('tanggalTerima').value = new Date().toISOString().split('T')[0];
            
            // Reset kode validasi
            document.getElementById('kodeValidasi').value = '';
            
            // Hapus data-id edit
            document.getElementById('inputForm').removeAttribute('data-edit-id');
            
            // Kembalikan tombol submit ke keadaan semula
            const submitButton = document.querySelector('#inputForm button[type="submit"]');
            submitButton.innerHTML = '<i class="fas fa-save me-1"></i> Simpan Data';
            
            // Hapus tombol batal
            const cancelButton = document.getElementById('cancelEditBtn');
            if (cancelButton) {
                cancelButton.remove();
            }
            
            showNotification('Edit data dibatalkan.', 'info');
        }
        
        // Fungsi untuk delete data
        function deleteData(id, showNotification = true) {
            if (confirm('Apakah Anda yakin ingin menghapus data ini?')) {
                appData = appData.filter(item => item.id !== id);
                saveData();
                
                if (showNotification) {
                    showNotification('Data berhasil dihapus.', 'success');
                }
                
                updateDashboard();
                renderDataTable();
            }
        }
        
        // Fungsi untuk update dashboard
        function updateDashboard() {
            // Update total penerima
            document.getElementById('totalPenerima').textContent = appData.length;
            
            // Update total bantuan
            const totalBantuan = appData.reduce((sum, data) => {
                return sum + (parseFloat(data.jumlahBantuan) || 0);
            }, 0);
            
            document.getElementById('totalBantuan').textContent = formatNumber(totalBantuan);
            
            // Update tahun aktif (tahun dengan data terbanyak)
            const tahunCount = {};
            appData.forEach(data => {
                if (tahunCount[data.tahunAnggaran]) {
                    tahunCount[data.tahunAnggaran]++;
                } else {
                    tahunCount[data.tahunAnggaran] = 1;
                }
            });
            
            let tahunAktif = '-';
            let maxCount = 0;
            
            for (const tahun in tahunCount) {
                if (tahunCount[tahun] > maxCount) {
                    maxCount = tahunCount[tahun];
                    tahunAktif = tahun;
                }
            }
            
            document.getElementById('tahunAktif').textContent = tahunAktif;
            
            // Update rata-rata bantuan
            const rataBantuan = appData.length > 0 ? totalBantuan / appData.length : 0;
            document.getElementById('rataBantuan').textContent = formatNumber(rataBantuan);
            
            // Update charts
            updateCharts();
            
            // Update settings info
            document.getElementById('settingsDataCount').textContent = appData.length;
        }
        
        // Fungsi untuk inisialisasi charts
        function initializeCharts() {
            // Chart untuk distribusi per kecamatan
            const kecamatanCtx = document.getElementById('kecamatanChart').getContext('2d');
            window.kecamatanChart = new Chart(kecamatanCtx, {
                type: 'pie',
                data: {
                    labels: [],
                    datasets: [{
                        data: [],
                        backgroundColor: [
                            '#0d47a1', '#1565c0', '#1976d2', '#1e88e5', '#2196f3',
                            '#42a5f5', '#64b5f6', '#90caf9', '#bbdefb', '#e3f2fd'
                        ]
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: {
                            position: 'right'
                        },
                        title: {
                            display: true,
                            text: 'Distribusi per Kecamatan'
                        }
                    }
                }
            });
            
            // Chart untuk tren per tahun
            const tahunCtx = document.getElementById('tahunChart').getContext('2d');
            window.tahunChart = new Chart(tahunCtx, {
                type: 'bar',
                data: {
                    labels: [],
                    datasets: [{
                        label: 'Jumlah Bantuan',
                        data: [],
                        backgroundColor: '#00695c'
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        title: {
                            display: true,
                            text: 'Tren Bantuan per Tahun'
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true
                        }
                    }
                }
            });
        }
        
        // Fungsi untuk update charts
        function updateCharts() {
            // Data untuk chart kecamatan
            const kecamatanData = {};
            appData.forEach(data => {
                if (kecamatanData[data.kecamatan]) {
                    kecamatanData[data.kecamatan]++;
                } else {
                    kecamatanData[data.kecamatan] = 1;
                }
            });
            
            window.kecamatanChart.data.labels = Object.keys(kecamatanData);
            window.kecamatanChart.data.datasets[0].data = Object.values(kecamatanData);
            window.kecamatanChart.update();
            
            // Data untuk chart tahun
            const tahunData = {};
            appData.forEach(data => {
                if (tahunData[data.tahunAnggaran]) {
                    tahunData[data.tahunAnggaran]++;
                } else {
                    tahunData[data.tahunAnggaran] = 1;
                }
            });
            
            // Urutkan tahun
            const sortedYears = Object.keys(tahunData).sort();
            const yearCounts = sortedYears.map(year => tahunData[year]);
            
            window.tahunChart.data.labels = sortedYears;
            window.tahunChart.data.datasets[0].data = yearCounts;
            window.tahunChart.update();
        }
        
        // Fungsi untuk print to PDF
        function printToPdf() {
            if (appData.length === 0) {
                showNotification('Tidak ada data untuk dicetak.', 'warning');
                return;
            }
            
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF('landscape', 'pt', 'a4');
            
            // Judul laporan
            doc.setFontSize(18);
            doc.text('LAPORAN DATA BANTUAN', 400, 30, { align: 'center' });
            doc.setFontSize(12);
            doc.text('Sistem Bantuan Terpadu (BARJAS) - Kabupaten Situbondo', 400, 50, { align: 'center' });
            doc.text(`Dicetak pada: ${new Date().toLocaleDateString('id-ID')}`, 400, 70, { align: 'center' });
            
            // Data untuk tabel
            const tableColumn = ["No", "Nama", "NIK", "WhatsApp", "Desa", "Jenis", "Nama Bantuan", "Jumlah", "Tanggal", "Petugas"];
            const tableRows = [];
            
            const dataToPrint = isFilterActive ? filteredData : appData;
            
            dataToPrint.forEach((data, index) {
                const whatsappDisplay = data.whatsapp ? data.whatsapp.replace('62', '0') : '-';
                const rowData = [
                    index + 1,
                    data.nama,
                    data.nik,
                    whatsappDisplay,
                    data.desa,
                    data.jenisBantuan,
                    data.namaBantuan || '-',
                    `${formatNumber(data.jumlahBantuan)} ${data.satuanBantuan}`,
                    formatDate(data.tanggalTerima),
                    data.namaPetugas || '-'
                ];
                tableRows.push(rowData);
            });
            
            // Tambahkan tabel ke PDF
            doc.autoTable({
                head: [tableColumn],
                body: tableRows,
                startY: 80,
                theme: 'grid',
                styles: { fontSize: 8 },
                headStyles: { fillColor: [13, 71, 161] }
            });
            
            // Simpan PDF
            doc.save('laporan_bantuan.pdf');
            
            showNotification('Laporan PDF telah berhasil diunduh.', 'success');
        }
        
        // Fungsi untuk show preview
        function showPreview() {
            if (appData.length === 0) {
                showNotification('Tidak ada data untuk dipratinjau.', 'warning');
                return;
            }
            
            const previewModal = new bootstrap.Modal(document.getElementById('previewModal'));
            
            // Isi konten pratinjau
            const printTahun = document.getElementById('printTahun').value;
            const printKecamatan = document.getElementById('printKecamatan').value;
            const printJenis = document.getElementById('printJenis').value;
            const printFormat = document.getElementById('printFormat').value;
            
            // Filter data berdasarkan pengaturan
            let dataToPrint = appData;
            if (printTahun) {
                dataToPrint = dataToPrint.filter(data => data.tahunAnggaran == printTahun);
            }
            if (printKecamatan) {
                dataToPrint = dataToPrint.filter(data => data.kecamatan === printKecamatan);
            }
            if (printJenis) {
                dataToPrint = dataToPrint.filter(data => data.jenisBantuan === printJenis);
            }
            
            if (dataToPrint.length === 0) {
                showNotification('Tidak ada data yang sesuai dengan filter.', 'warning');
                return;
            }
            
            // Buat konten pratinjau
            let previewContent = `
                <div class="print-header">
                    <h4 class="print-title">LAPORAN DATA BANTUAN</h4>
                    <p class="print-subtitle">Sistem Bantuan Terpadu (BARJAS)</p>
                    <p class="print-subtitle">Kabupaten Situbondo</p>
                    <p class="print-date">${formatDate(new Date().toISOString())}</p>
                </div>
                <table class="preview-table">
                    <thead>
                        <tr>
                            <th>No</th>
                            <th>Nama</th>
            `;
            
            // Tambahkan kolom berdasarkan format
            if (printFormat !== 'hanya-nama') {
                previewContent += `
                    <th>NIK</th>
                    <th>WhatsApp</th>
                    <th>Kelompok</th>
                    <th>Jabatan</th>
                `;
            }
            
            previewContent += `<th>Jenis Bantuan</th><th>Nama Bantuan</th><th>Jumlah Bantuan</th>`;
            
            if (printFormat === 'detail') {
                previewContent += `
                    <th>Tahun</th>
                    <th>Kecamatan</th>
                    <th>Desa</th>
                    <th>Tanggal</th>
                    <th>Petugas</th>
                `;
            }
            
            previewContent += `</tr></thead><tbody>`;
            
            // Isi data
            dataToPrint.forEach((data, index) {
                const whatsappDisplay = data.whatsapp ? data.whatsapp.replace('62', '0') : '-';
                
                previewContent += `
                    <tr>
                        <td>${index + 1}</td>
                        <td>${data.nama}</td>
                `;
                
                if (printFormat !== 'hanya-nama') {
                    previewContent += `
                        <td>${data.nik}</td>
                        <td>${whatsappDisplay}</td>
                        <td>${data.namaKelompok || '-'}</td>
                        <td>${data.jabatan || '-'}</td>
                    `;
                }
                
                previewContent += `
                    <td>${data.jenisBantuan}</td>
                    <td>${data.namaBantuan || '-'}</td>
                    <td>${data.jumlahBantuan} ${data.satuanBantuan}</td>
                `;
                
                if (printFormat === 'detail') {
                    previewContent += `
                        <td>${data.tahunAnggaran}</td>
                        <td>${data.kecamatan}</td>
                        <td>${data.desa}</td>
                        <td>${formatDate(data.tanggalTerima)}</td>
                        <td>${data.namaPetugas || '-'}</td>
                    `;
                }
                
                previewContent += `</tr>`;
            });
            
            previewContent += `</tbody></table>`;
            previewContent += `<p class="mt-3">Total Data: ${dataToPrint.length}</p>`;
            
            document.getElementById('previewContent').innerHTML = previewContent;
            previewModal.show();
        }
        
        // Fungsi untuk export to Excel
        function exportToExcel() {
            if (appData.length === 0) {
                showNotification('Tidak ada data untuk diekspor.', 'warning');
                return;
            }
            
            const dataToExport = isFilterActive ? filteredData : appData;
            
            // Siapkan data untuk Excel
            const excelData = dataToExport.map(data => ({
                'Nama': data.nama,
                'NIK': data.nik,
                'WhatsApp': data.whatsapp ? data.whatsapp.replace('62', '0') : '',
                'Kelompok': data.namaKelompok || '',
                'Jabatan': data.jabatan || '',
                'Tahun': data.tahunAnggaran,
                'Kecamatan': data.kecamatan,
                'Desa': data.desa,
                'Jenis Bantuan': data.jenisBantuan,
                'Nama Bantuan': data.namaBantuan || '',
                'Jumlah': data.jumlahBantuan,
                'Satuan': data.satuanBantuan,
                'Tanggal': formatDate(data.tanggalTerima),
                'Petugas': data.namaPetugas || '',
                'Link Google Drive': data.driveLink || '',
                'Kode Validasi': data.kodeValidasi,
                'Keterangan': data.keterangan || ''
            }));
            
            // Buat worksheet
            const worksheet = XLSX.utils.json_to_sheet(excelData);
            
            // Buat workbook
            const workbook = XLSX.utils.book_new();
            XLSX.utils.book_append_sheet(workbook, worksheet, 'Data Bantuan');
            
            // Ekspor ke file Excel
            XLSX.writeFile(workbook, 'data_bantuan.xlsx');
            
            showNotification('Data telah berhasil diekspor ke Excel.', 'success');
        }
        
        // Fungsi untuk export to CSV
        function exportToCsv() {
            if (appData.length === 0) {
                showNotification('Tidak ada data untuk diekspor.', 'warning');
                return;
            }
            
            const dataToExport = isFilterActive ? filteredData : appData;
            
            // Siapkan data untuk CSV
            const csvData = dataToExport.map(data => ({
                'Nama': data.nama,
                'NIK': data.nik,
                'WhatsApp': data.whatsapp ? data.whatsapp.replace('62', '0') : '',
                'Kelompok': data.namaKelompok || '',
                'Jabatan': data.jabatan || '',
                'Tahun': data.tahunAnggaran,
                'Kecamatan': data.kecamatan,
                'Desa': data.desa,
                'Jenis Bantuan': data.jenisBantuan,
                'Nama Bantuan': data.namaBantuan || '',
                'Jumlah': data.jumlahBantuan,
                'Satuan': data.satuanBantuan,
                'Tanggal': formatDate(data.tanggalTerima),
                'Petugas': data.namaPetugas || '',
                'Link Google Drive': data.driveLink || '',
                'Kode Validasi': data.kodeValidasi,
                'Keterangan': data.keterangan || ''
            }));
            
            // Buat worksheet
            const worksheet = XLSX.utils.json_to_sheet(csvData);
            
            // Konversi ke CSV
            const csv = XLSX.utils.sheet_to_csv(worksheet);
            
            // Buat blob dan unduh
            const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement('a');
            const url = URL.createObjectURL(blob);
            
            link.setAttribute('href', url);
            link.setAttribute('download', 'data_bantuan.csv');
            link.style.visibility = 'hidden';
            
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            
            showNotification('Data telah berhasil diekspor ke CSV.', 'success');
        }
        
        // Fungsi untuk export to JSON
        function exportToJson() {
            if (appData.length === 0) {
                showNotification('Tidak ada data untuk diekspor.', 'warning');
                return;
            }
            
            const dataToExport = isFilterActive ? filteredData : appData;
            
            // Konversi ke JSON
            const json = JSON.stringify(dataToExport, null, 2);
            
            // Buat blob dan unduh
            const blob = new Blob([json], { type: 'application/json' });
            const link = document.createElement('a');
            const url = URL.createObjectURL(blob);
            
            link.setAttribute('href', url);
            link.setAttribute('download', 'data_bantuan.json');
            link.style.visibility = 'hidden';
            
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            
            showNotification('Data telah berhasil diekspor ke JSON.', 'success');
        }
        
        // Fungsi untuk export to PDF
        function exportToPdf() {
            // Gunakan fungsi printToPdf yang sudah ada
            printToPdf();
        }
        
        // Fungsi untuk backup data
        function backupData() {
            if (appData.length === 0) {
                showNotification('Tidak ada data untuk dibackup.', 'warning');
                return;
            }
            
            const backupFileName = document.getElementById('backupFileName').value || 'backup-barjas';
            const dataStr = JSON.stringify(appData);
            const dataUri = 'data:application/json;charset=utf-8,'+ encodeURIComponent(dataStr);
            
            const exportFileDefaultName = `${backupFileName}-${new Date().toISOString().slice(0,10)}.json`;
            
            const linkElement = document.createElement('a');
            linkElement.setAttribute('href', dataUri);
            linkElement.setAttribute('download', exportFileDefaultName);
            linkElement.click();
            
            // Update last backup date
            document.getElementById('lastBackupDate').textContent = new Date().toLocaleDateString();
            
            showNotification('Backup data berhasil didownload.', 'success');
        }
        
        // Fungsi untuk enable restore button
        function enableRestoreButton() {
            const fileInput = document.getElementById('restoreFileInput');
            document.getElementById('restoreDataBtn').disabled = !fileInput.files.length;
        }
        
        // Fungsi untuk restore data
        function restoreData() {
            const fileInput = document.getElementById('restoreFileInput');
            const file = fileInput.files[0];
            
            if (!file) {
                showNotification('Pilih file backup terlebih dahulu.', 'error');
                return;
            }
            
            if (!confirm('Restore data akan menimpa semua data yang ada. Lanjutkan?')) {
                return;
            }
            
            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const restoredData = JSON.parse(e.target.result);
                    appData = restoredData;
                    saveData();
                    
                    // Reset form
                    fileInput.value = '';
                    document.getElementById('restoreDataBtn').disabled = true;
                    
                    // Update UI
                    updateDashboard();
                    renderDataTable();
                    
                    showNotification('Data berhasil direstore.', 'success');
                } catch (error) {
                    showNotification('File backup tidak valid.', 'error');
                    console.error('Restore error:', error);
                }
            };
            reader.readAsText(file);
        }
        
        // Fungsi untuk enable reset button
        function enableResetButton() {
            const input = document.getElementById('resetConfirmationInput');
            document.getElementById('confirmResetBtn').disabled = input.value !== 'RESET';
        }
        
        // Fungsi untuk reset data
        function resetData() {
            appData = [];
            generatedCodes = {};
            saveData();
            
            // Tutup modal
            const modal = bootstrap.Modal.getInstance(document.getElementById('confirmResetModal'));
            modal.hide();
            
            // Reset input confirmation
            document.getElementById('resetConfirmationInput').value = '';
            
            // Update UI
            updateDashboard();
            renderDataTable();
            
            showNotification('Semua data telah direset.', 'success');
        }
        
        // Fungsi untuk save settings
        function saveSettings(e) {
            e.preventDefault();
            
            // Validasi dan simpan kode keamanan
            const newSecurityCode = document.getElementById('securityCodeInput').value;
            
            if (newSecurityCode.length < MIN_SECURITY_CODE_LENGTH) {
                document.getElementById('securityCodeError').textContent = `Kode keamanan minimal ${MIN_SECURITY_CODE_LENGTH} karakter`;
                document.getElementById('securityCodeError').style.display = 'block';
                document.getElementById('securityCodeInput').classList.add('input-error');
                return;
            }
            
            // Update kode keamanan
            const result = updateSecurityCode(newSecurityCode);
            
            if (result.success) {
                showNotification('Pengaturan berhasil disimpan.', 'success');
                document.getElementById('securityCodeError').style.display = 'none';
                document.getElementById('securityCodeInput').classList.remove('input-error');
            } else {
                showNotification(result.message, 'error');
            }
        }
        
        // Fungsi untuk setup browser info
        function setupBrowserInfo() {
            // Info browser
            document.getElementById('browserInfo').textContent = navigator.userAgent.split(' ')[0];
            
            // Info local storage
            const usedStorage = JSON.stringify(localStorage).length;
            document.getElementById('storageInfo').textContent = `${Math.round(usedStorage / 1024)} KB digunakan`;
        }
        
        // Fungsi untuk toggle mobile menu
        function toggleMobileMenu() {
            const sidebar = document.getElementById('sidebarMenu');
            const overlay = document.getElementById('sidebarOverlay');
            
            sidebar.classList.toggle('mobile-show');
            overlay.classList.toggle('mobile-show');
        }
        
        // Fungsi untuk scroll to top
        function scrollToTop() {
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }
        
        // Fungsi untuk show notification
        function showNotification(message, type = 'info') {
            const toast = document.querySelector('.notification-toast');
            const toastMessage = document.getElementById('toastMessage');
            
            // Set message dan warna berdasarkan type
            toastMessage.textContent = message;
            
            // Set background color based on type
            if (type === 'success') {
                toast.querySelector('.toast-header').style.backgroundColor = '#d4edda';
                toast.querySelector('.toast-header').style.color = '#155724';
            } else if (type === 'error') {
                toast.querySelector('.toast-header').style.backgroundColor = '#f8d7da';
                toast.querySelector('.toast-header').style.color = '#721c24';
            } else if (type === 'warning') {
                toast.querySelector('.toast-header').style.backgroundColor = '#fff3cd';
                toast.querySelector('.toast-header').style.color = '#856404';
            } else {
                toast.querySelector('.toast-header').style.backgroundColor = '#d1ecf1';
                toast.querySelector('.toast-header').style.color = '#0c5460';
            }
            
            // Show toast
            const bsToast = new bootstrap.Toast(toast);
            bsToast.show();
        }
        
        // Fungsi untuk format tanggal
        function formatDate(dateString) {
            if (!dateString) return '-';
            
            const date = new Date(dateString);
            return date.toLocaleDateString('id-ID', {
                day: '2-digit',
                month: '2-digit',
                year: 'numeric'
            });
        }
        
        // Fungsi untuk format number
        function formatNumber(num) {
            return new Intl.NumberFormat('id-ID').format(num);
        }
    </script>
</body>
</html>
