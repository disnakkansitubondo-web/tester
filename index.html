<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>APLIKASI BARJAS - SISTEM BANTUAN</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-datepicker/1.9.0/css/bootstrap-datepicker.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.28/jspdf.plugin.autotable.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <style>
        :root {
            --primary-color: #0d47a1;
            --secondary-color: #00695c;
            --accent-color: #ff8f00;
            --light-blue: #e3f2fd;
            --dark-blue: #082e5c;
            --gradient-primary: linear-gradient(135deg, var(--primary-color), var(--dark-blue));
            --gradient-secondary: linear-gradient(135deg, var(--secondary-color), #004d40);
            --gradient-accent: linear-gradient(135deg, var(--accent-color), #e65100);
            --shadow-sm: 0 2px 8px rgba(0,0,0,0.08);
            --shadow-md: 0 4px 16px rgba(0,0,0,0.12);
            --shadow-lg: 0 8px 28px rgba(0,0,0,0.15);
            --login-gradient: linear-gradient(135deg, #0d47a1, #00695c, #ff8f00);
        }
        
        body {
            background: linear-gradient(135deg, #f5f9ff 0%, #e8f5e9 100%);
            font-family: 'Poppins', 'Segoe UI', sans-serif;
            min-height: 100vh;
            padding: 10px 0;
            overflow-x: hidden;
        }
        
        .app-container {
            max-width: 1600px;
            margin: 0 auto;
            background: white;
            box-shadow: var(--shadow-lg);
            border-radius: 12px;
            overflow: hidden;
            position: relative;
            z-index: 10;
        }
        
        .app-header {
            background: var(--gradient-primary);
            color: white;
            padding: 20px 15px;
            text-align: center;
            position: relative;
            overflow: hidden;
        }
        
        .app-header::before {
            content: "";
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(255,255,255,0.15) 0%, transparent 70%);
            pointer-events: none;
        }
        
        .app-logo {
            font-size: 2.5rem;
            margin-bottom: 10px;
            position: relative;
            z-index: 1;
        }
        
        .app-title {
            font-size: 1.8rem;
            font-weight: 800;
            margin: 0;
            position: relative;
            z-index: 1;
            text-shadow: 1px 1px 4px rgba(0,0,0,0.3);
        }
        
        .app-subtitle {
            font-size: 1rem;
            opacity: 0.95;
            position: relative;
            z-index: 1;
            font-weight: 300;
            letter-spacing: 0.5px;
            margin-bottom: 5px;
        }
        
        .nav-pills .nav-link {
            border-radius: 8px;
            margin-bottom: 8px;
            padding: 12px 15px;
            font-weight: 500;
            color: #444;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            font-size: 0.9rem;
        }
        
        .nav-pills .nav-link:hover {
            background-color: #f0f7ff;
            transform: translateX(3px);
        }
        
        .nav-pills .nav-link.active {
            background: var(--gradient-primary);
            font-weight: 600;
            box-shadow: var(--shadow-md);
            transform: translateX(3px);
            color: white;
        }
        
        .section-title {
            border-left: 4px solid var(--primary-color);
            padding-left: 12px;
            margin: 20px 0;
            font-weight: 700;
            color: var(--dark-blue);
            font-size: 1.4rem;
            position: relative;
        }
        
        .section-title::after {
            content: "";
            position: absolute;
            bottom: -5px;
            left: 12px;
            width: 40px;
            height: 2px;
            background: var(--gradient-primary);
            border-radius: 2px;
        }
        
        .btn-primary {
            background: var(--gradient-primary);
            border: none;
            padding: 10px 20px;
            font-weight: 600;
            box-shadow: var(--shadow-md);
            border-radius: 8px;
            transition: all 0.3s;
            font-size: 0.9rem;
        }
        
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-lg);
        }
        
        .btn-success {
            background: var(--gradient-secondary);
            border: none;
            padding: 10px 20px;
            font-weight: 600;
            box-shadow: var(--shadow-md);
            border-radius: 8px;
            transition: all 0.3s;
            font-size: 0.9rem;
        }
        
        .btn-success:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-lg);
        }
        
        .btn-warning {
            background: var(--gradient-accent);
            border: none;
            padding: 10px 20px;
            font-weight: 600;
            box-shadow: var(--shadow-md);
            border-radius: 8px;
            transition: all 0.3s;
            font-size: 0.9rem;
        }
        
        .btn-warning:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-lg);
        }
        
        .form-label {
            font-weight: 600;
            color: #444;
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            font-size: 0.9rem;
        }
        
        .form-label i {
            margin-right: 6px;
            color: var(--primary-color);
        }
        
        .form-control, .form-select {
            border-radius: 8px;
            padding: 12px 15px;
            border: 1px solid #ddd;
            transition: all 0.3s;
            box-shadow: var(--shadow-sm);
            font-size: 0.9rem;
        }
        
        .form-control:focus, .form-select:focus {
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(13, 71, 161, 0.2);
            transform: translateY(-2px);
        }
        
        .copyright {
            text-align: center;
            padding: 20px;
            background-color: var(--light-blue);
            color: var(--dark-blue);
            font-size: 0.9rem;
            font-weight: 500;
        }
        
        .data-table {
            font-size: 0.85rem;
            border-collapse: separate;
            border-spacing: 0;
            box-shadow: var(--shadow-sm);
            border-radius: 8px;
            overflow: hidden;
        }
        
        .data-table th {
            background: var(--gradient-primary);
            color: white;
            font-weight: 600;
            padding: 12px 10px;
            text-align: center;
            position: relative;
            font-size: 0.85rem;
        }
        
        .data-table th::after {
            content: "";
            position: absolute;
            bottom: 0;
            left: 0;
            width: 100%;
            height: 1px;
            background: rgba(255,255,255,0.3);
        }
        
        .data-table td {
            padding: 10px 8px;
            vertical-align: middle;
            border-bottom: 1px solid #eee;
            font-size: 0.85rem;
        }
        
        .data-table tr:nth-child(even) {
            background-color: #f9fbff;
        }
        
        .data-table tr:hover {
            background-color: #edf5ff;
        }
        
        .feature-icon {
            font-size: 1.1rem;
            margin-right: 8px;
            width: 24px;
            text-align: center;
        }
        
        .card {
            border-radius: 10px;
            border: none;
            box-shadow: var(--shadow-md);
            transition: all 0.3s ease;
            overflow: hidden;
            margin-bottom: 15px;
        }
        
        .card:hover {
            transform: translateY(-5px);
            box-shadow: var(--shadow-lg);
        }
        
        .card-header {
            border-radius: 10px 10px 0 0 !important;
            font-weight: 600;
            padding: 15px 20px;
            background: var(--gradient-primary);
            color: white;
            font-size: 0.95rem;
        }
        
        .stats-box {
            text-align: center;
            padding: 20px 15px;
            border-radius: 10px;
            background: white;
            box-shadow: var(--shadow-md);
            transition: all 0.3s;
            position: relative;
            overflow: hidden;
            margin-bottom: 15px;
        }
        
        .stats-box::before {
            content: "";
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 4px;
            background: var(--gradient-primary);
            border-radius: 2px;
        }
        
        .stats-box:hover {
            transform: translateY(-3px);
            box-shadow: var(--shadow-lg);
        }
        
        .stats-number {
            font-size: 1.8rem;
            font-weight: 800;
            color: var(--primary-color);
            margin: 10px 0;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.1);
        }
        
        .stats-label {
            font-size: 0.9rem;
            color: #666;
            font-weight: 500;
        }
        
        .notification-toast {
            position: fixed;
            bottom: 20px;
            right: 20px;
            z-index: 1050;
            min-width: 280px;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: var(--shadow-lg);
            max-width: calc(100vw - 40px);
        }
        
        .input-error {
            border-color: #dc3545;
            box-shadow: 0 0 0 3px rgba(220, 53, 69, 0.2);
        }
        
        .error-message {
            color: #dc3545;
            font-size: 0.8rem;
            margin-top: 5px;
            display: none;
            font-weight: 500;
        }
        
        .watermark {
            position: absolute;
            bottom: 10px;
            right: 15px;
            opacity: 0.8;
            font-size: 0.8rem;
            color: white;
            font-weight: 300;
        }
        
        .control-panel {
            background: #f8f9fa;
            border-radius: 8px;
            padding: 15px;
            margin-top: 15px;
            box-shadow: var(--shadow-sm);
        }
        
        .control-title {
            font-size: 1rem;
            color: var(--primary-color);
            font-weight: 600;
            margin-bottom: 15px;
            padding-bottom: 8px;
            border-bottom: 1px solid var(--light-blue);
        }
        
        .floating-action-btn {
            position: fixed;
            bottom: 20px;
            right: 20px;
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background: var(--gradient-primary);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: var(--shadow-lg);
            z-index: 1000;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .floating-action-btn:hover {
            transform: scale(1.1) rotate(90deg);
        }
        
        .filter-section {
            background: white;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 20px;
            box-shadow: var(--shadow-sm);
        }
        
        .badge-custom {
            background: var(--gradient-primary);
            color: white;
            padding: 6px 12px;
            border-radius: 16px;
            font-weight: 600;
            font-size: 0.8rem;
        }
        
        .mobile-menu-btn {
            display: none;
            position: fixed;
            top: 15px;
            left: 15px;
            z-index: 1050;
            background: var(--gradient-primary);
            color: white;
            border: none;
            border-radius: 50%;
            width: 45px;
            height: 45px;
            box-shadow: var(--shadow-lg);
        }
        
        .sidebar-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 1040;
        }
        
        /* Animations */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .animate-fadeIn {
            animation: fadeIn 0.5s ease forwards;
        }
        
        /* Custom scrollbar */
        ::-webkit-scrollbar {
            width: 6px;
        }
        
        ::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 8px;
        }
        
        ::-webkit-scrollbar-thumb {
            background: var(--primary-color);
            border-radius: 8px;
        }
        
        ::-webkit-scrollbar-thumb:hover {
            background: var(--dark-blue);
        }
        
        /* Responsive styles */
        @media (max-width: 991.98px) {
            .col-md-3.col-lg-2 {
                position: fixed;
                left: -300px;
                top: 0;
                bottom: 0;
                z-index: 1050;
                width: 280px;
                transition: left 0.3s ease;
                overflow-y: auto;
                padding-top: 60px;
            }
            
            .col-md-3.col-lg-2.mobile-show {
                left: 0;
            }
            
            .col-md-9.col-lg-10 {
                width: 100%;
                flex: 0 0 100%;
                max-width: 100%;
            }
            
            .mobile-menu-btn {
                display: flex;
                align-items: center;
                justify-content: center;
            }
            
            .sidebar-overlay.mobile-show {
                display: block;
            }
        }
        
        /* Print Styles - IMPROVED FOR LANDSCAPE */
        @media print {
            @page {
                size: landscape;
                margin: 0.5cm;
            }
            
            body * {
                visibility: hidden;
            }
            
            .app-container, .app-container * {
                visibility: visible;
            }
            
            .app-container {
                position: absolute;
                left: 0;
                top: 0;
                width: 100%;
                box-shadow: none;
            }
            
            .nav-pills, .mobile-menu-btn, .sidebar-overlay, .floating-action-btn,
            .btn-group, .filter-section, .toast {
                display: none !important;
            }
            
            .col-md-3.col-lg-2.p-4.bg-light {
                display: none !important;
            }
            
            .col-md-9.col-lg-10.p-5 {
                width: 100%;
                flex: 0 0 100%;
                max-width: 100%;
                padding: 0 !important;
            }
            
            .copyright {
                display: none;
            }
            
            .data-table {
                font-size: 10px;
                width: 100% !important;
            }
            
            .data-table th, .data-table td {
                padding: 4px 2px;
            }
            
            /* Sembunyikan kolom aksi dan link Google Drive saat mencetak */
            .data-table th:last-child,
            .data-table td:last-child {
                display: none !important;
            }
            
            /* Judul untuk laporan cetak */
            .print-header {
                display: block !important;
                text-align: center;
                margin-bottom: 15px;
            }
            
            .print-title {
                font-size: 18px;
                font-weight: bold;
                margin-bottom: 5px;
            }
            
            .print-subtitle {
                font-size: 14px;
                margin-bottom: 10px;
            }
            
            .print-date {
                font-size: 12px;
                text-align: right;
                margin-bottom: 10px;
            }
        }

        /* WhatsApp link style */
        .whatsapp-link {
            color: #25D366;
            text-decoration: none;
        }
        
        .whatsapp-link:hover {
            text-decoration: underline;
        }
        
        /* View Link Button */
        .btn-view {
            background: linear-gradient(135deg, #17a2b8, #138496);
            color: white;
            border: none;
            padding: 5px 10px;
            border-radius: 4px;
            font-size: 0.8rem;
        }
        
        .btn-view:hover {
            background: linear-gradient(135deg, #138496, #117a8b);
            color: white;
        }
        
        /* Undo Button */
        .btn-undo {
            background: linear-gradient(135deg, #6c757d, #5a6268);
            color: white;
            border: none;
        }
        
        .btn-undo:hover {
            background: linear-gradient(135deg, #5a6268, #4e555b);
            color: white;
        }
        
        /* WhatsApp number link in table */
        .whatsapp-number {
            color: #25D366;
            cursor: pointer;
            text-decoration: underline;
        }
        
        /* Welcome Modal Styles */
        .welcome-modal .modal-content {
            border-radius: 15px;
            overflow: hidden;
            border: none;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }
        
        .welcome-header {
            background: var(--gradient-primary);
            color: white;
            text-align: center;
            padding: 25px;
        }
        
        .welcome-icon {
            font-size: 3rem;
            margin-bottom: 15px;
            color: white;
        }
        
        .welcome-body {
            padding: 25px;
            text-align: center;
        }
        
        .welcome-footer {
            background: #f8f9fa;
            padding: 15px;
            text-align: center;
            border-top: 1px solid #eee;
        }
        
        .countdown-timer {
            font-size: 0.9rem;
            color: #6c757d;
            margin-top: 10px;
        }
        
        /* Button untuk cetak per data */
        .btn-print-individual {
            background: linear-gradient(135deg, #6f42c1, #5a2d95);
            color: white;
            border: none;
            padding: 5px 10px;
            border-radius: 4px;
            font-size: 0.8rem;
        }
        
        .btn-print-individual:hover {
            background: linear-gradient(135deg, #5a2d95, #4a2479);
            color: white;
        }
        
        /* Developer Info Styles */
        .developer-info {
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            border-radius: 10px;
            padding: 15px;
            margin-top: 20px;
            box-shadow: var(--shadow-sm);
        }
        
        .developer-info h6 {
            color: var(--primary-color);
            font-weight: 600;
            margin-bottom: 15px;
            padding-bottom: 8px;
            border-bottom: 1px solid #ddd;
        }
        
        .developer-contact p {
            margin-bottom: 8px;
            font-size: 0.85rem;
        }
        
        .developer-contact a {
            color: var(--primary-color);
            text-decoration: none;
            transition: all 0.3s;
        }
        
        .developer-contact a:hover {
            color: var(--dark-blue);
            text-decoration: underline;
        }
        
        /* Loading spinner */
        .spinner-border-sm {
            width: 1rem;
            height: 1rem;
        }

        /* Login Modal Styles */
        .login-modal .modal-content {
            border-radius: 15px;
            overflow: hidden;
            border: none;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
        }

        .login-header {
            background: var(--login-gradient);
            color: white;
            text-align: center;
            padding: 25px 20px;
            position: relative;
        }

        .login-icon {
            font-size: 3rem;
            margin-bottom: 15px;
            color: white;
        }

        .login-title {
            font-size: 1.8rem;
            font-weight: 700;
            margin: 0;
        }

        .login-subtitle {
            font-size: 1rem;
            opacity: 0.9;
            margin: 5px 0 0;
        }

        .login-body {
            padding: 25px;
            position: relative;
            z-index: 1;
        }

        .login-form-group {
            margin-bottom: 20px;
        }

        .login-form-label {
            font-weight: 600;
            color: var(--dark-blue);
            margin-bottom: 8px;
            display: flex;
            align-items: center;
        }

        .login-form-label i {
            margin-right: 10px;
            color: var(--dark-blue);
        }

        .login-form-control {
            border-radius: 8px;
            padding: 12px 15px;
            border: 2px solid #ddd;
            transition: all 0.3s;
        }

        .login-form-control:focus {
            border-color: var(--dark-blue);
            box-shadow: 0 0 0 3px rgba(13, 71, 161, 0.2);
        }

        .login-input-group-text {
            background: var(--light-blue);
            border: 2px solid #ddd;
            border-left: none;
        }

        .btn-login {
            background: var(--gradient-secondary);
            color: white;
            border: none;
            padding: 12px;
            font-weight: 600;
            border-radius: 8px;
            width: 100%;
            transition: all 0.3s;
            margin-top: 10px;
        }

        .btn-login:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 105, 92, 0.4);
        }

        .btn-login:disabled {
            background: #ccc;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        .login-security-notice {
            text-align: center;
            margin-top: 20px;
            font-size: 0.85rem;
            color: #666;
        }

        .login-attempts-count {
            text-align: center;
            font-size: 0.9rem;
            color: #ff8f00;
            font-weight: 500;
            margin-top: 5px;
        }

        .login-blocked-message {
            text-align: center;
            background: rgba(220, 53, 69, 0.1);
            border-radius: 8px;
            padding: 15px;
            margin-top: 20px;
            color: #dc3545;
            font-weight: 500;
        }

        .login-countdown {
            font-size: 1.2rem;
            font-weight: 700;
            color: var(--dark-blue);
        }

        .login-developer-info {
            background: var(--light-blue);
            border-radius: 10px;
            padding: 20px;
            margin-top: 25px;
            text-align: center;
        }

        .login-developer-logo {
            max-width: 180px;
            margin-bottom: 15px;
            border-radius: 8px;
        }

        .login-developer-contact a {
            color: var(--dark-blue);
            text-decoration: none;
            transition: all 0.3s;
            display: inline-block;
            margin: 5px 0;
        }

        .login-developer-contact a:hover {
            color: var(--primary-color);
            text-decoration: underline;
            transform: translateY(-2px);
        }

        .login-copyright {
            text-align: center;
            margin-top: 20px;
            color: #666;
            font-size: 0.9rem;
            opacity: 0.9;
        }

        /* Animations */
        @keyframes login-shake {
            0%, 100% { transform: translateX(0); }
            10%, 30%, 50%, 70%, 90% { transform: translateX(-10px); }
            20%, 40%, 60%, 80% { transform: translateX(10px); }
        }

        .login-shake {
            animation: login-shake 0.6s cubic-bezier(.36,.07,.19,.97) both;
        }

        /* Login particle background */
        #login-particles {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 1040; /* Higher than modal backdrop */
            display: none;
        }

        /* Link Google Drive dalam tabel */
        .drive-link {
            color: #0d47a1;
            text-decoration: none;
            cursor: pointer;
        }

        .drive-link:hover {
            text-decoration: underline;
        }

        /* Modal untuk menambah link */
        .link-modal .modal-dialog {
            max-width: 600px;
        }
        
        /* App content when not authenticated */
        .app-content-unauthenticated {
            display: none;
        }

        /* Search box for desa dropdown */
        .dropdown-search-container {
            position: relative;
        }

        .dropdown-search {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            z-index: 1000;
            background: white;
            border: 1px solid #ddd;
            border-radius: 8px;
            padding: 8px;
            display: none;
        }

        .dropdown-search input {
            width: 100%;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
        }

        /* Kode Validasi Styles */
        .kode-validasi-container {
            display: flex;
            align-items: center;
        }
        
        .kode-validasi-input {
            flex: 1;
            margin-right: 10px;
        }
        
        .btn-generate-kode {
            white-space: nowrap;
        }

        /* Auto-fill button styles */
        .btn-auto-fill {
            background: linear-gradient(135deg, #6c757d, #5a6268);
            color: white;
            border: none;
            padding: 10px 15px;
            border-radius: 8px;
            font-size: 0.85rem;
            margin-top: 8px;
        }
        
        .btn-auto-fill:hover {
            background: linear-gradient(135deg, #5a6268, #4e555b);
            color: white;
        }

        .login-hint {
            font-size: 0.85rem;
            color: #0d6efd;
            margin-top: 5px;
            text-align: center;
            background-color: #f8f9fa;
            padding: 8px;
            border-radius: 4px;
            border-left: 3px solid #0d6efd;
        }

        /* New styles for additional fields */
        .btn-not-group {
            background: linear-gradient(135deg, #6c757d, #5a6268);
            color: white;
            border: none;
            padding: 10px 15px;
            border-radius: 8px;
            font-size: 0.85rem;
            margin-top: 8px;
        }
        
        .btn-not-group:hover {
            background: linear-gradient(135deg, #5a6268, #4e555b);
            color: white;
        }

        .jenis-bantuan-container {
            display: flex;
            gap: 10px;
        }

        .jenis-bantuan-container select,
        .jenis-bantuan-container input {
            flex: 1;
        }

        /* WhatsApp input styling */
        .whatsapp-input-container {
            position: relative;
        }

        .whatsapp-prefix {
            position: absolute;
            left: 10px;
            top: 50%;
            transform: translateY(-50%);
            color: #25D366;
            font-weight: bold;
        }

        .whatsapp-input {
            padding-left: 30px;
        }
    </style>
</head>
<body>
    <!-- Login Modal -->
    <div class="modal fade login-modal" id="loginModal" tabindex="-1" aria-hidden="true" data-bs-backdrop="static" data-bs-keyboard="false">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="login-header">
                    <div class="login-icon">
                        <i class="fas fa-lock"></i>
                    </div>
                    <h2 class="login-title">AUTHENTICATION REQUIRED</h2>
                    <p class="login-subtitle">Masukkan Kode Keamanan untuk Mengakses Aplikasi</p>
                </div>
                <div class="login-body">
                    <form id="loginForm">
                        <div class="mb-3 login-form-group">
                            <label class="form-label login-form-label">
                                <i class="fas fa-key"></i> Kode Keamanan
                            </label>
                            <div class="input-group">
                                <input type="password" class="form-control login-form-control" id="securityCode" placeholder="Masukkan kode akses aplikasi">
                                <button class="btn btn-outline-secondary toggle-password" type="button">
                                    <i class="fas fa-eye"></i>
                                </button>
                            </div>
                            <div class="form-text text-danger login-attempts-count" id="attemptsCount"></div>
                            <div class="login-hint">
                                <i class="fas fa-lightbulb"></i> Kode default: 1234
                            </div>
                        </div>
                        <button type="submit" class="btn btn-login" id="loginButton">
                            <span class="login-button-text">Masuk ke Aplikasi</span>
                            <span class="spinner-border spinner-border-sm d-none" id="loginSpinner"></span>
                        </button>
                    </form>
                    
                    <div class="login-blocked-message d-none" id="blockedMessage">
                        <i class="fas fa-ban me-2"></i>
                        <span id="blockedText">Terlalu banyak percobaan gagal. Silakan coba lagi dalam </span>
                        <span class="login-countdown" id="countdown">30</span> detik.
                    </div>
                    
                    <div class="login-security-notice">
                        <i class="fas fa-info-circle me-2"></i>
                        Hubungi Administrator untuk mendapatkan kode akses
                    </div>
                    
                    <div class="login-developer-info">
                        <h5 class="mb-3">Developer Information</h5>
                        <div class="login-developer-contact">
                            <p><i class="fab fa-whatsapp me-2"></i> <a href="https://wa.me/6285647709114" target="_blank">+62 856-4770-9114</a></p>
                            <p><i class="fas fa-envelope me-2"></i> <a href="mailto:admin@anekamarket.my.id">admin@anekamarket.my.id</a></p>
                        </div>
                    </div>
                    
                    <div class="login-copyright">
                        &copy; 2025 Lentera karya Situbondo
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Login particle background -->
    <div id="login-particles"></div>
    
    <!-- Main Application Content (initially hidden) -->
    <div class="app-content-unauthenticated" id="appContent">
        <!-- Mobile Menu Button -->
        <button class="mobile-menu-btn" id="mobileMenuBtn">
            <i class="fas fa-bars"></i>
        </button>
        
        <!-- Sidebar Overlay -->
        <div class="sidebar-overlay" id="sidebarOverlay"></div>
        
        <div class="app-container animate-fadeIn">
            <div class="app-header">
                <div class="app-logo">
                    <i class="fas fa-hands-helping"></i>
                </div>
                <h1 class="app-title">BARJAS</h1>
                <p class="app-subtitle">Sistem Bantuan Terpadu</p>
                <p class="app-subtitle">KABUPATEN SITUBONDO</p>
                <div class="watermark">v2.0.1</div>
            </div>
            
            <div class="row g-0">
                <!-- Sidebar Navigation -->
                <div class="col-md-3 col-lg-2 p-4 bg-light" id="sidebarMenu">
                    <div class="nav flex-column nav-pills" id="v-pills-tab" role="tablist" aria-orientation="vertical">
                        <button class="nav-link active" id="v-pills-dashboard-tab" data-bs-toggle="pill" data-bs-target="#v-pills-dashboard" type="button" role="tab" aria-controls="v-pills-dashboard" aria-selected="true">
                            <i class="fas fa-tachometer-alt feature-icon"></i> Dashboard
                        </button>
                        <button class="nav-link" id="v-pills-input-tab" data-bs-toggle="pill" data-bs-target="#v-pills-input" type="button" role="tab" aria-controls="v-pills-input" aria-selected="false">
                            <i class="fas fa-plus-circle feature-icon"></i> Input Data
                        </button>
                        <button class="nav-link" id="v-pills-data-tab" data-bs-toggle="pill" data-bs-target="#v-pills-data" type="button" role="tab" aria-controls="v-pills-data" aria-selected="false">
                            <i class="fas fa-database feature-icon"></i> Data Penerima
                        </button>
                        <button class="nav-link" id="v-pills-statistik-tab" data-bs-toggle="pill" data-bs-target="#v-pills-statistik" type="button" role="tab" aria-controls="v-pills-statistik" aria-selected="false">
                            <i class="fas fa-chart-pie feature-icon"></i> Statistik
                        </button>
                        <button class="nav-link" id="v-pills-pengaturan-tab" data-bs-toggle="pill" data-bs-target="#v-pills-pengaturan" type="button" role="tab" aria-controls="v-pills-pengaturan" aria-selected="false">
                            <i class="fas fa-cog feature-icon"></i> Pengaturan
                        </button>
                        <button class="nav-link" id="v-pills-bantuan-tab" data-bs-toggle="pill" data-bs-target="#v-pills-bantuan" type="button" role="tab" aria-controls="v-pills-bantuan" aria-selected="false">
                            <i class="fas fa-question-circle feature-icon"></i> Bantuan
                        </button>
                        <button class="nav-link mt-4" id="logoutButton">
                            <i class="fas fa-sign-out-alt feature-icon"></i> Keluar
                        </button>
                    </div>
                </div>
                
                <!-- Main Content -->
                <div class="col-md-9 col-lg-10 p-5">
                    <div class="tab-content" id="v-pills-tabContent">
                        <!-- Dashboard Tab -->
                        <div class="tab-pane fade show active" id="v-pills-dashboard" role="tabpanel" aria-labelledby="v-pills-dashboard-tab">
                            <h3 class="section-title">Dashboard</h3>
                            
                            <div class="row mb-4">
                                <div class="col-md-3">
                                    <div class="stats-box">
                                        <i class="fas fa-users fa-2x text-primary"></i>
                                        <div class="stats-number" id="totalPenerima">0</div>
                                        <div class="stats-label">Total Penerima</div>
                                    </div>
                                </div>
                                <div class="col-md-3">
                                    <div class="stats-box">
                                        <i class="fas fa-map-marker-alt fa-2x text-success"></i>
                                        <div class="stats-number" id="totalDesa">0</div>
                                        <div class="stats-label">Desa Tercover</div>
                                    </div>
                                </div>
                                <div class="col-md-3">
                                    <div class="stats-box">
                                        <i class="fas fa-hand-holding-usd fa-2x text-warning"></i>
                                        <div class="stats-number" id="totalBantuan">0</div>
                                        <div class="stats-label">Jenis Bantuan</div>
                                    </div>
                                </div>
                                <div class="col-md-3">
                                    <div class="stats-box">
                                        <i class="fas fa-chart-line fa-2x text-info"></i>
                                        <div class="stats-number" id="rataRata">0</div>
                                        <div class="stats-label">Rata-rata per Desa</div>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="row">
                                <div class="col-md-8">
                                    <div class="card mb-4">
                                        <div class="card-header">
                                            <i class="fas fa-chart-bar me-2"></i> Data Penerima per Desa
                                        </div>
                                        <div class="card-body">
                                            <canvas id="desaChart" height="250"></canvas>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <div class="card mb-4">
                                        <div class="card-header">
                                            <i class="fas fa-chart-pie me-2"></i> Distribusi Bantuan
                                        </div>
                                        <div class="card-body">
                                            <canvas id="bantuanChart" height="250"></canvas>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="card">
                                <div class="card-header">
                                    <i class="fas fa-history me-2"></i> Data Terbaru
                                </div>
                                <div class="card-body">
                                    <div class="table-responsive">
                                        <table class="table table-hover data-table" id="recentTable">
                                            <thead>
                                                <tr>
                                                    <th>No</th>
                                                    <th>Nama</th>
                                                    <th>Desa</th>
                                                    <th>Jenis Bantuan</th>
                                                    <th>Tanggal</th>
                                                    <th>Aksi</th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                                <!-- Data akan diisi oleh JavaScript -->
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Input Data Tab -->
                        <div class="tab-pane fade" id="v-pills-input" role="tabpanel" aria-labelledby="v-pills-input-tab">
                            <h3 class="section-title">Input Data Penerima</h3>
                            
                            <form id="inputForm" class="needs-validation" novalidate>
                                <div class="row mb-4">
                                    <div class="col-md-6">
                                        <div class="card">
                                            <div class="card-header">Data Pribadi</div>
                                            <div class="card-body">
                                                <div class="mb-3">
                                                    <label for="nama" class="form-label"><i class="fas fa-user"></i> Nama Lengkap</label>
                                                    <input type="text" class="form-control" id="nama" required>
                                                    <div class="error-message" id="namaError">Nama harus diisi</div>
                                                </div>
                                                
                                                <div class="mb-3">
                                                    <label for="nik" class="form-label"><i class="fas fa-id-card"></i> NIK</label>
                                                    <input type="text" class="form-control" id="nik" required>
                                                    <div class="error-message" id="nikError">NIK harus diisi</div>
                                                </div>
                                                
                                                <div class="mb-3">
                                                    <label for="no_kk" class="form-label"><i class="fas fa-house-user"></i> No. KK</label>
                                                    <input type="text" class="form-control" id="no_kk" required>
                                                    <div class="error-message" id="no_kkError">No. KK harus diisi</div>
                                                </div>
                                                
                                                <div class="mb-3">
                                                    <label for="alamat" class="form-label"><i class="fas fa-map-marker-alt"></i> Alamat</label>
                                                    <textarea class="form-control" id="alamat" rows="2" required></textarea>
                                                    <div class="error-message" id="alamatError">Alamat harus diisi</div>
                                                </div>
                                                
                                                <div class="mb-3">
                                                    <label for="desa" class="form-label"><i class="fas fa-map-marked-alt"></i> Desa</label>
                                                    <div class="dropdown-search-container">
                                                        <select class="form-select" id="desa" required>
                                                            <option value="">Pilih Desa</option>
                                                            <option value="Sumberanyar">Sumberanyar</option>
                                                            <option value="Sumberejo">Sumberejo</option>
                                                            <option value="Mojosari">Mojosari</option>
                                                            <option value="Banyuputih">Banyuputih</option>
                                                            <option value="Sumberwaru">Sumberwaru</option>
                                                            <!-- Desa lainnya akan ditambahkan melalui JavaScript -->
                                                        </select>
                                                        <div class="dropdown-search" id="desaSearch">
                                                            <input type="text" class="form-control" placeholder="Cari desa..." id="searchDesa">
                                                        </div>
                                                    </div>
                                                    <div class="error-message" id="desaError">Desa harus dipilih</div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <div class="col-md-6">
                                        <div class="card">
                                            <div class="card-header">Data Bantuan</div>
                                            <div class="card-body">
                                                <div class="mb-3">
                                                    <label for="jenis_bantuan" class="form-label"><i class="fas fa-gift"></i> Jenis Bantuan</label>
                                                    <div class="jenis-bantuan-container">
                                                        <select class="form-select" id="jenis_bantuan" required>
                                                            <option value="">Pilih Jenis</option>
                                                            <option value="BLT">BLT</option>
                                                            <option value="PKH">PKH</option>
                                                            <option value="BPNT">BPNT</option>
                                                            <option value="BST">BST</option>
                                                            <option value="BANSOS">BANSOS</option>
                                                            <option value="LAINNYA">Lainnya</option>
                                                        </select>
                                                        <input type="text" class="form-control" id="jenis_bantuan_lainnya" placeholder="Jenis Lain" style="display:none">
                                                    </div>
                                                    <div class="error-message" id="jenis_bantuanError">Jenis bantuan harus dipilih</div>
                                                </div>
                                                
                                                <div class="mb-3">
                                                    <label for="jumlah_bantuan" class="form-label"><i class="fas fa-coins"></i> Jumlah Bantuan</label>
                                                    <input type="number" class="form-control" id="jumlah_bantuan" required>
                                                    <div class="error-message" id="jumlah_bantuanError">Jumlah bantuan harus diisi</div>
                                                </div>
                                                
                                                <div class="mb-3">
                                                    <label for="tanggal_terima" class="form-label"><i class="fas fa-calendar-alt"></i> Tanggal Terima</label>
                                                    <input type="date" class="form-control" id="tanggal_terima" required>
                                                    <div class="error-message" id="tanggal_terimaError">Tanggal terima harus diisi</div>
                                                </div>
                                                
                                                <div class="mb-3">
                                                    <label for="keterangan" class="form-label"><i class="fas fa-sticky-note"></i> Keterangan</label>
                                                    <textarea class="form-control" id="keterangan" rows="2"></textarea>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="row">
                                    <div class="col-md-6">
                                        <div class="card">
                                            <div class="card-header">Kontak & Media</div>
                                            <div class="card-body">
                                                <div class="mb-3">
                                                    <label for="no_telepon" class="form-label"><i class="fas fa-phone"></i> No. Telepon/WhatsApp</label>
                                                    <div class="whatsapp-input-container">
                                                        <span class="whatsapp-prefix">+62</span>
                                                        <input type="text" class="form-control whatsapp-input" id="no_telepon" placeholder="812-3456-7890">
                                                    </div>
                                                    <div class="error-message" id="no_teleponError">Format nomor telepon tidak valid</div>
                                                </div>
                                                
                                                <div class="mb-3">
                                                    <label for="link_gdrive" class="form-label"><i class="fab fa-google-drive"></i> Link Google Drive</label>
                                                    <input type="url" class="form-control" id="link_gdrive" placeholder="https://drive.google.com/...">
                                                    <div class="error-message" id="link_gdriveError">Format URL tidak valid</div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <div class="col-md-6">
                                        <div class="card">
                                            <div class="card-header">Kode Validasi</div>
                                            <div class="card-body">
                                                <div class="mb-3">
                                                    <label for="kode_validasi" class="form-label"><i class="fas fa-shield-alt"></i> Kode Validasi</label>
                                                    <div class="kode-validasi-container">
                                                        <input type="text" class="form-control kode-validasi-input" id="kode_validasi" placeholder="Kode validasi otomatis" readonly>
                                                        <button type="button" class="btn btn-primary btn-generate-kode" id="generateKode">
                                                            <i class="fas fa-sync-alt"></i>
                                                        </button>
                                                    </div>
                                                    <small class="form-text text-muted">Kode validasi akan digenerate otomatis</small>
                                                </div>
                                                
                                                <div class="d-grid gap-2 mt-4">
                                                    <button type="submit" class="btn btn-primary btn-lg">
                                                        <i class="fas fa-save me-2"></i> Simpan Data
                                                    </button>
                                                    <button type="reset" class="btn btn-secondary">
                                                        <i class="fas fa-undo me-2"></i> Reset Form
                                                    </button>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </form>
                        </div>
                        
                        <!-- Data Penerima Tab -->
                        <div class="tab-pane fade" id="v-pills-data" role="tabpanel" aria-labelledby="v-pills-data-tab">
                            <h3 class="section-title">Data Penerima Bantuan</h3>
                            
                            <div class="filter-section">
                                <div class="row g-3">
                                    <div class="col-md-3">
                                        <label class="form-label"><i class="fas fa-filter"></i> Filter Desa</label>
                                        <select class="form-select" id="filterDesa">
                                            <option value="">Semua Desa</option>
                                            <!-- Desa akan diisi oleh JavaScript -->
                                        </select>
                                    </div>
                                    <div class="col-md-3">
                                        <label class="form-label"><i class="fas fa-filter"></i> Filter Jenis Bantuan</label>
                                        <select class="form-select" id="filterJenis">
                                            <option value="">Semua Jenis</option>
                                            <option value="BLT">BLT</option>
                                            <option value="PKH">PKH</option>
                                            <option value="BPNT">BPNT</option>
                                            <option value="BST">BST</option>
                                            <option value="BANSOS">BANSOS</option>
                                            <option value="LAINNYA">Lainnya</option>
                                        </select>
                                    </div>
                                    <div class="col-md-3">
                                        <label class="form-label"><i class="fas fa-calendar"></i> Tanggal Mulai</label>
                                        <input type="date" class="form-control" id="filterTglMulai">
                                    </div>
                                    <div class="col-md-3">
                                        <label class="form-label"><i class="fas fa-calendar"></i> Tanggal Akhir</label>
                                        <input type="date" class="form-control" id="filterTglAkhir">
                                    </div>
                                    <div class="col-md-12">
                                        <div class="d-flex justify-content-end gap-2 mt-3">
                                            <button class="btn btn-primary" id="btnTerapkanFilter">
                                                <i class="fas fa-check me-2"></i> Terapkan Filter
                                            </button>
                                            <button class="btn btn-secondary" id="btnResetFilter">
                                                <i class="fas fa-sync-alt me-2"></i> Reset Filter
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="control-panel">
                                <div class="control-title">Kelola Data</div>
                                <div class="d-flex flex-wrap gap-2">
                                    <button class="btn btn-success" id="btnExportExcel">
                                        <i class="fas fa-file-excel me-2"></i> Export Excel
                                    </button>
                                    <button class="btn btn-danger" id="btnExportPDF">
                                        <i class="fas fa-file-pdf me-2"></i> Export PDF
                                    </button>
                                    <button class="btn btn-warning" id="btnPrint">
                                        <i class="fas fa-print me-2"></i> Cetak
                                    </button>
                                    <button class="btn btn-info" id="btnRefreshData">
                                        <i class="fas fa-sync-alt me-2"></i> Refresh Data
                                    </button>
                                    <button class="btn btn-undo" id="btnHapusFilter">
                                        <i class="fas fa-times me-2"></i> Hapus Filter
                                    </button>
                                </div>
                            </div>
                            
                            <div class="table-responsive mt-4">
                                <table class="table table-hover data-table" id="dataTable">
                                    <thead>
                                        <tr>
                                            <th>No</th>
                                            <th>Nama</th>
                                            <th>NIK</th>
                                            <th>No. KK</th>
                                            <th>Desa</th>
                                            <th>Jenis Bantuan</th>
                                            <th>Jumlah</th>
                                            <th>Tanggal</th>
                                            <th>Aksi</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <!-- Data akan diisi oleh JavaScript -->
                                    </tbody>
                                </table>
                            </div>
                            
                            <div class="d-flex justify-content-between align-items-center mt-4">
                                <div class="dataTables_info" id="tableInfo">Menampilkan 0 dari 0 data</div>
                                <nav>
                                    <ul class="pagination" id="pagination">
                                        <!-- Pagination akan diisi oleh JavaScript -->
                                    </ul>
                                </nav>
                            </div>
                        </div>
                        
                        <!-- Statistik Tab -->
                        <div class="tab-pane fade" id="v-pills-statistik" role="tabpanel" aria-labelledby="v-pills-statistik-tab">
                            <h3 class="section-title">Statistik & Grafik</h3>
                            
                            <div class="row mb-4">
                                <div class="col-md-6">
                                    <div class="card">
                                        <div class="card-header">
                                            <i class="fas fa-filter me-2"></i> Filter Statistik
                                        </div>
                                        <div class="card-body">
                                            <div class="row g-3">
                                                <div class="col-md-6">
                                                    <label class="form-label">Jenis Grafik</label>
                                                    <select class="form-select" id="chartType">
                                                        <option value="bar">Batang (Bar)</option>
                                                        <option value="line">Garis (Line)</option>
                                                        <option value="pie">Lingkaran (Pie)</option>
                                                        <option value="doughnut">Donat (Doughnut)</option>
                                                    </select>
                                                </div>
                                                <div class="col-md-6">
                                                    <label class="form-label">Tampilkan Berdasarkan</label>
                                                    <select class="form-select" id="chartBy">
                                                        <option value="desa">Desa</option>
                                                        <option value="jenis">Jenis Bantuan</option>
                                                        <option value="bulan">Bulan</option>
                                                    </select>
                                                </div>
                                                <div class="col-md-12">
                                                    <button class="btn btn-primary w-100" id="btnUpdateChart">
                                                        <i class="fas fa-sync-alt me-2"></i> Perbarui Grafik
                                                    </button>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="card">
                                        <div class="card-header">
                                            <i class="fas fa-download me-2"></i> Ekspor Grafik
                                        </div>
                                        <div class="card-body">
                                            <div class="d-grid gap-2">
                                                <button class="btn btn-success" id="btnExportChartJPG">
                                                    <i class="fas fa-file-image me-2"></i> Export JPG
                                                </button>
                                                <button class="btn btn-primary" id="btnExportChartPNG">
                                                    <i class="fas fa-file-image me-2"></i> Export PNG
                                                </button>
                                                <button class="btn btn-secondary" id="btnExportChartPDF">
                                                    <i class="fas fa-file-pdf me-2"></i> Export PDF
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="card mb-4">
                                <div class="card-header">
                                    <i class="fas fa-chart-area me-2"></i> Grafik Data Penerima Bantuan
                                </div>
                                <div class="card-body">
                                    <canvas id="statistikChart" height="350"></canvas>
                                </div>
                            </div>
                            
                            <div class="card">
                                <div class="card-header">
                                    <i class="fas fa-table me-2"></i> Data Statistik
                                </div>
                                <div class="card-body">
                                    <div class="table-responsive">
                                        <table class="table table-bordered" id="statistikTable">
                                            <thead>
                                                <tr>
                                                    <th>Kategori</th>
                                                    <th>Jumlah Penerima</th>
                                                    <th>Total Bantuan</th>
                                                    <th>Rata-rata per Penerima</th>
                                                    <th>Persentase</th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                                <!-- Data akan diisi oleh JavaScript -->
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Pengaturan Tab -->
                        <div class="tab-pane fade" id="v-pills-pengaturan" role="tabpanel" aria-labelledby="v-pills-pengaturan-tab">
                            <h3 class="section-title">Pengaturan Aplikasi</h3>
                            
                            <div class="row">
                                <div class="col-md-6">
                                    <div class="card mb-4">
                                        <div class="card-header">
                                            <i class="fas fa-key me-2"></i> Pengaturan Keamanan
                                        </div>
                                        <div class="card-body">
                                            <form id="securityForm">
                                                <div class="mb-3">
                                                    <label for="currentPassword" class="form-label">Kode Keamanan Saat Ini</label>
                                                    <input type="password" class="form-control" id="currentPassword" required>
                                                </div>
                                                <div class="mb-3">
                                                    <label for="newPassword" class="form-label">Kode Keamanan Baru</label>
                                                    <input type="password" class="form-control" id="newPassword" required>
                                                </div>
                                                <div class="mb-3">
                                                    <label for="confirmPassword" class="form-label">Konfirmasi Kode Baru</label>
                                                    <input type="password" class="form-control" id="confirmPassword" required>
                                                </div>
                                                <button type="submit" class="btn btn-primary">
                                                    <i class="fas fa-save me-2"></i> Simpan Perubahan
                                                </button>
                                            </form>
                                        </div>
                                    </div>
                                    
                                    <div class="card mb-4">
                                        <div class="card-header">
                                            <i class="fas fa-database me-2"></i> Kelola Data
                                        </div>
                                        <div class="card-body">
                                            <div class="d-grid gap-2">
                                                <button class="btn btn-success" id="btnBackupData">
                                                    <i class="fas fa-download me-2"></i> Backup Data
                                                </button>
                                                <button class="btn btn-warning" id="btnRestoreData">
                                                    <i class="fas fa-upload me-2"></i> Restore Data
                                                </button>
                                                <input type="file" id="restoreFile" class="d-none" accept=".json">
                                                <button class="btn btn-danger" id="btnHapusSemuaData">
                                                    <i class="fas fa-trash me-2"></i> Hapus Semua Data
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="col-md-6">
                                    <div class="card mb-4">
                                        <div class="card-header">
                                            <i class="fas fa-sliders-h me-2"></i> Pengaturan Tampilan
                                        </div>
                                        <div class="card-body">
                                            <div class="mb-3">
                                                <label for="themeSelect" class="form-label">Tema Aplikasi</label>
                                                <select class="form-select" id="themeSelect">
                                                    <option value="default">Default Biru</option>
                                                    <option value="green">Hijau</option>
                                                    <option value="purple">Ungu</option>
                                                    <option value="dark">Gelap</option>
                                                </select>
                                            </div>
                                            <div class="mb-3">
                                                <label for="fontSize" class="form-label">Ukuran Font</label>
                                                <select class="form-select" id="fontSize">
                                                    <option value="small">Kecil</option>
                                                    <option value="medium" selected>Sedang</option>
                                                    <option value="large">Besar</option>
                                                </select>
                                            </div>
                                            <div class="form-check form-switch mb-3">
                                                <input class="form-check-input" type="checkbox" id="animationsSwitch" checked>
                                                <label class="form-check-label" for="animationsSwitch">Aktifkan Animasi</label>
                                            </div>
                                            <button class="btn btn-primary" id="btnApplyTheme">
                                                <i class="fas fa-paint-brush me-2"></i> Terapkan Tema
                                            </button>
                                        </div>
                                    </div>
                                    
                                    <div class="card">
                                        <div class="card-header">
                                            <i class="fas fa-info-circle me-2"></i> Informasi Aplikasi
                                        </div>
                                        <div class="card-body">
                                            <div class="mb-3">
                                                <label class="form-label">Versi Aplikasi</label>
                                                <p class="form-control-static">v2.0.1</p>
                                            </div>
                                            <div class="mb-3">
                                                <label class="form-label">Tanggal Pembaruan Terakhir</label>
                                                <p class="form-control-static">15 Maret 2025</p>
                                            </div>
                                            <div class="mb-3">
                                                <label class="form-label">Pengembang</label>
                                                <p class="form-control-static">Lentera Karya Situbondo</p>
                                            </div>
                                            <div class="mb-3">
                                                <label class="form-label">Kontak Dukungan</label>
                                                <p class="form-control-static">
                                                    <i class="fab fa-whatsapp me-2"></i> 
                                                    <a href="https://wa.me/6285647709114" target="_blank" class="whatsapp-link">+62 856-4770-9114</a>
                                                </p>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Bantuan Tab -->
                        <div class="tab-pane fade" id="v-pills-bantuan" role="tabpanel" aria-labelledby="v-pills-bantuan-tab">
                            <h3 class="section-title">Bantuan & Panduan</h3>
                            
                            <div class="row">
                                <div class="col-md-8">
                                    <div class="card mb-4">
                                        <div class="card-header">
                                            <i class="fas fa-question-circle me-2"></i> Panduan Penggunaan
                                        </div>
                                        <div class="card-body">
                                            <div class="accordion" id="helpAccordion">
                                                <div class="accordion-item">
                                                    <h2 class="accordion-header">
                                                        <button class="accordion-button" type="button" data-bs-toggle="collapse" data-bs-target="#collapseOne" aria-expanded="true" aria-controls="collapseOne">
                                                            Cara Input Data Penerima
                                                        </button>
                                                    </h2>
                                                    <div id="collapseOne" class="accordion-collapse collapse show" data-bs-parent="#helpAccordion">
                                                        <div class="accordion-body">
                                                            <ol>
                                                                <li>Buka menu <strong>Input Data</strong></li>
                                                                <li>Isi semua field yang wajib diisi (ditandai dengan *)</li>
                                                                <li>Untuk nomor telepon, cukup masukkan angka tanpa kode negara (+62)</li>
                                                                <li>Klik tombol <strong>Generate Kode</strong> untuk membuat kode validasi otomatis</li>
                                                                <li>Klik <strong>Simpan Data</strong> untuk menyimpan data ke sistem</li>
                                                            </ol>
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="accordion-item">
                                                    <h2 class="accordion-header">
                                                        <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseTwo" aria-expanded="false" aria-controls="collapseTwo">
                                                            Cara Melihat dan Mencari Data
                                                        </button>
                                                    </h2>
                                                    <div id="collapseTwo" class="accordion-collapse collapse" data-bs-parent="#helpAccordion">
                                                        <div class="accordion-body">
                                                            <ol>
                                                                <li>Buka menu <strong>Data Penerima</strong></li>
                                                                <li>Gunakan filter di atas tabel untuk menyaring data berdasarkan desa, jenis bantuan, atau tanggal</li>
                                                                <li>Gunakan kotak pencarian untuk mencari data tertentu</li>
                                                                <li>Klik header kolom untuk mengurutkan data</li>
                                                                <li>Gunakan navigasi halaman di bawah tabel untuk melihat data lainnya</li>
                                                            </ol>
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="accordion-item">
                                                    <h2 class="accordion-header">
                                                        <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseThree" aria-expanded="false" aria-controls="collapseThree">
                                                            Cara Mencetak dan Mengekspor Data
                                                        </button>
                                                    </h2>
                                                    <div id="collapseThree" class="accordion-collapse collapse" data-bs-parent="#helpAccordion">
                                                        <div class="accordion-body">
                                                            <ol>
                                                                <li>Buka menu <strong>Data Penerima</strong></li>
                                                                <li>Gunakan filter jika ingin mencetak data tertentu saja</li>
                                                                <li>Klik tombol <strong>Cetak</strong> untuk mencetak data ke printer</li>
                                                                <li>Klik tombol <strong>Export Excel</strong> untuk menyimpan data dalam format Excel</li>
                                                                <li>Klik tombol <strong>Export PDF</strong> untuk menyimpan data dalam format PDF</li>
                                                            </ol>
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="accordion-item">
                                                    <h2 class="accordion-header">
                                                        <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseFour" aria-expanded="false" aria-controls="collapseFour">
                                                            Cara Menggunakan Fitur Statistik
                                                        </button>
                                                    </h2>
                                                    <div id="collapseFour" class="accordion-collapse collapse" data-bs-parent="#helpAccordion">
                                                        <div class="accordion-body">
                                                            <ol>
                                                                <li>Buka menu <strong>Statistik</strong></li>
                                                                <li>Pilih jenis grafik yang diinginkan (batang, garis, lingkaran, donat)</li>
                                                                <li>Pilih kategori untuk menampilkan data (berdasarkan desa, jenis bantuan, atau bulan)</li>
                                                                <li>Klik tombol <strong>Perbarui Grafik</strong> untuk menerapkan perubahan</li>
                                                                <li>Gunakan tombol ekspor untuk menyimpan grafik sebagai gambar</li>
                                                            </ol>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <div class="card mb-4">
                                        <div class="card-header">
                                            <i class="fas fa-exclamation-triangle me-2"></i> Pemecahan Masalah
                                        </div>
                                        <div class="card-body">
                                            <div class="accordion" id="troubleshootAccordion">
                                                <div class="accordion-item">
                                                    <h2 class="accordion-header">
                                                        <button class="accordion-button" type="button" data-bs-toggle="collapse" data-bs-target="#troubleOne" aria-expanded="true" aria-controls="troubleOne">
                                                            Data tidak tersimpan
                                                        </button>
                                                    </h2>
                                                    <div id="troubleOne" class="accordion-collapse collapse show" data-bs-parent="#troubleshootAccordion">
                                                        <div class="accordion-body">
                                                            <p>Pastikan semua field wajib telah diisi dengan benar. Periksa juga koneksi internet jika menggunakan penyimpanan cloud.</p>
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="accordion-item">
                                                    <h2 class="accordion-header">
                                                        <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#troubleTwo" aria-expanded="false" aria-controls="troubleTwo">
                                                            Grafik tidak muncul
                                                        </button>
                                                    </h2>
                                                    <div id="troubleTwo" class="accordion-collapse collapse" data-bs-parent="#troubleshootAccordion">
                                                        <div class="accordion-body">
                                                            <p>Pastikan browser mendukung JavaScript dan Canvas. Coba refresh halaman atau perbarui browser ke versi terbaru.</p>
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="accordion-item">
                                                    <h2 class="accordion-header">
                                                        <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#troubleThree" aria-expanded="false" aria-controls="troubleThree">
                                                            Aplikasi lambat
                                                        </button>
                                                    </h2>
                                                    <div id="troubleThree" class="accordion-collapse collapse" data-bs-parent="#troubleshootAccordion">
                                                        <div class="accordion-body">
                                                            <p>Bersihkan cache browser atau tutup tab browser yang tidak diperlukan. Jika data sudah banyak, pertimbangkan untuk melakukan backup dan hapus data lama.</p>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="col-md-4">
                                    <div class="card mb-4">
                                        <div class="card-header">
                                            <i class="fas fa-video me-2"></i> Video Tutorial
                                        </div>
                                        <div class="card-body text-center">
                                            <div class="mb-3">
                                                <i class="fas fa-film fa-3x text-primary mb-3"></i>
                                                <p>Video tutorial akan segera tersedia</p>
                                            </div>
                                            <button class="btn btn-outline-primary disabled">
                                                <i class="fas fa-play-circle me-2"></i> Putar Tutorial
                                            </button>
                                        </div>
                                    </div>
                                    
                                    <div class="card mb-4">
                                        <div class="card-header">
                                            <i class="fas fa-book me-2"></i> Dokumentasi
                                        </div>
                                        <div class="card-body text-center">
                                            <div class="mb-3">
                                                <i class="fas fa-file-pdf fa-3x text-danger mb-3"></i>
                                                <p>Panduan pengguna lengkap dalam format PDF</p>
                                            </div>
                                            <button class="btn btn-outline-danger disabled">
                                                <i class="fas fa-download me-2"></i> Unduh Dokumentasi
                                            </button>
                                        </div>
                                    </div>
                                    
                                    <div class="card">
                                        <div class="card-header">
                                            <i class="fas fa-headset me-2"></i> Dukungan Teknis
                                        </div>
                                        <div class="card-body">
                                            <p>Untuk bantuan teknis dan pertanyaan lebih lanjut, hubungi:</p>
                                            <div class="developer-info">
                                                <h6>Lentera Karya Situbondo</h6>
                                                <div class="developer-contact">
                                                    <p><i class="fab fa-whatsapp me-2"></i> <a href="https://wa.me/6285647709114" target="_blank">+62 856-4770-9114</a></p>
                                                    <p><i class="fas fa-envelope me-2"></i> <a href="mailto:admin@anekamarket.my.id">admin@anekamarket.my.id</a></p>
                                                    <p><i class="fas fa-globe me-2"></i> <a href="https://anekamarket.my.id" target="_blank">anekamarket.my.id</a></p>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="copyright">
                &copy; 2025 BARJAS - Sistem Bantuan Terpadu. Hak Cipta Dilindungi.
            </div>
        </div>
        
        <!-- Floating Action Button -->
        <div class="floating-action-btn" id="fabButton">
            <i class="fas fa-plus"></i>
        </div>
        
        <!-- Notification Toast -->
        <div class="toast notification-toast" role="alert" aria-live="assertive" aria-atomic="true" id="notificationToast">
            <div class="toast-header">
                <i class="fas fa-bell me-2 text-primary"></i>
                <strong class="me-auto">BARJAS Notification</strong>
                <small>Just now</small>
                <button type="button" class="btn-close" data-bs-dismiss="toast" aria-label="Close"></button>
            </div>
            <div class="toast-body" id="toastMessage">
                <!-- Message will be inserted here -->
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-datepicker/1.9.0/js/bootstrap-datepicker.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script>
        // Inisialisasi variabel global
        let penerimaBantuan = JSON.parse(localStorage.getItem('penerimaBantuan')) || [];
        let loginAttempts = 0;
        let isBlocked = false;
        let blockTimeout;
        let currentPage = 1;
        const itemsPerPage = 10;
        let filteredData = [];
        let currentChart = null;
        let securityCode = localStorage.getItem('securityCode') || '1234';
        
        // Daftar desa di Situbondo
        const desaSitubondo = [
            "Sumberanyar", "Sumberejo", "Mojosari", "Banyuputih", "Sumberwaru", 
            "Patokan", "Kembang", "Kotakan", "Wringinanom", "Peleyan", 
            "Curah Tatal", "Ardirejo", "Jangkar", "Kayu Putih", "Klampokan", 
            "Banyuglugur", "Taman", "Banyu urip", "Kalisari", "Kalianget", 
            "Besuki", "Blado", "Bloro", "Gelung", "Kalitokol", 
            "Pesisir", "Sumberejo", "Trepan", "Wonorejo", "Mlandingan", 
            "Pasir Putih", "Sumberanyar", "Sumberpinang", "Alas Malang", "Bades", 
            "Batuputih", "Default Desa"
        ];
        
        // Fungsi inisialisasi aplikasi
        function initApp() {
            console.log("Initializing BARJAS Application...");
            
            // Inisialisasi komponen UI
            initUIComponents();
            
            // Inisialisasi chart
            initCharts();
            
            // Muat data
            loadData();
            
            // Perbarui dashboard
            updateDashboard();
            
            // Setup event listeners
            setupEventListeners();
            
            // Tampilkan login modal jika belum login
            if (!isAuthenticated()) {
                $('#loginModal').modal('show');
            } else {
                $('#appContent').show();
            }
            
            console.log("BARJAS Application initialized successfully.");
        }
        
        // Fungsi inisialisasi komponen UI
        function initUIComponents() {
            console.log("Initializing UI components...");
            
            // Isi dropdown desa
            const desaDropdown = document.getElementById('desa');
            const filterDesaDropdown = document.getElementById('filterDesa');
            
            // Hapus opsi default terlebih dahulu
            while (desaDropdown.options.length > 1) {
                desaDropdown.remove(1);
            }
            
            while (filterDesaDropdown.options.length > 1) {
                filterDesaDropdown.remove(1);
            }
            
            // Tambahkan desa dari array
            desaSitubondo.forEach(desa => {
                const option = document.createElement('option');
                option.value = desa;
                option.textContent = desa;
                desaDropdown.appendChild(option.cloneNode(true));
                filterDesaDropdown.appendChild(option);
            });
            
            // Set tanggal hari ini untuk input tanggal
            document.getElementById('tanggal_terima').valueAsDate = new Date();
            
            // Generate kode validasi pertama kali
            generateKodeValidasi();
            
            console.log("UI components initialized.");
        }
        
        // Fungsi untuk inisialisasi chart
        function initCharts() {
            console.log("Initializing charts...");
            
            // Inisialisasi chart dashboard
            initDashboardCharts();
            
            console.log("Charts initialized.");
        }
        
        // Fungsi untuk inisialisasi chart dashboard
        function initDashboardCharts() {
            console.log("Initializing dashboard charts...");
            
            // Data untuk chart desa
            const desaData = getDataByDesa();
            const desaLabels = desaData.map(item => item.desa);
            const desaCounts = desaData.map(item => item.count);
            
            // Chart untuk data per desa
            const desaCtx = document.getElementById('desaChart').getContext('2d');
            if (window.desaChartInstance) {
                window.desaChartInstance.destroy();
            }
            window.desaChartInstance = new Chart(desaCtx, {
                type: 'bar',
                data: {
                    labels: desaLabels,
                    datasets: [{
                        label: 'Jumlah Penerima per Desa',
                        data: desaCounts,
                        backgroundColor: 'rgba(54, 162, 235, 0.7)',
                        borderColor: 'rgba(54, 162, 235, 1)',
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: {
                            position: 'top',
                        },
                        title: {
                            display: true,
                            text: 'Distribusi Penerima Bantuan per Desa'
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: {
                                stepSize: 1
                            }
                        }
                    }
                }
            });
            
            // Data untuk chart jenis bantuan
            const bantuanData = getDataByJenisBantuan();
            const bantuanLabels = bantuanData.map(item => item.jenis);
            const bantuanCounts = bantuanData.map(item => item.count);
            
            // Chart untuk jenis bantuan
            const bantuanCtx = document.getElementById('bantuanChart').getContext('2d');
            if (window.bantuanChartInstance) {
                window.bantuanChartInstance.destroy();
            }
            window.bantuanChartInstance = new Chart(bantuanCtx, {
                type: 'pie',
                data: {
                    labels: bantuanLabels,
                    datasets: [{
                        label: 'Distribusi Jenis Bantuan',
                        data: bantuanCounts,
                        backgroundColor: [
                            'rgba(255, 99, 132, 0.7)',
                            'rgba(54, 162, 235, 0.7)',
                            'rgba(255, 206, 86, 0.7)',
                            'rgba(75, 192, 192, 0.7)',
                            'rgba(153, 102, 255, 0.7)',
                            'rgba(255, 159, 64, 0.7)'
                        ],
                        borderColor: [
                            'rgba(255, 99, 132, 1)',
                            'rgba(54, 162, 235, 1)',
                            'rgba(255, 206, 86, 1)',
                            'rgba(75, 192, 192, 1)',
                            'rgba(153, 102, 255, 1)',
                            'rgba(255, 159, 64, 1)'
                        ],
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: {
                            position: 'top',
                        },
                        title: {
                            display: true,
                            text: 'Distribusi Jenis Bantuan'
                        }
                    }
                }
            });
            
            console.log("Dashboard charts initialized.");
        }
        
        // Fungsi untuk memuat data
        function loadData() {
            console.log("Loading data...");
            
            // Muat data dari localStorage
            penerimaBantuan = JSON.parse(localStorage.getItem('penerimaBantuan')) || [];
            filteredData = [...penerimaBantuan];
            
            // Perbarui tampilan data
            renderDataTable();
            
            console.log("Data loaded. Total records:", penerimaBantuan.length);
        }
        
        // Fungsi untuk memperbarui dashboard
        function updateDashboard() {
            console.log("Updating dashboard...");
            
            // Update statistik box
            document.getElementById('totalPenerima').textContent = penerimaBantuan.length;
            
            // Hitung jumlah desa unik
            const uniqueDesa = new Set(penerimaBantuan.map(item => item.desa));
            document.getElementById('totalDesa').textContent = uniqueDesa.size;
            
            // Hitung jumlah jenis bantuan unik
            const uniqueBantuan = new Set(penerimaBantuan.map(item => item.jenis_bantuan));
            document.getElementById('totalBantuan').textContent = uniqueBantuan.size;
            
            // Hitung rata-rata per desa
            const rataRata = uniqueDesa.size > 0 ? (penerimaBantuan.length / uniqueDesa.size).toFixed(1) : 0;
            document.getElementById('rataRata').textContent = rataRata;
            
            // Update tabel data terbaru
            updateRecentTable();
            
            console.log("Dashboard updated.");
        }
        
        // Fungsi untuk memperbarui tabel data terbaru
        function updateRecentTable() {
            const recentTableBody = document.querySelector('#recentTable tbody');
            recentTableBody.innerHTML = '';
            
            // Ambil 5 data terbaru
            const recentData = [...penerimaBantuan]
                .sort((a, b) => new Date(b.tanggal_terima) - new Date(a.tanggal_terima))
                .slice(0, 5);
            
            recentData.forEach((item, index) => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${index + 1}</td>
                    <td>${item.nama}</td>
                    <td>${item.desa}</td>
                    <td><span class="badge bg-primary">${item.jenis_bantuan}</span></td>
                    <td>${formatDate(item.tanggal_terima)}</td>
                    <td>
                        <button class="btn btn-sm btn-info view-item" data-id="${item.id}">
                            <i class="fas fa-eye"></i>
                        </button>
                    </td>
                `;
                recentTableBody.appendChild(row);
            });
            
            // Tambahkan event listener untuk tombol view
            document.querySelectorAll('.view-item').forEach(button => {
                button.addEventListener('click', function() {
                    const id = this.getAttribute('data-id');
                    viewItem(id);
                });
            });
        }
        
        // Fungsi untuk merender tabel data
        function renderDataTable() {
            console.log("Rendering data table...");
            
            const tableBody = document.querySelector('#dataTable tbody');
            tableBody.innerHTML = '';
            
            // Hitung pagination
            const totalPages = Math.ceil(filteredData.length / itemsPerPage);
            const startIndex = (currentPage - 1) * itemsPerPage;
            const endIndex = Math.min(startIndex + itemsPerPage, filteredData.length);
            const currentData = filteredData.slice(startIndex, endIndex);
            
            // Isi tabel dengan data
            currentData.forEach((item, index) => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${startIndex + index + 1}</td>
                    <td>${item.nama}</td>
                    <td>${item.nik}</td>
                    <td>${item.no_kk}</td>
                    <td>${item.desa}</td>
                    <td><span class="badge bg-primary">${item.jenis_bantuan}</span></td>
                    <td>${formatCurrency(item.jumlah_bantuan)}</td>
                    <td>${formatDate(item.tanggal_terima)}</td>
                    <td>
                        <button class="btn btn-sm btn-info view-item" data-id="${item.id}">
                            <i class="fas fa-eye"></i>
                        </button>
                        <button class="btn btn-sm btn-warning edit-item" data-id="${item.id}">
                            <i class="fas fa-edit"></i>
                        </button>
                        <button class="btn btn-sm btn-danger delete-item" data-id="${item.id}">
                            <i class="fas fa-trash"></i>
                        </button>
                        ${item.link_gdrive ? `<a href="${item.link_gdrive}" target="_blank" class="btn btn-sm btn-view"><i class="fas fa-link"></i></a>` : ''}
                    </td>
                `;
                tableBody.appendChild(row);
            });
            
            // Update info tabel
            document.getElementById('tableInfo').textContent = 
                `Menampilkan ${startIndex + 1} sampai ${endIndex} dari ${filteredData.length} data`;
            
            // Render pagination
            renderPagination(totalPages);
            
            // Tambahkan event listener untuk tombol aksi
            document.querySelectorAll('.view-item').forEach(button => {
                button.addEventListener('click', function() {
                    const id = this.getAttribute('data-id');
                    viewItem(id);
                });
            });
            
            document.querySelectorAll('.edit-item').forEach(button => {
                button.addEventListener('click', function() {
                    const id = this.getAttribute('data-id');
                    editItem(id);
                });
            });
            
            document.querySelectorAll('.delete-item').forEach(button => {
                button.addEventListener('click', function() {
                    const id = this.getAttribute('data-id');
                    deleteItem(id);
                });
            });
            
            console.log("Data table rendered.");
        }
        
        // Fungsi untuk merender pagination
        function renderPagination(totalPages) {
            const paginationElement = document.getElementById('pagination');
            paginationElement.innerHTML = '';
            
            if (totalPages <= 1) return;
            
            // Tombol Previous
            const prevLi = document.createElement('li');
            prevLi.classList.add('page-item', currentPage === 1 ? 'disabled' : '');
            prevLi.innerHTML = `<a class="page-link" href="#" data-page="${currentPage - 1}">Previous</a>`;
            paginationElement.appendChild(prevLi);
            
            // Tombol halaman
            const startPage = Math.max(1, currentPage - 2);
            const endPage = Math.min(totalPages, startPage + 4);
            
            for (let i = startPage; i <= endPage; i++) {
                const pageLi = document.createElement('li');
                pageLi.classList.add('page-item', i === currentPage ? 'active' : '');
                pageLi.innerHTML = `<a class="page-link" href="#" data-page="${i}">${i}</a>`;
                paginationElement.appendChild(pageLi);
            }
            
            // Tombol Next
            const nextLi = document.createElement('li');
            nextLi.classList.add('page-item', currentPage === totalPages ? 'disabled' : '');
            nextLi.innerHTML = `<a class="page-link" href="#" data-page="${currentPage + 1}">Next</a>`;
            paginationElement.appendChild(nextLi);
            
            // Tambahkan event listener untuk pagination
            paginationElement.querySelectorAll('.page-link').forEach(link => {
                link.addEventListener('click', function(e) {
                    e.preventDefault();
                    const page = parseInt(this.getAttribute('data-page'));
                    if (page && page !== currentPage) {
                        currentPage = page;
                        renderDataTable();
                    }
                });
            });
        }
        
        // Fungsi untuk mengatur event listeners
        function setupEventListeners() {
            console.log("Setting up event listeners...");
            
            // Event listener untuk form input
            document.getElementById('inputForm').addEventListener('submit', function(e) {
                e.preventDefault();
                simpanData();
            });
            
            // Event listener untuk generate kode
            document.getElementById('generateKode').addEventListener('click', generateKodeValidasi);
            
            // Event listener untuk jenis bantuan lainnya
            document.getElementById('jenis_bantuan').addEventListener('change', function() {
                const lainnyaInput = document.getElementById('jenis_bantuan_lainnya');
                lainnyaInput.style.display = this.value === 'LAINNYA' ? 'block' : 'none';
                if (this.value !== 'LAINNYA') {
                    lainnyaInput.value = '';
                }
            });
            
            // Event listener untuk filter
            document.getElementById('btnTerapkanFilter').addEventListener('click', terapkanFilter);
            document.getElementById('btnResetFilter').addEventListener('click', resetFilter);
            document.getElementById('btnHapusFilter').addEventListener('click', resetFilter);
            
            // Event listener untuk ekspor data
            document.getElementById('btnExportExcel').addEventListener('click', exportToExcel);
            document.getElementById('btnExportPDF').addEventListener('click', exportToPDF);
            document.getElementById('btnPrint').addEventListener('click', printData);
            
            // Event listener untuk refresh data
            document.getElementById('btnRefreshData').addEventListener('click', function() {
                loadData();
                showNotification('Data telah diperbarui', 'success');
            });
            
            // Event listener untuk menu navigasi
            document.querySelectorAll('.nav-link').forEach(link => {
                link.addEventListener('click', function() {
                    // Sembunyikan sidebar di mobile setelah memilih menu
                    if (window.innerWidth < 992) {
                        document.getElementById('sidebarMenu').classList.remove('mobile-show');
                        document.getElementById('sidebarOverlay').classList.remove('mobile-show');
                    }
                });
            });
            
            // Event listener untuk logout
            document.getElementById('logoutButton').addEventListener('click', logout);
            
            // Event listener untuk mobile menu
            document.getElementById('mobileMenuBtn').addEventListener('click', function() {
                document.getElementById('sidebarMenu').classList.add('mobile-show');
                document.getElementById('sidebarOverlay').classList.add('mobile-show');
            });
            
            document.getElementById('sidebarOverlay').addEventListener('click', function() {
                document.getElementById('sidebarMenu').classList.remove('mobile-show');
                this.classList.remove('mobile-show');
            });
            
            // Event listener untuk FAB
            document.getElementById('fabButton').addEventListener('click', function() {
                // Switch to input tab
                document.getElementById('v-pills-input-tab').click();
                
                // Scroll to form
                document.getElementById('inputForm').scrollIntoView({ behavior: 'smooth' });
            });
            
            // Event listener untuk form login
            document.getElementById('loginForm').addEventListener('submit', function(e) {
                e.preventDefault();
                handleLogin();
            });
            
            // Event listener untuk toggle password visibility
            document.querySelector('.toggle-password').addEventListener('click', function() {
                const passwordInput = document.getElementById('securityCode');
                const icon = this.querySelector('i');
                
                if (passwordInput.type === 'password') {
                    passwordInput.type = 'text';
                    icon.classList.remove('fa-eye');
                    icon.classList.add('fa-eye-slash');
                } else {
                    passwordInput.type = 'password';
                    icon.classList.remove('fa-eye-slash');
                    icon.classList.add('fa-eye');
                }
            });
            
            // Event listener untuk chart update
            document.getElementById('btnUpdateChart').addEventListener('click', updateStatistikChart);
            
            // Event listener untuk search desa
            document.getElementById('desa').addEventListener('focus', function() {
                document.getElementById('desaSearch').style.display = 'block';
            });
            
            document.getElementById('searchDesa').addEventListener('input', function() {
                const searchTerm = this.value.toLowerCase();
                const options = document.getElementById('desa').options;
                
                for (let i = 0; i < options.length; i++) {
                    const option = options[i];
                    if (option.text.toLowerCase().includes(searchTerm)) {
                        option.style.display = '';
                    } else {
                        option.style.display = 'none';
                    }
                }
            });
            
            console.log("Event listeners set up successfully.");
        }
        
        // Fungsi untuk menangani login
        function handleLogin() {
            if (isBlocked) {
                showNotification('Anda telah diblokir sementara. Silakan coba lagi nanti.', 'error');
                return;
            }
            
            const inputCode = document.getElementById('securityCode').value;
            const loginButton = document.getElementById('loginButton');
            const loginSpinner = document.getElementById('loginSpinner');
            const loginButtonText = document.querySelector('.login-button-text');
            
            // Tampilkan spinner
            loginButton.disabled = true;
            loginSpinner.classList.remove('d-none');
            loginButtonText.textContent = 'Memproses...';
            
            // Simulasi proses login
            setTimeout(() => {
                if (inputCode === securityCode) {
                    // Login berhasil
                    loginAttempts = 0;
                    localStorage.setItem('isAuthenticated', 'true');
                    $('#loginModal').modal('hide');
                    $('#appContent').show();
                    showNotification('Login berhasil. Selamat datang di BARJAS!', 'success');
                } else {
                    // Login gagal
                    loginAttempts++;
                    
                    if (loginAttempts >= 3) {
                        // Blokir akses sementara
                        isBlocked = true;
                        document.getElementById('blockedMessage').classList.remove('d-none');
                        document.getElementById('attemptsCount').classList.add('d-none');
                        
                        let countdown = 30;
                        document.getElementById('countdown').textContent = countdown;
                        
                        blockTimeout = setInterval(() => {
                            countdown--;
                            document.getElementById('countdown').textContent = countdown;
                            
                            if (countdown <= 0) {
                                clearInterval(blockTimeout);
                                isBlocked = false;
                                loginAttempts = 0;
                                document.getElementById('blockedMessage').classList.add('d-none');
                            }
                        }, 1000);
                    } else {
                        document.getElementById('attemptsCount').textContent = 
                            `Percobaan login gagal: ${loginAttempts} dari 3. Setelah 3 kali gagal, akses akan diblokir sementara.`;
                        document.getElementById('attemptsCount').style.display = 'block';
                        
                        // Animasi shake untuk form
                        document.getElementById('loginForm').classList.add('login-shake');
                        setTimeout(() => {
                            document.getElementById('loginForm').classList.remove('login-shake');
                        }, 600);
                    }
                    
                    showNotification('Kode keamanan salah. Silakan coba lagi.', 'error');
                }
                
                // Sembunyikan spinner
                loginButton.disabled = false;
                loginSpinner.classList.add('d-none');
                loginButtonText.textContent = 'Masuk ke Aplikasi';
            }, 1000);
        }
        
        // Fungsi untuk mengecek status autentikasi
        function isAuthenticated() {
            return localStorage.getItem('isAuthenticated') === 'true';
        }
        
        // Fungsi untuk logout
        function logout() {
            localStorage.removeItem('isAuthenticated');
            $('#appContent').hide();
            $('#loginModal').modal('show');
            document.getElementById('securityCode').value = '';
            showNotification('Anda telah logout dari aplikasi', 'info');
        }
        
        // Fungsi untuk menghasilkan kode validasi
        function generateKodeValidasi() {
            const chars = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789';
            let result = '';
            for (let i = 0; i < 6; i++) {
                result += chars.charAt(Math.floor(Math.random() * chars.length));
            }
            document.getElementById('kode_validasi').value = result;
        }
        
        // Fungsi untuk menyimpan data
        function simpanData() {
            // Validasi form
            if (!validateForm()) {
                showNotification('Harap periksa kembali form input. Terdapat data yang tidak valid.', 'error');
                return;
            }
            
            // Ambil nilai dari form
            const jenisBantuan = document.getElementById('jenis_bantuan').value;
            const jenisBantuanLainnya = document.getElementById('jenis_bantuan_lainnya').value;
            
            const data = {
                id: Date.now().toString(),
                nama: document.getElementById('nama').value,
                nik: document.getElementById('nik').value,
                no_kk: document.getElementById('no_kk').value,
                alamat: document.getElementById('alamat').value,
                desa: document.getElementById('desa').value,
                jenis_bantuan: jenisBantuan === 'LAINNYA' ? jenisBantuanLainnya : jenisBantuan,
                jumlah_bantuan: parseInt(document.getElementById('jumlah_bantuan').value),
                tanggal_terima: document.getElementById('tanggal_terima').value,
                keterangan: document.getElementById('keterangan').value,
                no_telepon: document.getElementById('no_telepon').value ? '+62' + document.getElementById('no_telepon').value : '',
                link_gdrive: document.getElementById('link_gdrive').value,
                kode_validasi: document.getElementById('kode_validasi').value,
                tanggal_input: new Date().toISOString()
            };
            
            // Simpan ke array
            penerimaBantuan.push(data);
            
            // Simpan ke localStorage
            localStorage.setItem('penerimaBantuan', JSON.stringify(penerimaBantuan));
            
            // Perbarui tampilan
            loadData();
            updateDashboard();
            initDashboardCharts();
            
            // Reset form
            document.getElementById('inputForm').reset();
            generateKodeValidasi();
            
            // Tampilkan notifikasi
            showNotification('Data penerima bantuan berhasil disimpan', 'success');
            
            // Kembali ke tab dashboard
            document.getElementById('v-pills-dashboard-tab').click();
        }
        
        // Fungsi untuk validasi form
        function validateForm() {
            let isValid = true;
            
            // Validasi nama
            const nama = document.getElementById('nama');
            const namaError = document.getElementById('namaError');
            if (!nama.value.trim()) {
                nama.classList.add('input-error');
                namaError.style.display = 'block';
                isValid = false;
            } else {
                nama.classList.remove('input-error');
                namaError.style.display = 'none';
            }
            
            // Validasi NIK
            const nik = document.getElementById('nik');
            const nikError = document.getElementById('nikError');
            if (!nik.value.trim()) {
                nik.classList.add('input-error');
                nikError.style.display = 'block';
                isValid = false;
            } else {
                nik.classList.remove('input-error');
                nikError.style.display = 'none';
            }
            
            // Validasi No. KK
            const no_kk = document.getElementById('no_kk');
            const no_kkError = document.getElementById('no_kkError');
            if (!no_kk.value.trim()) {
                no_kk.classList.add('input-error');
                no_kkError.style.display = 'block';
                isValid = false;
            } else {
                no_kk.classList.remove('input-error');
                no_kkError.style.display = 'none';
            }
            
            // Validasi alamat
            const alamat = document.getElementById('alamat');
            const alamatError = document.getElementById('alamatError');
            if (!alamat.value.trim()) {
                alamat.classList.add('input-error');
                alamatError.style.display = 'block';
                isValid = false;
            } else {
                alamat.classList.remove('input-error');
                alamatError.style.display = 'none';
            }
            
            // Validasi desa
            const desa = document.getElementById('desa');
            const desaError = document.getElementById('desaError');
            if (!desa.value) {
                desa.classList.add('input-error');
                desaError.style.display = 'block';
                isValid = false;
            } else {
                desa.classList.remove('input-error');
                desaError.style.display = 'none';
            }
            
            // Validasi jenis bantuan
            const jenis_bantuan = document.getElementById('jenis_bantuan');
            const jenis_bantuanError = document.getElementById('jenis_bantuanError');
            const jenis_bantuan_lainnya = document.getElementById('jenis_bantuan_lainnya');
            
            if (!jenis_bantuan.value) {
                jenis_bantuan.classList.add('input-error');
                jenis_bantuanError.style.display = 'block';
                isValid = false;
            } else if (jenis_bantuan.value === 'LAINNYA' && !jenis_bantuan_lainnya.value.trim()) {
                jenis_bantuan.classList.add('input-error');
                jenis_bantuan_lainnya.classList.add('input-error');
                jenis_bantuanError.textContent = 'Harap isi jenis bantuan lainnya';
                jenis_bantuanError.style.display = 'block';
                isValid = false;
            } else {
                jenis_bantuan.classList.remove('input-error');
                jenis_bantuan_lainnya.classList.remove('input-error');
                jenis_bantuanError.style.display = 'none';
            }
            
            // Validasi jumlah bantuan
            const jumlah_bantuan = document.getElementById('jumlah_bantuan');
            const jumlah_bantuanError = document.getElementById('jumlah_bantuanError');
            if (!jumlah_bantuan.value || parseInt(jumlah_bantuan.value) <= 0) {
                jumlah_bantuan.classList.add('input-error');
                jumlah_bantuanError.style.display = 'block';
                isValid = false;
            } else {
                jumlah_bantuan.classList.remove('input-error');
                jumlah_bantuanError.style.display = 'none';
            }
            
            // Validasi tanggal terima
            const tanggal_terima = document.getElementById('tanggal_terima');
            const tanggal_terimaError = document.getElementById('tanggal_terimaError');
            if (!tanggal_terima.value) {
                tanggal_terima.classList.add('input-error');
                tanggal_terimaError.style.display = 'block';
                isValid = false;
            } else {
                tanggal_terima.classList.remove('input-error');
                tanggal_terimaError.style.display = 'none';
            }
            
            // Validasi nomor telepon (jika diisi)
            const no_telepon = document.getElementById('no_telepon');
            const no_teleponError = document.getElementById('no_teleponError');
            if (no_telepon.value && !/^[0-9]{9,12}$/.test(no_telepon.value)) {
                no_telepon.classList.add('input-error');
                no_teleponError.style.display = 'block';
                isValid = false;
            } else {
                no_telepon.classList.remove('input-error');
                no_teleponError.style.display = 'none';
            }
            
            // Validasi link Google Drive (jika diisi)
            const link_gdrive = document.getElementById('link_gdrive');
            const link_gdriveError = document.getElementById('link_gdriveError');
            if (link_gdrive.value && !isValidURL(link_gdrive.value)) {
                link_gdrive.classList.add('input-error');
                link_gdriveError.style.display = 'block';
                isValid = false;
            } else {
                link_gdrive.classList.remove('input-error');
                link_gdriveError.style.display = 'none';
            }
            
            return isValid;
        }
        
        // Fungsi untuk menerapkan filter
        function terapkanFilter() {
            const filterDesa = document.getElementById('filterDesa').value;
            const filterJenis = document.getElementById('filterJenis').value;
            const filterTglMulai = document.getElementById('filterTglMulai').value;
            const filterTglAkhir = document.getElementById('filterTglAkhir').value;
            
            filteredData = penerimaBantuan.filter(item => {
                // Filter desa
                if (filterDesa && item.desa !== filterDesa) return false;
                
                // Filter jenis bantuan
                if (filterJenis) {
                    if (filterJenis === 'LAINNYA') {
                        // Untuk filter "Lainnya", cocokkan dengan nilai yang tidak ada dalam daftar standard
                        const standardJenis = ['BLT', 'PKH', 'BPNT', 'BST', 'BANSOS'];
                        if (standardJenis.includes(item.jenis_bantuan)) return false;
                    } else if (item.jenis_bantuan !== filterJenis) {
                        return false;
                    }
                }
                
                // Filter tanggal
                if (filterTglMulai && filterTglAkhir) {
                    const tglTerima = new Date(item.tanggal_terima);
                    const tglMulai = new Date(filterTglMulai);
                    const tglAkhir = new Date(filterTglAkhir);
                    
                    if (tglTerima < tglMulai || tglTerima > tglAkhir) return false;
                }
                
                return true;
            });
            
            currentPage = 1;
            renderDataTable();
            
            showNotification(`Filter diterapkan. Ditemukan ${filteredData.length} data.`, 'success');
        }
        
        // Fungsi untuk reset filter
        function resetFilter() {
            document.getElementById('filterDesa').value = '';
            document.getElementById('filterJenis').value = '';
            document.getElementById('filterTglMulai').value = '';
            document.getElementById('filterTglAkhir').value = '';
            
            filteredData = [...penerimaBantuan];
            currentPage = 1;
            renderDataTable();
            
            showNotification('Filter direset ke kondisi semula', 'info');
        }
        
        // Fungsi untuk mengekspor data ke Excel
        function exportToExcel() {
            // Menggunakan library xlsx
            const dataToExport = filteredData.map(item => ({
                'Nama': item.nama,
                'NIK': item.nik,
                'No. KK': item.no_kk,
                'Alamat': item.alamat,
                'Desa': item.desa,
                'Jenis Bantuan': item.jenis_bantuan,
                'Jumlah Bantuan': item.jumlah_bantuan,
                'Tanggal Terima': formatDate(item.tanggal_terima),
                'Keterangan': item.keterangan,
                'No. Telepon': item.no_telepon,
                'Link Google Drive': item.link_gdrive,
                'Kode Validasi': item.kode_validasi
            }));
            
            const worksheet = XLSX.utils.json_to_sheet(dataToExport);
            const workbook = XLSX.utils.book_new();
            XLSX.utils.book_append_sheet(workbook, worksheet, 'Data Penerima Bantuan');
            
            // Generate Excel file
            const excelBuffer = XLSX.write(workbook, { bookType: 'xlsx', type: 'array' });
            saveAsExcel(excelBuffer, 'Data_Penerima_Bantuan.xlsx');
            
            showNotification('Data berhasil diekspor ke Excel', 'success');
        }
        
        // Fungsi untuk menyimpan file Excel
        function saveAsExcel(buffer, filename) {
            const blob = new Blob([buffer], { type: 'application/octet-stream' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = filename;
            a.click();
            URL.revokeObjectURL(url);
        }
        
        // Fungsi untuk mengekspor data ke PDF
        function exportToPDF() {
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF();
            
            // Judul
            doc.setFontSize(18);
            doc.text('DATA PENERIMA BANTUAN', 105, 15, { align: 'center' });
            doc.setFontSize(12);
            doc.text(`Tanggal Ekspor: ${new Date().toLocaleDateString('id-ID')}`, 105, 22, { align: 'center' });
            
            // Data
            const columns = [
                { header: 'No', dataKey: 'no' },
                { header: 'Nama', dataKey: 'nama' },
                { header: 'Desa', dataKey: 'desa' },
                { header: 'Jenis Bantuan', dataKey: 'jenis_bantuan' },
                { header: 'Jumlah', dataKey: 'jumlah_bantuan' },
                { header: 'Tanggal', dataKey: 'tanggal_terima' }
            ];
            
            const data = filteredData.map((item, index) => ({
                no: index + 1,
                nama: item.nama,
                desa: item.desa,
                jenis_bantuan: item.jenis_bantuan,
                jumlah_bantuan: formatCurrency(item.jumlah_bantuan),
                tanggal_terima: formatDate(item.tanggal_terima)
            }));
            
            // Buat tabel
            doc.autoTable({
                columns: columns,
                body: data,
                startY: 30,
                styles: { fontSize: 9 },
                headStyles: { fillColor: [13, 71, 161] },
                alternateRowStyles: { fillColor: [240, 240, 240] }
            });
            
            // Simpan PDF
            doc.save('Data_Penerima_Bantuan.pdf');
            
            showNotification('Data berhasil diekspor ke PDF', 'success');
        }
        
        // Fungsi untuk mencetak data
        function printData() {
            // Buat elemen untuk print
            const printWindow = window.open('', '_blank');
            printWindow.document.write(`
                <!DOCTYPE html>
                <html>
                <head>
                    <title>Cetak Data Penerima Bantuan</title>
                    <style>
                        body { font-family: Arial, sans-serif; margin: 20px; }
                        .print-header { text-align: center; margin-bottom: 20px; }
                        .print-title { font-size: 18px; font-weight: bold; }
                        .print-subtitle { font-size: 14px; }
                        .print-date { text-align: right; font-size: 12px; margin-bottom: 10px; }
                        table { width: 100%; border-collapse: collapse; font-size: 12px; }
                        th, td { border: 1px solid #ddd; padding: 6px; text-align: left; }
                        th { background-color: #0d47a1; color: white; }
                        tr:nth-child(even) { background-color: #f2f2f2; }
                        @media print {
                            @page { size: landscape; margin: 0.5cm; }
                            body { margin: 0; }
                        }
                    </style>
                </head>
                <body>
                    <div class="print-header">
                        <div class="print-title">DATA PENERIMA BANTUAN</div>
                        <div class="print-subtitle">BARJAS - Sistem Bantuan Terpadu</div>
                    </div>
                    <div class="print-date">Dicetak pada: ${new Date().toLocaleDateString('id-ID')} ${new Date().toLocaleTimeString('id-ID')}</div>
                    <table>
                        <thead>
                            <tr>
                                <th>No</th>
                                <th>Nama</th>
                                <th>NIK</th>
                                <th>No. KK</th>
                                <th>Desa</th>
                                <th>Jenis Bantuan</th>
                                <th>Jumlah</th>
                                <th>Tanggal</th>
                            </tr>
                        </thead>
                        <tbody>
            `);
            
            // Isi data
            filteredData.forEach((item, index) => {
                printWindow.document.write(`
                    <tr>
                        <td>${index + 1}</td>
                        <td>${item.nama}</td>
                        <td>${item.nik}</td>
                        <td>${item.no_kk}</td>
                        <td>${item.desa}</td>
                        <td>${item.jenis_bantuan}</td>
                        <td>${formatCurrency(item.jumlah_bantuan)}</td>
                        <td>${formatDate(item.tanggal_terima)}</td>
                    </tr>
                `);
            });
            
            printWindow.document.write(`
                        </tbody>
                    </table>
                </body>
                </html>
            `);
            
            printWindow.document.close();
            printWindow.focus();
            
            setTimeout(() => {
                printWindow.print();
                printWindow.close();
            }, 250);
            
            showNotification('Mempersiapkan cetakan...', 'info');
        }
        
        // Fungsi untuk melihat detail item
        function viewItem(id) {
            const item = penerimaBantuan.find(i => i.id === id);
            if (!item) return;
            
            // Tampilkan modal dengan detail item
            const modalContent = `
                <div class="modal fade" id="viewModal" tabindex="-1">
                    <div class="modal-dialog modal-lg">
                        <div class="modal-content">
                            <div class="modal-header bg-primary text-white">
                                <h5 class="modal-title">Detail Penerima Bantuan</h5>
                                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
                            </div>
                            <div class="modal-body">
                                <div class="row">
                                    <div class="col-md-6">
                                        <h6>Data Pribadi</h6>
                                        <table class="table table-borderless">
                                            <tr>
                                                <th width="40%">Nama</th>
                                                <td>${item.nama}</td>
                                            </tr>
                                            <tr>
                                                <th>NIK</th>
                                                <td>${item.nik}</td>
                                            </tr>
                                            <tr>
                                                <th>No. KK</th>
                                                <td>${item.no_kk}</td>
                                            </tr>
                                            <tr>
                                                <th>Alamat</th>
                                                <td>${item.alamat}</td>
                                            </tr>
                                            <tr>
                                                <th>Desa</th>
                                                <td>${item.desa}</td>
                                            </tr>
                                            ${item.no_telepon ? `
                                            <tr>
                                                <th>No. Telepon/WA</th>
                                                <td>
                                                    ${item.no_telepon} 
                                                    <a href="https://wa.me/${item.no_telepon}" target="_blank" class="btn btn-sm btn-success ms-2">
                                                        <i class="fab fa-whatsapp"></i> WhatsApp
                                                    </a>
                                                </td>
                                            </tr>
                                            ` : ''}
                                        </table>
                                    </div>
                                    <div class="col-md-6">
                                        <h6>Data Bantuan</h6>
                                        <table class="table table-borderless">
                                            <tr>
                                                <th width="40%">Jenis Bantuan</th>
                                                <td><span class="badge bg-primary">${item.jenis_bantuan}</span></td>
                                            </tr>
                                            <tr>
                                                <th>Jumlah Bantuan</th>
                                                <td>${formatCurrency(item.jumlah_bantuan)}</td>
                                            </tr>
                                            <tr>
                                                <th>Tanggal Terima</th>
                                                <td>${formatDate(item.tanggal_terima)}</td>
                                            </tr>
                                            <tr>
                                                <th>Keterangan</th>
                                                <td>${item.keterangan || '-'}</td>
                                            </tr>
                                            <tr>
                                                <th>Kode Validasi</th>
                                                <td><code>${item.kode_validasi}</code></td>
                                            </tr>
                                            ${item.link_gdrive ? `
                                            <tr>
                                                <th>Link Google Drive</th>
                                                <td>
                                                    <a href="${item.link_gdrive}" target="_blank" class="btn btn-sm btn-info">
                                                        <i class="fas fa-external-link-alt"></i> Buka Link
                                                    </a>
                                                </td>
                                            </tr>
                                            ` : ''}
                                        </table>
                                    </div>
                                </div>
                            </div>
                            <div class="modal-footer">
                                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Tutup</button>
                                <button type="button" class="btn btn-primary" onclick="printItem('${item.id}')">
                                    <i class="fas fa-print"></i> Cetak
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            `;
            
            // Tambahkan modal ke body jika belum ada
            if (!document.getElementById('viewModal')) {
                const modalDiv = document.createElement('div');
                modalDiv.innerHTML = modalContent;
                document.body.appendChild(modalDiv);
            } else {
                document.getElementById('viewModal').remove();
                const modalDiv = document.createElement('div');
                modalDiv.innerHTML = modalContent;
                document.body.appendChild(modalDiv);
            }
            
            // Tampilkan modal
            const viewModal = new bootstrap.Modal(document.getElementById('viewModal'));
            viewModal.show();
        }
        
        // Fungsi untuk mencetak item tertentu
        function printItem(id) {
            const item = penerimaBantuan.find(i => i.id === id);
            if (!item) return;
            
            const printWindow = window.open('', '_blank');
            printWindow.document.write(`
                <!DOCTYPE html>
                <html>
                <head>
                    <title>Cetak Data Penerima - ${item.nama}</title>
                    <style>
                        body { font-family: Arial, sans-serif; margin: 20px; }
                        .header { text-align: center; margin-bottom: 20px; }
                        .title { font-size: 18px; font-weight: bold; }
                        .subtitle { font-size: 14px; }
                        .print-date { text-align: right; font-size: 12px; margin-bottom: 20px; }
                        table { width: 100%; border-collapse: collapse; margin-bottom: 20px; }
                        th, td { border: 1px solid #ddd; padding: 8px; text-align: left; }
                        th { background-color: #f2f2f2; width: 30%; }
                        .footer { margin-top: 30px; text-align: right; }
                        .signature { margin-top: 60px; }
                        @media print {
                            body { margin: 0; }
                        }
                    </style>
                </head>
                <body>
                    <div class="header">
                        <div class="title">DATA PENERIMA BANTUAN</div>
                        <div class="subtitle">BARJAS - Sistem Bantuan Terpadu</div>
                    </div>
                    <div class="print-date">Dicetak pada: ${new Date().toLocaleDateString('id-ID')}</div>
                    
                    <h4>Data Pribadi</h4>
                    <table>
                        <tr>
                            <th>Nama Lengkap</th>
                            <td>${item.nama}</td>
                        </tr>
                        <tr>
                            <th>NIK</th>
                            <td>${item.nik}</td>
                        </tr>
                        <tr>
                            <th>No. Kartu Keluarga</th>
                            <td>${item.no_kk}</td>
                        </tr>
                        <tr>
                            <th>Alamat</th>
                            <td>${item.alamat}</td>
                        </tr>
                        <tr>
                            <th>Desa</th>
                            <td>${item.desa}</td>
                        </tr>
                        <tr>
                            <th>No. Telepon/WhatsApp</th>
                            <td>${item.no_telepon || '-'}</td>
                        </tr>
                    </table>
                    
                    <h4>Data Bantuan</h4>
                    <table>
                        <tr>
                            <th>Jenis Bantuan</th>
                            <td>${item.jenis_bantuan}</td>
                        </tr>
                        <tr>
                            <th>Jumlah Bantuan</th>
                            <td>${formatCurrency(item.jumlah_bantuan)}</td>
                        </tr>
                        <tr>
                            <th>Tanggal Penerimaan</th>
                            <td>${formatDate(item.tanggal_terima)}</td>
                        </tr>
                        <tr>
                            <th>Keterangan</th>
                            <td>${item.keterangan || '-'}</td>
                        </tr>
                        <tr>
                            <th>Kode Validasi</th>
                            <td><strong>${item.kode_validasi}</strong></td>
                        </tr>
                    </table>
                    
                    <div class="footer">
                        <div class="signature">
                            <div>Situbondo, ${new Date().toLocaleDateString('id-ID')}</div>
                            <br><br><br>
                            <div>_________________________</div>
                            <div>Petugas</div>
                        </div>
                    </div>
                </body>
                </html>
            `);
            
            printWindow.document.close();
            printWindow.focus();
            
            setTimeout(() => {
                printWindow.print();
                // printWindow.close();
            }, 250);
        }
        
        // Fungsi untuk mengedit item
        function editItem(id) {
            // Implementasi edit item
            showNotification('Fitur edit akan segera tersedia', 'info');
        }
        
        // Fungsi untuk menghapus item
        function deleteItem(id) {
            if (!confirm('Apakah Anda yakin ingin menghapus data ini?')) return;
            
            const index = penerimaBantuan.findIndex(item => item.id === id);
            if (index !== -1) {
                penerimaBantuan.splice(index, 1);
                localStorage.setItem('penerimaBantuan', JSON.stringify(penerimaBantuan));
                loadData();
                updateDashboard();
                initDashboardCharts();
                showNotification('Data berhasil dihapus', 'success');
            }
        }
        
        // Fungsi untuk memperbarui chart statistik
        function updateStatistikChart() {
            const chartType = document.getElementById('chartType').value;
            const chartBy = document.getElementById('chartBy').value;
            
            let labels = [];
            let data = [];
            let labelText = '';
            
            if (chartBy === 'desa') {
                const desaData = getDataByDesa();
                labels = desaData.map(item => item.desa);
                data = desaData.map(item => item.count);
                labelText = 'Jumlah Penerima per Desa';
            } else if (chartBy === 'jenis') {
                const jenisData = getDataByJenisBantuan();
                labels = jenisData.map(item => item.jenis);
                data = jenisData.map(item => item.count);
                labelText = 'Jumlah Penerima per Jenis Bantuan';
            } else if (chartBy === 'bulan') {
                const bulanData = getDataByBulan();
                labels = bulanData.map(item => item.bulan);
                data = bulanData.map(item => item.count);
                labelText = 'Jumlah Penerima per Bulan';
            }
            
            // Hapus chart sebelumnya jika ada
            const ctx = document.getElementById('statistikChart').getContext('2d');
            if (currentChart) {
                currentChart.destroy();
            }
            
            // Buat chart baru
            currentChart = new Chart(ctx, {
                type: chartType,
                data: {
                    labels: labels,
                    datasets: [{
                        label: labelText,
                        data: data,
                        backgroundColor: [
                            'rgba(255, 99, 132, 0.7)',
                            'rgba(54, 162, 235, 0.7)',
                            'rgba(255, 206, 86, 0.7)',
                            'rgba(75, 192, 192, 0.7)',
                            'rgba(153, 102, 255, 0.7)',
                            'rgba(255, 159, 64, 0.7)',
                            'rgba(199, 199, 199, 0.7)',
                            'rgba(83, 102, 255, 0.7)',
                            'rgba(40, 159, 64, 0.7)',
                            'rgba(210, 99, 132, 0.7)'
                        ],
                        borderColor: [
                            'rgba(255, 99, 132, 1)',
                            'rgba(54, 162, 235, 1)',
                            'rgba(255, 206, 86, 1)',
                            'rgba(75, 192, 192, 1)',
                            'rgba(153, 102, 255, 1)',
                            'rgba(255, 159, 64, 1)',
                            'rgba(199, 199, 199, 1)',
                            'rgba(83, 102, 255, 1)',
                            'rgba(40, 159, 64, 1)',
                            'rgba(210, 99, 132, 1)'
                        ],
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: {
                            position: 'top',
                        },
                        title: {
                            display: true,
                            text: `Grafik Data Penerima Bantuan Berdasarkan ${chartBy.toUpperCase()}`
                        }
                    }
                }
            });
            
            // Perbarui tabel statistik
            updateStatistikTable(chartBy);
            
            showNotification('Grafik berhasil diperbarui', 'success');
        }
        
        // Fungsi untuk memperbarui tabel statistik
        function updateStatistikTable(by) {
            const tableBody = document.querySelector('#statistikTable tbody');
            tableBody.innerHTML = '';
            
            let data = [];
            
            if (by === 'desa') {
                data = getDataByDesa();
            } else if (by === 'jenis') {
                data = getDataByJenisBantuan();
            } else if (by === 'bulan') {
                data = getDataByBulan();
            }
            
            // Hitung total
            const totalPenerima = data.reduce((sum, item) => sum + item.count, 0);
            const totalBantuan = data.reduce((sum, item) => sum + item.total, 0);
            
            data.forEach(item => {
                const percentage = ((item.count / totalPenerima) * 100).toFixed(1);
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${by === 'bulan' ? item.bulan : item[by]}</td>
                    <td>${item.count}</td>
                    <td>${formatCurrency(item.total)}</td>
                    <td>${formatCurrency(Math.round(item.total / item.count))}</td>
                    <td>${percentage}%</td>
                `;
                tableBody.appendChild(row);
            });
            
            // Tambahkan baris total
            const totalRow = document.createElement('tr');
            totalRow.classList.add('table-primary');
            totalRow.innerHTML = `
                <td><strong>TOTAL</strong></td>
                <td><strong>${totalPenerima}</strong></td>
                <td><strong>${formatCurrency(totalBantuan)}</strong></td>
                <td><strong>${formatCurrency(Math.round(totalBantuan / totalPenerima))}</strong></td>
                <td><strong>100%</strong></td>
            `;
            tableBody.appendChild(totalRow);
        }
        
        // Fungsi untuk mendapatkan data berdasarkan desa
        function getDataByDesa() {
            const result = {};
            
            penerimaBantuan.forEach(item => {
                if (!result[item.desa]) {
                    result[item.desa] = {
                        desa: item.desa,
                        count: 0,
                        total: 0
                    };
                }
                result[item.desa].count++;
                result[item.desa].total += item.jumlah_bantuan;
            });
            
            return Object.values(result).sort((a, b) => b.count - a.count);
        }
        
        // Fungsi untuk mendapatkan data berdasarkan jenis bantuan
        function getDataByJenisBantuan() {
            const result = {};
            
            penerimaBantuan.forEach(item => {
                if (!result[item.jenis_bantuan]) {
                    result[item.jenis_bantuan] = {
                        jenis: item.jenis_bantuan,
                        count: 0,
                        total: 0
                    };
                }
                result[item.jenis_bantuan].count++;
                result[item.jenis_bantuan].total += item.jumlah_bantuan;
            });
            
            return Object.values(result).sort((a, b) => b.count - a.count);
        }
        
        // Fungsi untuk mendapatkan data berdasarkan bulan
        function getDataByBulan() {
            const result = {};
            const monthNames = [
                'Januari', 'Februari', 'Maret', 'April', 'Mei', 'Juni',
                'Juli', 'Agustus', 'September', 'Oktober', 'November', 'Desember'
            ];
            
            penerimaBantuan.forEach(item => {
                const date = new Date(item.tanggal_terima);
                const monthYear = `${monthNames[date.getMonth()]} ${date.getFullYear()}`;
                
                if (!result[monthYear]) {
                    result[monthYear] = {
                        bulan: monthYear,
                        count: 0,
                        total: 0
                    };
                }
                result[monthYear].count++;
                result[monthYear].total += item.jumlah_bantuan;
            });
            
            return Object.values(result).sort((a, b) => {
                // Urutkan berdasarkan tanggal
                const [monthA, yearA] = a.bulan.split(' ');
                const [monthB, yearB] = b.bulan.split(' ');
                
                const dateA = new Date(`${yearA}-${monthNames.indexOf(monthA) + 1}-01`);
                const dateB = new Date(`${yearB}-${monthNames.indexOf(monthB) + 1}-01`);
                
                return dateA - dateB;
            });
        }
        
        // Fungsi untuk menampilkan notifikasi
        function showNotification(message, type = 'info') {
            const toast = document.getElementById('notificationToast');
            const toastMessage = document.getElementById('toastMessage');
            
            // Set warna berdasarkan jenis notifikasi
            const toastHeader = toast.querySelector('.toast-header');
            toastHeader.className = 'toast-header';
            
            switch (type) {
                case 'success':
                    toastHeader.classList.add('bg-success', 'text-white');
                    break;
                case 'error':
                    toastHeader.classList.add('bg-danger', 'text-white');
                    break;
                case 'warning':
                    toastHeader.classList.add('bg-warning');
                    break;
                default:
                    toastHeader.classList.add('bg-primary', 'text-white');
            }
            
            // Set pesan
            toastMessage.textContent = message;
            
            // Tampilkan notifikasi
            const bsToast = new bootstrap.Toast(toast);
            bsToast.show();
        }
        
        // Fungsi untuk memformat tanggal
        function formatDate(dateString) {
            const date = new Date(dateString);
            return date.toLocaleDateString('id-ID', {
                day: '2-digit',
                month: '2-digit',
                year: 'numeric'
            });
        }
        
        // Fungsi untuk memformat mata uang
        function formatCurrency(amount) {
            return new Intl.NumberFormat('id-ID', {
                style: 'currency',
                currency: 'IDR',
                minimumFractionDigits: 0
            }).format(amount);
        }
        
        // Fungsi untuk memvalidasi URL
        function isValidURL(string) {
            try {
                new URL(string);
                return true;
            } catch (_) {
                return false;
            }
        }
        
        // Inisialisasi aplikasi setelah halaman dimuat
        document.addEventListener('DOMContentLoaded', function() {
            // Inisialisasi tooltip Bootstrap
            const tooltipTriggerList = [].slice.call(document.querySelectorAll('[data-bs-toggle="tooltip"]'));
            tooltipTriggerList.map(function (tooltipTriggerEl) {
                return new bootstrap.Tooltip(tooltipTriggerEl);
            });
            
            // Inisialisasi aplikasi
            initApp();
        });
        
        // Fungsi untuk mengatasi masalah responsivitas pada perangkat mobile
        function handleMobileView() {
            if (window.innerWidth < 992) {
                // Mobile view
                document.getElementById('sidebarMenu').classList.remove('mobile-show');
            } else {
                // Desktop view
                document.getElementById('sidebarMenu').classList.remove('mobile-show');
                document.getElementById('sidebarOverlay').classList.remove('mobile-show');
            }
        }
        
        // Event listener untuk resize window
        window.addEventListener('resize', handleMobileView);
        
        // Panggil sekali saat pertama kali dimuat
        handleMobileView();
    </script>
</body>
</html>
