<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>APLIKASI BARJAS - SISTEM BANTUAN</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-datepicker/1.9.0/css/bootstrap-datepicker.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.28/jspdf.plugin.autotable.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <style>
        :root {
            --primary-color: #0d47a1;
            --secondary-color: #00695c;
            --accent-color: #ff8f00;
            --light-blue: #e3f2fd;
            --dark-blue: #082e5c;
            --gradient-primary: linear-gradient(135deg, var(--primary-color), var(--dark-blue));
            --gradient-secondary: linear-gradient(135deg, var(--secondary-color), #004d40);
            --gradient-accent: linear-gradient(135deg, var(--accent-color), #e65100);
            --shadow-sm: 0 2px 8px rgba(0,0,0,0.08);
            --shadow-md: 0 4px 16px rgba(0,0,0,0.12);
            --shadow-lg: 0 8px 28px rgba(0,0,0,0.15);
            --login-gradient: linear-gradient(135deg, #0d47a1, #00695c, #ff8f00);
        }
        
        body {
            background: linear-gradient(135deg, #f5f9ff 0%, #e8f5e9 100%);
            font-family: 'Poppins', 'Segoe UI', sans-serif;
            min-height: 100vh;
            padding: 10px 0;
            overflow-x: hidden;
        }
        
        .app-container {
            max-width: 1600px;
            margin: 0 auto;
            background: white;
            box-shadow: var(--shadow-lg);
            border-radius: 12px;
            overflow: hidden;
            position: relative;
            z-index: 10;
        }
        
        .app-header {
            background: var(--gradient-primary);
            color: white;
            padding: 20px 15px;
            text-align: center;
            position: relative;
            overflow: hidden;
        }
        
        .app-header::before {
            content: "";
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(255,255,255,0.15) 0%, transparent 70%);
            pointer-events: none;
        }
        
        .app-logo {
            font-size: 2.5rem;
            margin-bottom: 10px;
            position: relative;
            z-index: 1;
        }
        
        .app-title {
            font-size: 1.8rem;
            font-weight: 800;
            margin: 0;
            position: relative;
            z-index: 1;
            text-shadow: 1px 1px 4px rgba(0,0,0,0.3);
        }
        
        .app-subtitle {
            font-size: 1rem;
            opacity: 0.95;
            position: relative;
            z-index: 1;
            font-weight: 300;
            letter-spacing: 0.5px;
            margin-bottom: 5px;
        }
        
        .nav-pills .nav-link {
            border-radius: 8px;
            margin-bottom: 8px;
            padding: 12px 15px;
            font-weight: 500;
            color: #444;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            font-size: 0.9rem;
        }
        
        .nav-pills .nav-link:hover {
            background-color: #f0f7ff;
            transform: translateX(3px);
        }
        
        .nav-pills .nav-link.active {
            background: var(--gradient-primary);
            font-weight: 600;
            box-shadow: var(--shadow-md);
            transform: translateX(3px);
            color: white;
        }
        
        .section-title {
            border-left: 4px solid var(--primary-color);
            padding-left: 12px;
            margin: 20px 0;
            font-weight: 700;
            color: var(--dark-blue);
            font-size: 1.4rem;
            position: relative;
        }
        
        .section-title::after {
            content: "";
            position: absolute;
            bottom: -5px;
            left: 12px;
            width: 40px;
            height: 2px;
            background: var(--gradient-primary);
            border-radius: 2px;
        }
        
        .btn-primary {
            background: var(--gradient-primary);
            border: none;
            padding: 10px 20px;
            font-weight: 600;
            box-shadow: var(--shadow-md);
            border-radius: 8px;
            transition: all 0.3s;
            font-size: 0.9rem;
        }
        
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-lg);
        }
        
        .btn-success {
            background: var(--gradient-secondary);
            border: none;
            padding: 10px 20px;
            font-weight: 600;
            box-shadow: var(--shadow-md);
            border-radius: 8px;
            transition: all 0.3s;
            font-size: 0.9rem;
        }
        
        .btn-success:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-lg);
        }
        
        .btn-warning {
            background: var(--gradient-accent);
            border: none;
            padding: 10px 20px;
            font-weight: 600;
            box-shadow: var(--shadow-md);
            border-radius: 8px;
            transition: all 0.3s;
            font-size: 0.9rem;
        }
        
        .btn-warning:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-lg);
        }
        
        .form-label {
            font-weight: 600;
            color: #444;
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            font-size: 0.9rem;
        }
        
        .form-label i {
            margin-right: 6px;
            color: var(--primary-color);
        }
        
        .form-control, .form-select {
            border-radius: 8px;
            padding: 12px 15px;
            border: 1px solid #ddd;
            transition: all 0.3s;
            box-shadow: var(--shadow-sm);
            font-size: 0.9rem;
        }
        
        .form-control:focus, .form-select:focus {
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(13, 71, 161, 0.2);
            transform: translateY(-2px);
        }
        
        .copyright {
            text-align: center;
            padding: 20px;
            background-color: var(--light-blue);
            color: var(--dark-blue);
            font-size: 0.9rem;
            font-weight: 500;
        }
        
        .data-table {
            font-size: 0.85rem;
            border-collapse: separate;
            border-spacing: 0;
            box-shadow: var(--shadow-sm);
            border-radius: 8px;
            overflow: hidden;
        }
        
        .data-table th {
            background: var(--gradient-primary);
            color: white;
            font-weight: 600;
            padding: 12px 10px;
            text-align: center;
            position: relative;
            font-size: 0.85rem;
        }
        
        .data-table th::after {
            content: "";
            position: absolute;
            bottom: 0;
            left: 0;
            width: 100%;
            height: 1px;
            background: rgba(255,255,255,0.3);
        }
        
        .data-table td {
            padding: 10px 8px;
            vertical-align: middle;
            border-bottom: 1px solid #eee;
            font-size: 0.85rem;
        }
        
        .data-table tr:nth-child(even) {
            background-color: #f9fbff;
        }
        
        .data-table tr:hover {
            background-color: #edf5ff;
        }
        
        .feature-icon {
            font-size: 1.1rem;
            margin-right: 8px;
            width: 24px;
            text-align: center;
        }
        
        .card {
            border-radius: 10px;
            border: none;
            box-shadow: var(--shadow-md);
            transition: all 0.3s ease;
            overflow: hidden;
            margin-bottom: 15px;
        }
        
        .card:hover {
            transform: translateY(-5px);
            box-shadow: var(--shadow-lg);
        }
        
        .card-header {
            border-radius: 10px 10px 0 0 !important;
            font-weight: 600;
            padding: 15px 20px;
            background: var(--gradient-primary);
            color: white;
            font-size: 0.95rem;
        }
        
        .stats-box {
            text-align: center;
            padding: 20px 15px;
            border-radius: 10px;
            background: white;
            box-shadow: var(--shadow-md);
            transition: all 0.3s;
            position: relative;
            overflow: hidden;
            margin-bottom: 15px;
        }
        
        .stats-box::before {
            content: "";
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 4px;
            background: var(--gradient-primary);
            border-radius: 2px;
        }
        
        .stats-box:hover {
            transform: translateY(-3px);
            box-shadow: var(--shadow-lg);
        }
        
        .stats-number {
            font-size: 1.8rem;
            font-weight: 800;
            color: var(--primary-color);
            margin: 10px 0;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.1);
        }
        
        .stats-label {
            font-size: 0.9rem;
            color: #666;
            font-weight: 500;
        }
        
        .notification-toast {
            position: fixed;
            bottom: 20px;
            right: 20px;
            z-index: 1050;
            min-width: 280px;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: var(--shadow-lg);
            max-width: calc(100vw - 40px);
        }
        
        .input-error {
            border-color: #dc3545;
            box-shadow: 0 0 0 3px rgba(220, 53, 69, 0.2);
        }
        
        .error-message {
            color: #dc3545;
            font-size: 0.8rem;
            margin-top: 5px;
            display: none;
            font-weight: 500;
        }
        
        .watermark {
            position: absolute;
            bottom: 10px;
            right: 15px;
            opacity: 0.8;
            font-size: 0.8rem;
            color: white;
            font-weight: 300;
        }
        
        .control-panel {
            background: #f8f9fa;
            border-radius: 8px;
            padding: 15px;
            margin-top: 15px;
            box-shadow: var(--shadow-sm);
        }
        
        .control-title {
            font-size: 1rem;
            color: var(--primary-color);
            font-weight: 600;
            margin-bottom: 15px;
            padding-bottom: 8px;
            border-bottom: 1px solid var(--light-blue);
        }
        
        .floating-action-btn {
            position: fixed;
            bottom: 20px;
            right: 20px;
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background: var(--gradient-primary);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: var(--shadow-lg);
            z-index: 1000;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .floating-action-btn:hover {
            transform: scale(1.1) rotate(90deg);
        }
        
        .filter-section {
            background: white;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 20px;
            box-shadow: var(--shadow-sm);
        }
        
        .badge-custom {
            background: var(--gradient-primary);
            color: white;
            padding: 6px 12px;
            border-radius: 16px;
            font-weight: 600;
            font-size: 0.8rem;
        }
        
        .mobile-menu-btn {
            display: none;
            position: fixed;
            top: 15px;
            left: 15px;
            z-index: 1050;
            background: var(--gradient-primary);
            color: white;
            border: none;
            border-radius: 50%;
            width: 45px;
            height: 45px;
            box-shadow: var(--shadow-lg);
        }
        
        .sidebar-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 1040;
        }
        
        /* Animations */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .animate-fadeIn {
            animation: fadeIn 0.5s ease forwards;
        }
        
        /* Custom scrollbar */
        ::-webkit-scrollbar {
            width: 6px;
        }
        
        ::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 8px;
        }
        
        ::-webkit-scrollbar-thumb {
            background: var(--primary-color);
            border-radius: 8px;
        }
        
        ::-webkit-scrollbar-thumb:hover {
            background: var(--dark-blue);
        }
        
        /* Responsive styles */
        @media (max-width: 991.98px) {
            .col-md-3.col-lg-2 {
                position: fixed;
                left: -300px;
                top: 0;
                bottom: 0;
                z-index: 1050;
                width: 280px;
                transition: left 0.3s ease;
                overflow-y: auto;
                padding-top: 60px;
            }
            
            .col-md-3.col-lg-2.mobile-show {
                left: 0;
            }
            
            .col-md-9.col-lg-10 {
                width: 100%;
                flex: 0 0 100%;
                max-width: 100%;
            }
            
            .mobile-menu-btn {
                display: flex;
                align-items: center;
                justify-content: center;
            }
            
            .sidebar-overlay.mobile-show {
                display: block;
            }
        }
        
        /* Print Styles - IMPROVED FOR LANDSCAPE */
        @media print {
            @page {
                size: landscape;
                margin: 0.5cm;
            }
            
            body * {
                visibility: hidden;
            }
            
            .app-container, .app-container * {
                visibility: visible;
            }
            
            .app-container {
                position: absolute;
                left: 0;
                top: 0;
                width: 100%;
                box-shadow: none;
            }
            
            .nav-pills, .mobile-menu-btn, .sidebar-overlay, .floating-action-btn,
            .btn-group, .filter-section, .toast {
                display: none !important;
            }
            
            .col-md-3.col-lg-2.p-4.bg-light {
                display: none !important;
            }
            
            .col-md-9.col-lg-10.p-5 {
                width: 100%;
                flex: 0 0 100%;
                max-width: 100%;
                padding: 0 !important;
            }
            
            .copyright {
                display: none;
            }
            
            .data-table {
                font-size: 10px;
                width: 100% !important;
            }
            
            .data-table th, .data-table td {
                padding: 4px 2px;
            }
            
            /* Sembunyikan kolom aksi dan link Google Drive saat mencetak */
            .data-table th:last-child,
            .data-table td:last-child {
                display: none !important;
            }
            
            /* Judul untuk laporan cetak */
            .print-header {
                display: block !important;
                text-align: center;
                margin-bottom: 15px;
            }
            
            .print-title {
                font-size: 18px;
                font-weight: bold;
                margin-bottom: 5px;
            }
            
            .print-subtitle {
                font-size: 14px;
                margin-bottom: 10px;
            }
            
            .print-date {
                font-size: 12px;
                text-align: right;
                margin-bottom: 10px;
            }
        }

        /* WhatsApp link style */
        .whatsapp-link {
            color: #25D366;
            text-decoration: none;
        }
        
        .whatsapp-link:hover {
            text-decoration: underline;
        }
        
        /* View Link Button */
        .btn-view {
            background: linear-gradient(135deg, #17a2b8, #138496);
            color: white;
            border: none;
            padding: 5px 10px;
            border-radius: 4px;
            font-size: 0.8rem;
        }
        
        .btn-view:hover {
            background: linear-gradient(135deg, #138496, #117a8b);
            color: white;
        }
        
        /* Undo Button */
        .btn-undo {
            background: linear-gradient(135deg, #6c757d, #5a6268);
            color: white;
            border: none;
        }
        
        .btn-undo:hover {
            background: linear-gradient(135deg, #5a6268, #4e555b);
            color: white;
        }
        
        /* WhatsApp number link in table */
        .whatsapp-number {
            color: #25D366;
            cursor: pointer;
            text-decoration: underline;
        }
        
        /* Welcome Modal Styles */
        .welcome-modal .modal-content {
            border-radius: 15px;
            overflow: hidden;
            border: none;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }
        
        .welcome-header {
            background: var(--gradient-primary);
            color: white;
            text-align: center;
            padding: 25px;
        }
        
        .welcome-icon {
            font-size: 3rem;
            margin-bottom: 15px;
            color: white;
        }
        
        .welcome-body {
            padding: 25px;
            text-align: center;
        }
        
        .welcome-footer {
            background: #f8f9fa;
            padding: 15px;
            text-align: center;
            border-top: 1px solid #eee;
        }
        
        .countdown-timer {
            font-size: 0.9rem;
            color: #6c757d;
            margin-top: 10px;
        }
        
        /* Button untuk cetak per data */
        .btn-print-individual {
            background: linear-gradient(135deg, #6f42c1, #5a2d95);
            color: white;
            border: none;
            padding: 5px 10px;
            border-radius: 4px;
            font-size: 0.8rem;
        }
        
        .btn-print-individual:hover {
            background: linear-gradient(135deg, #5a2d95, #4a2479);
            color: white;
        }
        
        /* Developer Info Styles */
        .developer-info {
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            border-radius: 10px;
            padding: 15px;
            margin-top: 20px;
            box-shadow: var(--shadow-sm);
        }
        
        .developer-info h6 {
            color: var(--primary-color);
            font-weight: 600;
            margin-bottom: 15px;
            padding-bottom: 8px;
            border-bottom: 1px solid #ddd;
        }
        
        .developer-contact p {
            margin-bottom: 8px;
            font-size: 0.85rem;
        }
        
        .developer-contact a {
            color: var(--primary-color);
            text-decoration: none;
            transition: all 0.3s;
        }
        
        .developer-contact a:hover {
            color: var(--dark-blue);
            text-decoration: underline;
        }
        
        /* Welcome Splash Screen */
        .welcome-splash {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: var(--gradient-primary);
            color: white;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 9999;
            transition: opacity 0.5s ease;
        }
        
        .welcome-splash-content {
            text-align: center;
            max-width: 600px;
            padding: 30px;
        }
        
        .welcome-splash-logo {
            font-size: 4rem;
            margin-bottom: 20px;
        }
        
        .welcome-splash-title {
            font-size: 2.2rem;
            font-weight: 800;
            margin-bottom: 15px;
        }
        
        .welcome-splash-message {
            font-size: 1.1rem;
            line-height: 1.6;
            margin-bottom: 25px;
        }
        
        .welcome-splash-countdown {
            font-size: 1rem;
            margin-top: 20px;
        }
        
        .welcome-splash-close {
            position: absolute;
            top: 20px;
            right: 20px;
            background: rgba(255,255,255,0.2);
            border: none;
            color: white;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .welcome-splash-close:hover {
            background: rgba(255,255,255,0.3);
            transform: rotate(90deg);
        }
        
        /* Loading spinner */
        .spinner-border-sm {
            width: 1rem;
            height: 1rem;
        }

        /* Login Modal Styles */
        .login-modal .modal-content {
            border-radius: 15px;
            overflow: hidden;
            border: none;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
        }

        .login-header {
            background: var(--login-gradient);
            color: white;
            text-align: center;
            padding: 25px 20px;
            position: relative;
        }

        .login-icon {
            font-size: 3rem;
            margin-bottom: 15px;
            color: white;
        }

        .login-title {
            font-size: 1.8rem;
            font-weight: 700;
            margin: 0;
        }

        .login-subtitle {
            font-size: 1rem;
            opacity: 0.9;
            margin: 5px 0 0;
        }

        .login-body {
            padding: 25px;
            position: relative;
            z-index: 1;
        }

        .login-form-group {
            margin-bottom: 20px;
        }

        .login-form-label {
            font-weight: 600;
            color: var(--dark-blue);
            margin-bottom: 8px;
            display: flex;
            align-items: center;
        }

        .login-form-label i {
            margin-right: 10px;
            color: var(--dark-blue);
        }

        .login-form-control {
            border-radius: 8px;
            padding: 12px 15px;
            border: 2px solid #ddd;
            transition: all 0.3s;
        }

        .login-form-control:focus {
            border-color: var(--dark-blue);
            box-shadow: 0 0 0 3px rgba(13, 71, 161, 0.2);
        }

        .login-input-group-text {
            background: var(--light-blue);
            border: 2px solid #ddd;
            border-left: none;
        }

        .btn-login {
            background: var(--gradient-secondary);
            color: white;
            border: none;
            padding: 12px;
            font-weight: 600;
            border-radius: 8px;
            width: 100%;
            transition: all 0.3s;
            margin-top: 10px;
        }

        .btn-login:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 105, 92, 0.4);
        }

        .btn-login:disabled {
            background: #ccc;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        .login-security-notice {
            text-align: center;
            margin-top: 20px;
            font-size: 0.85rem;
            color: #666;
        }

        .login-attempts-count {
            text-align: center;
            font-size: 0.9rem;
            color: #ff8f00;
            font-weight: 500;
            margin-top: 5px;
        }

        .login-blocked-message {
            text-align: center;
            background: rgba(220, 53, 69, 0.1);
            border-radius: 8px;
            padding: 15px;
            margin-top: 20px;
            color: #dc3545;
            font-weight: 500;
        }

        .login-countdown {
            font-size: 1.2rem;
            font-weight: 700;
            color: var(--dark-blue);
        }

        .login-developer-info {
            background: var(--light-blue);
            border-radius: 10px;
            padding: 20px;
            margin-top: 25px;
            text-align: center;
        }

        .login-developer-logo {
            max-width: 180px;
            margin-bottom: 15px;
            border-radius: 8px;
        }

        .login-developer-contact a {
            color: var(--dark-blue);
            text-decoration: none;
            transition: all 0.3s;
            display: inline-block;
            margin: 5px 0;
        }

        .login-developer-contact a:hover {
            color: var(--primary-color);
            text-decoration: underline;
            transform: translateY(-2px);
        }

        .login-copyright {
            text-align: center;
            margin-top: 20px;
            color: #666;
            font-size: 0.9rem;
            opacity: 0.9;
        }

        /* Animations */
        @keyframes login-shake {
            0%, 100% { transform: translateX(0); }
            10%, 30%, 50%, 70%, 90% { transform: translateX(-10px); }
            20%, 40%, 60%, 80% { transform: translateX(10px); }
        }

        .login-shake {
            animation: login-shake 0.6s cubic-bezier(.36,.07,.19,.97) both;
        }

        /* Login particle background */
        #login-particles {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 1040; /* Higher than modal backdrop */
            display: none;
        }

        /* Link Google Drive dalam tabel */
        .drive-link {
            color: #0d47a1;
            text-decoration: none;
            cursor: pointer;
        }

        .drive-link:hover {
            text-decoration: underline;
        }

        /* Modal untuk menambah link */
        .link-modal .modal-dialog {
            max-width: 600px;
        }
        
        /* App content when not authenticated */
        .app-content-unauthenticated {
            display: none;
        }

        /* Search box for desa dropdown */
        .dropdown-search-container {
            position: relative;
        }

        .dropdown-search {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            z-index: 1000;
            background: white;
            border: 1px solid #ddd;
            border-radius: 8px;
            padding: 8px;
            display: none;
        }

        .dropdown-search input {
            width: 100%;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
        }

        /* Kode Validasi Styles */
        .kode-validasi-container {
            display: flex;
            align-items: center;
        }
        
        .kode-validasi-input {
            flex: 1;
            margin-right: 10px;
        }
        
        .btn-generate-kode {
            white-space: nowrap;
        }
    </style>
</head>
<body>
    <!-- Login Modal -->
    <div class="modal fade login-modal" id="loginModal" tabindex="-1" aria-hidden="true" data-bs-backdrop="static" data-bs-keyboard="false">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="login-header">
                    <div class="login-icon">
                        <i class="fas fa-lock"></i>
                    </div>
                    <h2 class="login-title">AUTHENTICATION REQUIRED</h2>
                    <p class="login-subtitle">Masukkan Kode Keamanan untuk Mengakses Aplikasi</p>
                </div>
                <div class="login-body">
                    <form id="loginForm">
                        <div class="mb-3 login-form-group">
                            <label class="form-label login-form-label">
                                <i class="fas fa-key"></i> Kode Keamanan
                            </label>
                            <div class="input-group">
                                <input type="password" class="form-control login-form-control" id="securityCode" placeholder="Masukkan kode akses aplikasi">
                                <button class="btn btn-outline-secondary toggle-password" type="button">
                                    <i class="fas fa-eye"></i>
                                </button>
                            </div>
                            <div class="form-text text-danger login-attempts-count" id="attemptsCount"></div>
                        </div>
                        <button type="submit" class="btn btn-login" id="loginButton">
                            <span class="login-button-text">Masuk ke Aplikasi</span>
                            <span class="spinner-border spinner-border-sm d-none" id="loginSpinner"></span>
                        </button>
                    </form>
                    
                    <div class="login-blocked-message d-none" id="blockedMessage">
                        <i class="fas fa-ban me-2"></i>
                        <span id="blockedText">Terlalu banyak percobaan gagal. Silakan coba lagi dalam </span>
                        <span class="login-countdown" id="countdown">30</span> detik.
                    </div>
                    
                    <div class="login-security-notice">
                        <i class="fas fa-info-circle me-2"></i>
                        Hubungi Administrator untuk mendapatkan kode akses
                    </div>
                    
                    <div class="login-developer-info">
                        <h5 class="mb-3">Developer Information</h5>
                        <div class="login-developer-contact">
                            <p><i class="fab fa-whatsapp me-2"></i> <a href="https://wa.me/6285647709114" target="_blank">+62 856-4770-9114</a></p>
                            <p><i class="fas fa-envelope me-2"></i> <a href="mailto:admin@anekamarket.my.id">admin@anekamarket.my.id</a></p>
                        </div>
                    </div>
                    
                    <div class="login-copyright">
                        &copy; 2025 Lentera karya Situbondo
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Login particle background -->
    <div id="login-particles"></div>
    
    <!-- Welcome Splash Screen -->
    <div class="welcome-splash" id="welcomeSplash">
        <button class="welcome-splash-close" id="closeSplash">
            <i class="fas fa-times"></i>
        </button>
        <div class="welcome-splash-content">
            <div class="welcome-splash-logo">
                <i class="fas fa-hands-helping"></i>
            </div>
            <h1 class="welcome-splash-title">SISTEM BANTUAN BARJAS</h1>
            <p class="welcome-splash-message">
                Aplikasi Sistem Bantuan BARJAS merupakan platform terpadu yang dirancang untuk mentransformasi pendataan, penyaluran, 
                dan monitoring program bantuan pemerintah. Aplikasi ini kami ciptakan untuk mendorong efisiensi, akurasi, 
                dan transparansi dalam pengelolaan bantuan, guna mempercepat penyerapan dan meningkatkan akuntabilitas.
            </p>
            <div class="welcome-splash-countdown" id="splashCountdown">
                Membuka aplikasi dalam <span id="countdownTimer">5</span> detik...
            </div>
        </div>
    </div>
    
    <!-- Main Application Content (initially hidden) -->
    <div class="app-content-unauthenticated" id="appContent">
        <!-- Mobile Menu Button -->
        <button class="mobile-menu-btn" id="mobileMenuBtn">
            <i class="fas fa-bars"></i>
        </button>
        
        <!-- Sidebar Overlay -->
        <div class="sidebar-overlay" id="sidebarOverlay"></div>
        
        <div class="app-container animate-fadeIn">
            <div class="app-header">
                <div class="app-logo">
                    <i class="fas fa-hands-helping"></i>
                </div>
                <h1 class="app-title">SISTEM BANTUAN BARJAS</h1>
                <p class="app-subtitle">Dinas Peternakan dan Perikanan Kabupaten Situbondo</p>
                <div class="watermark">
                    <i class="fas fa-code"></i> by Lentera Karya Situbondo
                </div>
            </div>
            
            <div class="row g-0">
                <!-- Sidebar Navigation -->
                <div class="col-md-3 col-lg-2 p-4 bg-light" id="sidebarMenu">
                    <ul class="nav nav-pills flex-column">
                        <li class="nav-item">
                            <a class="nav-link active" href="#" data-bs-target="dashboard">
                                <i class="fas fa-tachometer-alt feature-icon"></i> Dashboard
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="#" data-bs-target="inputData">
                                <i class="fas fa-pencil-alt feature-icon"></i> Input Data
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="#" data-bs-target="dataTable">
                                <i class="fas fa-table feature-icon"></i> Data Tersimpan
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="#" data-bs-target="statistik">
                                <i class="fas fa-chart-bar feature-icon"></i> Statistik
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="#" data-bs-target="panduan">
                                <i class="fas fa-book feature-icon"></i> Panduan
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="#" data-bs-target="pengaturan">
                                <i class="fas fa-cog feature-icon"></i> Pengaturan
                            </a>
                        </li>
                        <li class="nav-item mt-4">
                            <a class="nav-link text-danger" href="#" id="logoutButton">
                                <i class="fas fa-sign-out-alt feature-icon"></i> Keluar
                            </a>
                        </li>
                    </ul>
                    
                    <div class="developer-info">
                        <h6>Developer Contact</h6>
                        <div class="developer-contact">
                            <p><i class="fab fa-whatsapp"></i> <a href="https://wa.me/6285647709114" target="_blank" class="whatsapp-link">+62 856-4770-9114</a></p>
                            <p><i class="fas fa-envelope"></i> <a href="mailto:admin@anekamarket.my.id">admin@anekamarket.my.id</a></p>
                        </div>
                    </div>
                </div>
                
                <!-- Main Content Area -->
                <div class="col-md-9 col-lg-10 p-5">
                    <!-- Dashboard Section -->
                    <div class="content-section" id="dashboard">
                        <h3 class="section-title">Dashboard</h3>
                        
                        <div class="row">
                            <div class="col-md-3">
                                <div class="stats-box">
                                    <i class="fas fa-users fa-2x text-primary"></i>
                                    <div class="stats-number" id="totalPenerima">0</div>
                                    <div class="stats-label">Total Penerima</div>
                                </div>
                            </div>
                            <div class="col-md-3">
                                <div class="stats-box">
                                    <i class="fas fa-map-marker-alt fa-2x text-success"></i>
                                    <div class="stats-number" id="totalDesa">0</div>
                                    <div class="stats-label">Desa Tercover</div>
                                </div>
                            </div>
                            <div class="col-md-3">
                                <div class="stats-box">
                                    <i class="fas fa-fish fa-2x text-info"></i>
                                    <div class="stats-number" id="totalBantuan">0</div>
                                    <div class="stats-label">Jenis Bantuan</div>
                                </div>
                            </div>
                            <div class="col-md-3">
                                <div class="stats-box">
                                    <i class="fas fa-calendar-alt fa-2x text-warning"></i>
                                    <div class="stats-number" id="tahunAktif">2025</div>
                                    <div class="stats-label">Tahun Aktif</div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="row mt-4">
                            <div class="col-md-6">
                                <div class="card">
                                    <div class="card-header">
                                        <i class="fas fa-chart-pie me-2"></i> Distribusi Bantuan per Jenis
                                    </div>
                                    <div class="card-body">
                                        <canvas id="jenisBantuanChart" height="250"></canvas>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="card">
                                    <div class="card-header">
                                        <i class="fas fa-chart-bar me-2"></i> Distribusi per Kecamatan
                                    </div>
                                    <div class="card-body">
                                        <canvas id="kecamatanChart" height="250"></canvas>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="row mt-4">
                            <div class="col-md-12">
                                <div class="card">
                                    <div class="card-header">
                                        <i class="fas fa-history me-2"></i> Aktivitas Terbaru
                                    </div>
                                    <div class="card-body">
                                        <div class="table-responsive">
                                            <table class="table table-hover data-table">
                                                <thead>
                                                    <tr>
                                                        <th>Tanggal</th>
                                                        <th>Nama Penerima</th>
                                                        <th>Desa</th>
                                                        <th>Jenis Bantuan</th>
                                                        <th>Jumlah</th>
                                                    </tr>
                                                </thead>
                                                <tbody id="recentActivities">
                                                    <tr>
                                                        <td colspan="5" class="text-center">Tidak ada data aktivitas</td>
                                                    </tr>
                                                </tbody>
                                            </table>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Input Data Section -->
                    <div class="content-section d-none" id="inputData">
                        <h3 class="section-title">Input Data Bantuan</h3>
                        
                        <form id="bantuanForm">
                            <div class="row">
                                <div class="col-md-6">
                                    <div class="mb-3">
                                        <label class="form-label"><i class="fas fa-user"></i> Nama Penerima</label>
                                        <input type="text" class="form-control" id="namaPenerima" required>
                                        <div class="error-message" id="namaPenerimaError">Nama penerima harus diisi</div>
                                    </div>
                                    
                                    <div class="mb-3">
                                        <label class="form-label"><i class="fas fa-id-card"></i> NIK</label>
                                        <input type="text" class="form-control" id="nik" required>
                                        <div class="error-message" id="nikError">NIK harus diisi (16 digit)</div>
                                    </div>
                                    
                                    <div class="mb-3">
                                        <label class="form-label"><i class="fas fa-phone"></i> No. WhatsApp</label>
                                        <input type="text" class="form-control" id="noWhatsApp" required>
                                        <div class="error-message" id="noWhatsAppError">Nomor WhatsApp harus diisi</div>
                                    </div>
                                    
                                    <div class="mb-3">
                                        <label class="form-label"><i class="fas fa-map-marker-alt"></i> Kecamatan</label>
                                        <select class="form-select" id="kecamatan" required>
                                            <option value="">Pilih Kecamatan</option>
                                            <option value="Arjasa">Arjasa</option>
                                            <option value="Asembagus">Asembagus</option>
                                            <option value="Banyuglugur">Banyuglugur</option>
                                            <option value="Banyuputih">Banyuputih</option>
                                            <option value="Besuki">Besuki</option>
                                            <option value="Bungatan">Bungatan</option>
                                            <option value="Jangkar">Jangkar</option>
                                            <option value="Jatibanteng">Jatibanteng</option>
                                            <option value="Kapongan">Kapongan</option>
                                            <option value="Kendit">Kendit</option>
                                            <option value="Mangaran">Mangaran</option>
                                            <option value="Mlandingan">Mlandingan</option>
                                            <option value="Panarukan">Panarukan</option>
                                            <option value="Panji">Panji</option>
                                            <option value="Situbondo">Situbondo</option>
                                            <option value="Suboh">Suboh</option>
                                            <option value="Sumbermalang">Sumbermalang</option>
                                        </select>
                                        <div class="error-message" id="kecamatanError">Kecamatan harus dipilih</div>
                                    </div>
                                </div>
                                
                                <div class="col-md-6">
                                    <div class="mb-3">
                                        <label class="form-label"><i class="fas fa-map-marked-alt"></i> Desa</label>
                                        <select class="form-select" id="desa" required disabled>
                                            <option value="">Pilih Desa</option>
                                        </select>
                                        <div class="error-message" id="desaError">Desa harus dipilih</div>
                                    </div>
                                    
                                    <div class="mb-3">
                                        <label class="form-label"><i class="fas fa-tshirt"></i> Jenis Bantuan</label>
                                        <select class="form-select" id="jenisBantuan" required>
                                            <option value="">Pilih Jenis Bantuan</option>
                                            <option value="Bibit Lele">Bibit Lele</option>
                                            <option value="Bibit Nila">Bibit Nila</option>
                                            <option value="Bibit Gurame">Bibit Gurame</option>
                                            <option value="Pakan Ikan">Pakan Ikan</option>
                                            <option value="Probiotik">Probiotik</option>
                                            <option value="Vitamin Ikan">Vitamin Ikan</option>
                                            <option value="Jaring Apung">Jaring Apung</option>
                                            <option value="Terpal Kolam">Terpal Kolam</option>
                                        </select>
                                        <div class="error-message" id="jenisBantuanError">Jenis bantuan harus dipilih</div>
                                    </div>
                                    
                                    <div class="mb-3">
                                        <label class="form-label"><i class="fas fa-balance-scale"></i> Jumlah</label>
                                        <input type="number" class="form-control" id="jumlah" min="1" required>
                                        <div class="error-message" id="jumlahError">Jumlah harus diisi</div>
                                    </div>
                                    
                                    <div class="mb-3">
                                        <label class="form-label"><i class="fas fa-calendar-alt"></i> Tanggal Penyerahan</label>
                                        <input type="text" class="form-control datepicker" id="tanggalPenyerahan" required>
                                        <div class="error-message" id="tanggalPenyerahanError">Tanggal penyerahan harus diisi</div>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="mb-3">
                                <label class="form-label"><i class="fas fa-link"></i> Link Google Drive (Foto/Dokumen)</label>
                                <div class="input-group">
                                    <input type="text" class="form-control" id="linkGoogleDrive" placeholder="https://drive.google.com/...">
                                    <button class="btn btn-outline-secondary" type="button" id="btnTestLink">
                                        <i class="fas fa-external-link-alt"></i> Test Link
                                    </button>
                                </div>
                                <div class="form-text">Masukkan link Google Drive yang berisi foto atau dokumen pendukung</div>
                            </div>
                            
                            <div class="mb-3">
                                <label class="form-label"><i class="fas fa-sticky-note"></i> Keterangan (Opsional)</label>
                                <textarea class="form-control" id="keterangan" rows="3"></textarea>
                            </div>
                            
                            <div class="d-flex justify-content-between mt-4">
                                <button type="button" class="btn btn-secondary" id="btnResetForm">
                                    <i class="fas fa-undo"></i> Reset Form
                                </button>
                                <button type="submit" class="btn btn-primary">
                                    <i class="fas fa-save"></i> Simpan Data
                                </button>
                            </div>
                        </form>
                    </div>
                    
                    <!-- Data Table Section -->
                    <div class="content-section d-none" id="dataTable">
                        <div class="d-flex justify-content-between align-items-center mb-4">
                            <h3 class="section-title mb-0">Data Bantuan Tersimpan</h3>
                            <div>
                                <button class="btn btn-success me-2" id="btnExportExcel">
                                    <i class="fas fa-file-excel"></i> Excel
                                </button>
                                <button class="btn btn-danger" id="btnExportPDF">
                                    <i class="fas fa-file-pdf"></i> PDF
                                </button>
                            </div>
                        </div>
                        
                        <div class="filter-section">
                            <div class="row">
                                <div class="col-md-3">
                                    <div class="mb-3">
                                        <label class="form-label">Filter Kecamatan</label>
                                        <select class="form-select" id="filterKecamatan">
                                            <option value="">Semua Kecamatan</option>
                                            <option value="Arjasa">Arjasa</option>
                                            <option value="Asembagus">Asembagus</option>
                                            <option value="Banyuglugur">Banyuglugur</option>
                                            <option value="Banyuputih">Banyuputih</option>
                                            <option value="Besuki">Besuki</option>
                                            <option value="Bungatan">Bungatan</option>
                                            <option value="Jangkar">Jangkar</option>
                                            <option value="Jatibanteng">Jatibanteng</option>
                                            <option value="Kapongan">Kapongan</option>
                                            <option value="Kendit">Kendit</option>
                                            <option value="Mangaran">Mangaran</option>
                                            <option value="Mlandingan">Mlandingan</option>
                                            <option value="Panarukan">Panarukan</option>
                                            <option value="Panji">Panji</option>
                                            <option value="Situbondo">Situbondo</option>
                                            <option value="Suboh">Suboh</option>
                                            <option value="Sumbermalang">Sumbermalang</option>
                                        </select>
                                    </div>
                                </div>
                                <div class="col-md-3">
                                    <div class="mb-3">
                                        <label class="form-label">Filter Desa</label>
                                        <select class="form-select" id="filterDesa" disabled>
                                            <option value="">Semua Desa</option>
                                        </select>
                                    </div>
                                </div>
                                <div class="col-md-3">
                                    <div class="mb-3">
                                        <label class="form-label">Filter Jenis Bantuan</label>
                                        <select class="form-select" id="filterJenisBantuan">
                                            <option value="">Semua Jenis</option>
                                            <option value="Bibit Lele">Bibit Lele</option>
                                            <option value="Bibit Nila">Bibit Nila</option>
                                            <option value="Bibit Gurame">Bibit Gurame</option>
                                            <option value="Pakan Ikan">Pakan Ikan</option>
                                            <option value="Probiotik">Probiotik</option>
                                            <option value="Vitamin Ikan">Vitamin Ikan</option>
                                            <option value="Jaring Apung">Jaring Apung</option>
                                            <option value="Terpal Kolam">Terpal Kolam</option>
                                        </select>
                                    </div>
                                </div>
                                <div class="col-md-3">
                                    <div class="mb-3">
                                        <label class="form-label">Pencarian</label>
                                        <input type="text" class="form-control" id="searchInput" placeholder="Cari nama/NIK...">
                                    </div>
                                </div>
                            </div>
                            <div class="d-flex justify-content-end">
                                <button class="btn btn-outline-secondary me-2" id="btnResetFilter">
                                    <i class="fas fa-times"></i> Reset Filter
                                </button>
                                <button class="btn btn-primary" id="btnApplyFilter">
                                    <i class="fas fa-filter"></i> Terapkan Filter
                                </button>
                            </div>
                        </div>
                        
                        <div class="table-responsive">
                            <table class="table table-striped table-bordered data-table" id="tabelDataBantuan">
                                <thead>
                                    <tr>
                                        <th>No</th>
                                        <th>Tanggal</th>
                                        <th>Nama Penerima</th>
                                        <th>NIK</th>
                                        <th>No. WhatsApp</th>
                                        <th>Desa</th>
                                        <th>Kecamatan</th>
                                        <th>Jenis Bantuan</th>
                                        <th>Jumlah</th>
                                        <th>Link Drive</th>
                                        <th>Aksi</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr>
                                        <td colspan="11" class="text-center">Tidak ada data</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                        
                        <div class="d-flex justify-content-between align-items-center mt-3">
                            <div class="fw-bold" id="paginationInfo">Menampilkan 0 dari 0 data</div>
                            <nav>
                                <ul class="pagination" id="paginationControls">
                                    <li class="page-item disabled">
                                        <a class="page-link" href="#" tabindex="-1">Sebelumnya</a>
                                    </li>
                                    <li class="page-item active">
                                        <a class="page-link" href="#">1</a>
                                    </li>
                                    <li class="page-item disabled">
                                        <a class="page-link" href="#">Selanjutnya</a>
                                    </li>
                                </ul>
                            </nav>
                        </div>
                    </div>
                    
                    <!-- Statistik Section -->
                    <div class="content-section d-none" id="statistik">
                        <h3 class="section-title">Statistik dan Grafik</h3>
                        
                        <div class="row mb-4">
                            <div class="col-md-4">
                                <div class="card">
                                    <div class="card-header">
                                        <i class="fas fa-filter me-2"></i> Filter Statistik
                                    </div>
                                    <div class="card-body">
                                        <div class="mb-3">
                                            <label class="form-label">Tahun</label>
                                            <select class="form-select" id="statTahun">
                                                <option value="2025">2025</option>
                                                <option value="2024">2024</option>
                                                <option value="2023">2023</option>
                                            </select>
                                        </div>
                                        <div class="mb-3">
                                            <label class="form-label">Kecamatan</label>
                                            <select class="form-select" id="statKecamatan">
                                                <option value="">Semua Kecamatan</option>
                                                <option value="Arjasa">Arjasa</option>
                                                <option value="Asembagus">Asembagus</option>
                                                <option value="Banyuglugur">Banyuglugur</option>
                                                <option value="Banyuputih">Banyuputih</option>
                                                <option value="Besuki">Besuki</option>
                                                <option value="Bungatan">Bungatan</option>
                                                <option value="Jangkar">Jangkar</option>
                                                <option value="Jatibanteng">Jatibanteng</option>
                                                <option value="Kapongan">Kapongan</option>
                                                <option value="Kendit">Kendit</option>
                                                <option value="Mangaran">Mangaran</option>
                                                <option value="Mlandingan">Mlandingan</option>
                                                <option value="Panarukan">Panarukan</option>
                                                <option value="Panji">Panji</option>
                                                <option value="Situbondo">Situbondo</option>
                                                <option value="Suboh">Suboh</option>
                                                <option value="Sumbermalang">Sumbermalang</option>
                                            </select>
                                        </div>
                                        <div class="mb-3">
                                            <label class="form-label">Jenis Bantuan</label>
                                            <select class="form-select" id="statJenisBantuan">
                                                <option value="">Semua Jenis</option>
                                                <option value="Bibit Lele">Bibit Lele</option>
                                                <option value="Bibit Nila">Bibit Nila</option>
                                                <option value="Bibit Gurame">Bibit Gurame</option>
                                                <option value="Pakan Ikan">Pakan Ikan</option>
                                                <option value="Probiotik">Probiotik</option>
                                                <option value="Vitamin Ikan">Vitamin Ikan</option>
                                                <option value="Jaring Apung">Jaring Apung</option>
                                                <option value="Terpal Kolam">Terpal Kolam</option>
                                            </select>
                                        </div>
                                        <button class="btn btn-primary w-100" id="btnGenerateStatistik">
                                            <i class="fas fa-chart-line"></i> Generate Statistik
                                        </button>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-8">
                                <div class="card">
                                    <div class="card-header">
                                        <i class="fas fa-chart-bar me-2"></i> Grafik Distribusi per Bulan
                                    </div>
                                    <div class="card-body">
                                        <canvas id="bulananChart" height="250"></canvas>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="row">
                            <div class="col-md-6">
                                <div class="card">
                                    <div class="card-header">
                                        <i class="fas fa-chart-pie me-2"></i> Distribusi per Jenis Bantuan
                                    </div>
                                    <div class="card-body">
                                        <canvas id="statJenisBantuanChart" height="250"></canvas>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="card">
                                    <div class="card-header">
                                        <i class="fas fa-map-marked-alt me-2"></i> Distribusi per Kecamatan
                                    </div>
                                    <div class="card-body">
                                        <canvas id="statKecamatanChart" height="250"></canvas>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="card mt-4">
                            <div class="card-header">
                                <i class="fas fa-table me-2"></i> Data Statistik
                            </div>
                            <div class="card-body">
                                <div class="table-responsive">
                                    <table class="table table-bordered data-table">
                                        <thead>
                                            <tr>
                                                <th>Kecamatan</th>
                                                <th>Bibit Lele</th>
                                                <th>Bibit Nila</th>
                                                <th>Bibit Gurame</th>
                                                <th>Pakan Ikan</th>
                                                <th>Probiotik</th>
                                                <th>Vitamin Ikan</th>
                                                <th>Jaring Apung</th>
                                                <th>Terpal Kolam</th>
                                                <th>Total</th>
                                            </tr>
                                        </thead>
                                        <tbody id="statistikTableBody">
                                            <tr>
                                                <td colspan="10" class="text-center">Tidak ada data statistik</td>
                                            </tr>
                                        </tbody>
                                        <tfoot>
                                            <tr id="statistikTableFooter">
                                                <th>Total</th>
                                                <th>0</th>
                                                <th>0</th>
                                                <th>0</th>
                                                <th>0</th>
                                                <th>0</th>
                                                <th>0</th>
                                                <th>0</th>
                                                <th>0</th>
                                                <th>0</th>
                                            </tr>
                                        </tfoot>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Panduan Section -->
                    <div class="content-section d-none" id="panduan">
                        <h3 class="section-title">Panduan Penggunaan Aplikasi</h3>
                        
                        <div class="accordion" id="panduanAccordion">
                            <div class="accordion-item">
                                <h2 class="accordion-header">
                                    <button class="accordion-button" type="button" data-bs-toggle="collapse" data-bs-target="#panduan1">
                                        <i class="fas fa-info-circle me-2"></i> Cara Input Data Bantuan
                                    </button>
                                </h2>
                                <div id="panduan1" class="accordion-collapse collapse show" data-bs-parent="#panduanAccordion">
                                    <div class="accordion-body">
                                        <ol>
                                            <li>Buka menu <strong>Input Data</strong> di sidebar</li>
                                            <li>Isi semua field yang wajib diisi (ditandai dengan asterisk)</li>
                                            <li>Pilih kecamatan terlebih dahulu, kemudian pilih desa</li>
                                            <li>Pilih jenis bantuan yang diberikan</li>
                                            <li>Masukkan jumlah bantuan yang diberikan</li>
                                            <li>Masukkan tanggal penyerahan bantuan</li>
                                            <li>Masukkan link Google Drive untuk dokumentasi (jika ada)</li>
                                            <li>Tambahkan keterangan jika diperlukan</li>
                                            <li>Klik tombol <strong>Simpan Data</strong> untuk menyimpan</li>
                                        </ol>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="accordion-item">
                                <h2 class="accordion-header">
                                    <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#panduan2">
                                        <i class="fas fa-table me-2"></i> Cara Melihat dan Mencari Data
                                    </button>
                                </h2>
                                <div id="panduan2" class="accordion-collapse collapse" data-bs-parent="#panduanAccordion">
                                    <div class="accordion-body">
                                        <ol>
                                            <li>Buka menu <strong>Data Tersimpan</strong> di sidebar</li>
                                            <li>Gunakan filter di atas tabel untuk menyaring data berdasarkan:
                                                <ul>
                                                    <li>Kecamatan</li>
                                                    <li>Desa</li>
                                                    <li>Jenis bantuan</li>
                                                </ul>
                                            </li>
                                            <li>Gunakan kotak pencarian untuk mencari data berdasarkan nama atau NIK</li>
                                            <li>Klik tombol <strong>Terapkan Filter</strong> untuk menerapkan filter</li>
                                            <li>Gunakan navigasi halaman di bawah tabel untuk melihat data lainnya</li>
                                        </ol>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="accordion-item">
                                <h2 class="accordion-header">
                                    <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#panduan3">
                                        <i class="fas fa-chart-bar me-2"></i> Cara Melihat Statistik
                                    </button>
                                </h2>
                                <div id="panduan3" class="accordion-collapse collapse" data-bs-parent="#panduanAccordion">
                                    <div class="accordion-body">
                                        <ol>
                                            <li>Buka menu <strong>Statistik</strong> di sidebar</li>
                                            <li>Gunakan filter di sebelah kiri untuk memilih:
                                                <ul>
                                                    <li>Tahun</li>
                                                    <li>Kecamatan</li>
                                                    <li>Jenis bantuan</li>
                                                </ul>
                                            </li>
                                            <li>Klik tombol <strong>Generate Statistik</strong> untuk menampilkan data</li>
                                            <li>Statistik akan ditampilkan dalam bentuk grafik dan tabel</li>
                                            <li>Grafik dapat dilihat per bulan, per jenis bantuan, dan per kecamatan</li>
                                        </ol>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="accordion-item">
                                <h2 class="accordion-header">
                                    <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#panduan4">
                                        <i class="fas fa-file-export me-2"></i> Cara Export Data
                                    </button>
                                </h2>
                                <div id="panduan4" class="accordion-collapse collapse" data-bs-parent="#panduanAccordion">
                                    <div class="accordion-body">
                                        <ol>
                                            <li>Buka menu <strong>Data Tersimpan</strong></li>
                                            <li>Terapkan filter jika ingin mengekspor data tertentu</li>
                                            <li>Klik tombol <strong>Excel</strong> untuk mengekspor data ke format Excel</li>
                                            <li>Klik tombol <strong>PDF</strong> untuk mengekspor data ke format PDF</li>
                                            <li>File akan diunduh secara otomatis setelah proses ekspor selesai</li>
                                        </ol>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="accordion-item">
                                <h2 class="accordion-header">
                                    <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#panduan5">
                                        <i class="fas fa-print me-2"></i> Cara Mencetak Data
                                    </button>
                                </h2>
                                <div id="panduan5" class="accordion-collapse collapse" data-bs-parent="#panduanAccordion">
                                    <div class="accordion-body">
                                        <ol>
                                            <li>Buka menu <strong>Data Tersimpan</strong></li>
                                            <li>Terapkan filter jika ingin mencetak data tertentu</li>
                                            <li>Gunakan fungsi cetak browser (Ctrl+P) untuk mencetak data</li>
                                            <li>Pastikan untuk memilih opsi <strong>Landscape</strong> pada pengaturan cetak</li>
                                            <li>Data akan dicetak dalam format yang sudah dioptimalkan untuk cetak</li>
                                        </ol>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="alert alert-info mt-4">
                            <h5><i class="fas fa-question-circle me-2"></i> Butuh Bantuan?</h5>
                            <p class="mb-0">Jika mengalami kendala atau memiliki pertanyaan tentang penggunaan aplikasi, silakan hubungi developer di <a href="https://wa.me/6285647709114" target="_blank" class="whatsapp-link">+62 856-4770-9114</a> atau email ke <a href="mailto:admin@anekamarket.my.id">admin@anekamarket.my.id</a>.</p>
                        </div>
                    </div>
                    
                    <!-- Pengaturan Section -->
                    <div class="content-section d-none" id="pengaturan">
                        <h3 class="section-title">Pengaturan Aplikasi</h3>
                        
                        <div class="row">
                            <div class="col-md-6">
                                <div class="card">
                                    <div class="card-header">
                                        <i class="fas fa-database me-2"></i> Manajemen Data
                                    </div>
                                    <div class="card-body">
                                        <div class="mb-3">
                                            <label class="form-label">Backup Data</label>
                                            <p class="form-text">Buat cadangan data aplikasi untuk mencegah kehilangan data.</p>
                                            <button class="btn btn-outline-primary w-100" id="btnBackupData">
                                                <i class="fas fa-download me-2"></i> Backup Data
                                            </button>
                                        </div>
                                        
                                        <div class="mb-3">
                                            <label class="form-label">Restore Data</label>
                                            <p class="form-text">Pulihkan data dari file backup sebelumnya.</p>
                                            <div class="input-group">
                                                <input type="file" class="form-control" id="restoreFile" accept=".json">
                                                <button class="btn btn-outline-secondary" type="button" id="btnRestoreData" disabled>
                                                    <i class="fas fa-upload me-2"></i> Restore
                                                </button>
                                            </div>
                                        </div>
                                        
                                        <div class="mb-3">
                                            <label class="form-label">Hapus Semua Data</label>
                                            <p class="form-text">Hapus semua data yang tersimpan di aplikasi. Tindakan ini tidak dapat dibatalkan!</p>
                                            <button class="btn btn-outline-danger w-100" id="btnHapusSemuaData" data-bs-toggle="modal" data-bs-target="#confirmDeleteModal">
                                                <i class="fas fa-trash-alt me-2"></i> Hapus Semua Data
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="col-md-6">
                                <div class="card">
                                    <div class="card-header">
                                        <i class="fas fa-lock me-2"></i> Keamanan
                                    </div>
                                    <div class="card-body">
                                        <div class="mb-3">
                                            <label class="form-label">Ganti Kode Keamanan</label>
                                            <p class="form-text">Ubah kode keamanan untuk mengakses aplikasi.</p>
                                            <div class="input-group mb-2">
                                                <input type="password" class="form-control" id="newSecurityCode" placeholder="Kode keamanan baru">
                                                <button class="btn btn-outline-secondary toggle-password" type="button">
                                                    <i class="fas fa-eye"></i>
                                                </button>
                                            </div>
                                            <div class="input-group">
                                                <input type="password" class="form-control" id="confirmSecurityCode" placeholder="Konfirmasi kode keamanan">
                                                <button class="btn btn-outline-secondary toggle-password" type="button">
                                                    <i class="fas fa-eye"></i>
                                                </button>
                                            </div>
                                            <div class="d-grid mt-2">
                                                <button class="btn btn-primary" id="btnChangeSecurityCode">
                                                    <i class="fas fa-save me-2"></i> Simpan Kode Baru
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="card mt-4">
                                    <div class="card-header">
                                        <i class="fas fa-info-circle me-2"></i> Informasi Aplikasi
                                    </div>
                                    <div class="card-body">
                                        <div class="mb-3">
                                            <label class="form-label">Versi Aplikasi</label>
                                            <p class="form-text">BARJAS v2.0.1</p>
                                        </div>
                                        
                                        <div class="mb-3">
                                            <label class="form-label">Developer</label>
                                            <p class="form-text">Lentera Karya Situbondo</p>
                                        </div>
                                        
                                        <div class="mb-3">
                                            <label class="form-label">Kontak Support</label>
                                            <p class="form-text">
                                                <a href="https://wa.me/6285647709114" target="_blank" class="whatsapp-link">
                                                    <i class="fab fa-whatsapp me-2"></i> +62 856-4770-9114
                                                </a>
                                                <br>
                                                <a href="mailto:admin@anekamarket.my.id">
                                                    <i class="fas fa-envelope me-2"></i> admin@anekamarket.my.id
                                                </a>
                                            </p>
                                        </div>
                                        
                                        <div class="mb-3">
                                            <label class="form-label">Update Terakhir</label>
                                            <p class="form-text">15 Agustus 2025</p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="copyright">
                &copy; 2025 Dinas Peternakan dan Perikanan Kabupaten Situbondo | 
                <span class="d-none d-md-inline">Dikembangkan oleh </span>
                <a href="https://wa.me/6285647709114" target="_blank" class="whatsapp-link">Lentera Karya Situbondo</a>
            </div>
        </div>
        
        <!-- Floating Action Button -->
        <div class="floating-action-btn" id="floatingActionBtn">
            <i class="fas fa-plus"></i>
        </div>
        
        <!-- Notification Toast -->
        <div class="toast notification-toast" role="alert" aria-live="assertive" aria-atomic="true" id="notificationToast">
            <div class="toast-header">
                <strong class="me-auto" id="toastTitle">Notifikasi</strong>
                <small id="toastTime">Baru saja</small>
                <button type="button" class="btn-close" data-bs-dismiss="toast" aria-label="Close"></button>
            </div>
            <div class="toast-body" id="toastMessage">
                Pesan notifikasi akan muncul di sini
            </div>
        </div>
        
        <!-- Modal Konfirmasi Hapus Data -->
        <div class="modal fade" id="confirmDeleteModal" tabindex="-1" aria-hidden="true">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title">Konfirmasi Hapus Data</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body">
                        <p>Apakah Anda yakin ingin menghapus semua data? Tindakan ini tidak dapat dibatalkan!</p>
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" id="confirmDeleteCheckbox">
                            <label class="form-check-label" for="confirmDeleteCheckbox">
                                Ya, saya yakin ingin menghapus semua data
                            </label>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Batal</button>
                        <button type="button" class="btn btn-danger" id="btnConfirmDelete" disabled>Hapus Semua Data</button>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Modal untuk menambah link Google Drive -->
        <div class="modal fade link-modal" id="addLinkModal" tabindex="-1" aria-hidden="true">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title">Tambah Link Google Drive</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body">
                        <div class="mb-3">
                            <label class="form-label">Link Google Drive</label>
                            <input type="text" class="form-control" id="modalLinkInput" placeholder="https://drive.google.com/...">
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Keterangan (Opsional)</label>
                            <textarea class="form-control" id="modalKeteranganInput" rows="3"></textarea>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Batal</button>
                        <button type="button" class="btn btn-primary" id="btnSaveLink">Simpan Link</button>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Scripts -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-datepicker/1.9.0/js/bootstrap-datepicker.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-datepicker/1.9.0/locales/bootstrap-datepicker.id.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    
    <script>
        // Inisialisasi variabel global
        let appData = {
            bantuan: [],
            settings: {
                securityCode: "BARJAS2025",
                tahunAktif: 2025
            }
        };
        
        let currentPage = 1;
        const itemsPerPage = 10;
        let filteredData = [];
        let loginAttempts = 0;
        let isBlocked = false;
        let blockTimeout;
        
        // DOM Ready
        document.addEventListener('DOMContentLoaded', function() {
            // Initialize components
            initApp();
            
            // Event listeners
            document.getElementById('mobileMenuBtn').addEventListener('click', toggleMobileMenu);
            document.getElementById('sidebarOverlay').addEventListener('click', closeMobileMenu);
            
            // Navigation
            document.querySelectorAll('.nav-link').forEach(link => {
                link.addEventListener('click', function(e) {
                    e.preventDefault();
                    const target = this.getAttribute('data-bs-target');
                    showSection(target);
                    
                    // Close mobile menu after selection
                    closeMobileMenu();
                });
            });
            
            // Kecamatan change event
            document.getElementById('kecamatan').addEventListener('change', function() {
                updateDesaOptions(this.value, 'desa');
            });
            
            // Filter kecamatan change event
            document.getElementById('filterKecamatan').addEventListener('change', function() {
                const desaSelect = document.getElementById('filterDesa');
                if (this.value) {
                    desaSelect.disabled = false;
                    updateDesaOptions(this.value, 'filterDesa');
                } else {
                    desaSelect.disabled = true;
                    desaSelect.innerHTML = '<option value="">Semua Desa</option>';
                }
            });
            
            // Form submission
            document.getElementById('bantuanForm').addEventListener('submit', function(e) {
                e.preventDefault();
                simpanDataBantuan();
            });
            
            // Reset form
            document.getElementById('btnResetForm').addEventListener('click', function() {
                resetForm();
            });
            
            // Test Google Drive link
            document.getElementById('btnTestLink').addEventListener('click', function() {
                testGoogleDriveLink();
            });
            
            // Filter application
            document.getElementById('btnApplyFilter').addEventListener('click', function() {
                applyFilters();
            });
            
            // Reset filter
            document.getElementById('btnResetFilter').addEventListener('click', function() {
                resetFilters();
            });
            
            // Search input
            document.getElementById('searchInput').addEventListener('keyup', function(e) {
                if (e.key === 'Enter') {
                    applyFilters();
                }
            });
            
            // Export buttons
            document.getElementById('btnExportExcel').addEventListener('click', function() {
                exportToExcel();
            });
            
            document.getElementById('btnExportPDF').addEventListener('click', function() {
                exportToPDF();
            });
            
            // Generate statistik
            document.getElementById('btnGenerateStatistik').addEventListener('click', function() {
                generateStatistik();
            });
            
            // Toggle password visibility
            document.querySelectorAll('.toggle-password').forEach(button => {
                button.addEventListener('click', function() {
                    const input = this.parentElement.querySelector('input');
                    if (input.type === 'password') {
                        input.type = 'text';
                        this.innerHTML = '<i class="fas fa-eye-slash"></i>';
                    } else {
                        input.type = 'password';
                        this.innerHTML = '<i class="fas fa-eye"></i>';
                    }
                });
            });
            
            // Data management
            document.getElementById('restoreFile').addEventListener('change', function() {
                document.getElementById('btnRestoreData').disabled = !this.files.length;
            });
            
            document.getElementById('btnRestoreData').addEventListener('click', function() {
                restoreData();
            });
            
            document.getElementById('btnBackupData').addEventListener('click', function() {
                backupData();
            });
            
            document.getElementById('confirmDeleteCheckbox').addEventListener('change', function() {
                document.getElementById('btnConfirmDelete').disabled = !this.checked;
            });
            
            document.getElementById('btnConfirmDelete').addEventListener('click', function() {
                hapusSemuaData();
            });
            
            // Security code change
            document.getElementById('btnChangeSecurityCode').addEventListener('click', function() {
                changeSecurityCode();
            });
            
            // Floating action button
            document.getElementById('floatingActionBtn').addEventListener('click', function() {
                showSection('inputData');
                document.getElementById('namaPenerima').focus();
            });
            
            // Logout
            document.getElementById('logoutButton').addEventListener('click', function(e) {
                e.preventDefault();
                logout();
            });
            
            // Initialize datepicker
            $('.datepicker').datepicker({
                format: 'dd-mm-yyyy',
                autoclose: true,
                language: 'id',
                todayHighlight: true
            });
            
            // Initialize charts with error handling
            try {
                initCharts();
            } catch (error) {
                console.error("Error initializing charts:", error);
                showNotification('Error', 'Gagal memuat grafik. Memuat ulang halaman mungkin diperlukan.', 'error');
            }
            
            // Show welcome splash screen
            setTimeout(() => {
                document.getElementById('welcomeSplash').style.opacity = '0';
                setTimeout(() => {
                    document.getElementById('welcomeSplash').style.display = 'none';
                    document.getElementById('loginModal').classList.add('show');
                    document.getElementById('loginModal').style.display = 'block';
                    document.body.classList.add('modal-open');
                }, 500);
            }, 5000);
            
            // Close splash screen manually
            document.getElementById('closeSplash').addEventListener('click', function() {
                document.getElementById('welcomeSplash').style.opacity = '0';
                setTimeout(() => {
                    document.getElementById('welcomeSplash').style.display = 'none';
                    document.getElementById('loginModal').classList.add('show');
                    document.getElementById('loginModal').style.display = 'block';
                    document.body.classList.add('modal-open');
                }, 500);
            });
            
            // Countdown for splash screen
            let countdown = 5;
            const countdownElement = document.getElementById('countdownTimer');
            const countdownInterval = setInterval(() => {
                countdown--;
                countdownElement.textContent = countdown;
                if (countdown <= 0) {
                    clearInterval(countdownInterval);
                }
            }, 1000);
            
            // Login form submission
            document.getElementById('loginForm').addEventListener('submit', function(e) {
                e.preventDefault();
                attemptLogin();
            });
        });
        
        // Initialize application
        function initApp() {
            // Load data from localStorage
            loadData();
            
            // Update dashboard stats
            updateDashboardStats();
            
            // Load data table
            loadDataTable();
            
            // Check if user is authenticated
            const isAuthenticated = localStorage.getItem('barjasAuthenticated');
            if (isAuthenticated === 'true') {
                document.getElementById('appContent').classList.remove('app-content-unauthenticated');
                document.getElementById('loginModal').classList.remove('show');
                document.getElementById('loginModal').style.display = 'none';
                document.body.classList.remove('modal-open');
            }
        }
        
        // Toggle mobile menu
        function toggleMobileMenu() {
            document.getElementById('sidebarMenu').classList.toggle('mobile-show');
            document.getElementById('sidebarOverlay').classList.toggle('mobile-show');
        }
        
        // Close mobile menu
        function closeMobileMenu() {
            document.getElementById('sidebarMenu').classList.remove('mobile-show');
            document.getElementById('sidebarOverlay').classList.remove('mobile-show');
        }
        
        // Show specific section
        function showSection(sectionId) {
            // Hide all sections
            document.querySelectorAll('.content-section').forEach(section => {
                section.classList.add('d-none');
            });
            
            // Show selected section
            document.getElementById(sectionId).classList.remove('d-none');
            
            // Update active nav link
            document.querySelectorAll('.nav-link').forEach(link => {
                link.classList.remove('active');
                if (link.getAttribute('data-bs-target') === sectionId) {
                    link.classList.add('active');
                }
            });
            
            // Special actions for specific sections
            if (sectionId === 'dataTable') {
                // Refresh data table when shown
                loadDataTable();
            } else if (sectionId === 'statistik') {
                // Generate statistik when shown
                generateStatistik();
            }
        }
        
        // Update desa options based on selected kecamatan
        function updateDesaOptions(kecamatan, targetElementId) {
            const desaSelect = document.getElementById(targetElementId);
            desaSelect.innerHTML = '<option value="">Pilih Desa</option>';
            
            if (!kecamatan) {
                desaSelect.disabled = true;
                return;
            }
            
            // Daftar desa per kecamatan (contoh data)
            const desaByKecamatan = {
                'Arjasa': ['Arjasa', 'Biting', 'Candijati', 'Darsono', 'Jugantoro', 'Kalianyar', 'Kamal', 'Kemuninglor', 'Balesait'],
                'Asembagus': ['Asembagus', 'Banyuputih', 'Gudang', 'Kedunglo', 'Wringinanom', 'Trigonco', 'Awar-awar', 'Perante', 'Mojosari'],
                'Banyuglugur': ['Banyuglugur', 'Kalianget', 'Tepos', 'Selobanteng', 'Kalisari', 'Klemu', 'Sumberanyar', 'Taman', 'Banyupute'],
                'Banyuputih': ['Banyuputih', 'Sumberejo', 'Sumberwaru', 'Tamansari', 'Tlogosari', 'Trebungan', 'Wringinanom', 'Wringinpitu', 'Sumberjambe'],
                'Besuki': ['Besuki', 'Blimbing', 'Bloro', 'Demung', 'Jambewangi', 'Jatirejo', 'Kalimas', 'Kebonan', 'Klatakan'],
                'Bungatan': ['Bungatan', 'Banyuwangi', 'Kedungrejo', 'Mojosari', 'Patemon', 'Sumberanyar', 'Sumberejo', 'Sumberkencono', 'Tlogosari'],
                'Jangkar': ['Jangkar', 'Curahtatal', 'Kesambirampak', 'Klabang', 'Klampokan', 'Tamansari', 'Tlogosari', 'Wonorejo', 'Wringinanom'],
                'Jatibanteng': ['Jatibanteng', 'Curahsuri', 'Kalianget', 'Kotakan', 'Mimbaan', 'Pesanggaran', 'Sumberanyar', 'Sumberejo', 'Wringinanom'],
                'Kapongan': ['Kapongan', 'Kesambirampak', 'Klabang', 'Klampokan', 'Tamansari', 'Tlogosari', 'Wonorejo', 'Wringinanom', 'Curahtatal'],
                'Kendit': ['Kendit', 'Balung', 'Biting', 'Curahsuri', 'Jatibanteng', 'Kesambirampak', 'Klabang', 'Klampokan', 'Tamansari'],
                'Mangaran': ['Mangaran', 'Curahsuri', 'Kalianget', 'Kotakan', 'Mimbaan', 'Pesanggaran', 'Sumberanyar', 'Sumberejo', 'Wringinanom'],
                'Mlandingan': ['Mlandingan', 'Balung', 'Biting', 'Curahsuri', 'Jatibanteng', 'Kesambirampak', 'Klabang', 'Klampokan', 'Tamansari'],
                'Panarukan': ['Panarukan', 'Alasmalang', 'Gelung', 'Kilensari', 'Paowan', 'Peleyan', 'Sumberanyar', 'Sumberejo', 'Wringinanom'],
                'Panji': ['Panji', 'Badean', 'Banyuwangi', 'Kedungrejo', 'Mojosari', 'Patemon', 'Sumberanyar', 'Sumberejo', 'Sumberkencono'],
                'Situbondo': ['Situbondo', 'Jawa', 'Kotakan', 'Mimbaan', 'Olean', 'Pategalan', 'Patemon', 'Sumberanyar', 'Sumberejo'],
                'Suboh': ['Suboh', 'Banyuputih', 'Sumberejo', 'Sumberwaru', 'Tamansari', 'Tlogosari', 'Trebungan', 'Wringinanom', 'Wringinpitu'],
                'Sumbermalang': ['Sumbermalang', 'Banyuglugur', 'Kalianget', 'Tepos', 'Selobanteng', 'Kalisari', 'Klemu', 'Sumberanyar', 'Taman']
            };
            
            if (desaByKecamatan[kecamatan]) {
                desaSelect.disabled = false;
                desaByKecamatan[kecamatan].forEach(desa => {
                    const option = document.createElement('option');
                    option.value = desa;
                    option.textContent = desa;
                    desaSelect.appendChild(option);
                });
            }
        }
        
        // Simpan data bantuan
        function simpanDataBantuan() {
            // Validate form
            if (!validateForm()) {
                showNotification('Error', 'Harap isi semua field yang wajib diisi dengan benar.', 'error');
                return;
            }
            
            // Get form values
            const newData = {
                id: Date.now(), // Unique ID based on timestamp
                namaPenerima: document.getElementById('namaPenerima').value.trim(),
                nik: document.getElementById('nik').value.trim(),
                noWhatsApp: document.getElementById('noWhatsApp').value.trim(),
                kecamatan: document.getElementById('kecamatan').value,
                desa: document.getElementById('desa').value,
                jenisBantuan: document.getElementById('jenisBantuan').value,
                jumlah: parseInt(document.getElementById('jumlah').value),
                tanggalPenyerahan: document.getElementById('tanggalPenyerahan').value,
                linkGoogleDrive: document.getElementById('linkGoogleDrive').value.trim(),
                keterangan: document.getElementById('keterangan').value.trim(),
                tanggalInput: new Date().toLocaleString('id-ID')
            };
            
            // Add to data array
            appData.bantuan.push(newData);
            
            // Save to localStorage
            saveData();
            
            // Reset form
            resetForm();
            
            // Show success notification
            showNotification('Sukses', 'Data bantuan berhasil disimpan.', 'success');
            
            // Update dashboard and table if visible
            updateDashboardStats();
            if (!document.getElementById('dataTable').classList.contains('d-none')) {
                loadDataTable();
            }
        }
        
        // Validate form
        function validateForm() {
            let isValid = true;
            
            // Reset error states
            document.querySelectorAll('.form-control, .form-select').forEach(input => {
                input.classList.remove('input-error');
            });
            document.querySelectorAll('.error-message').forEach(msg => {
                msg.style.display = 'none';
            });
            
            // Validate nama penerima
            const namaPenerima = document.getElementById('namaPenerima').value.trim();
            if (!namaPenerima) {
                document.getElementById('namaPenerima').classList.add('input-error');
                document.getElementById('namaPenerimaError').style.display = 'block';
                isValid = false;
            }
            
            // Validate NIK
            const nik = document.getElementById('nik').value.trim();
            if (!nik || nik.length !== 16) {
                document.getElementById('nik').classList.add('input-error');
                document.getElementById('nikError').style.display = 'block';
                isValid = false;
            }
            
            // Validate WhatsApp number
            const noWhatsApp = document.getElementById('noWhatsApp').value.trim();
            if (!noWhatsApp) {
                document.getElementById('noWhatsApp').classList.add('input-error');
                document.getElementById('noWhatsAppError').style.display = 'block';
                isValid = false;
            }
            
            // Validate kecamatan
            const kecamatan = document.getElementById('kecamatan').value;
            if (!kecamatan) {
                document.getElementById('kecamatan').classList.add('input-error');
                document.getElementById('kecamatanError').style.display = 'block';
                isValid = false;
            }
            
            // Validate desa
            const desa = document.getElementById('desa').value;
            if (!desa) {
                document.getElementById('desa').classList.add('input-error');
                document.getElementById('desaError').style.display = 'block';
                isValid = false;
            }
            
            // Validate jenis bantuan
            const jenisBantuan = document.getElementById('jenisBantuan').value;
            if (!jenisBantuan) {
                document.getElementById('jenisBantuan').classList.add('input-error');
                document.getElementById('jenisBantuanError').style.display = 'block';
                isValid = false;
            }
            
            // Validate jumlah
            const jumlah = document.getElementById('jumlah').value;
            if (!jumlah || parseInt(jumlah) <= 0) {
                document.getElementById('jumlah').classList.add('input-error');
                document.getElementById('jumlahError').style.display = 'block';
                isValid = false;
            }
            
            // Validate tanggal penyerahan
            const tanggalPenyerahan = document.getElementById('tanggalPenyerahan').value;
            if (!tanggalPenyerahan) {
                document.getElementById('tanggalPenyerahan').classList.add('input-error');
                document.getElementById('tanggalPenyerahanError').style.display = 'block';
                isValid = false;
            }
            
            return isValid;
        }
        
        // Reset form
        function resetForm() {
            document.getElementById('bantuanForm').reset();
            document.getElementById('desa').disabled = true;
            document.getElementById('desa').innerHTML = '<option value="">Pilih Desa</option>';
            
            // Reset error states
            document.querySelectorAll('.form-control, .form-select').forEach(input => {
                input.classList.remove('input-error');
            });
            document.querySelectorAll('.error-message').forEach(msg => {
                msg.style.display = 'none';
            });
        }
        
        // Test Google Drive link
        function testGoogleDriveLink() {
            const link = document.getElementById('linkGoogleDrive').value.trim();
            if (!link) {
                showNotification('Peringatan', 'Masukkan link Google Drive terlebih dahulu.', 'warning');
                return;
            }
            
            // Simple validation for Google Drive links
            if (!link.includes('drive.google.com')) {
                showNotification('Peringatan', 'Link harus berupa link Google Drive yang valid.', 'warning');
                return;
            }
            
            // Open link in new tab
            window.open(link, '_blank');
            showNotification('Info', 'Membuka link Google Drive di tab baru.', 'info');
        }
        
        // Load data table
        function loadDataTable() {
            const tableBody = document.querySelector('#tabelDataBantuan tbody');
            tableBody.innerHTML = '';
            
            // Use filteredData if available, otherwise use all data
            const dataToDisplay = filteredData.length > 0 ? filteredData : appData.bantuan;
            
            if (dataToDisplay.length === 0) {
                tableBody.innerHTML = '<tr><td colspan="11" class="text-center">Tidak ada data</td></tr>';
                updatePaginationInfo(0, 0);
                return;
            }
            
            // Calculate pagination
            const totalPages = Math.ceil(dataToDisplay.length / itemsPerPage);
            if (currentPage > totalPages) currentPage = totalPages;
            
            const startIndex = (currentPage - 1) * itemsPerPage;
            const endIndex = Math.min(startIndex + itemsPerPage, dataToDisplay.length);
            const currentItems = dataToDisplay.slice(startIndex, endIndex);
            
            // Populate table
            currentItems.forEach((item, index) => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${startIndex + index + 1}</td>
                    <td>${item.tanggalPenyerahan}</td>
                    <td>${item.namaPenerima}</td>
                    <td>${item.nik}</td>
                    <td>
                        <a href="https://wa.me/${item.noWhatsApp}" target="_blank" class="whatsapp-number">
                            ${item.noWhatsApp}
                        </a>
                    </td>
                    <td>${item.desa}</td>
                    <td>${item.kecamatan}</td>
                    <td>${item.jenisBantuan}</td>
                    <td>${item.jumlah}</td>
                    <td>
                        ${item.linkGoogleDrive ? 
                            `<a href="${item.linkGoogleDrive}" target="_blank" class="drive-link">Lihat Dokumen</a>` : 
                            '<span class="text-muted">Tidak ada</span>'}
                    </td>
                    <td>
                        <div class="btn-group btn-group-sm">
                            <button class="btn btn-outline-primary btn-view" onclick="viewData(${item.id})">
                                <i class="fas fa-eye"></i>
                            </button>
                            <button class="btn btn-outline-danger" onclick="deleteData(${item.id})">
                                <i class="fas fa-trash"></i>
                            </button>
                            <button class="btn btn-outline-secondary btn-print-individual" onclick="printIndividualData(${item.id})">
                                <i class="fas fa-print"></i>
                            </button>
                        </div>
                    </td>
                `;
                tableBody.appendChild(row);
            });
            
            // Update pagination controls
            updatePaginationControls(dataToDisplay.length);
            updatePaginationInfo(dataToDisplay.length, startIndex + 1, endIndex);
        }
        
        // Update pagination controls
        function updatePaginationControls(totalItems) {
            const totalPages = Math.ceil(totalItems / itemsPerPage);
            const paginationElement = document.getElementById('paginationControls');
            
            if (totalPages <= 1) {
                paginationElement.innerHTML = '';
                return;
            }
            
            let paginationHTML = `
                <li class="page-item ${currentPage === 1 ? 'disabled' : ''}">
                    <a class="page-link" href="#" onclick="changePage(${currentPage - 1})">Sebelumnya</a>
                </li>
            `;
            
            // Show page numbers
            for (let i = 1; i <= totalPages; i++) {
                paginationHTML += `
                    <li class="page-item ${currentPage === i ? 'active' : ''}">
                        <a class="page-link" href="#" onclick="changePage(${i})">${i}</a>
                    </li>
                `;
            }
            
            paginationHTML += `
                <li class="page-item ${currentPage === totalPages ? 'disabled' : ''}">
                    <a class="page-link" href="#" onclick="changePage(${currentPage + 1})">Selanjutnya</a>
                </li>
            `;
            
            paginationElement.innerHTML = paginationHTML;
        }
        
        // Update pagination info
        function updatePaginationInfo(totalItems, start, end) {
            const infoElement = document.getElementById('paginationInfo');
            
            if (totalItems === 0) {
                infoElement.textContent = 'Menampilkan 0 dari 0 data';
                return;
            }
            
            infoElement.textContent = `Menampilkan ${start} sampai ${end} dari ${totalItems} data`;
        }
        
        // Change page
        function changePage(page) {
            currentPage = page;
            loadDataTable();
        }
        
        // Apply filters
        function applyFilters() {
            const kecamatan = document.getElementById('filterKecamatan').value;
            const desa = document.getElementById('filterDesa').value;
            const jenisBantuan = document.getElementById('filterJenisBantuan').value;
            const searchTerm = document.getElementById('searchInput').value.toLowerCase();
            
            // Reset to first page
            currentPage = 1;
            
            // Filter data
            filteredData = appData.bantuan.filter(item => {
                let match = true;
                
                if (kecamatan && item.kecamatan !== kecamatan) {
                    match = false;
                }
                
                if (match && desa && item.desa !== desa) {
                    match = false;
                }
                
                if (match && jenisBantuan && item.jenisBantuan !== jenisBantuan) {
                    match = false;
                }
                
                if (match && searchTerm) {
                    const searchIn = item.namaPenerima.toLowerCase() + item.nik.toLowerCase();
                    if (!searchIn.includes(searchTerm)) {
                        match = false;
                    }
                }
                
                return match;
            });
            
            // Reload table with filtered data
            loadDataTable();
        }
        
        // Reset filters
        function resetFilters() {
            document.getElementById('filterKecamatan').value = '';
            document.getElementById('filterDesa').value = '';
            document.getElementById('filterDesa').disabled = true;
            document.getElementById('filterJenisBantuan').value = '';
            document.getElementById('searchInput').value = '';
            
            // Reset filtered data and reload table
            filteredData = [];
            currentPage = 1;
            loadDataTable();
        }
        
        // View data
        function viewData(id) {
            const data = appData.bantuan.find(item => item.id === id);
            if (!data) return;
            
            // Show data in a modal or alert
            const message = `
                <strong>Nama Penerima:</strong> ${data.namaPenerima}<br>
                <strong>NIK:</strong> ${data.nik}<br>
                <strong>No. WhatsApp:</strong> ${data.noWhatsApp}<br>
                <strong>Alamat:</strong> ${data.desa}, ${data.kecamatan}<br>
                <strong>Jenis Bantuan:</strong> ${data.jenisBantuan}<br>
                <strong>Jumlah:</strong> ${data.jumlah}<br>
                <strong>Tanggal Penyerahan:</strong> ${data.tanggalPenyerahan}<br>
                <strong>Link Google Drive:</strong> ${data.linkGoogleDrive ? `<a href="${data.linkGoogleDrive}" target="_blank">${data.linkGoogleDrive}</a>` : 'Tidak ada'}<br>
                <strong>Keterangan:</strong> ${data.keterangan || 'Tidak ada'}
            `;
            
            // Create a custom modal for viewing data
            const modal = document.createElement('div');
            modal.className = 'modal fade';
            modal.innerHTML = `
                <div class="modal-dialog modal-lg">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h5 class="modal-title">Detail Data Bantuan</h5>
                            <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                        </div>
                        <div class="modal-body">
                            ${message}
                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Tutup</button>
                        </div>
                    </div>
                </div>
            `;
            
            document.body.appendChild(modal);
            const bsModal = new bootstrap.Modal(modal);
            bsModal.show();
            
            // Remove modal from DOM after it's hidden
            modal.addEventListener('hidden.bs.modal', function() {
                document.body.removeChild(modal);
            });
        }
        
        // Delete data
        function deleteData(id) {
            if (!confirm('Apakah Anda yakin ingin menghapus data ini?')) {
                return;
            }
            
            // Find index of data to delete
            const index = appData.bantuan.findIndex(item => item.id === id);
            if (index === -1) return;
            
            // Remove from array
            appData.bantuan.splice(index, 1);
            
            // Save to localStorage
            saveData();
            
            // Update filteredData if in use
            if (filteredData.length > 0) {
                const filteredIndex = filteredData.findIndex(item => item.id === id);
                if (filteredIndex !== -1) {
                    filteredData.splice(filteredIndex, 1);
                }
            }
            
            // Reload table and update dashboard
            loadDataTable();
            updateDashboardStats();
            
            // Show success notification
            showNotification('Sukses', 'Data berhasil dihapus.', 'success');
        }
        
        // Print individual data
        function printIndividualData(id) {
            const data = appData.bantuan.find(item => item.id === id);
            if (!data) return;
            
            // Create a print-friendly version
            const printWindow = window.open('', '_blank');
            printWindow.document.write(`
                <!DOCTYPE html>
                <html>
                <head>
                    <title>Cetak Data Bantuan - ${data.namaPenerima}</title>
                    <style>
                        body { font-family: Arial, sans-serif; margin: 20px; }
                        .header { text-align: center; margin-bottom: 20px; }
                        .header h2 { margin-bottom: 5px; }
                        .header p { margin: 0; color: #666; }
                        table { width: 100%; border-collapse: collapse; margin-bottom: 20px; }
                        th, td { border: 1px solid #ddd; padding: 8px; text-align: left; }
                        th { background-color: #f5f5f5; }
                        .footer { margin-top: 30px; text-align: right; font-size: 14px; color: #666; }
                    </style>
                </head>
                <body>
                    <div class="header">
                        <h2>DATA BANTUAN BARJAS</h2>
                        <p>Dinas Peternakan dan Perikanan Kabupaten Situbondo</p>
                    </div>
                    
                    <table>
                        <tr><th width="30%">Nama Penerima</th><td>${data.namaPenerima}</td></tr>
                        <tr><th>NIK</th><td>${data.nik}</td></tr>
                        <tr><th>No. WhatsApp</th><td>${data.noWhatsApp}</td></tr>
                        <tr><th>Alamat</th><td>${data.desa}, ${data.kecamatan}</td></tr>
                        <tr><th>Jenis Bantuan</th><td>${data.jenisBantuan}</td></tr>
                        <tr><th>Jumlah</th><td>${data.jumlah}</td></tr>
                        <tr><th>Tanggal Penyerahan</th><td>${data.tanggalPenyerahan}</td></tr>
                        <tr><th>Link Google Drive</th><td>${data.linkGoogleDrive || 'Tidak ada'}</td></tr>
                        <tr><th>Keterangan</th><td>${data.keterangan || 'Tidak ada'}</td></tr>
                    </table>
                    
                    <div class="footer">
                        <p>Dicetak pada: ${new Date().toLocaleString('id-ID')}</p>
                    </div>
                </body>
                </html>
            `);
            
            printWindow.document.close();
            
            // Wait for content to load then print
            setTimeout(() => {
                printWindow.print();
                // printWindow.close(); // Uncomment to automatically close after printing
            }, 250);
        }
        
        // Export to Excel
        function exportToExcel() {
            // Use filteredData if available, otherwise use all data
            const dataToExport = filteredData.length > 0 ? filteredData : appData.bantuan;
            
            if (dataToExport.length === 0) {
                showNotification('Peringatan', 'Tidak ada data untuk diekspor.', 'warning');
                return;
            }
            
            try {
                // Prepare data for Excel
                const worksheet = XLSX.utils.json_to_sheet(dataToExport.map(item => ({
                    'Tanggal Penyerahan': item.tanggalPenyerahan,
                    'Nama Penerima': item.namaPenerima,
                    'NIK': item.nik,
                    'No. WhatsApp': item.noWhatsApp,
                    'Desa': item.desa,
                    'Kecamatan': item.kecamatan,
                    'Jenis Bantuan': item.jenisBantuan,
                    'Jumlah': item.jumlah,
                    'Link Google Drive': item.linkGoogleDrive || '',
                    'Keterangan': item.keterangan || ''
                })));
                
                const workbook = XLSX.utils.book_new();
                XLSX.utils.book_append_sheet(workbook, worksheet, 'Data Bantuan');
                
                // Generate Excel file and download
                const excelBuffer = XLSX.write(workbook, { bookType: 'xlsx', type: 'array' });
                const blob = new Blob([excelBuffer], { type: 'application/vnd.openxmlformats-officedocument.spreadsheetml.sheet' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `data_bantuan_barjas_${new Date().toISOString().split('T')[0]}.xlsx`;
                a.click();
                
                // Clean up
                setTimeout(() => URL.revokeObjectURL(url), 100);
                
                showNotification('Sukses', 'Data berhasil diekspor ke Excel.', 'success');
            } catch (error) {
                console.error('Error exporting to Excel:', error);
                showNotification('Error', 'Gagal mengekspor data ke Excel.', 'error');
            }
        }
        
        // Export to PDF
        function exportToPDF() {
            // Use filteredData if available, otherwise use all data
            const dataToExport = filteredData.length > 0 ? filteredData : appData.bantuan;
            
            if (dataToExport.length === 0) {
                showNotification('Peringatan', 'Tidak ada data untuk diekspor.', 'warning');
                return;
            }
            
            try {
                const { jsPDF } = window.jspdf;
                const doc = new jsPDF({
                    orientation: 'landscape',
                    unit: 'mm',
                    format: 'a4'
                });
                
                // Add title
                doc.setFontSize(16);
                doc.text('DATA BANTUAN BARJAS', 14, 15);
                doc.setFontSize(10);
                doc.text(`Dinas Peternakan dan Perikanan Kabupaten Situbondo - Dicetak pada: ${new Date().toLocaleString('id-ID')}`, 14, 20);
                
                // Prepare table data
                const tableData = dataToExport.map(item => [
                    item.tanggalPenyerahan,
                    item.namaPenerima,
                    item.nik,
                    item.noWhatsApp,
                    item.desa,
                    item.kecamatan,
                    item.jenisBantuan,
                    item.jumlah.toString(),
                    item.linkGoogleDrive ? 'Ya' : 'Tidak'
                ]);
                
                // Add table
                doc.autoTable({
                    startY: 25,
                    head: [['Tanggal', 'Nama', 'NIK', 'WhatsApp', 'Desa', 'Kecamatan', 'Jenis', 'Jumlah', 'Dokumen']],
                    body: tableData,
                    theme: 'grid',
                    headStyles: {
                        fillColor: [13, 71, 161],
                        textColor: 255
                    },
                    styles: {
                        fontSize: 8,
                        cellPadding: 1.5
                    },
                    margin: { left: 14, right: 14 }
                });
                
                // Save PDF
                doc.save(`data_bantuan_barjas_${new Date().toISOString().split('T')[0]}.pdf`);
                
                showNotification('Sukses', 'Data berhasil diekspor ke PDF.', 'success');
            } catch (error) {
                console.error('Error exporting to PDF:', error);
                showNotification('Error', 'Gagal mengekspor data ke PDF.', 'error');
            }
        }
        
        // Generate statistik
        function generateStatistik() {
            const tahun = document.getElementById('statTahun').value;
            const kecamatan = document.getElementById('statKecamatan').value;
            const jenisBantuan = document.getElementById('statJenisBantuan').value;
            
            // Filter data based on selected criteria
            let filteredData = appData.bantuan;
            
            if (tahun) {
                filteredData = filteredData.filter(item => {
                    const itemYear = item.tanggalPenyerahan.split('-')[2];
                    return itemYear === tahun;
                });
            }
            
            if (kecamatan) {
                filteredData = filteredData.filter(item => item.kecamatan === kecamatan);
            }
            
            if (jenisBantuan) {
                filteredData = filteredData.filter(item => item.jenisBantuan === jenisBantuan);
            }
            
            // Update statistik table
            updateStatistikTable(filteredData);
            
            // Update charts
            updateCharts(filteredData);
        }
        
        // Update statistik table
        function updateStatistikTable(data) {
            const tableBody = document.getElementById('statistikTableBody');
            const tableFooter = document.getElementById('statistikTableFooter');
            
            tableBody.innerHTML = '';
            
            if (data.length === 0) {
                tableBody.innerHTML = '<tr><td colspan="10" class="text-center">Tidak ada data statistik</td></tr>';
                
                // Reset footer
                for (let i = 1; i <= 9; i++) {
                    tableFooter.cells[i].textContent = '0';
                }
                return;
            }
            
            // Group data by kecamatan
            const dataByKecamatan = {};
            data.forEach(item => {
                if (!dataByKecamatan[item.kecamatan]) {
                    dataByKecamatan[item.kecamatan] = {
                        'Bibit Lele': 0,
                        'Bibit Nila': 0,
                        'Bibit Gurame': 0,
                        'Pakan Ikan': 0,
                        'Probiotik': 0,
                        'Vitamin Ikan': 0,
                        'Jaring Apung': 0,
                        'Terpal Kolam': 0,
                        Total: 0
                    };
                }
                
                dataByKecamatan[item.kecamatan][item.jenisBantuan] += item.jumlah;
                dataByKecamatan[item.kecamatan].Total += item.jumlah;
            });
            
            // Calculate totals
            const totals = {
                'Bibit Lele': 0,
                'Bibit Nila': 0,
                'Bibit Gurame': 0,
                'Pakan Ikan': 0,
                'Probiotik': 0,
                'Vitamin Ikan': 0,
                'Jaring Apung': 0,
                'Terpal Kolam': 0,
                Total: 0
            };
            
            // Populate table rows
            Object.keys(dataByKecamatan).sort().forEach(kecamatan => {
                const rowData = dataByKecamatan[kecamatan];
                const row = document.createElement('tr');
                
                row.innerHTML = `
                    <td>${kecamatan}</td>
                    <td>${rowData['Bibit Lele'] || 0}</td>
                    <td>${rowData['Bibit Nila'] || 0}</td>
                    <td>${rowData['Bibit Gurame'] || 0}</td>
                    <td>${rowData['Pakan Ikan'] || 0}</td>
                    <td>${rowData['Probiotik'] || 0}</td>
                    <td>${rowData['Vitamin Ikan'] || 0}</td>
                    <td>${rowData['Jaring Apung'] || 0}</td>
                    <td>${rowData['Terpal Kolam'] || 0}</td>
                    <td>${rowData.Total}</td>
                `;
                
                tableBody.appendChild(row);
                
                // Add to totals
                totals['Bibit Lele'] += rowData['Bibit Lele'] || 0;
                totals['Bibit Nila'] += rowData['Bibit Nila'] || 0;
                totals['Bibit Gurame'] += rowData['Bibit Gurame'] || 0;
                totals['Pakan Ikan'] += rowData['Pakan Ikan'] || 0;
                totals['Probiotik'] += rowData['Probiotik'] || 0;
                totals['Vitamin Ikan'] += rowData['Vitamin Ikan'] || 0;
                totals['Jaring Apung'] += rowData['Jaring Apung'] || 0;
                totals['Terpal Kolam'] += rowData['Terpal Kolam'] || 0;
                totals.Total += rowData.Total;
            });
            
            // Update footer with totals
            tableFooter.cells[1].textContent = totals['Bibit Lele'];
            tableFooter.cells[2].textContent = totals['Bibit Nila'];
            tableFooter.cells[3].textContent = totals['Bibit Gurame'];
            tableFooter.cells[4].textContent = totals['Pakan Ikan'];
            tableFooter.cells[5].textContent = totals['Probiotik'];
            tableFooter.cells[6].textContent = totals['Vitamin Ikan'];
            tableFooter.cells[7].textContent = totals['Jaring Apung'];
            tableFooter.cells[8].textContent = totals['Terpal Kolam'];
            tableFooter.cells[9].textContent = totals.Total;
        }
        
        // Initialize charts
        function initCharts() {
            // Check if Chart is available
            if (typeof Chart === 'undefined') {
                console.error('Chart.js is not loaded');
                return;
            }
            
            // Create empty charts initially
            const chartOptions = {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: {
                        position: 'bottom'
                    }
                }
            };
            
            // Jenis Bantuan Chart
            const jenisBantuanCtx = document.getElementById('jenisBantuanChart').getContext('2d');
            window.jenisBantuanChart = new Chart(jenisBantuanCtx, {
                type: 'pie',
                data: {
                    labels: ['Tidak ada data'],
                    datasets: [{
                        data: [1],
                        backgroundColor: ['#cccccc']
                    }]
                },
                options: chartOptions
            });
            
            // Kecamatan Chart
            const kecamatanCtx = document.getElementById('kecamatanChart').getContext('2d');
            window.kecamatanChart = new Chart(kecamatanCtx, {
                type: 'bar',
                data: {
                    labels: ['Tidak ada data'],
                    datasets: [{
                        label: 'Jumlah',
                        data: [0],
                        backgroundColor: '#0d47a1'
                    }]
                },
                options: chartOptions
            });
            
            // Bulanan Chart
            const bulananCtx = document.getElementById('bulananChart').getContext('2d');
            window.bulananChart = new Chart(bulananCtx, {
                type: 'line',
                data: {
                    labels: ['Tidak ada data'],
                    datasets: [{
                        label: 'Jumlah',
                        data: [0],
                        borderColor: '#0d47a1',
                        backgroundColor: 'rgba(13, 71, 161, 0.1)',
                        fill: true,
                        tension: 0.3
                    }]
                },
                options: chartOptions
            });
            
            // Statistik Jenis Bantuan Chart
            const statJenisBantuanCtx = document.getElementById('statJenisBantuanChart').getContext('2d');
            window.statJenisBantuanChart = new Chart(statJenisBantuanCtx, {
                type: 'doughnut',
                data: {
                    labels: ['Tidak ada data'],
                    datasets: [{
                        data: [1],
                        backgroundColor: ['#cccccc']
                    }]
                },
                options: chartOptions
            });
            
            // Statistik Kecamatan Chart
            const statKecamatanCtx = document.getElementById('statKecamatanChart').getContext('2d');
            window.statKecamatanChart = new Chart(statKecamatanCtx, {
                type: 'bar',
                data: {
                    labels: ['Tidak ada data'],
                    datasets: [{
                        label: 'Jumlah',
                        data: [0],
                        backgroundColor: '#00695c'
                    }]
                },
                options: chartOptions
            });
            
            // Update charts with actual data
            updateCharts(appData.bantuan);
        }
        
        // Update charts with data
        function updateCharts(data) {
            if (!window.jenisBantuanChart || data.length === 0) {
                return;
            }
            
            // Update Jenis Bantuan Chart (Pie)
            const jenisBantuanCount = {};
            data.forEach(item => {
                jenisBantuanCount[item.jenisBantuan] = (jenisBantuanCount[item.jenisBantuan] || 0) + item.jumlah;
            });
            
            window.jenisBantuanChart.data.labels = Object.keys(jenisBantuanCount);
            window.jenisBantuanChart.data.datasets[0].data = Object.values(jenisBantuanCount);
            window.jenisBantuanChart.data.datasets[0].backgroundColor = [
                '#0d47a1', '#00695c', '#ff8f00', '#5e35b1', '#d81b60', 
                '#00897b', '#f57c00', '#7b1fa2', '#e53935'
            ];
            window.jenisBantuanChart.update();
            
            // Update Kecamatan Chart (Bar)
            const kecamatanCount = {};
            data.forEach(item => {
                kecamatanCount[item.kecamatan] = (kecamatanCount[item.kecamatan] || 0) + item.jumlah;
            });
            
            window.kecamatanChart.data.labels = Object.keys(kecamatanCount);
            window.kecamatanChart.data.datasets[0].data = Object.values(kecamatanCount);
            window.kecamatanChart.update();
            
            // Update Bulanan Chart (Line)
            const bulananCount = {};
            data.forEach(item => {
                const bulan = item.tanggalPenyerahan.split('-')[1]; // Extract month
                bulananCount[bulan] = (bulananCount[bulan] || 0) + item.jumlah;
            });
            
            // Fill in all months
            const allMonths = ['01', '02', '03', '04', '05', '06', '07', '08', '09', '10', '11', '12'];
            const bulananData = allMonths.map(month => bulananCount[month] || 0);
            
            window.bulananChart.data.labels = ['Jan', 'Feb', 'Mar', 'Apr', 'Mei', 'Jun', 'Jul', 'Agu', 'Sep', 'Okt', 'Nov', 'Des'];
            window.bulananChart.data.datasets[0].data = bulananData;
            window.bulananChart.update();
            
            // Update Statistik Jenis Bantuan Chart (Doughnut) - same as jenis bantuan
            window.statJenisBantuanChart.data.labels = Object.keys(jenisBantuanCount);
            window.statJenisBantuanChart.data.datasets[0].data = Object.values(jenisBantuanCount);
            window.statJenisBantuanChart.data.datasets[0].backgroundColor = [
                '#0d47a1', '#00695c', '#ff8f00', '#5e35b1', '#d81b60', 
                '#00897b', '#f57c00', '#7b1fa2', '#e53935'
            ];
            window.statJenisBantuanChart.update();
            
            // Update Statistik Kecamatan Chart (Bar) - same as kecamatan
            window.statKecamatanChart.data.labels = Object.keys(kecamatanCount);
            window.statKecamatanChart.data.datasets[0].data = Object.values(kecamatanCount);
            window.statKecamatanChart.update();
        }
        
        // Update dashboard statistics
        function updateDashboardStats() {
            // Total penerima
            document.getElementById('totalPenerima').textContent = appData.bantuan.length;
            
            // Total desa
            const uniqueDesa = new Set(appData.bantuan.map(item => item.desa));
            document.getElementById('totalDesa').textContent = uniqueDesa.size;
            
            // Total jenis bantuan
            const uniqueJenis = new Set(appData.bantuan.map(item => item.jenisBantuan));
            document.getElementById('totalBantuan').textContent = uniqueJenis.size;
            
            // Tahun aktif
            document.getElementById('tahunAktif').textContent = appData.settings.tahunAktif;
            
            // Recent activities
            const recentActivities = document.getElementById('recentActivities');
            recentActivities.innerHTML = '';
            
            if (appData.bantuan.length === 0) {
                recentActivities.innerHTML = '<tr><td colspan="5" class="text-center">Tidak ada data aktivitas</td></tr>';
                return;
            }
            
            // Get last 5 activities
            const lastActivities = [...appData.bantuan]
                .sort((a, b) => b.id - a.id)
                .slice(0, 5);
            
            lastActivities.forEach(activity => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${activity.tanggalPenyerahan}</td>
                    <td>${activity.namaPenerima}</td>
                    <td>${activity.desa}</td>
                    <td>${activity.jenisBantuan}</td>
                    <td>${activity.jumlah}</td>
                `;
                recentActivities.appendChild(row);
            });
        }
        
        // Backup data
        function backupData() {
            try {
                const dataStr = JSON.stringify(appData);
                const dataUri = 'data:application/json;charset=utf-8,'+ encodeURIComponent(dataStr);
                
                const exportFileDefaultName = `backup_barjas_${new Date().toISOString().split('T')[0]}.json`;
                
                const linkElement = document.createElement('a');
                linkElement.setAttribute('href', dataUri);
                linkElement.setAttribute('download', exportFileDefaultName);
                linkElement.click();
                
                showNotification('Sukses', 'Backup data berhasil dibuat.', 'success');
            } catch (error) {
                console.error('Error backing up data:', error);
                showNotification('Error', 'Gagal membuat backup data.', 'error');
            }
        }
        
        // Restore data
        function restoreData() {
            const fileInput = document.getElementById('restoreFile');
            if (!fileInput.files.length) {
                showNotification('Peringatan', 'Pilih file backup terlebih dahulu.', 'warning');
                return;
            }
            
            const file = fileInput.files[0];
            const reader = new FileReader();
            
            reader.onload = function(e) {
                try {
                    const backupData = JSON.parse(e.target.result);
                    
                    // Validate backup data structure
                    if (!backupData.bantuan || !backupData.settings) {
                        throw new Error('Format file backup tidak valid.');
                    }
                    
                    if (!confirm('Apakah Anda yakin ingin memulihkan data dari backup? Data saat ini akan digantikan.')) {
                        return;
                    }
                    
                    // Replace current data with backup data
                    appData = backupData;
                    
                    // Save to localStorage
                    saveData();
                    
                    // Update UI
                    updateDashboardStats();
                    loadDataTable();
                    
                    // Reset file input
                    fileInput.value = '';
                    document.getElementById('btnRestoreData').disabled = true;
                    
                    showNotification('Sukses', 'Data berhasil dipulihkan dari backup.', 'success');
                } catch (error) {
                    console.error('Error restoring data:', error);
                    showNotification('Error', 'Gagal memulihkan data. File mungkin rusak atau format tidak sesuai.', 'error');
                }
            };
            
            reader.onerror = function() {
                showNotification('Error', 'Gagal membaca file backup.', 'error');
            };
            
            reader.readAsText(file);
        }
        
        // Delete all data
        function hapusSemuaData() {
            if (!confirm('APAKAH ANDA YAKIN INGIN MENGHAPUS SEMUA DATA? TINDAKAN INI TIDAK DAPAT DIBATALKAN!')) {
                return;
            }
            
            // Clear all data
            appData.bantuan = [];
            
            // Save to localStorage
            saveData();
            
            // Update UI
            updateDashboardStats();
            loadDataTable();
            
            // Close modal
            const modal = bootstrap.Modal.getInstance(document.getElementById('confirmDeleteModal'));
            modal.hide();
            
            showNotification('Sukses', 'Semua data berhasil dihapus.', 'success');
        }
        
        // Change security code
        function changeSecurityCode() {
            const newCode = document.getElementById('newSecurityCode').value;
            const confirmCode = document.getElementById('confirmSecurityCode').value;
            
            if (!newCode || !confirmCode) {
                showNotification('Peringatan', 'Harap isi kedua field kode keamanan.', 'warning');
                return;
            }
            
            if (newCode !== confirmCode) {
                showNotification('Error', 'Kode keamanan tidak cocok.', 'error');
                return;
            }
            
            // Update security code
            appData.settings.securityCode = newCode;
            
            // Save to localStorage
            saveData();
            
            // Clear fields
            document.getElementById('newSecurityCode').value = '';
            document.getElementById('confirmSecurityCode').value = '';
            
            showNotification('Sukses', 'Kode keamanan berhasil diubah.', 'success');
        }
        
        // Show notification
        function showNotification(title, message, type = 'info') {
            const toast = document.getElementById('notificationToast');
            const toastTitle = document.getElementById('toastTitle');
            const toastMessage = document.getElementById('toastMessage');
            const toastTime = document.getElementById('toastTime');
            
            // Set toast content
            toastTitle.textContent = title;
            toastMessage.textContent = message;
            toastTime.textContent = new Date().toLocaleTimeString('id-ID');
            
            // Set toast color based on type
            toast.classList.remove('bg-success', 'bg-danger', 'bg-warning', 'bg-info');
            switch (type) {
                case 'success':
                    toast.classList.add('bg-success');
                    break;
                case 'error':
                    toast.classList.add('bg-danger');
                    break;
                case 'warning':
                    toast.classList.add('bg-warning');
                    break;
                default:
                    toast.classList.add('bg-info');
            }
            
            // Show toast
            const bsToast = new bootstrap.Toast(toast);
            bsToast.show();
        }
        
        // Load data from localStorage
        function loadData() {
            const savedData = localStorage.getItem('barjasData');
            if (savedData) {
                try {
                    appData = JSON.parse(savedData);
                } catch (error) {
                    console.error('Error parsing saved data:', error);
                    // Initialize with default data if parsing fails
                    appData = {
                        bantuan: [],
                        settings: {
                            securityCode: "BARJAS2025",
                            tahunAktif: 2025
                        }
                    };
                }
            }
        }
        
        // Save data to localStorage
        function saveData() {
            localStorage.setItem('barjasData', JSON.stringify(appData));
        }
        
        // Login functions
        function attemptLogin() {
            if (isBlocked) {
                showNotification('Error', 'Anda telah diblokir sementara. Silakan coba lagi nanti.', 'error');
                return;
            }
            
            const enteredCode = document.getElementById('securityCode').value;
            const correctCode = appData.settings.securityCode;
            
            // Show loading state
            document.getElementById('loginButton').disabled = true;
            document.getElementById('loginSpinner').classList.remove('d-none');
            document.querySelector('.login-button-text').textContent = 'Memeriksa...';
            
            // Simulate network delay
            setTimeout(() => {
                if (enteredCode === correctCode) {
                    // Successful login
                    loginAttempts = 0;
                    document.getElementById('attemptsCount').textContent = '';
                    
                    // Hide login modal and show app content
                    document.getElementById('loginModal').classList.remove('show');
                    document.getElementById('loginModal').style.display = 'none';
                    document.body.classList.remove('modal-open');
                    document.getElementById('appContent').classList.remove('app-content-unauthenticated');
                    
                    // Set authentication flag
                    localStorage.setItem('barjasAuthenticated', 'true');
                    
                    showNotification('Selamat Datang', 'Berhasil masuk ke aplikasi BARJAS.', 'success');
                } else {
                    // Failed login
                    loginAttempts++;
                    
                    // Update attempts count display
                    document.getElementById('attemptsCount').textContent = `Percobaan gagal: ${loginAttempts}`;
                    
                    // Apply shake animation to form
                    document.getElementById('loginForm').classList.add('login-shake');
                    setTimeout(() => {
                        document.getElementById('loginForm').classList.remove('login-shake');
                    }, 600);
                    
                    if (loginAttempts >= 3) {
                        // Block after 3 failed attempts
                        isBlocked = true;
                        document.getElementById('blockedMessage').classList.remove('d-none');
                        document.getElementById('loginForm').classList.add('d-none');
                        
                        // Start countdown
                        let countdown = 30;
                        document.getElementById('countdown').textContent = countdown;
                        
                        blockTimeout = setInterval(() => {
                            countdown--;
                            document.getElementById('countdown').textContent = countdown;
                            
                            if (countdown <= 0) {
                                clearInterval(blockTimeout);
                                isBlocked = false;
                                loginAttempts = 0;
                                document.getElementById('blockedMessage').classList.add('d-none');
                                document.getElementById('loginForm').classList.remove('d-none');
                                document.getElementById('attemptsCount').textContent = '';
                            }
                        }, 1000);
                    }
                    
                    showNotification('Error', 'Kode keamanan salah.', 'error');
                }
                
                // Reset login button state
                document.getElementById('loginButton').disabled = false;
                document.getElementById('loginSpinner').classList.add('d-none');
                document.querySelector('.login-button-text').textContent = 'Masuk ke Aplikasi';
            }, 1000);
        }
        
        // Logout
        function logout() {
            if (confirm('Apakah Anda yakin ingin keluar dari aplikasi?')) {
                // Clear authentication flag
                localStorage.removeItem('barjasAuthenticated');
                
                // Show login modal again
                document.getElementById('appContent').classList.add('app-content-unauthenticated');
                document.getElementById('loginModal').classList.add('show');
                document.getElementById('loginModal').style.display = 'block';
                document.body.classList.add('modal-open');
                
                // Reset login form
                document.getElementById('securityCode').value = '';
                document.getElementById('attemptsCount').textContent = '';
                document.getElementById('blockedMessage').classList.add('d-none');
                document.getElementById('loginForm').classList.remove('d-none');
                
                showNotification('Info', 'Anda telah keluar dari aplikasi.', 'info');
            }
        }
    </script>
</body>
</html>
