<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>APLIKASI BARJAS - SISTEM BANTUAN</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-datepicker/1.9.0/css/bootstrap-datepicker.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.28/jspdf.plugin.autotable.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <style>
        :root {
            --primary-color: #0d47a1;
            --secondary-color: #00695c;
            --accent-color: #ff8f00;
            --light-blue: #e3f2fd;
            --dark-blue: #082e5c;
            --gradient-primary: linear-gradient(135deg, var(--primary-color), var(--dark-blue));
            --gradient-secondary: linear-gradient(135deg, var(--secondary-color), #004d40);
            --gradient-accent: linear-gradient(135deg, var(--accent-color), #e65100);
            --shadow-sm: 0 2px 8px rgba(0,0,0,0.08);
            --shadow-md: 0 4px 16px rgba(0,0,0,0.12);
            --shadow-lg: 0 8px 28px rgba(0,0,0,0.15);
            --login-gradient: linear-gradient(135deg, #0d47a1, #00695c, #ff8f00);
        }
        
        body {
            background: linear-gradient(135deg, #f5f9ff 0%, #e8f5e9 100%);
            font-family: 'Poppins', 'Segoe UI', sans-serif;
            min-height: 100vh;
            padding: 10px 0;
            overflow-x: hidden;
        }
        
        .app-container {
            max-width: 1600px;
            margin: 0 auto;
            background: white;
            box-shadow: var(--shadow-lg);
            border-radius: 12px;
            overflow: hidden;
            position: relative;
            z-index: 10;
        }
        
        .app-header {
            background: var(--gradient-primary);
            color: white;
            padding: 20px 15px;
            text-align: center;
            position: relative;
            overflow: hidden;
        }
        
        .app-header::before {
            content: "";
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(255,255,255,0.15) 0%, transparent 70%);
            pointer-events: none;
        }
        
        .app-logo {
            font-size: 2.5rem;
            margin-bottom: 10px;
            position: relative;
            z-index: 1;
        }
        
        .app-title {
            font-size: 1.8rem;
            font-weight: 800;
            margin: 0;
            position: relative;
            z-index: 1;
            text-shadow: 1px 1px 4px rgba(0,0,0,0.3);
        }
        
        .app-subtitle {
            font-size: 1rem;
            opacity: 0.95;
            position: relative;
            z-index: 1;
            font-weight: 300;
            letter-spacing: 0.5px;
            margin-bottom: 5px;
        }
        
        .nav-pills .nav-link {
            border-radius: 8px;
            margin-bottom: 8px;
            padding: 12px 15px;
            font-weight: 500;
            color: #444;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            font-size: 0.9rem;
        }
        
        .nav-pills .nav-link:hover {
            background-color: #f0f7ff;
            transform: translateX(3px);
        }
        
        .nav-pills .nav-link.active {
            background: var(--gradient-primary);
            font-weight: 600;
            box-shadow: var(--shadow-md);
            transform: translateX(3px);
            color: white;
        }
        
        .section-title {
            border-left: 4px solid var(--primary-color);
            padding-left: 12px;
            margin: 20px 0;
            font-weight: 700;
            color: var(--dark-blue);
            font-size: 1.4rem;
            position: relative;
        }
        
        .section-title::after {
            content: "";
            position: absolute;
            bottom: -5px;
            left: 12px;
            width: 40px;
            height: 2px;
            background: var(--gradient-primary);
            border-radius: 2px;
        }
        
        .btn-primary {
            background: var(--gradient-primary);
            border: none;
            padding: 10px 20px;
            font-weight: 600;
            box-shadow: var(--shadow-md);
            border-radius: 8px;
            transition: all 0.3s;
            font-size: 0.9rem;
        }
        
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-lg);
        }
        
        .btn-success {
            background: var(--gradient-secondary);
            border: none;
            padding: 10px 20px;
            font-weight: 600;
            box-shadow: var(--shadow-md);
            border-radius: 8px;
            transition: all 0.3s;
            font-size: 0.9rem;
        }
        
        .btn-success:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-lg);
        }
        
        .btn-warning {
            background: var(--gradient-accent);
            border: none;
            padding: 10px 20px;
            font-weight: 600;
            box-shadow: var(--shadow-md);
            border-radius: 8px;
            transition: all 0.3s;
            font-size: 0.9rem;
        }
        
        .btn-warning:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-lg);
        }
        
        .form-label {
            font-weight: 600;
            color: #444;
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            font-size: 0.9rem;
        }
        
        .form-label i {
            margin-right: 6px;
            color: var(--primary-color);
        }
        
        .form-control, .form-select {
            border-radius: 8px;
            padding: 12px 15px;
            border: 1px solid #ddd;
            transition: all 0.3s;
            box-shadow: var(--shadow-sm);
            font-size: 0.9rem;
        }
        
        .form-control:focus, .form-select:focus {
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(13, 71, 161, 0.2);
            transform: translateY(-2px);
        }
        
        .copyright {
            text-align: center;
            padding: 20px;
            background-color: var(--light-blue);
            color: var(--dark-blue);
            font-size: 0.9rem;
            font-weight: 500;
        }
        
        .data-table {
            font-size: 0.85rem;
            border-collapse: separate;
            border-spacing: 0;
            box-shadow: var(--shadow-sm);
            border-radius: 8px;
            overflow: hidden;
        }
        
        .data-table th {
            background: var(--gradient-primary);
            color: white;
            font-weight: 600;
            padding: 12px 10px;
            text-align: center;
            position: relative;
            font-size: 0.85rem;
        }
        
        .data-table th::after {
            content: "";
            position: absolute;
            bottom: 0;
            left: 0;
            width: 100%;
            height: 1px;
            background: rgba(255,255,255,0.3);
        }
        
        .data-table td {
            padding: 10px 8px;
            vertical-align: middle;
            border-bottom: 1px solid #eee;
            font-size: 0.85rem;
        }
        
        .data-table tr:nth-child(even) {
            background-color: #f9fbff;
        }
        
        .data-table tr:hover {
            background-color: #edf5ff;
        }
        
        .feature-icon {
            font-size: 1.1rem;
            margin-right: 8px;
            width: 24px;
            text-align: center;
        }
        
        .card {
            border-radius: 10px;
            border: none;
            box-shadow: var(--shadow-md);
            transition: all 0.3s ease;
            overflow: hidden;
            margin-bottom: 15px;
        }
        
        .card:hover {
            transform: translateY(-5px);
            box-shadow: var(--shadow-lg);
        }
        
        .card-header {
            border-radius: 10px 10px 0 0 !important;
            font-weight: 600;
            padding: 15px 20px;
            background: var(--gradient-primary);
            color: white;
            font-size: 0.95rem;
        }
        
        .stats-box {
            text-align: center;
            padding: 20px 15px;
            border-radius: 10px;
            background: white;
            box-shadow: var(--shadow-md);
            transition: all 0.3s;
            position: relative;
            overflow: hidden;
            margin-bottom: 15px;
        }
        
        .stats-box::before {
            content: "";
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 4px;
            background: var(--gradient-primary);
            border-radius: 2px;
        }
        
        .stats-box:hover {
            transform: translateY(-3px);
            box-shadow: var(--shadow-lg);
        }
        
        .stats-number {
            font-size: 1.8rem;
            font-weight: 800;
            color: var(--primary-color);
            margin: 10px 0;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.1);
        }
        
        .stats-label {
            font-size: 0.9rem;
            color: #666;
            font-weight: 500;
        }
        
        .notification-toast {
            position: fixed;
            bottom: 20px;
            right: 20px;
            z-index: 1050;
            min-width: 280px;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: var(--shadow-lg);
            max-width: calc(100vw - 40px);
        }
        
        .input-error {
            border-color: #dc3545;
            box-shadow: 0 0 0 3px rgba(220, 53, 69, 0.2);
        }
        
        .error-message {
            color: #dc3545;
            font-size: 0.8rem;
            margin-top: 5px;
            display: none;
            font-weight: 500;
        }
        
        .watermark {
            position: absolute;
            bottom: 10px;
            right: 15px;
            opacity: 0.8;
            font-size: 0.8rem;
            color: white;
            font-weight: 300;
        }
        
        .control-panel {
            background: #f8f9fa;
            border-radius: 8px;
            padding: 15px;
            margin-top: 15px;
            box-shadow: var(--shadow-sm);
        }
        
        .control-title {
            font-size: 1rem;
            color: var(--primary-color);
            font-weight: 600;
            margin-bottom: 15px;
            padding-bottom: 8px;
            border-bottom: 1px solid var(--light-blue);
        }
        
        .floating-action-btn {
            position: fixed;
            bottom: 20px;
            right: 20px;
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background: var(--gradient-primary);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: var(--shadow-lg);
            z-index: 1000;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .floating-action-btn:hover {
            transform: scale(1.1) rotate(90deg);
        }
        
        .filter-section {
            background: white;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 20px;
            box-shadow: var(--shadow-sm);
        }
        
        .badge-custom {
            background: var(--gradient-primary);
            color: white;
            padding: 6px 12px;
            border-radius: 16px;
            font-weight: 600;
            font-size: 0.8rem;
        }
        
        .mobile-menu-btn {
            display: none;
            position: fixed;
            top: 15px;
            left: 15px;
            z-index: 1050;
            background: var(--gradient-primary);
            color: white;
            border: none;
            border-radius: 50%;
            width: 45px;
            height: 45px;
            box-shadow: var(--shadow-lg);
        }
        
        .sidebar-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 1040;
        }
        
        /* Animations */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .animate-fadeIn {
            animation: fadeIn 0.5s ease forwards;
        }
        
        /* Custom scrollbar */
        ::-webkit-scrollbar {
            width: 6px;
        }
        
        ::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 8px;
        }
        
        ::-webkit-scrollbar-thumb {
            background: var(--primary-color);
            border-radius: 8px;
        }
        
        ::-webkit-scrollbar-thumb:hover {
            background: var(--dark-blue);
        }
        
        /* Responsive styles */
        @media (max-width: 991.98px) {
            .col-md-3.col-lg-2 {
                position: fixed;
                left: -300px;
                top: 0;
                bottom: 0;
                z-index: 1050;
                width: 280px;
                transition: left 0.3s ease;
                overflow-y: auto;
                padding-top: 60px;
            }
            
            .col-md-3.col-lg-2.mobile-show {
                left: 0;
            }
            
            .col-md-9.col-lg-10 {
                width: 100%;
                flex: 0 0 100%;
                max-width: 100%;
            }
            
            .mobile-menu-btn {
                display: flex;
                align-items: center;
                justify-content: center;
            }
            
            .sidebar-overlay.mobile-show {
                display: block;
            }
        }
        
        /* Print Styles - IMPROVED FOR LANDSCAPE */
        @media print {
            @page {
                size: landscape;
                margin: 0.5cm;
            }
            
            body * {
                visibility: hidden;
            }
            
            .app-container, .app-container * {
                visibility: visible;
            }
            
            .app-container {
                position: absolute;
                left: 0;
                top: 0;
                width: 100%;
                box-shadow: none;
            }
            
            .nav-pills, .mobile-menu-btn, .sidebar-overlay, .floating-action-btn,
            .btn-group, .filter-section, .toast {
                display: none !important;
            }
            
            .col-md-3.col-lg-2.p-4.bg-light {
                display: none !important;
            }
            
            .col-md-9.col-lg-10.p-5 {
                width: 100%;
                flex: 0 0 100%;
                max-width: 100%;
                padding: 0 !important;
            }
            
            .copyright {
                display: none;
            }
            
            .data-table {
                font-size: 10px;
                width: 100% !important;
            }
            
            .data-table th, .data-table td {
                padding: 4px 2px;
            }
            
            /* Sembunyikan kolom aksi dan link Google Drive saat mencetak */
            .data-table th:last-child,
            .data-table td:last-child {
                display: none !important;
            }
            
            /* Judul untuk laporan cetak */
            .print-header {
                display: block !important;
                text-align: center;
                margin-bottom: 15px;
            }
            
            .print-title {
                font-size: 18px;
                font-weight: bold;
                margin-bottom: 5px;
            }
            
            .print-subtitle {
                font-size: 14px;
                margin-bottom: 10px;
            }
            
            .print-date {
                font-size: 12px;
                text-align: right;
                margin-bottom: 10px;
            }
        }

        /* WhatsApp link style */
        .whatsapp-link {
            color: #25D366;
            text-decoration: none;
        }
        
        .whatsapp-link:hover {
            text-decoration: underline;
        }
        
        /* View Link Button */
        .btn-view {
            background: linear-gradient(135deg, #17a2b8, #138496);
            color: white;
            border: none;
            padding: 5px 10px;
            border-radius: 4px;
            font-size: 0.8rem;
        }
        
        .btn-view:hover {
            background: linear-gradient(135deg, #138496, #117a8b);
            color: white;
        }
        
        /* Undo Button */
        .btn-undo {
            background: linear-gradient(135deg, #6c757d, #5a6268);
            color: white;
            border: none;
        }
        
        .btn-undo:hover {
            background: linear-gradient(135deg, #5a6268, #4e555b);
            color: white;
        }
        
        /* WhatsApp number link in table */
        .whatsapp-number {
            color: #25D366;
            cursor: pointer;
            text-decoration: underline;
        }
        
        /* Welcome Modal Styles */
        .welcome-modal .modal-content {
            border-radius: 15px;
            overflow: hidden;
            border: none;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }
        
        .welcome-header {
            background: var(--gradient-primary);
            color: white;
            text-align: center;
            padding: 25px;
        }
        
        .welcome-icon {
            font-size: 3rem;
            margin-bottom: 15px;
        }
        
        .welcome-body {
            padding: 25px;
            text-align: center;
        }
        
        .welcome-footer {
            background: #f8f9fa;
            padding: 15px;
            text-align: center;
            border-top: 1px solid #eee;
        }
        
        .countdown-timer {
            font-size: 0.9rem;
            color: #6c757d;
            margin-top: 10px;
        }
        
        /* Button untuk cetak per data */
        .btn-print-individual {
            background: linear-gradient(135deg, #6f42c1, #5a2d95);
            color: white;
            border: none;
            padding: 5px 10px;
            border-radius: 4px;
            font-size: 0.8rem;
        }
        
        .btn-print-individual:hover {
            background: linear-gradient(135deg, #5a2d95, #4a2479);
            color: white;
        }
        
        /* Developer Info Styles */
        .developer-info {
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            border-radius: 10px;
            padding: 20px;
            margin-top: 20px;
            box-shadow: var(--shadow-sm);
        }
        
        .developer-logo {
            max-width: 120px;
            margin-bottom: 15px;
            border-radius: 8px;
        }
        
        .developer-contact a {
            color: var(--primary-color);
            text-decoration: none;
            transition: all 0.3s;
        }
        
        .developer-contact a:hover {
            color: var(--dark-blue);
            text-decoration: underline;
        }
        
        /* Welcome Splash Screen */
        .welcome-splash {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: var(--gradient-primary);
            color: white;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 9999;
            transition: opacity 0.5s ease;
        }
        
        .welcome-splash-content {
            text-align: center;
            max-width: 600px;
            padding: 30px;
        }
        
        .welcome-splash-logo {
            font-size: 4rem;
            margin-bottom: 20px;
        }
        
        .welcome-splash-title {
            font-size: 2.2rem;
            font-weight: 800;
            margin-bottom: 15px;
        }
        
        .welcome-splash-message {
            font-size: 1.1rem;
            line-height: 1.6;
            margin-bottom: 25px;
        }
        
        .welcome-splash-countdown {
            font-size: 1rem;
            margin-top: 20px;
        }
        
        .welcome-splash-close {
            position: absolute;
            top: 20px;
            right: 20px;
            background: rgba(255,255,255,0.2);
            border: none;
            color: white;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .welcome-splash-close:hover {
            background: rgba(255,255,255,0.3);
            transform: rotate(90deg);
        }
        
        /* Loading spinner */
        .spinner-border-sm {
            width: 1rem;
            height: 1rem;
        }

        /* Login Modal Styles */
        .login-modal .modal-content {
            border-radius: 15px;
            overflow: hidden;
            border: none;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
        }

        .login-header {
            background: var(--login-gradient);
            color: white;
            text-align: center;
            padding: 25px 20px;
            position: relative;
        }

        .login-icon {
            font-size: 3rem;
            margin-bottom: 15px;
            color: white;
        }

        .login-title {
            font-size: 1.8rem;
            font-weight: 700;
            margin: 0;
        }

        .login-subtitle {
            font-size: 1rem;
            opacity: 0.9;
            margin: 5px 0 0;
        }

        .login-body {
            padding: 25px;
            position: relative;
            z-index: 1;
        }

        .login-form-group {
            margin-bottom: 20px;
        }

        .login-form-label {
            font-weight: 600;
            color: var(--dark-blue);
            margin-bottom: 8px;
            display: flex;
            align-items: center;
        }

        .login-form-label i {
            margin-right: 10px;
            color: var(--dark-blue);
        }

        .login-form-control {
            border-radius: 8px;
            padding: 12px 15px;
            border: 2px solid #ddd;
            transition: all 0.3s;
        }

        .login-form-control:focus {
            border-color: var(--dark-blue);
            box-shadow: 0 0 0 3px rgba(13, 71, 161, 0.2);
        }

        .login-input-group-text {
            background: var(--light-blue);
            border: 2px solid #ddd;
            border-left: none;
        }

        .btn-login {
            background: var(--gradient-secondary);
            color: white;
            border: none;
            padding: 12px;
            font-weight: 600;
            border-radius: 8px;
            width: 100%;
            transition: all 0.3s;
            margin-top: 10px;
        }

        .btn-login:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 105, 92, 0.4);
        }

        .btn-login:disabled {
            background: #ccc;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        .login-security-notice {
            text-align: center;
            margin-top: 20px;
            font-size: 0.85rem;
            color: #666;
        }

        .login-attempts-count {
            text-align: center;
            font-size: 0.9rem;
            color: #ff8f00;
            font-weight: 500;
            margin-top: 5px;
        }

        .login-blocked-message {
            text-align: center;
            background: rgba(220, 53, 69, 0.1);
            border-radius: 8px;
            padding: 15px;
            margin-top: 20px;
            color: #dc3545;
            font-weight: 500;
        }

        .login-countdown {
            font-size: 1.2rem;
            font-weight: 700;
            color: var(--dark-blue);
        }

        .login-developer-info {
            background: var(--light-blue);
            border-radius: 10px;
            padding: 20px;
            margin-top: 25px;
            text-align: center;
        }

        .login-developer-logo {
            max-width: 180px;
            margin-bottom: 15px;
            border-radius: 8px;
        }

        .login-developer-contact a {
            color: var(--dark-blue);
            text-decoration: none;
            transition: all 0.3s;
            display: inline-block;
            margin: 5px 0;
        }

        .login-developer-contact a:hover {
            color: var(--primary-color);
            text-decoration: underline;
            transform: translateY(-2px);
        }

        .login-copyright {
            text-align: center;
            margin-top: 20px;
            color: #666;
            font-size: 0.9rem;
            opacity: 0.9;
        }

        /* Animations */
        @keyframes login-shake {
            0%, 100% { transform: translateX(0); }
            10%, 30%, 50%, 70%, 90% { transform: translateX(-10px); }
            20%, 40%, 60%, 80% { transform: translateX(10px); }
        }

        .login-shake {
            animation: login-shake 0.6s cubic-bezier(.36,.07,.19,.97) both;
        }

        /* Login particle background */
        #login-particles {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 1040; /* Higher than modal backdrop */
            display: none;
        }

        /* Link Google Drive dalam tabel */
        .drive-link {
            color: #0d47a1;
            text-decoration: none;
            cursor: pointer;
        }

        .drive-link:hover {
            text-decoration: underline;
        }

        /* Modal untuk menambah link */
        .link-modal .modal-dialog {
            max-width: 600px;
        }
        
        /* App content when not authenticated */
        .app-content-unauthenticated {
            display: none;
        }
    </style>
</head>
<body>
    <!-- Login Modal -->
    <div class="modal fade login-modal" id="loginModal" tabindex="-1" aria-hidden="true" data-bs-backdrop="static" data-bs-keyboard="false">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="login-header">
                    <div class="login-icon">
                        <i class="fas fa-lock"></i>
                    </div>
                    <h2 class="login-title">AUTHENTICATION REQUIRED</h2>
                    <p class="login-subtitle">Masukkan Kode Keamanan untuk Mengakses Aplikasi</p>
                </div>
                <div class="login-body">
                    <form id="loginForm">
                        <div class="mb-3 login-form-group">
                            <label class="form-label login-form-label">
                                <i class="fas fa-key"></i> Kode Keamanan
                            </label>
                            <div class="input-group">
                                <input type="password" class="form-control login-form-control" id="securityCode" placeholder="Masukkan kode akses aplikasi">
                                <button class="btn btn-outline-secondary toggle-password" type="button">
                                    <i class="fas fa-eye"></i>
                                </button>
                            </div>
                            <div class="form-text text-danger login-attempts-count" id="attemptsCount"></div>
                        </div>
                        <button type="submit" class="btn btn-login" id="loginButton">
                            <span class="login-button-text">Masuk ke Aplikasi</span>
                            <span class="spinner-border spinner-border-sm d-none" id="loginSpinner"></span>
                        </button>
                    </form>
                    
                    <div class="login-blocked-message d-none" id="blockedMessage">
                        <i class="fas fa-ban me-2"></i>
                        <span id="blockedText">Terlalu banyak percobaan gagal. Silakan coba lagi dalam </span>
                        <span class="login-countdown" id="countdown">30</span> detik.
                    </div>
                    
                    <div class="login-security-notice">
                        <i class="fas fa-info-circle me-2"></i>
                        Hubungi Administrator untuk mendapatkan kode akses
                    </div>
                    
                    <div class="login-developer-info">
                        <h5 class="mb-3">Developer Information</h5>
                        <div class="login-developer-contact">
                            <p><i class="fab fa-whatsapp me-2"></i> <a href="https://wa.me/6285647709114" target="_blank">+62 856-4770-9114</a></p>
                            <p><i class="fas fa-envelope me-2"></i> <a href="mailto:admin@anekamarket.my.id">admin@anekamarket.my.id</a></p>
                        </div>
                    </div>
                    
                    <div class="login-copyright">
                        &copy; 2025 Lentera karya Situbondo
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Login particle background -->
    <div id="login-particles"></div>
    
    <!-- Welcome Splash Screen -->
    <div class="welcome-splash" id="welcomeSplash">
        <button class="welcome-splash-close" id="closeSplash">
            <i class="fas fa-times"></i>
        </button>
        <div class="welcome-splash-content">
            <div class="welcome-splash-logo">
                <i class="fas fa-hands-helping"></i>
            </div>
            <h1 class="welcome-splash-title">SISTEM BANTUAN BARJAS</h1>
            <p class="welcome-splash-message">
                Aplikasi Sistem Bantuan BARJAS merupakan platform terpadu yang dirancang untuk mentransformasi pendataan, penyaluran, 
                dan monitoring program bantuan pemerintah. Aplikasi ini kami ciptakan untuk mendorong efisiensi, akurasi, 
                dan transparansi dalam pengelolaan bantuan, guna mempercepat penyerapan dan meningkatkan akuntabilitas.
            </p>
            <div class="welcome-splash-countdown" id="splashCountdown">
                Membuka aplikasi dalam <span id="countdownTimer">5</span> detik...
            </div>
        </div>
    </div>
    
    <!-- Main Application Content (initially hidden) -->
    <div class="app-content-unauthenticated" id="appContent">
        <!-- Mobile Menu Button -->
        <button class="mobile-menu-btn" id="mobileMenuBtn">
            <i class="fas fa-bars"></i>
        </button>
        
        <!-- Sidebar Overlay -->
        <div class="sidebar-overlay" id="sidebarOverlay"></div>
        
        <div class="app-container animate-fadeIn">
            <div class="app-header">
                <div class="app-logo">
                    <i class="fas fa-hands-helping"></i>
                </div>
                <h1 class="app-title">BARJAS</h1>
                <p class="app-subtitle">Sistem Bantuan Terpadu</p>
                <p class="app-subtitle" id="institutionName">Dinas Peternakan dan Perikanan Kabupaten Situbondo</p>
                <div class="watermark">v2.1.0</div>
            </div>
            
            <div class="row g-0">
                <!-- Sidebar Navigation -->
                <div class="col-md-3 col-lg-2 p-4 bg-light" id="sidebar">
                    <ul class="nav nav-pills flex-column mb-auto">
                        <li class="nav-item">
                            <a href="#" class="nav-link active" data-bs-target="dashboard">
                                <span class="feature-icon"><i class="fas fa-home"></i></span>
                                Dashboard
                            </a>
                        </li>
                        <li class="nav-item">
                            <a href="#" class="nav-link" data-bs-target="inputData">
                                <span class="feature-icon"><i class="fas fa-pen-to-square"></i></span>
                                Input Data Bantuan
                            </a>
                        </li>
                        <li class="nav-item">
                            <a href="#" class="nav-link" data-bs-target="dataTable">
                                <span class="feature-icon"><i class="fas fa-table"></i></span>
                                Tabel Data
                            </a>
                        </li>
                        <li class="nav-item">
                            <a href="#" class="nav-link" data-bs-target="statistik">
                                <span class="feature-icon"><i class="fas fa-chart-pie"></i></span>
                                Statistik
                            </a>
                        </li>
                        <li class="nav-item">
                            <a href="#" class="nav-link" data-bs-target="pengaturan">
                                <span class="feature-icon"><i class="fas fa-gear"></i></span>
                                Pengaturan
                            </a>
                        </li>
                    </ul>
                    
                    <hr>
                    
                    <!-- Developer Info -->
                    <div class="developer-info">
                        <h6 class="mb-3">Developer Support</h6>
                        <div class="developer-contact">
                            <p><i class="fab fa-whatsapp me-2"></i> <a href="https://wa.me/6285647709114" target="_blank">+62 856-4770-9114</a></p>
                            <p><i class="fas fa-envelope me-2"></i> <a href="mailto:admin@anekamarket.my.id">admin@anekamarket.my.id</a></p>
                        </div>
                    </div>
                </div>
                
                <!-- Main Content Area -->
                <div class="col-md-9 col-lg-10 p-5">
                    <!-- Dashboard Section -->
                    <div class="content-section" id="dashboard">
                        <h3 class="section-title">Dashboard</h3>
                        
                        <!-- Stats Overview -->
                        <div class="row">
                            <div class="col-md-3">
                                <div class="stats-box">
                                    <div class="stats-icon">
                                        <i class="fas fa-users fa-2x text-primary"></i>
                                    </div>
                                    <div class="stats-number" id="totalPenerima">0</div>
                                    <div class="stats-label">Total Penerima Bantuan</div>
                                </div>
                            </div>
                            <div class="col-md-3">
                                <div class="stats-box">
                                    <div class="stats-icon">
                                        <i class="fas fa-box fa-2x text-success"></i>
                                    </div>
                                    <div class="stats-number" id="totalBantuan">0</div>
                                    <div class="stats-label">Jenis Bantuan</div>
                                </div>
                            </div>
                            <div class="col-md-3">
                                <div class="stats-box">
                                    <div class="stats-icon">
                                        <i class="fas fa-map-marker-alt fa-2x text-warning"></i>
                                    </div>
                                    <div class="stats-number" id="totalDesa">0</div>
                                    <div class="stats-label">Desa Terjangkau</div>
                                </div>
                            </div>
                            <div class="col-md-3">
                                <div class="stats-box">
                                    <div class="stats-icon">
                                        <i class="fas fa-check-circle fa-2x text-info"></i>
                                    </div>
                                    <div class="stats-number" id="totalTersalurkan">0</div>
                                    <div class="stats-label">Tersalurkan</div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Charts -->
                        <div class="row mt-4">
                            <div class="col-md-6">
                                <div class="card">
                                    <div class="card-header">
                                        <i class="fas fa-chart-bar me-2"></i> Distribusi Bantuan per Desa
                                    </div>
                                    <div class="card-body">
                                        <canvas id="desaChart" height="250"></canvas>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="card">
                                    <div class="card-header">
                                        <i class="fas fa-chart-pie me-2"></i> Distribusi Jenis Bantuan
                                    </div>
                                    <div class="card-body">
                                        <canvas id="jenisChart" height="250"></canvas>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Recent Activity -->
                        <div class="card mt-4">
                            <div class="card-header">
                                <i class="fas fa-history me-2"></i> Aktivitas Terbaru
                            </div>
                            <div class="card-body">
                                <div class="table-responsive">
                                    <table class="table table-hover data-table">
                                        <thead>
                                            <tr>
                                                <th>Tanggal</th>
                                                <th>Desa</th>
                                                <th>Jenis Bantuan</th>
                                                <th>Penerima</th>
                                                <th>Status</th>
                                            </tr>
                                        </thead>
                                        <tbody id="recentActivityTable">
                                            <!-- Data akan diisi oleh JavaScript -->
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Input Data Section -->
                    <div class="content-section d-none" id="inputData">
                        <h3 class="section-title">Input Data Bantuan</h3>
                        
                        <div class="card">
                            <div class="card-header">
                                <i class="fas fa-pen-to-square me-2"></i> Formulir Input Data
                            </div>
                            <div class="card-body">
                                <form id="dataForm">
                                    <div class="row mb-3">
                                        <div class="col-md-6">
                                            <label class="form-label">
                                                <i class="fas fa-user"></i> Nama Penerima
                                            </label>
                                            <input type="text" class="form-control" id="namaPenerima" required>
                                            <div class="error-message" id="namaError">Nama penerima harus diisi</div>
                                        </div>
                                        <div class="col-md-6">
                                            <label class="form-label">
                                                <i class="fas fa-id-card"></i> NIK
                                            </label>
                                            <input type="text" class="form-control" id="nik" required>
                                            <div class="error-message" id="nikError">NIK harus diisi (16 digit)</div>
                                        </div>
                                    </div>
                                    
                                    <div class="row mb-3">
                                        <div class="col-md-6">
                                            <label class="form-label">
                                                <i class="fas fa-phone"></i> Nomor WhatsApp
                                            </label>
                                            <input type="text" class="form-control" id="whatsapp" required>
                                            <div class="error-message" id="whatsappError">Nomor WhatsApp harus diisi</div>
                                        </div>
                                        <div class="col-md-6">
                                            <label class="form-label">
                                                <i class="fas fa-map-marker-alt"></i> Desa
                                            </label>
                                            <select class="form-select" id="desa" required>
                                                <option value="">Pilih Desa</option>
                                                <option value="Desa Sumberanyar">Desa Sumberanyar</option>
                                                <option value="Desa Banyuputih">Desa Banyuputih</option>
                                                <option value="Desa Sumberejo">Desa Sumberejo</option>
                                                <option value="Desa Kalibagor">Desa Kalibagor</option>
                                                <option value="Desa Patemon">Desa Patemon</option>
                                                <option value="Desa Sumberwaru">Desa Sumberwaru</option>
                                            </select>
                                            <div class="error-message" id="desaError">Desa harus dipilih</div>
                                        </div>
                                    </div>
                                    
                                    <div class="row mb-3">
                                        <div class="col-md-6">
                                            <label class="form-label">
                                                <i class="fas fa-box"></i> Jenis Bantuan
                                            </label>
                                            <select class="form-select" id="jenisBantuan" required>
                                                <option value="">Pilih Jenis Bantuan</option>
                                                <option value="Bibit Lele">Bibit Lele</option>
                                                <option value="Bibit Nila">Bibit Nila</option>
                                                <option value="Pakan Ikan">Pakan Ikan</option>
                                                <option value="Obat-obatan">Obat-obatan</option>
                                                <option value="Peralatan Budidaya">Peralatan Budidaya</option>
                                            </select>
                                            <div class="error-message" id="jenisError">Jenis bantuan harus dipilih</div>
                                        </div>
                                        <div class="col-md-6">
                                            <label class="form-label">
                                                <i class="fas fa-box-open"></i> Jumlah
                                            </label>
                                            <input type="number" class="form-control" id="jumlah" required>
                                            <div class="error-message" id="jumlahError">Jumlah harus diisi</div>
                                        </div>
                                    </div>
                                    
                                    <div class="row mb-3">
                                        <div class="col-md-6">
                                            <label class="form-label">
                                                <i class="fas fa-calendar"></i> Tanggal Penyaluran
                                            </label>
                                            <input type="text" class="form-control datepicker" id="tanggal" required>
                                            <div class="error-message" id="tanggalError">Tanggal harus diisi</div>
                                        </div>
                                        <div class="col-md-6">
                                            <label class="form-label">
                                                <i class="fas fa-link"></i> Link Google Drive (Foto/Dokumen)
                                            </label>
                                            <input type="url" class="form-control" id="driveLink" placeholder="https://drive.google.com/...">
                                            <div class="error-message" id="driveError">Format URL tidak valid</div>
                                        </div>
                                    </div>
                                    
                                    <div class="row mb-3">
                                        <div class="col-md-12">
                                            <label class="form-label">
                                                <i class="fas fa-sticky-note"></i> Keterangan
                                            </label>
                                            <textarea class="form-control" id="keterangan" rows="3"></textarea>
                                        </div>
                                    </div>
                                    
                                    <div class="d-flex justify-content-between mt-4">
                                        <button type="reset" class="btn btn-secondary">
                                            <i class="fas fa-undo me-2"></i> Reset
                                        </button>
                                        <button type="submit" class="btn btn-primary">
                                            <i class="fas fa-save me-2"></i> Simpan Data
                                        </button>
                                    </div>
                                </form>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Data Table Section -->
                    <div class="content-section d-none" id="dataTable">
                        <h3 class="section-title">Tabel Data Bantuan</h3>
                        
                        <!-- Filter Section -->
                        <div class="filter-section mb-4">
                            <div class="row">
                                <div class="col-md-3">
                                    <label class="form-label">Filter berdasarkan Desa</label>
                                    <select class="form-select" id="filterDesa">
                                        <option value="">Semua Desa</option>
                                        <option value="Desa Sumberanyar">Desa Sumberanyar</option>
                                        <option value="Desa Banyuputih">Desa Banyuputih</option>
                                        <option value="Desa Sumberejo">Desa Sumberejo</option>
                                        <option value="Desa Kalibagor">Desa Kalibagor</option>
                                        <option value="Desa Patemon">Desa Patemon</option>
                                        <option value="Desa Sumberwaru">Desa Sumberwaru</option>
                                    </select>
                                </div>
                                <div class="col-md-3">
                                    <label class="form-label">Filter berdasarkan Jenis</label>
                                    <select class="form-select" id="filterJenis">
                                        <option value="">Semua Jenis</option>
                                        <option value="Bibit Lele">Bibit Lele</option>
                                        <option value="Bibit Nila">Bibit Nila</option>
                                        <option value="Pakan Ikan">Pakan Ikan</option>
                                        <option value="Obat-obatan">Obat-obatan</option>
                                        <option value="Peralatan Budidaya">Peralatan Budidaya</option>
                                    </select>
                                </div>
                                <div class="col-md-3">
                                    <label class="form-label">Tanggal Mulai</label>
                                    <input type="text" class="form-control datepicker" id="filterTglMulai">
                                </div>
                                <div class="col-md-3">
                                    <label class="form-label">Tanggal Akhir</label>
                                    <input type="text" class="form-control datepicker" id="filterTglAkhir">
                                </div>
                            </div>
                            <div class="row mt-3">
                                <div class="col-md-12 d-flex justify-content-between">
                                    <div>
                                        <button class="btn btn-primary" id="applyFilter">
                                            <i class="fas fa-filter me-2"></i> Terapkan Filter
                                        </button>
                                        <button class="btn btn-secondary ms-2" id="resetFilter">
                                            <i class="fas fa-undo me-2"></i> Reset
                                        </button>
                                    </div>
                                    <div>
                                        <button class="btn btn-success" id="exportExcel">
                                            <i class="fas fa-file-excel me-2"></i> Excel
                                        </button>
                                        <button class="btn btn-danger ms-2" id="exportPDF">
                                            <i class="fas fa-file-pdf me-2"></i> PDF
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Data Table -->
                        <div class="card">
                            <div class="card-header d-flex justify-content-between align-items-center">
                                <div>
                                    <i class="fas fa-table me-2"></i> Data Bantuan
                                </div>
                                <div class="d-flex align-items-center">
                                    <span class="me-2">Tampilkan</span>
                                    <select class="form-select form-select-sm" id="rowsPerPage" style="width: auto;">
                                        <option value="10">10</option>
                                        <option value="25">25</option>
                                        <option value="50">50</option>
                                        <option value="100">100</option>
                                    </select>
                                    <span class="ms-2">entri</span>
                                </div>
                            </div>
                            <div class="card-body">
                                <div class="table-responsive">
                                    <table class="table table-hover data-table">
                                        <thead>
                                            <tr>
                                                <th>No</th>
                                                <th>Nama Penerima</th>
                                                <th>NIK</th>
                                                <th>WhatsApp</th>
                                                <th>Desa</th>
                                                <th>Jenis Bantuan</th>
                                                <th>Jumlah</th>
                                                <th>Tanggal</th>
                                                <th>Link Drive</th>
                                                <th>Aksi</th>
                                            </tr>
                                        </thead>
                                        <tbody id="dataTableBody">
                                            <!-- Data akan diisi oleh JavaScript -->
                                        </tbody>
                                    </table>
                                </div>
                                
                                <!-- Pagination -->
                                <nav aria-label="Data table navigation">
                                    <ul class="pagination justify-content-center" id="pagination">
                                        <li class="page-item disabled">
                                            <a class="page-link" href="#" tabindex="-1">Previous</a>
                                        </li>
                                        <li class="page-item active"><a class="page-link" href="#">1</a></li>
                                        <li class="page-item">
                                            <a class="page-link" href="#">Next</a>
                                        </li>
                                    </ul>
                                </nav>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Statistik Section -->
                    <div class="content-section d-none" id="statistik">
                        <h3 class="section-title">Statistik dan Analisis</h3>
                        
                        <div class="row">
                            <div class="col-md-8">
                                <div class="card">
                                    <div class="card-header">
                                        <i class="fas fa-chart-line me-2"></i> Trend Penyaluran Bantuan
                                    </div>
                                    <div class="card-body">
                                        <canvas id="trendChart" height="300"></canvas>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="card">
                                    <div class="card-header">
                                        <i class="fas fa-info-circle me-2"></i> Informasi Statistik
                                    </div>
                                    <div class="card-body">
                                        <div class="mb-3">
                                            <h6>Total Data</h6>
                                            <p class="fs-4 fw-bold text-primary" id="statTotalData">0</p>
                                        </div>
                                        <div class="mb-3">
                                            <h6>Periode Data</h6>
                                            <p class="fw-semibold" id="statPeriode">-</p>
                                        </div>
                                        <div class="mb-3">
                                            <h6>Desa dengan Bantuan Terbanyak</h6>
                                            <p class="fw-semibold" id="statTopDesa">-</p>
                                        </div>
                                        <div>
                                            <h6>Jenis Bantuan Terbanyak</h6>
                                            <p class="fw-semibold" id="statTopJenis">-</p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="row mt-4">
                            <div class="col-md-6">
                                <div class="card">
                                    <div class="card-header">
                                        <i class="fas fa-chart-bar me-2"></i> Perbandingan Desa
                                    </div>
                                    <div class="card-body">
                                        <canvas id="desaComparisonChart" height="250"></canvas>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="card">
                                    <div class="card-header">
                                        <i class="fas fa-chart-bar me-2"></i> Perbandingan Jenis Bantuan
                                    </div>
                                    <div class="card-body">
                                        <canvas id="jenisComparisonChart" height="250"></canvas>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Pengaturan Section -->
                    <div class="content-section d-none" id="pengaturan">
                        <h3 class="section-title">Pengaturan Aplikasi</h3>
                        
                        <div class="row">
                            <div class="col-md-6">
                                <div class="card">
                                    <div class="card-header">
                                        <i class="fas fa-database me-2"></i> Kelola Data
                                    </div>
                                    <div class="card-body">
                                        <div class="d-grid gap-2">
                                            <button class="btn btn-primary mb-2" id="exportAllData">
                                                <i class="fas fa-download me-2"></i> Ekspor Semua Data
                                            </button>
                                            <button class="btn btn-success mb-2" id="importData">
                                                <i class="fas fa-upload me-2"></i> Impor Data
                                            </button>
                                            <button class="btn btn-warning mb-2" id="backupData">
                                                <i class="fas fa-save me-2"></i> Backup Data
                                            </button>
                                            <button class="btn btn-danger" id="resetData">
                                                <i class="fas fa-trash me-2"></i> Reset Semua Data
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="col-md-6">
                                <div class="card">
                                    <div class="card-header">
                                        <i class="fas fa-lock me-2"></i> Keamanan
                                    </div>
                                    <div class="card-body">
                                        <form id="securityForm">
                                            <div class="mb-3">
                                                <label class="form-label">Kode Keamanan Saat Ini</label>
                                                <input type="password" class="form-control" id="currentSecurityCode" required>
                                            </div>
                                            <div class="mb-3">
                                                <label class="form-label">Kode Keamanan Baru</label>
                                                <input type="password" class="form-control" id="newSecurityCode" required>
                                            </div>
                                            <div class="mb-3">
                                                <label class="form-label">Konfirmasi Kode Baru</label>
                                                <input type="password" class="form-control" id="confirmSecurityCode" required>
                                            </div>
                                            <button type="submit" class="btn btn-primary">
                                                <i class="fas fa-save me-2"></i> Simpan Perubahan
                                            </button>
                                        </form>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="card mt-4">
                            <div class="card-header">
                                <i class="fas fa-info-circle me-2"></i> Informasi Aplikasi
                            </div>
                            <div class="card-body">
                                <div class="row">
                                    <div class="col-md-6">
                                        <table class="table table-borderless">
                                            <tr>
                                                <th width="40%">Nama Aplikasi</th>
                                                <td>BARJAS (Sistem Bantuan Terpadu)</td>
                                            </tr>
                                            <tr>
                                                <th>Versi</th>
                                                <td>v2.1.0</td>
                                            </tr>
                                            <tr>
                                                <th>Developer</th>
                                                <td>Lentera karya Situbondo</td>
                                            </tr>
                                        </table>
                                    </div>
                                    <div class="col-md-6">
                                        <table class="table table-borderless">
                                            <tr>
                                                <th width="40%">Dibuat</th>
                                                <td>15 Agustus 2025</td>
                                            </tr>
                                            <tr>
                                                <th>Diperbarui</th>
                                                <td id="lastUpdated">-</td>
                                            </tr>
                                            <tr>
                                                <th>Ukuran Data</th>
                                                <td id="dataSize">-</td>
                                            </tr>
                                        </table>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="copyright">
                &copy; 2025 BARJAS - Sistem Bantuan Terpadu. Dikembangkan oleh <strong>Lentera karya Situbondo</strong>.
            </div>
        </div>
        
        <!-- Floating Action Button -->
        <div class="floating-action-btn" id="fab">
            <i class="fas fa-plus"></i>
        </div>
        
        <!-- Notification Toast -->
        <div class="toast notification-toast" role="alert" aria-live="assertive" aria-atomic="true" id="notificationToast">
            <div class="toast-header">
                <strong class="me-auto" id="toastTitle">BARJAS Notification</strong>
                <small id="toastTime">Just now</small>
                <button type="button" class="btn-close" data-bs-dismiss="toast" aria-label="Close"></button>
            </div>
            <div class="toast-body" id="toastMessage">
                Operation completed successfully.
            </div>
        </div>
    </div>
    
    <!-- Scripts -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-datepicker/1.9.0/js/bootstrap-datepicker.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-datepicker/1.9.0/locales/bootstrap-datepicker.id.min.js"></script>
    
    <script>
        // Inisialisasi variabel global
        let appData = [];
        let currentPage = 1;
        let rowsPerPage = 10;
        let filteredData = [];
        let isFiltered = false;
        let loginAttempts = 0;
        let isBlocked = false;
        let blockTime = 0;
        let loginTimer;
        let charts = {};
        
        // Konfigurasi Keamanan
        const SECURITY_CODE = "BARJAS2025"; // Kode default - bisa diubah melalui pengaturan
        const MAX_LOGIN_ATTEMPTS = 3;
        const BLOCK_TIME = 30; // dalam detik
        
        // DOM Ready
        document.addEventListener('DOMContentLoaded', function() {
            // Inisialisasi aplikasi
            initApp();
            
            // Setup event listeners
            setupEventListeners();
            
            // Tampilkan splash screen
            showSplashScreen();
        });
        
        // Inisialisasi Aplikasi
        function initApp() {
            // Load data dari localStorage
            loadData();
            
            // Inisialisasi datepicker
            $('.datepicker').datepicker({
                format: 'dd-mm-yyyy',
                autoclose: true,
                language: 'id',
                todayHighlight: true
            });
            
            // Set tanggal hari ini sebagai default
            $('#tanggal').datepicker('setDate', new Date());
            
            // Setup chart.js global defaults
            Chart.defaults.font.family = "'Poppins', 'Segoe UI', sans-serif";
            Chart.defaults.color = '#666';
            Chart.defaults.font.size = 12;
            
            // Inisialisasi toast
            const toastEl = document.getElementById('notificationToast');
            const toast = new bootstrap.Toast(toastEl, {
                autohide: true,
                delay: 3000
            });
            
            // Tampilkan modal login
            const loginModal = new bootstrap.Modal(document.getElementById('loginModal'));
            loginModal.show();
        }
        
        // Setup Event Listeners
        function setupEventListeners() {
            // Navigasi menu
            document.querySelectorAll('.nav-link').forEach(link => {
                link.addEventListener('click', function(e) {
                    e.preventDefault();
                    const target = this.getAttribute('data-bs-target');
                    showSection(target);
                    
                    // Update active class
                    document.querySelectorAll('.nav-link').forEach(l => l.classList.remove('active'));
                    this.classList.add('active');
                });
            });
            
            // Mobile menu
            document.getElementById('mobileMenuBtn').addEventListener('click', function() {
                document.getElementById('sidebar').classList.add('mobile-show');
                document.getElementById('sidebarOverlay').classList.add('mobile-show');
            });
            
            document.getElementById('sidebarOverlay').addEventListener('click', function() {
                document.getElementById('sidebar').classList.remove('mobile-show');
                this.classList.remove('mobile-show');
            });
            
            // Form input data
            document.getElementById('dataForm').addEventListener('submit', function(e) {
                e.preventDefault();
                saveData();
            });
            
            // Form login
            document.getElementById('loginForm').addEventListener('submit', function(e) {
                e.preventDefault();
                handleLogin();
            });
            
            // Toggle password visibility
            document.querySelector('.toggle-password').addEventListener('click', function() {
                const passwordField = document.getElementById('securityCode');
                const icon = this.querySelector('i');
                
                if (passwordField.type === 'password') {
                    passwordField.type = 'text';
                    icon.classList.remove('fa-eye');
                    icon.classList.add('fa-eye-slash');
                } else {
                    passwordField.type = 'password';
                    icon.classList.remove('fa-eye-slash');
                    icon.classList.add('fa-eye');
                }
            });
            
            // Filter data
            document.getElementById('applyFilter').addEventListener('click', function() {
                applyFilters();
            });
            
            document.getElementById('resetFilter').addEventListener('click', function() {
                resetFilters();
            });
            
            // Export data
            document.getElementById('exportExcel').addEventListener('click', function() {
                exportToExcel();
            });
            
            document.getElementById('exportPDF').addEventListener('click', function() {
                exportToPDF();
            });
            
            // Rows per page change
            document.getElementById('rowsPerPage').addEventListener('change', function() {
                rowsPerPage = parseInt(this.value);
                currentPage = 1;
                renderDataTable();
            });
            
            // Security form
            document.getElementById('securityForm').addEventListener('submit', function(e) {
                e.preventDefault();
                updateSecurityCode();
            });
            
            // Data management
            document.getElementById('exportAllData').addEventListener('click', function() {
                exportAllData();
            });
            
            document.getElementById('backupData').addEventListener('click', function() {
                backupData();
            });
            
            document.getElementById('resetData').addEventListener('click', function() {
                resetData();
            });
            
            // Close splash screen
            document.getElementById('closeSplash').addEventListener('click', function() {
                hideSplashScreen();
            });
            
            // FAB click
            document.getElementById('fab').addEventListener('click', function() {
                showSection('inputData');
                document.querySelectorAll('.nav-link').forEach(l => l.classList.remove('active'));
                document.querySelector('[data-bs-target="inputData"]').classList.add('active');
            });
        }
        
        // Tampilkan section tertentu
        function showSection(sectionId) {
            // Sembunyikan semua section
            document.querySelectorAll('.content-section').forEach(section => {
                section.classList.add('d-none');
            });
            
            // Tampilkan section yang dipilih
            document.getElementById(sectionId).classList.remove('d-none');
            
            // Jika section adalah dashboard atau statistik, render chart
            if (sectionId === 'dashboard') {
                updateDashboard();
                renderDashboardCharts();
            } else if (sectionId === 'statistik') {
                renderStatisticCharts();
            } else if (sectionId === 'dataTable') {
                renderDataTable();
            } else if (sectionId === 'pengaturan') {
                updateAppInfo();
            }
            
            // Tutup sidebar di mobile
            if (window.innerWidth < 992) {
                document.getElementById('sidebar').classList.remove('mobile-show');
                document.getElementById('sidebarOverlay').classList.remove('mobile-show');
            }
        }
        
        // Tampilkan splash screen
        function showSplashScreen() {
            const splashScreen = document.getElementById('welcomeSplash');
            splashScreen.style.display = 'flex';
            
            let countdown = 5;
            const countdownElement = document.getElementById('countdownTimer');
            
            const countdownInterval = setInterval(() => {
                countdown--;
                countdownElement.textContent = countdown;
                
                if (countdown <= 0) {
                    clearInterval(countdownInterval);
                    hideSplashScreen();
                }
            }, 1000);
        }
        
        // Sembunyikan splash screen
        function hideSplashScreen() {
            const splashScreen = document.getElementById('welcomeSplash');
            splashScreen.style.opacity = '0';
            
            setTimeout(() => {
                splashScreen.style.display = 'none';
            }, 500);
        }
        
        // Handle login
        function handleLogin() {
            if (isBlocked) {
                showNotification('Login Diblokir', 'Terlalu banyak percobaan gagal. Silakan coba lagi nanti.', 'danger');
                return;
            }
            
            const securityCode = document.getElementById('securityCode').value;
            const loginButton = document.getElementById('loginButton');
            const loginSpinner = document.getElementById('loginSpinner');
            const loginButtonText = document.querySelector('.login-button-text');
            
            // Tampilkan spinner
            loginButton.disabled = true;
            loginSpinner.classList.remove('d-none');
            loginButtonText.textContent = 'Memverifikasi...';
            
            // Simulasi proses verifikasi (dalam aplikasi nyata, ini akan memverifikasi dengan backend)
            setTimeout(() => {
                if (securityCode === SECURITY_CODE) {
                    // Login berhasil
                    loginAttempts = 0;
                    document.getElementById('attemptsCount').textContent = '';
                    
                    // Sembunyikan modal login
                    const loginModal = bootstrap.Modal.getInstance(document.getElementById('loginModal'));
                    loginModal.hide();
                    
                    // Tampilkan konten aplikasi
                    document.getElementById('appContent').classList.remove('app-content-unauthenticated');
                    
                    // Tampilkan notifikasi sukses
                    showNotification('Login Berhasil', 'Selamat datang di Aplikasi BARJAS', 'success');
                    
                    // Update dashboard
                    updateDashboard();
                    renderDashboardCharts();
                } else {
                    // Login gagal
                    loginAttempts++;
                    
                    if (loginAttempts >= MAX_LOGIN_ATTEMPTS) {
                        // Blokir login sementara
                        isBlocked = true;
                        blockTime = BLOCK_TIME;
                        
                        // Tampilkan pesan blokir
                        document.getElementById('blockedMessage').classList.remove('d-none');
                        document.getElementById('blockedText').textContent = 'Terlalu banyak percobaan gagal. Silakan coba lagi dalam ';
                        
                        // Mulai countdown
                        loginTimer = setInterval(() => {
                            blockTime--;
                            document.getElementById('countdown').textContent = blockTime;
                            
                            if (blockTime <= 0) {
                                clearInterval(loginTimer);
                                isBlocked = false;
                                loginAttempts = 0;
                                document.getElementById('blockedMessage').classList.add('d-none');
                            }
                        }, 1000);
                    } else {
                        // Tampilkan sisa percobaan
                        document.getElementById('attemptsCount').textContent = 
                            `Percobaan login gagal: ${loginAttempts} dari ${MAX_LOGIN_ATTEMPTS}.`;
                        
                        // Shake effect
                        document.getElementById('loginForm').classList.add('login-shake');
                        setTimeout(() => {
                            document.getElementById('loginForm').classList.remove('login-shake');
                        }, 600);
                    }
                }
                
                // Reset login button
                loginButton.disabled = false;
                loginSpinner.classList.add('d-none');
                loginButtonText.textContent = 'Masuk ke Aplikasi';
            }, 1500);
        }
        
        // Load data dari localStorage
        function loadData() {
            const savedData = localStorage.getItem('barjasData');
            if (savedData) {
                appData = JSON.parse(savedData);
            } else {
                // Data contoh jika tidak ada data
                appData = [
                    {
                        id: 1,
                        nama: "Ahmad Sutisna",
                        nik: "3523114509970001",
                        whatsapp: "628123456789",
                        desa: "Desa Sumberanyar",
                        jenis: "Bibit Lele",
                        jumlah: 5000,
                        tanggal: "15-08-2025",
                        driveLink: "https://drive.google.com/drive/folders/abc123",
                        keterangan: "Penyaluran bantuan bibit lele untuk kolam pembesaran"
                    },
                    {
                        id: 2,
                        nama: "Siti Rahayu",
                        nik: "3523115508970002",
                        whatsapp: "628987654321",
                        desa: "Desa Banyuputih",
                        jenis: "Pakan Ikan",
                        jumlah: 100,
                        tanggal: "16-08-2025",
                        driveLink: "https://drive.google.com/drive/folders/def456",
                        keterangan: "Bantuan pakan ikan untuk pembesaran lele"
                    },
                    {
                        id: 3,
                        nama: "Budi Santoso",
                        nik: "3523112203970003",
                        whatsapp: "628567890123",
                        desa: "Desa Sumberejo",
                        jenis: "Obat-obatan",
                        jumlah: 50,
                        tanggal: "17-08-2025",
                        driveLink: "https://drive.google.com/drive/folders/ghi789",
                        keterangan: "Obat-obatan untuk pencegahan penyakit ikan"
                    }
                ];
                saveToLocalStorage();
            }
            
            filteredData = [...appData];
        }
        
        // Simpan data ke localStorage
        function saveToLocalStorage() {
            localStorage.setItem('barjasData', JSON.stringify(appData));
            localStorage.setItem('barjasLastUpdated', new Date().toISOString());
        }
        
        // Simpan data dari form
        function saveData() {
            // Validasi form
            if (!validateForm()) {
                return;
            }
            
            // Ambil nilai dari form
            const newData = {
                id: Date.now(), // ID unik berdasarkan timestamp
                nama: document.getElementById('namaPenerima').value,
                nik: document.getElementById('nik').value,
                whatsapp: document.getElementById('whatsapp').value,
                desa: document.getElementById('desa').value,
                jenis: document.getElementById('jenisBantuan').value,
                jumlah: parseInt(document.getElementById('jumlah').value),
                tanggal: document.getElementById('tanggal').value,
                driveLink: document.getElementById('driveLink').value,
                keterangan: document.getElementById('keterangan').value
            };
            
            // Tambahkan ke array data
            appData.push(newData);
            
            // Simpan ke localStorage
            saveToLocalStorage();
            
            // Reset form
            document.getElementById('dataForm').reset();
            $('#tanggal').datepicker('setDate', new Date());
            
            // Update filteredData jika tidak sedang dalam mode filter
            if (!isFiltered) {
                filteredData = [...appData];
            }
            
            // Tampilkan notifikasi
            showNotification('Data Tersimpan', 'Data bantuan berhasil disimpan', 'success');
            
            // Jika sedang di section data table, update tabel
            if (!document.getElementById('dataTable').classList.contains('d-none')) {
                renderDataTable();
            }
            
            // Update dashboard
            updateDashboard();
        }
        
        // Validasi form
        function validateForm() {
            let isValid = true;
            
            // Validasi nama
            const nama = document.getElementById('namaPenerima');
            const namaError = document.getElementById('namaError');
            if (!nama.value.trim()) {
                nama.classList.add('input-error');
                namaError.style.display = 'block';
                isValid = false;
            } else {
                nama.classList.remove('input-error');
                namaError.style.display = 'none';
            }
            
            // Validasi NIK
            const nik = document.getElementById('nik');
            const nikError = document.getElementById('nikError');
            if (!nik.value.trim() || nik.value.length !== 16) {
                nik.classList.add('input-error');
                nikError.style.display = 'block';
                isValid = false;
            } else {
                nik.classList.remove('input-error');
                nikError.style.display = 'none';
            }
            
            // Validasi WhatsApp
            const whatsapp = document.getElementById('whatsapp');
            const whatsappError = document.getElementById('whatsappError');
            if (!whatsapp.value.trim()) {
                whatsapp.classList.add('input-error');
                whatsappError.style.display = 'block';
                isValid = false;
            } else {
                whatsapp.classList.remove('input-error');
                whatsappError.style.display = 'none';
            }
            
            // Validasi desa
            const desa = document.getElementById('desa');
            const desaError = document.getElementById('desaError');
            if (!desa.value) {
                desa.classList.add('input-error');
                desaError.style.display = 'block';
                isValid = false;
            } else {
                desa.classList.remove('input-error');
                desaError.style.display = 'none';
            }
            
            // Validasi jenis bantuan
            const jenis = document.getElementById('jenisBantuan');
            const jenisError = document.getElementById('jenisError');
            if (!jenis.value) {
                jenis.classList.add('input-error');
                jenisError.style.display = 'block';
                isValid = false;
            } else {
                jenis.classList.remove('input-error');
                jenisError.style.display = 'none';
            }
            
            // Validasi jumlah
            const jumlah = document.getElementById('jumlah');
            const jumlahError = document.getElementById('jumlahError');
            if (!jumlah.value || parseInt(jumlah.value) <= 0) {
                jumlah.classList.add('input-error');
                jumlahError.style.display = 'block';
                isValid = false;
            } else {
                jumlah.classList.remove('input-error');
                jumlahError.style.display = 'none';
            }
            
            // Validasi tanggal
            const tanggal = document.getElementById('tanggal');
            const tanggalError = document.getElementById('tanggalError');
            if (!tanggal.value) {
                tanggal.classList.add('input-error');
                tanggalError.style.display = 'block';
                isValid = false;
            } else {
                tanggal.classList.remove('input-error');
                tanggalError.style.display = 'none';
            }
            
            return isValid;
        }
        
        // Update dashboard
        function updateDashboard() {
            // Hitung statistik
            const totalPenerima = appData.length;
            const totalBantuan = [...new Set(appData.map(item => item.jenis))].length;
            const totalDesa = [...new Set(appData.map(item => item.desa))].length;
            const totalTersalurkan = appData.reduce((sum, item) => sum + item.jumlah, 0);
            
            // Update elemen dashboard
            document.getElementById('totalPenerima').textContent = totalPenerima.toLocaleString('id-ID');
            document.getElementById('totalBantuan').textContent = totalBantuan.toLocaleString('id-ID');
            document.getElementById('totalDesa').textContent = totalDesa.toLocaleString('id-ID');
            document.getElementById('totalTersalurkan').textContent = totalTersalurkan.toLocaleString('id-ID');
            
            // Update recent activity
            updateRecentActivity();
        }
        
        // Update recent activity
        function updateRecentActivity() {
            const recentActivityTable = document.getElementById('recentActivityTable');
            recentActivityTable.innerHTML = '';
            
            // Ambil 5 data terbaru
            const recentData = [...appData]
                .sort((a, b) => new Date(b.tanggal.split('-').reverse().join('-')) - new Date(a.tanggal.split('-').reverse().join('-')))
                .slice(0, 5);
            
            recentData.forEach(item => {
                const row = document.createElement('tr');
                
                row.innerHTML = `
                    <td>${item.tanggal}</td>
                    <td>${item.desa}</td>
                    <td>${item.jenis}</td>
                    <td>${item.nama}</td>
                    <td><span class="badge bg-success">Tersalurkan</span></td>
                `;
                
                recentActivityTable.appendChild(row);
            });
        }
        
        // Render data table
        function renderDataTable() {
            const tableBody = document.getElementById('dataTableBody');
            tableBody.innerHTML = '';
            
            // Hitung total halaman
            const totalPages = Math.ceil(filteredData.length / rowsPerPage);
            
            // Pastikan currentPage valid
            if (currentPage > totalPages) {
                currentPage = totalPages > 0 ? totalPages : 1;
            }
            
            // Data untuk halaman saat ini
            const startIndex = (currentPage - 1) * rowsPerPage;
            const endIndex = startIndex + rowsPerPage;
            const currentData = filteredData.slice(startIndex, endIndex);
            
            // Render data
            currentData.forEach((item, index) => {
                const row = document.createElement('tr');
                
                row.innerHTML = `
                    <td>${startIndex + index + 1}</td>
                    <td>${item.nama}</td>
                    <td>${item.nik}</td>
                    <td>
                        <span class="whatsapp-number" onclick="openWhatsApp('${item.whatsapp}')">
                            ${item.whatsapp}
                        </span>
                    </td>
                    <td>${item.desa}</td>
                    <td>${item.jenis}</td>
                    <td>${item.jumlah.toLocaleString('id-ID')}</td>
                    <td>${item.tanggal}</td>
                    <td>
                        ${item.driveLink ? 
                            `<a href="${item.driveLink}" target="_blank" class="drive-link">
                                <i class="fas fa-link me-1"></i> Lihat
                            </a>` : 
                            '<span class="text-muted">Tidak ada</span>'
                        }
                    </td>
                    <td>
                        <div class="btn-group btn-group-sm">
                            <button class="btn btn-primary" onclick="editData(${item.id})">
                                <i class="fas fa-edit"></i>
                            </button>
                            <button class="btn btn-danger" onclick="deleteData(${item.id})">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>
                    </td>
                `;
                
                tableBody.appendChild(row);
            });
            
            // Render pagination
            renderPagination(totalPages);
        }
        
        // Render pagination
        function renderPagination(totalPages) {
            const pagination = document.getElementById('pagination');
            pagination.innerHTML = '';
            
            // Previous button
            const prevLi = document.createElement('li');
            prevLi.className = `page-item ${currentPage === 1 ? 'disabled' : ''}`;
            prevLi.innerHTML = `<a class="page-link" href="#" data-page="${currentPage - 1}">Previous</a>`;
            pagination.appendChild(prevLi);
            
            // Page numbers
            const maxVisiblePages = 5;
            let startPage = Math.max(1, currentPage - Math.floor(maxVisiblePages / 2));
            let endPage = Math.min(totalPages, startPage + maxVisiblePages - 1);
            
            if (endPage - startPage + 1 < maxVisiblePages) {
                startPage = Math.max(1, endPage - maxVisiblePages + 1);
            }
            
            for (let i = startPage; i <= endPage; i++) {
                const pageLi = document.createElement('li');
                pageLi.className = `page-item ${i === currentPage ? 'active' : ''}`;
                pageLi.innerHTML = `<a class="page-link" href="#" data-page="${i}">${i}</a>`;
                pagination.appendChild(pageLi);
            }
            
            // Next button
            const nextLi = document.createElement('li');
            nextLi.className = `page-item ${currentPage === totalPages ? 'disabled' : ''}`;
            nextLi.innerHTML = `<a class="page-link" href="#" data-page="${currentPage + 1}">Next</a>`;
            pagination.appendChild(nextLi);
            
            // Add event listeners to pagination links
            pagination.querySelectorAll('.page-link').forEach(link => {
                link.addEventListener('click', function(e) {
                    e.preventDefault();
                    const page = parseInt(this.getAttribute('data-page'));
                    if (!isNaN(page)) {
                        currentPage = page;
                        renderDataTable();
                    }
                });
            });
        }
        
        // Terapkan filter
        function applyFilters() {
            const desa = document.getElementById('filterDesa').value;
            const jenis = document.getElementById('filterJenis').value;
            const tglMulai = document.getElementById('filterTglMulai').value;
            const tglAkhir = document.getElementById('filterTglAkhir').value;
            
            filteredData = appData.filter(item => {
                // Filter desa
                if (desa && item.desa !== desa) {
                    return false;
                }
                
                // Filter jenis
                if (jenis && item.jenis !== jenis) {
                    return false;
                }
                
                // Filter tanggal
                if (tglMulai && tglAkhir) {
                    const itemDate = new Date(item.tanggal.split('-').reverse().join('-'));
                    const startDate = new Date(tglMulai.split('-').reverse().join('-'));
                    const endDate = new Date(tglAkhir.split('-').reverse().join('-'));
                    
                    if (itemDate < startDate || itemDate > endDate) {
                        return false;
                    }
                }
                
                return true;
            });
            
            isFiltered = true;
            currentPage = 1;
            renderDataTable();
            
            // Tampilkan notifikasi
            showNotification('Filter Diterapkan', `Menampilkan ${filteredData.length} data yang sesuai filter`, 'info');
        }
        
        // Reset filter
        function resetFilters() {
            document.getElementById('filterDesa').value = '';
            document.getElementById('filterJenis').value = '';
            document.getElementById('filterTglMulai').value = '';
            document.getElementById('filterTglAkhir').value = '';
            
            filteredData = [...appData];
            isFiltered = false;
            currentPage = 1;
            renderDataTable();
            
            // Tampilkan notifikasi
            showNotification('Filter Direset', 'Menampilkan semua data', 'info');
        }
        
        // Render dashboard charts
        function renderDashboardCharts() {
            // Data untuk chart desa
            const desaCount = {};
            appData.forEach(item => {
                desaCount[item.desa] = (desaCount[item.desa] || 0) + 1;
            });
            
            const desaLabels = Object.keys(desaCount);
            const desaData = Object.values(desaCount);
            
            // Data untuk chart jenis bantuan
            const jenisCount = {};
            appData.forEach(item => {
                jenisCount[item.jenis] = (jenisCount[item.jenis] || 0) + 1;
            });
            
            const jenisLabels = Object.keys(jenisCount);
            const jenisData = Object.values(jenisCount);
            
            // Hancurkan chart yang sudah ada jika ada
            if (charts.desaChart) {
                charts.desaChart.destroy();
            }
            
            if (charts.jenisChart) {
                charts.jenisChart.destroy();
            }
            
            // Render chart distribusi desa
            const desaCtx = document.getElementById('desaChart').getContext('2d');
            charts.desaChart = new Chart(desaCtx, {
                type: 'bar',
                data: {
                    labels: desaLabels,
                    datasets: [{
                        label: 'Jumlah Bantuan per Desa',
                        data: desaData,
                        backgroundColor: 'rgba(13, 71, 161, 0.7)',
                        borderColor: 'rgba(13, 71, 161, 1)',
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: {
                            position: 'top',
                        },
                        title: {
                            display: true,
                            text: 'Distribusi Bantuan per Desa'
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: {
                                precision: 0
                            }
                        }
                    }
                }
            });
            
            // Render chart distribusi jenis bantuan
            const jenisCtx = document.getElementById('jenisChart').getContext('2d');
            charts.jenisChart = new Chart(jenisCtx, {
                type: 'pie',
                data: {
                    labels: jenisLabels,
                    datasets: [{
                        data: jenisData,
                        backgroundColor: [
                            'rgba(13, 71, 161, 0.7)',
                            'rgba(0, 105, 92, 0.7)',
                            'rgba(255, 143, 0, 0.7)',
                            'rgba(121, 85, 72, 0.7)',
                            'rgba(156, 39, 176, 0.7)'
                        ],
                        borderColor: [
                            'rgba(13, 71, 161, 1)',
                            'rgba(0, 105, 92, 1)',
                            'rgba(255, 143, 0, 1)',
                            'rgba(121, 85, 72, 1)',
                            'rgba(156, 39, 176, 1)'
                        ],
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: {
                            position: 'top',
                        },
                        title: {
                            display: true,
                            text: 'Distribusi Jenis Bantuan'
                        }
                    }
                }
            });
        }
        
        // Render statistic charts
        function renderStatisticCharts() {
            // Update informasi statistik
            document.getElementById('statTotalData').textContent = appData.length.toLocaleString('id-ID');
            
            // Hitung periode data
            if (appData.length > 0) {
                const dates = appData.map(item => new Date(item.tanggal.split('-').reverse().join('-')));
                const minDate = new Date(Math.min.apply(null, dates));
                const maxDate = new Date(Math.max.apply(null, dates));
                
                document.getElementById('statPeriode').textContent = 
                    `${minDate.toLocaleDateString('id-ID')} - ${maxDate.toLocaleDateString('id-ID')}`;
            } else {
                document.getElementById('statPeriode').textContent = '-';
            }
            
            // Hitung desa dengan bantuan terbanyak
            const desaCount = {};
            appData.forEach(item => {
                desaCount[item.desa] = (desaCount[item.desa] || 0) + 1;
            });
            
            if (Object.keys(desaCount).length > 0) {
                const topDesa = Object.keys(desaCount).reduce((a, b) => desaCount[a] > desaCount[b] ? a : b);
                document.getElementById('statTopDesa').textContent = `${topDesa} (${desaCount[topDesa]} bantuan)`;
            } else {
                document.getElementById('statTopDesa').textContent = '-';
            }
            
            // Hitung jenis bantuan terbanyak
            const jenisCount = {};
            appData.forEach(item => {
                jenisCount[item.jenis] = (jenisCount[item.jenis] || 0) + 1;
            });
            
            if (Object.keys(jenisCount).length > 0) {
                const topJenis = Object.keys(jenisCount).reduce((a, b) => jenisCount[a] > jenisCount[b] ? a : b);
                document.getElementById('statTopJenis').textContent = `${topJenis} (${jenisCount[topJenis]} kali)`;
            } else {
                document.getElementById('statTopJenis').textContent = '-';
            }
            
            // Data untuk trend chart (per bulan)
            const monthlyData = {};
            appData.forEach(item => {
                const date = new Date(item.tanggal.split('-').reverse().join('-'));
                const monthYear = `${date.getMonth() + 1}/${date.getFullYear()}`;
                
                if (!monthlyData[monthYear]) {
                    monthlyData[monthYear] = 0;
                }
                
                monthlyData[monthYear] += item.jumlah;
            });
            
            const sortedMonths = Object.keys(monthlyData).sort((a, b) => {
                const [aMonth, aYear] = a.split('/').map(Number);
                const [bMonth, bYear] = b.split('/').map(Number);
                
                if (aYear !== bYear) {
                    return aYear - bYear;
                }
                
                return aMonth - bMonth;
            });
            
            const trendLabels = sortedMonths.map(month => {
                const [m, y] = month.split('/');
                return `${new Date(2000, m - 1).toLocaleString('id-ID', { month: 'short' })} ${y}`;
            });
            
            const trendData = sortedMonths.map(month => monthlyData[month]);
            
            // Hancurkan chart yang sudah ada jika ada
            if (charts.trendChart) {
                charts.trendChart.destroy();
            }
            
            if (charts.desaComparisonChart) {
                charts.desaComparisonChart.destroy();
            }
            
            if (charts.jenisComparisonChart) {
                charts.jenisComparisonChart.destroy();
            }
            
            // Render trend chart
            const trendCtx = document.getElementById('trendChart').getContext('2d');
            charts.trendChart = new Chart(trendCtx, {
                type: 'line',
                data: {
                    labels: trendLabels,
                    datasets: [{
                        label: 'Volume Penyaluran per Bulan',
                        data: trendData,
                        fill: false,
                        backgroundColor: 'rgba(13, 71, 161, 0.7)',
                        borderColor: 'rgba(13, 71, 161, 1)',
                        tension: 0.1,
                        pointBackgroundColor: 'rgba(13, 71, 161, 1)',
                        pointRadius: 5,
                        pointHoverRadius: 7
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: {
                            position: 'top',
                        },
                        title: {
                            display: true,
                            text: 'Trend Penyaluran Bantuan per Bulan'
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            title: {
                                display: true,
                                text: 'Jumlah'
                            }
                        }
                    }
                }
            });
            
            // Data untuk perbandingan desa (jumlah bantuan)
            const desaSum = {};
            appData.forEach(item => {
                desaSum[item.desa] = (desaSum[item.desa] || 0) + item.jumlah;
            });
            
            const desaComparisonLabels = Object.keys(desaSum);
            const desaComparisonData = Object.values(desaSum);
            
            // Render perbandingan desa chart
            const desaComparisonCtx = document.getElementById('desaComparisonChart').getContext('2d');
            charts.desaComparisonChart = new Chart(desaComparisonCtx, {
                type: 'bar',
                data: {
                    labels: desaComparisonLabels,
                    datasets: [{
                        label: 'Jumlah Bantuan per Desa',
                        data: desaComparisonData,
                        backgroundColor: 'rgba(0, 105, 92, 0.7)',
                        borderColor: 'rgba(0, 105, 92, 1)',
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: {
                            position: 'top',
                        },
                        title: {
                            display: true,
                            text: 'Perbandingan Jumlah Bantuan per Desa'
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            title: {
                                display: true,
                                text: 'Jumlah'
                            }
                        }
                    }
                }
            });
            
            // Data untuk perbandingan jenis bantuan (jumlah)
            const jenisSum = {};
            appData.forEach(item => {
                jenisSum[item.jenis] = (jenisSum[item.jenis] || 0) + item.jumlah;
            });
            
            const jenisComparisonLabels = Object.keys(jenisSum);
            const jenisComparisonData = Object.values(jenisSum);
            
            // Render perbandingan jenis bantuan chart
            const jenisComparisonCtx = document.getElementById('jenisComparisonChart').getContext('2d');
            charts.jenisComparisonChart = new Chart(jenisComparisonCtx, {
                type: 'bar',
                data: {
                    labels: jenisComparisonLabels,
                    datasets: [{
                        label: 'Jumlah per Jenis Bantuan',
                        data: jenisComparisonData,
                        backgroundColor: 'rgba(255, 143, 0, 0.7)',
                        borderColor: 'rgba(255, 143, 0, 1)',
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: {
                            position: 'top',
                        },
                        title: {
                            display: true,
                            text: 'Perbandingan Jumlah per Jenis Bantuan'
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            title: {
                                display: true,
                                text: 'Jumlah'
                            }
                        }
                    }
                }
            });
        }
        
        // Update app info
        function updateAppInfo() {
            const lastUpdated = localStorage.getItem('barjasLastUpdated');
            if (lastUpdated) {
                const date = new Date(lastUpdated);
                document.getElementById('lastUpdated').textContent = date.toLocaleDateString('id-ID', {
                    day: 'numeric',
                    month: 'long',
                    year: 'numeric',
                    hour: '2-digit',
                    minute: '2-digit'
                });
            }
            
            // Hitung ukuran data
            const dataSize = JSON.stringify(appData).length;
            document.getElementById('dataSize').textContent = `${(dataSize / 1024).toFixed(2)} KB`;
        }
        
        // Update security code
        function updateSecurityCode() {
            const currentCode = document.getElementById('currentSecurityCode').value;
            const newCode = document.getElementById('newSecurityCode').value;
            const confirmCode = document.getElementById('confirmSecurityCode').value;
            
            if (currentCode !== SECURITY_CODE) {
                showNotification('Error', 'Kode keamanan saat ini tidak sesuai', 'danger');
                return;
            }
            
            if (newCode !== confirmCode) {
                showNotification('Error', 'Konfirmasi kode keamanan baru tidak sesuai', 'danger');
                return;
            }
            
            if (newCode.length < 6) {
                showNotification('Error', 'Kode keamanan baru harus minimal 6 karakter', 'danger');
                return;
            }
            
            // Update security code (dalam aplikasi nyata, ini akan disimpan di backend)
            // Untuk demo, kita hanya akan menampilkan notifikasi
            showNotification('Berhasil', 'Kode keamanan berhasil diperbarui', 'success');
            
            // Reset form
            document.getElementById('securityForm').reset();
        }
        
        // Export to Excel
        function exportToExcel() {
            // Data untuk diekspor (gunakan filteredData jika sedang difilter)
            const dataToExport = isFiltered ? filteredData : appData;
            
            if (dataToExport.length === 0) {
                showNotification('Info', 'Tidak ada data untuk diekspor', 'info');
                return;
            }
            
            // Siapkan data untuk Excel
            const excelData = dataToExport.map(item => ({
                'Nama Penerima': item.nama,
                'NIK': item.nik,
                'WhatsApp': item.whatsapp,
                'Desa': item.desa,
                'Jenis Bantuan': item.jenis,
                'Jumlah': item.jumlah,
                'Tanggal': item.tanggal,
                'Link Drive': item.driveLink,
                'Keterangan': item.keterangan
            }));
            
            // Buat worksheet
            const ws = XLSX.utils.json_to_sheet(excelData);
            
            // Buat workbook
            const wb = XLSX.utils.book_new();
            XLSX.utils.book_append_sheet(wb, ws, 'Data Bantuan');
            
            // Export ke file
            XLSX.writeFile(wb, `Data_Bantuan_BARJAS_${new Date().toISOString().split('T')[0]}.xlsx`);
            
            // Tampilkan notifikasi
            showNotification('Ekspor Berhasil', 'Data berhasil diekspor ke Excel', 'success');
        }
        
        // Export to PDF
        function exportToPDF() {
            // Data untuk diekspor (gunakan filteredData jika sedang difilter)
            const dataToExport = isFiltered ? filteredData : appData;
            
            if (dataToExport.length === 0) {
                showNotification('Info', 'Tidak ada data untuk diekspor', 'info');
                return;
            }
            
            // Gunakan jsPDF dengan autotable
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF();
            
            // Judul
            doc.setFontSize(18);
            doc.text('LAPORAN DATA BANTUAN BARJAS', 105, 15, { align: 'center' });
            
            // Info filter jika sedang difilter
            if (isFiltered) {
                doc.setFontSize(12);
                doc.text(`Data difilter: ${filteredData.length} dari ${appData.length} data`, 105, 22, { align: 'center' });
            }
            
            // Tanggal ekspor
            doc.setFontSize(10);
            doc.text(`Diekspor pada: ${new Date().toLocaleDateString('id-ID')}`, 105, 29, { align: 'center' });
            
            // Siapkan data untuk tabel
            const tableData = dataToExport.map(item => [
                item.nama,
                item.nik,
                item.whatsapp,
                item.desa,
                item.jenis,
                item.jumlah.toLocaleString('id-ID'),
                item.tanggal,
                item.driveLink ? 'Ya' : 'Tidak'
            ]);
            
            // Buat tabel
            doc.autoTable({
                startY: 35,
                head: [['Nama', 'NIK', 'WhatsApp', 'Desa', 'Jenis', 'Jumlah', 'Tanggal', 'Dokumen']],
                body: tableData,
                theme: 'grid',
                headStyles: {
                    fillColor: [13, 71, 161],
                    textColor: 255
                },
                styles: {
                    fontSize: 8,
                    cellPadding: 1
                },
                margin: { left: 10, right: 10 }
            });
            
            // Simpan PDF
            doc.save(`Data_Bantuan_BARJAS_${new Date().toISOString().split('T')[0]}.pdf`);
            
            // Tampilkan notifikasi
            showNotification('Ekspor Berhasil', 'Data berhasil diekspor ke PDF', 'success');
        }
        
        // Export semua data
        function exportAllData() {
            // Buat data untuk backup
            const backupData = {
                appData: appData,
                exportedAt: new Date().toISOString(),
                version: '2.1.0'
            };
            
            // Buat blob dan download
            const dataStr = JSON.stringify(backupData, null, 2);
            const dataBlob = new Blob([dataStr], { type: 'application/json' });
            
            const link = document.createElement('a');
            link.href = URL.createObjectURL(dataBlob);
            link.download = `BARJAS_Backup_${new Date().toISOString().split('T')[0]}.json`;
            link.click();
            
            // Tampilkan notifikasi
            showNotification('Backup Berhasil', 'Semua data berhasil dibackup', 'success');
        }
        
        // Backup data
        function backupData() {
            exportAllData();
        }
        
        // Reset data
        function resetData() {
            if (confirm('Apakah Anda yakin ingin menghapus semua data? Tindakan ini tidak dapat dibatalkan.')) {
                appData = [];
                filteredData = [];
                saveToLocalStorage();
                
                // Update UI
                updateDashboard();
                renderDataTable();
                
                // Tampilkan notifikasi
                showNotification('Data Dihapus', 'Semua data telah direset', 'info');
            }
        }
        
        // Tampilkan notifikasi
        function showNotification(title, message, type = 'info') {
            const toast = document.getElementById('notificationToast');
            const toastTitle = document.getElementById('toastTitle');
            const toastMessage = document.getElementById('toastMessage');
            const toastTime = document.getElementById('toastTime');
            
            // Set warna berdasarkan type
            switch (type) {
                case 'success':
                    toast.style.borderLeft = '4px solid #198754';
                    break;
                case 'danger':
                    toast.style.borderLeft = '4px solid #dc3545';
                    break;
                case 'warning':
                    toast.style.borderLeft = '4px solid #ffc107';
                    break;
                default:
                    toast.style.borderLeft = '4px solid #0d6efd';
            }
            
            // Set konten
            toastTitle.textContent = title;
            toastMessage.textContent = message;
            toastTime.textContent = 'Baru saja';
            
            // Tampilkan toast
            const bsToast = new bootstrap.Toast(toast);
            bsToast.show();
        }
        
        // Buka WhatsApp
        function openWhatsApp(number) {
            window.open(`https://wa.me/${number}`, '_blank');
        }
        
        // Edit data
        function editData(id) {
            const data = appData.find(item => item.id === id);
            if (!data) return;
            
            // Isi form dengan data yang dipilih
            document.getElementById('namaPenerima').value = data.nama;
            document.getElementById('nik').value = data.nik;
            document.getElementById('whatsapp').value = data.whatsapp;
            document.getElementById('desa').value = data.desa;
            document.getElementById('jenisBantuan').value = data.jenis;
            document.getElementById('jumlah').value = data.jumlah;
            document.getElementById('tanggal').value = data.tanggal;
            document.getElementById('driveLink').value = data.driveLink || '';
            document.getElementById('keterangan').value = data.keterangan || '';
            
            // Hapus data lama
            deleteData(id, false);
            
            // Scroll ke form
            showSection('inputData');
            document.querySelectorAll('.nav-link').forEach(l => l.classList.remove('active'));
            document.querySelector('[data-bs-target="inputData"]').classList.add('active');
            
            // Tampilkan notifikasi
            showNotification('Edit Data', 'Data siap untuk diedit', 'info');
        }
        
        // Hapus data
        function deleteData(id, showConfirm = true) {
            if (showConfirm && !confirm('Apakah Anda yakin ingin menghapus data ini?')) {
                return;
            }
            
            // Hapus data
            appData = appData.filter(item => item.id !== id);
            filteredData = filteredData.filter(item => item.id !== id);
            
            // Simpan ke localStorage
            saveToLocalStorage();
            
            // Update UI
            renderDataTable();
            updateDashboard();
            
            if (showConfirm) {
                // Tampilkan notifikasi
                showNotification('Data Dihapus', 'Data berhasil dihapus', 'success');
            }
        }
        
        // Fungsi untuk mengatasi masalah Chart.js
        function fixChartIssues() {
            // Pastikan canvas elements ada sebelum membuat chart
            const canvasElements = [
                'desaChart', 'jenisChart', 'trendChart', 
                'desaComparisonChart', 'jenisComparisonChart'
            ];
            
            canvasElements.forEach(id => {
                const canvas = document.getElementById(id);
                if (canvas) {
                    // Pastikan canvas memiliki width dan height yang tepat
                    const parent = canvas.parentElement;
                    if (parent) {
                        canvas.width = parent.clientWidth;
                        canvas.height = parent.clientHeight;
                    }
                }
            });
            
            // Render ulang chart jika diperlukan
            if (charts.desaChart) {
                charts.desaChart.update();
            }
            if (charts.jenisChart) {
                charts.jenisChart.update();
            }
            if (charts.trendChart) {
                charts.trendChart.update();
            }
            if (charts.desaComparisonChart) {
                charts.desaComparisonChart.update();
            }
            if (charts.jenisComparisonChart) {
                charts.jenisComparisonChart.update();
            }
        }
        
        // Panggil fungsi perbaikan chart saat window di-resize
        window.addEventListener('resize', fixChartIssues);
        
        // Panggil juga setelah semua konten dimuat
        setTimeout(fixChartIssues, 1000);
    </script>
</body>
</html>
